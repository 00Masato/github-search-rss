{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This backports <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1794829131\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48693\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48693/hovercard\" href=\"https://github.com/rails/rails/pull/48693\">#48693</a> to <code class=\"notranslate\">7-0-stable</code> branch</p>",
            "url": "https://github.com/rails/rails/pull/48726",
            "title": "[7-0-stable] Backport: Use a consistent format when testing BigDecimal.to_s",
            "date_modified": "2023-07-12T22:16:31.000Z",
            "date_published": "2023-07-12T22:16:27.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/64050?u=e41ff60552c0dcda088e5c5c3ed1e3bf34f37dcc&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">In <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1363537361\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45952\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/45952/hovercard\" href=\"https://github.com/rails/rails/pull/45952\">#45952</a>, a change was made to ActiveSupport to \"accept an optional parameter to specify the types of callbacks that the user would want to run.\" However, the parameter is mandatory. This has broken downstream gems, such as <code class=\"notranslate\">activerecord-import</code>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1469808274\" data-permission-text=\"Title is private\" data-url=\"https://github.com/zdennis/activerecord-import/issues/787\" data-hovercard-type=\"issue\" data-hovercard-url=\"/zdennis/activerecord-import/issues/787/hovercard\" href=\"https://github.com/zdennis/activerecord-import/issues/787\">zdennis/activerecord-import#787</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Rather than fix the issue in the dependencies, I think it would be easier/safer to just set this argument to <code class=\"notranslate\">nil</code>, for backwards compatibility.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48723",
            "title": "Allow `type` to be optional",
            "date_modified": "2023-07-12T20:28:29.000Z",
            "date_published": "2023-07-12T20:28:25.000Z",
            "author": {
                "name": "gjtorikian",
                "url": "https://github.com/gjtorikian"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1530175?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR documents how to handle a couple of common situations with ActiveStorage that I always have to look up.</p>\n<ul dir=\"auto\">\n<li>How to keep existing attachments on a <code class=\"notranslate\">has_many_attached</code> when uploading new ones</li>\n<li>How to retain uploaded files when a form submission fails validation</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48722",
            "title": "Document common ActiveStorage issues",
            "date_modified": "2023-07-12T20:21:11.000Z",
            "date_published": "2023-07-12T19:44:00.000Z",
            "author": {
                "name": "thedanbob",
                "url": "https://github.com/thedanbob"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1798866939\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48712\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48712/hovercard\" href=\"https://github.com/rails/rails/issues/48712\">#48712</a>.</p>\n<p dir=\"auto\">The problem was that <code class=\"notranslate\">.first</code> method call, used in the condition, evaluated lazy enumerator, and thus lead to the problematic behavior.</p>",
            "url": "https://github.com/rails/rails/pull/48720",
            "title": "Fix `Enumerable#sum` for `Enumerator#lazy`",
            "date_modified": "2023-07-12T12:03:05.000Z",
            "date_published": "2023-07-12T12:03:02.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/216?u=72c9aed290b66eff3cb32c44be5718866fc5ce19&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Doc and spec <code class=\"notranslate\">cookies.delete</code> returning the cookie value.</p>\n<p dir=\"auto\">I didn't want to rely on this behaviour since it was undocumented and (AFAIK) untested.</p>",
            "url": "https://github.com/rails/rails/pull/48719",
            "title": "Doc and spec cookies.delete returning the cookie value",
            "date_modified": "2023-07-12T11:09:01.000Z",
            "date_published": "2023-07-12T11:00:58.000Z",
            "author": {
                "name": "henrik",
                "url": "https://github.com/henrik"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/33979976?u=55cb7b791cdb7adf94ee02066347b63c0f835fe3&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #47918.\">Closes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1663004010\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47918\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/47918/hovercard\" href=\"https://github.com/rails/rails/issues/47918\">#47918</a></p>\n<h3 dir=\"auto\">Context</h3>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveStorage::Mirror</code> is really nice to have. However when you define a Mirror service on storage.yml , the upload to the mirror actually happens inline, instead of using <code class=\"notranslate\">ActiveStorage::MirrorJob</code>.</p>\n<p dir=\"auto\">This actually slows down any uploads to the service, because it is performed n times (n being the number of mirrors), inline, instead of using the <code class=\"notranslate\">ActiveStorage::MirrorJob</code>.</p>\n<h3 dir=\"auto\">Fix</h3>\n<p dir=\"auto\">Before this commit, when a file was uploaded to a mirror service, the file upload to each service (primary and mirrors) was happening synchronously:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def upload(key, io, checksum: nil, **options)\n  each_service.collect do |service|\n    io.rewind\n    service.upload key, io, checksum: checksum, **options\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">def</span> <span class=\"pl-en\">upload</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">io</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">checksum</span>: <span class=\"pl-c1\">nil</span><span class=\"pl-kos\">,</span> **<span class=\"pl-s1\">options</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-en\">each_service</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">collect</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">service</span>|\n    <span class=\"pl-s1\">io</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rewind</span>\n    <span class=\"pl-s1\">service</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">upload</span> <span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">io</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">checksum</span>: <span class=\"pl-s1\">checksum</span><span class=\"pl-kos\">,</span> **<span class=\"pl-s1\">options</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">In this commit, we change this behavior to only upload the file to the primary service synchronously and then enqueue a job to upload the file to the mirrors asynchronously.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def upload(key, io, checksum: nil, **options)\n  io.rewind\n  primary.upload key, io, checksum: checksum, **options\n  mirror_later key, checksum: checksum\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">def</span> <span class=\"pl-en\">upload</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">io</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">checksum</span>: <span class=\"pl-c1\">nil</span><span class=\"pl-kos\">,</span> **<span class=\"pl-s1\">options</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-s1\">io</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rewind</span>\n  <span class=\"pl-en\">primary</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">upload</span> <span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">io</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">checksum</span>: <span class=\"pl-s1\">checksum</span><span class=\"pl-kos\">,</span> **<span class=\"pl-s1\">options</span>\n  <span class=\"pl-en\">mirror_later</span> <span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">checksum</span>: <span class=\"pl-s1\">checksum</span>\n<span class=\"pl-k\">end</span></pre></div>",
            "url": "https://github.com/rails/rails/pull/48718",
            "title": "ActiveStorage mirror uploads should be asynchronous",
            "date_modified": "2023-07-11T22:04:43.000Z",
            "date_published": "2023-07-11T21:51:38.000Z",
            "author": {
                "name": "alexandreruban",
                "url": "https://github.com/alexandreruban"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #47582.\">Fix</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1610309214\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47582\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47582/hovercard\" href=\"https://github.com/rails/rails/pull/47582\">#47582</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #796.\">Fix</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1533499111\" data-permission-text=\"Title is private\" data-url=\"https://github.com/bensheldon/good_job/issues/796\" data-hovercard-type=\"issue\" data-hovercard-url=\"/bensheldon/good_job/issues/796/hovercard\" href=\"https://github.com/bensheldon/good_job/issues/796\">bensheldon/good_job#796</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #38577.\">Fix</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"571168840\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/38577\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/38577/hovercard\" href=\"https://github.com/rails/rails/pull/38577\">#38577</a><br>\nMaybe: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1508859778\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46797\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/46797/hovercard\" href=\"https://github.com/rails/rails/issues/46797\">#46797</a> ?</p>\n<p dir=\"auto\">This is mostly a rebase of <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a>'s <a class=\"commit-link\" href=\"https://github.com/rails/rails/compare/main...matthewd:rails:schema-reflection\"><tt>main...matthewd:rails:schema-reflection</tt></a>, I initially went with my own implementation, but it ended up very similar, just less elegant, so I decided to rebase it instead.</p>\n<h3 dir=\"auto\">Context</h3>\n<p dir=\"auto\">A big problem with the current <code class=\"notranslate\">SchemaCache</code> implementation is that it holds a reference to a connection, and uses it to lazily query the schema when the information is missing.</p>\n<p dir=\"auto\">This cause issues in multi-threaded contexts because all the connections of a pool share the same schema, so they are constantly setting themselves as the connection the schema cache should use, and you can end up in situation where Thread#1 query the schema cache, which end up using the connection currently attributed to Thread#2.</p>\n<p dir=\"auto\">For a very long time this worked more or less by accident, because all connection adapters would have an internal Monitor.</p>\n<p dir=\"auto\">However in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1454896644\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46519\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/46519/hovercard\" href=\"https://github.com/rails/rails/pull/46519\">#46519</a> we got rid of this synchronization, revealing the pre-existing issue. Previously it would workâ„¢, but still wasn't ideal because of unexpected the connection sharing between threads.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">The idea here is to refactor the schema cache so that it doesn't hold a reference onto any connection.</p>\n<p dir=\"auto\">And instead of a SchemaCache, connections now have access to a SchemaReflection. Now the connection that needs a schema information is always provided as an argument, so that in case of a miss, it can be used to populate the cache.</p>\n<p dir=\"auto\">That should fix the database thread safety issues that were witnessed.</p>\n<p dir=\"auto\">However note that at this stage, the underlying <code class=\"notranslate\">SchemaCache</code> isn't synchronized, so in case of a race condition, the same schema query can be performed more than once. It could make sense to add synchronization in a followup.</p>",
            "url": "https://github.com/rails/rails/pull/48716",
            "title": "Refactor Active Record Schema Cache to not hold a connection",
            "date_modified": "2023-07-12T22:10:18.000Z",
            "date_published": "2023-07-11T15:58:08.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/92044?u=68c6916605dc9a38a01fc4b0a11d0536fa232be9&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I believe the previous phrasing could be interpreted ambiguously. See discussion in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1799158435\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48713\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48713/hovercard\" href=\"https://github.com/rails/rails/issues/48713\">#48713</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">n/a</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">n/a</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48715",
            "title": "Clarify comment about debug log level.",
            "date_modified": "2023-07-11T15:28:04.000Z",
            "date_published": "2023-07-11T15:27:04.000Z",
            "author": {
                "name": "jcoyne",
                "url": "https://github.com/jcoyne"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/99586?u=b4abd791d83e768c72cb832147b4a210caecf47d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Rails 7 uses Turbo/Stimulus by default. Turbo adds disabled attributes when submitting form (see <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"993156012\" data-permission-text=\"Title is private\" data-url=\"https://github.com/hotwired/turbo/issues/386\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/hotwired/turbo/pull/386/hovercard\" href=\"https://github.com/hotwired/turbo/pull/386\">hotwired/turbo#386</a>). As the PR describes, we can change submission text when form is submitted.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"button                  .show-when-disabled { display: none; }\nbutton[disabled]        .show-when-disabled { display: initial; }\n\nbutton                  .show-when-enabled { display: initial; }\nbutton[disabled]        .show-when-enabled { display: none; }\"><pre class=\"notranslate\"><code class=\"notranslate\">button                  .show-when-disabled { display: none; }\nbutton[disabled]        .show-when-disabled { display: initial; }\n\nbutton                  .show-when-enabled { display: initial; }\nbutton[disabled]        .show-when-enabled { display: none; }\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt;button&gt;\n  &lt;span class=&quot;show-when-enabled&quot;&gt;Submit&lt;/span&gt;\n  &lt;span class=&quot;show-when-disabled&quot;&gt;Submitting...&lt;/span&gt;\n&lt;/button&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">&lt;button&gt;\n  &lt;span class=\"show-when-enabled\"&gt;Submit&lt;/span&gt;\n  &lt;span class=\"show-when-disabled\"&gt;Submitting...&lt;/span&gt;\n&lt;/button&gt;\n</code></pre></div>\n<p dir=\"auto\">This is only possible with the button tag. Because input tag does not allow child elements.</p>\n<p dir=\"auto\">It also seems like that button tags are preferred way nowadays.</p>\n<blockquote>\n<p dir=\"auto\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/button\" rel=\"nofollow\">https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/button</a><br>\nNote: While  elements of type button are still perfectly valid<br>\nHTML, the newer  element is now the favored way to create<br>\nbuttons. Given that a 's label text is inserted between the<br>\nopening and closing tags, you can include HTML in the label, even<br>\nimages.</p><p dir=\"auto\"></p>\n<p></p></blockquote>",
            "url": "https://github.com/rails/rails/pull/48711",
            "title": "Change form template to use button tag",
            "date_modified": "2023-07-11T10:32:31.000Z",
            "date_published": "2023-07-11T10:32:27.000Z",
            "author": {
                "name": "shouichi",
                "url": "https://github.com/shouichi"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/25947043?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Previously, <code class=\"notranslate\">ActionCable::Channel::ConnectionStub</code> would throw a <code class=\"notranslate\">NoMethodError</code> when the channel under test calls <code class=\"notranslate\">stop_stream_for</code>, as shown in the test case below:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire &quot;bundler/inline&quot;\n\ngemfile(true) do\n  source &quot;https://rubygems.org&quot;\n\n  git_source(:github) { |repo| &quot;https://github.com/#{repo}.git&quot; }\n\n  # Activate the gem you are reporting the issue against.\n  gem &quot;actioncable&quot;, &quot;~&gt; 7.0.0&quot;\nend\n\nrequire &quot;minitest/autorun&quot;\nrequire &quot;action_cable&quot;\n\nActionCable.server.config.cable = { &quot;adapter&quot; =&gt; &quot;test&quot; }\n\nclass ChatChannel &lt; ActionCable::Channel::Base\n  def subscribed\n    stream_from &quot;test&quot;\n  end \n\n  def unsubscribed\n    stop_stream_from &quot;test&quot;\n  end \nend\n\nclass ChatChannelTest &lt; ActionCable::Channel::TestCase\n  test &quot;unsubscribe&quot; do\n    stub_connection\n\n    subscribe\n    unsubscribe # raises a NoMethodError\n\n    assert_no_streams\n  end \nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/inline\"</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">\"https://rubygems.org\"</span>\n\n  <span class=\"pl-en\">git_source</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:github</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">repo</span>| <span class=\"pl-s\">\"https://github.com/<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">repo</span><span class=\"pl-kos\">}</span></span>.git\"</span> <span class=\"pl-kos\">}</span>\n\n  <span class=\"pl-c\"># Activate the gem you are reporting the issue against.</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"actioncable\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"~&gt; 7.0.0\"</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"minitest/autorun\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"action_cable\"</span>\n\n<span class=\"pl-v\">ActionCable</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">server</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">cable</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s\">\"adapter\"</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">\"test\"</span> <span class=\"pl-kos\">}</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">ChatChannel</span> &lt; <span class=\"pl-v\">ActionCable</span>::<span class=\"pl-v\">Channel</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">subscribed</span>\n    <span class=\"pl-en\">stream_from</span> <span class=\"pl-s\">\"test\"</span>\n  <span class=\"pl-k\">end</span> \n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">unsubscribed</span>\n    <span class=\"pl-en\">stop_stream_from</span> <span class=\"pl-s\">\"test\"</span>\n  <span class=\"pl-k\">end</span> \n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">ChatChannelTest</span> &lt; <span class=\"pl-v\">ActionCable</span>::<span class=\"pl-v\">Channel</span>::<span class=\"pl-v\">TestCase</span>\n  <span class=\"pl-en\">test</span> <span class=\"pl-s\">\"unsubscribe\"</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-en\">stub_connection</span>\n\n    <span class=\"pl-en\">subscribe</span>\n    <span class=\"pl-en\">unsubscribe</span> <span class=\"pl-c\"># raises a NoMethodError</span>\n\n    <span class=\"pl-en\">assert_no_streams</span>\n  <span class=\"pl-k\">end</span> \n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">This happens because <code class=\"notranslate\">stop_stream_for</code> <a href=\"https://github.com/rails/rails/blob/593893c901f87b4ed205751f72df41519b4d2da3/actioncable/lib/action_cable/channel/streams.rb#L109\">calls <code class=\"notranslate\">pubsub</code> when unsubscribing from a channel</a>, which is missing from the <a href=\"https://github.com/rails/rails/blob/593893c901f87b4ed205751f72df41519b4d2da3/actioncable/lib/action_cable/channel/test_case.rb#L47\"><code class=\"notranslate\">ConnectionStub</code> implementation</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR fixes this issue by assigning the <code class=\"notranslate\">ActionCable.server</code> singleton to a <code class=\"notranslate\">@server</code> instance variable in<br>\n<code class=\"notranslate\">ActionCable::Channel::ConnectionStub</code>.</p>\n<p dir=\"auto\">This lets us delegate the <code class=\"notranslate\">config</code> and <code class=\"notranslate\">pubsub</code> method calls to it, hence fixing the <code class=\"notranslate\">NoMethodError</code> issue.</p>\n<p dir=\"auto\">I updated <code class=\"notranslate\">config</code> to be delegated to <code class=\"notranslate\">@server</code> as well since <a href=\"https://github.com/rails/rails/blob/593893c901f87b4ed205751f72df41519b4d2da3/actioncable/lib/action_cable/server/base.rb#L15\"><code class=\"notranslate\">config</code> defaults to <code class=\"notranslate\">ActionCable::Server::Configuration.new</code></a>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I'm not sure if I should add a changelog entry for this. But, I added it anyway since I feel adding<code class=\"notranslate\">@server = ActionCable.server</code> qualifies as a behavior change.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48706",
            "title": "Delegate `StubConnection#pubsub` and `StubConnection#config` to `ActionCable.server`",
            "date_modified": "2023-07-10T14:15:56.000Z",
            "date_published": "2023-07-10T14:12:44.000Z",
            "author": {
                "name": "julianfssen",
                "url": "https://github.com/julianfssen"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48652.\">Fix</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1788556376\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48652\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48652/hovercard\" href=\"https://github.com/rails/rails/issues/48652\">#48652</a><br>\nRef: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1375121023\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46048\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/46048/hovercard\" href=\"https://github.com/rails/rails/pull/46048\">#46048</a><br>\nRef: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1374793684\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46044\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/46044/hovercard\" href=\"https://github.com/rails/rails/issues/46044\">#46044</a><br>\nRef: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"373279692\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/34303\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/34303/hovercard\" href=\"https://github.com/rails/rails/pull/34303\">#34303</a><br>\nRef: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"613032330\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/39160\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/39160/hovercard\" href=\"https://github.com/rails/rails/pull/39160\">#39160</a></p>\n<p dir=\"auto\">This deep_dup was introduced to prevent the value stored in the query cache to be later mutated.</p>\n<p dir=\"auto\">The problem is that <code class=\"notranslate\">ActiveRecord::Base#dup</code> will return a copy of the record but with the primary key set to nil. One could argue that <code class=\"notranslate\">#dup</code> shouldn't behave this way, but I think this ship has sailed (or has it?).</p>\n<p dir=\"auto\">My initial fix was to instead call <code class=\"notranslate\">type.cast</code> so that we'd dup serialized types in a more correct way. However there is a test that explictly ensure this doesn't happen: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"613032330\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/39160\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/39160/hovercard\" href=\"https://github.com/rails/rails/pull/39160\">#39160</a></p>\n<p dir=\"auto\">The reason isn't 100% clear to me, but if I get it correctly, it's to avoid a potentially costly operation upfront.</p>\n<p dir=\"auto\">So instead we can call <code class=\"notranslate\">deserialize(serialize(value))</code> for serialized attributes only.</p>\n<p dir=\"auto\">This isn't very performant, but honestly it's kind of a miracle this even work. Querying by a serialized attribute is a very weird idea.</p>",
            "url": "https://github.com/rails/rails/pull/48705",
            "title": "Stop deep duping query values of serialized attributes",
            "date_modified": "2023-07-12T14:09:33.000Z",
            "date_published": "2023-07-10T13:41:25.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/380564?u=2c5759e8d2dfc73b598bd6f8baaabbcc1517aa8a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because providing developer friendly security and privacy tooling is so important.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Adding <a href=\"https://github.com/Bearer/bearer\">Bearer</a> open-source tool to the resources section as an alternative to Brakeman. It covers both Ruby and JS code, which is practical for modern Rails application.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This tool is also referenced by OWASP in the <a href=\"https://cheatsheetseries.owasp.org/cheatsheets/Ruby_on_Rails_Cheat_Sheet.html#tools\" rel=\"nofollow\">Rails cheat sheet</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48703",
            "title": "Adding a new resource to the Security documentation",
            "date_modified": "2023-07-12T13:14:59.000Z",
            "date_published": "2023-07-10T11:25:04.000Z",
            "author": {
                "name": "gmontard",
                "url": "https://github.com/gmontard"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54629302?u=be8de5137bf940532cddd05aff823129ab8a39db&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created to update some inconsistent documentation for the public methods  <code class=\"notranslate\">ActiveRecord::QueryMethods#structurally_compatible?</code>, <code class=\"notranslate\">ActiveRecord::QueryMethods#and?</code> and <code class=\"notranslate\">ActiveRecord::QueryMethods#or?</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">In <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"638651790\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/39634\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/39634/hovercard\" href=\"https://github.com/rails/rails/pull/39634\">#39634</a>, <code class=\"notranslate\">#structurally_incompatible_values_for</code> was updated so that a given relation is only considered structurally incompatible to the current relation if it explicitly uses relation value methods that either vary from (eg. joining on a different table) or are not included in the current relation.</p>\n<p dir=\"auto\">The public method <code class=\"notranslate\">#structurally_compatible?</code> was affected by this change but currently has an example in its documentation that is inconsistent with the current functionality:</p>\n<p dir=\"auto\"><strong>Expected:</strong><br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/a5fc471b3f4bbd02e6be38dae023526a49e7d049/activerecord/lib/active_record/relation/query_methods.rb#L1011-L1012\">rails/activerecord/lib/active_record/relation/query_methods.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 1011 to 1012\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/a5fc471b3f4bbd02e6be38dae023526a49e7d049\">a5fc471</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L1011\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1011\"></td>\n          <td id=\"LC1011\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\">#    Post.joins(:comments).structurally_compatible?(Post.where(\"id = 1\"))</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1012\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1012\"></td>\n          <td id=\"LC1012\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\">#    # =&gt; false</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\"><strong>Actual</strong></p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Post.joins(:comments).structurally_compatible?(Post.where(&quot;id = 1&quot;))\n# =&gt; true\"><pre class=\"notranslate\"><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">joins</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:comments</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">structurally_compatible?</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"id = 1\"</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\"># =&gt; true</span></pre></div>\n<p dir=\"auto\">The descriptions for <code class=\"notranslate\">#structurally_compatible?</code>, <code class=\"notranslate\">#and</code> and <code class=\"notranslate\">#or</code> also imply that the two relations need to include the exact same relation value methods, which is no longer true.</p>\n<p dir=\"auto\">This PR simply updates the documentation for these methods so that:</p>\n<ol dir=\"auto\">\n<li>The 'new' functionality is reflected in the descriptions.</li>\n<li>The incorrect result for the example in <code class=\"notranslate\">#structurally_compatible?</code> is fixed.</li>\n</ol>\n<p dir=\"auto\">I've also added 2 more examples to <code class=\"notranslate\">#structurally_compatible?</code> to make the expected output clearer.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">Originally, I opened this issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1795195618\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48694\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48694/hovercard\" href=\"https://github.com/rails/rails/issues/48694\">#48694</a> and a PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1795195618\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48694\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48694/hovercard\" href=\"https://github.com/rails/rails/issues/48694\">#48694</a> to address it by reverting the changes in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"638651790\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/39634\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/39634/hovercard\" href=\"https://github.com/rails/rails/pull/39634\">#39634</a>. However, I concluded that:</p>\n<ul dir=\"auto\">\n<li>The changes and reasoning in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"638651790\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/39634\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/39634/hovercard\" href=\"https://github.com/rails/rails/pull/39634\">#39634</a> make sense in that a majority of the time the given relation will probably just vary by <code class=\"notranslate\">#where</code>. I was a bit on the fence at first cause I felt like consistently raising an error here might prevent unexpected query results and provide a more meaningful error than the ones you might get due to a malformed query (like referencing a table in the given relation that's only been joined to in the current relation), but at the same time I can see how that approach can be considered to be a bit too heavy handed.</li>\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"638651790\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/39634\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/39634/hovercard\" href=\"https://github.com/rails/rails/pull/39634\">#39634</a> was merged 3 years ago and I don't see any other open issues relating to it, so I think it's more reasonable to just update the documentation at this point than to revert the changes in that PR which might result in breaking changes on apps running on edge or when upgrading to the version this commit ends up in.</li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48700",
            "title": "Update inconsistent documentation for `#structurally_compatible?`, `#and` and `#or`",
            "date_modified": "2023-07-10T01:15:26.000Z",
            "date_published": "2023-07-09T21:24:03.000Z",
            "author": {
                "name": "joshuay03",
                "url": "https://github.com/joshuay03"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/15572959?u=524a32c40db55e38d5fd9b1e6920e2a157998a12&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR fixes <code class=\"notranslate\">AbstractController#internal_methods</code> to exclude <code class=\"notranslate\">action_methods</code>.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I tried enabling <a href=\"https://github.com/rails/rails/pull/43487\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/43487/hovercard\"><code class=\"notranslate\">raise_on_missing_callback_actions</code></a> and I found out that <code class=\"notranslate\">MyController#action_methods</code> is missing a method that <code class=\"notranslate\">MyController</code> actually defines. It only happens when a method is also defined by an ancestor abstract controller.</p>\n<p dir=\"auto\">xref <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1769404472\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48559\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48559/hovercard?comment_id=1624321279&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/pull/48559#issuecomment-1624321279\">#48559 (comment)</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48699",
            "title": "AbstractController#internal_methods: ignore action_methods",
            "date_modified": "2023-07-10T17:11:50.000Z",
            "date_published": "2023-07-09T19:03:22.000Z",
            "author": {
                "name": "kamil-gwozdz",
                "url": "https://github.com/kamil-gwozdz"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/47554?u=7f919feee43d319ec01c7b135f4d1868a31bddc3&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">Rails has some configuration options that explicitly type-check on <code class=\"notranslate\">Proc</code> instead of allowing duck-typing. This PR introduces <code class=\"notranslate\">ActiveSupport::Callable</code> which case-equals any object that responds to <code class=\"notranslate\">call</code>.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class CustomQueryWarningsAction\n  def self.call\n    new.very_complex_method\n  end\n  # ....\nend\n\n# This PR allows this:\nconfig.active_record.db_warnings_action = CustomQueryWarningsAction\n\n# ...instead of previously requiring this:\nconfig.active_record.db_warnings_action = CustomQueryWarningsAction.method(:call).to_proc\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">CustomQueryWarningsAction</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">call</span>\n    <span class=\"pl-en\">new</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">very_complex_method</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-c\"># ....</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-c\"># This PR allows this:</span>\n<span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_record</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">db_warnings_action</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">CustomQueryWarningsAction</span>\n\n<span class=\"pl-c\"># ...instead of previously requiring this:</span>\n<span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_record</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">db_warnings_action</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">CustomQueryWarningsAction</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">method</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:call</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_proc</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48691",
            "title": "Create an `ActiveSupport::Callable` object to do case-equality with objects that implement `#call`",
            "date_modified": "2023-07-07T23:41:56.000Z",
            "date_published": "2023-07-07T23:12:18.000Z",
            "author": {
                "name": "bensheldon",
                "url": "https://github.com/bensheldon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/58582?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created to <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48685.\">fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1793527161\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48685\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48685/hovercard\" href=\"https://github.com/rails/rails/issues/48685\">#48685</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">[<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48685.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1793527161\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48685\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48685/hovercard\" href=\"https://github.com/rails/rails/issues/48685\">#48685</a>] Make the encryptor agnostic of the type of data to decrypt</p>\n<p dir=\"auto\">The default message serializer will raise a <code class=\"notranslate\">TypeError</code> when invoking <code class=\"notranslate\">JSON.parse</code> on any non-<code class=\"notranslate\">String</code> input. This error will subsequently be translated into an <code class=\"notranslate\">ActiveRecord::Encryption::Errors::Encoding</code> error and then a <code class=\"notranslate\">ActiveRecord::Encryption::Errors::Decryption</code> error by the encryptor, which does not change the current behavior at the encryptor level.</p>\n<p dir=\"auto\">This change clarifies that it is the role of the underlying serializer to accept or reject the data to decrypt depending on its type. This behavior mirrors what is done at encryption, where the serializer asserts that the input is an <code class=\"notranslate\">ActiveRecord::Encryption::Message</code>.</p>\n<p dir=\"auto\">This change is a no-op when using the default <code class=\"notranslate\">MessageSerializer</code> class, but it enables the use a wider variety of custom serializers.</p>\n<p dir=\"auto\">By being agnostic of the type of data to decrypt at the encryptor level, it is now possible to serialize and store messages in a binary format (e.g. in a <code class=\"notranslate\">bytea</code> column in PostgreSQL). A custom message serializer is now able to decrypt binary values coming from the database (<code class=\"notranslate\">String</code>) or from user input (<code class=\"notranslate\">ActiveModel::Type::Binary::Data</code>) without having an exception raised at the encryptor level because the type is not <code class=\"notranslate\">String</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48686",
            "title": "[Fix #48685] Make the encryptor agnostic of the type of data to decrypt",
            "date_modified": "2023-07-07T20:30:26.000Z",
            "date_published": "2023-07-07T13:18:03.000Z",
            "author": {
                "name": "maximerety",
                "url": "https://github.com/maximerety"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">The goal is to raise an exception when calling <code class=\"notranslate\">create_association</code> which would replace an already persisted association.</p>\n<p dir=\"auto\">Here is a failing test report as well:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire &quot;bundler/inline&quot;\n\ngemfile(true) do\n  source &quot;https://rubygems.org&quot;\n\n  gem &quot;rails&quot;, github: &quot;rails/rails&quot;, branch: &quot;main&quot;\n  gem &quot;sqlite3&quot;\nend\n\nrequire &quot;active_record&quot;\nrequire &quot;active_support/testing/assertions&quot;\nrequire &quot;minitest/autorun&quot;\nrequire &quot;logger&quot;\n\n# This connection will do for database-independent bug reports.\nActiveRecord::Base.establish_connection(adapter: &quot;sqlite3&quot;, database: &quot;:memory:&quot;)\nActiveRecord::Base.logger = Logger.new(STDOUT)\n\nActiveRecord::Schema.define do\n  create_table :authors, force: true\n\n  create_table :books, force: true do |t|\n    t.integer :author_id\n  end\nend\n\nclass Author &lt; ActiveRecord::Base\n  has_one :book\nend\n\nclass Book &lt; ActiveRecord::Base\n  belongs_to :author\n  validates :author_id, uniqueness: true\nend\n\nclass BugTest &lt; Minitest::Test\n  include ActiveSupport::Testing::Assertions\n\n  def test_association_stuff\n    author = Author.create!\n    author.create_book!\n\n    assert_no_difference -&gt; { Book.count } do\n      assert_raises ActiveRecord::RecordNotSaved do\n        author.create_book!\n      end\n    end\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/inline\"</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">\"https://rubygems.org\"</span>\n\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"rails\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">github</span>: <span class=\"pl-s\">\"rails/rails\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">branch</span>: <span class=\"pl-s\">\"main\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"sqlite3\"</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_record\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/testing/assertions\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"minitest/autorun\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"logger\"</span>\n\n<span class=\"pl-c\"># This connection will do for database-independent bug reports.</span>\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">establish_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">adapter</span>: <span class=\"pl-s\">\"sqlite3\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">database</span>: <span class=\"pl-s\">\":memory:\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Schema</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">define</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:authors</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span>\n\n  <span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:books</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">integer</span> <span class=\"pl-pds\">:author_id</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Author</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">has_one</span> <span class=\"pl-pds\">:book</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Book</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:author</span>\n  <span class=\"pl-en\">validates</span> <span class=\"pl-pds\">:author_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">uniqueness</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">BugTest</span> &lt; <span class=\"pl-v\">Minitest</span>::<span class=\"pl-v\">Test</span>\n  <span class=\"pl-en\">include</span> <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">Testing</span>::<span class=\"pl-v\">Assertions</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_association_stuff</span>\n    <span class=\"pl-s1\">author</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Author</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create!</span>\n    <span class=\"pl-s1\">author</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create_book!</span>\n\n    <span class=\"pl-en\">assert_no_difference</span> <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-v\">Book</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">count</span> <span class=\"pl-kos\">}</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-en\">assert_raises</span> <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">RecordNotSaved</span> <span class=\"pl-k\">do</span>\n        <span class=\"pl-s1\">author</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create_book!</span>\n      <span class=\"pl-k\">end</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>",
            "url": "https://github.com/rails/rails/pull/48683",
            "title": "HasOne `create_association` should raise if association already exists",
            "date_modified": "2023-07-12T01:07:02.000Z",
            "date_published": "2023-07-07T06:13:00.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8207?u=519e0cd2eb38c2b5c30ce471f5801c3b77b37f31&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><g-emoji class=\"g-emoji\" alias=\"warning\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/26a0.png\">âš </g-emoji> NOTE: this PR is dependent upon <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1792114069\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails-dom-testing/issues/109\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails-dom-testing/pull/109/hovercard\" href=\"https://github.com/rails/rails-dom-testing/pull/109\">rails/rails-dom-testing#109</a></p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Some early users of Rails edge reported test breakage due to the change in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1764190810\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48523\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48523/hovercard\" href=\"https://github.com/rails/rails/pull/48523\">#48523</a> that updated test helpers to use Nokogiri's HTML5 parser.</p>\n<p dir=\"auto\">After discussing with Rafael, he suggested that we introduce a Rails config parameter so users may opt into this change at their convenience, essentially wrapping a config param around the changes in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1764190810\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48523\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48523/hovercard\" href=\"https://github.com/rails/rails/pull/48523\">#48523</a>.</p>\n<p dir=\"auto\">This PR takes that idea a step further and groups all the test helpers from <code class=\"notranslate\">ActionView::TestCase</code>, <code class=\"notranslate\">ActionDispatch::Assertions</code>, and everything in <code class=\"notranslate\">Rails::Dom::Testing</code> under a single config param:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"config.dom_testing_default_html_version\"><pre class=\"notranslate\"><code class=\"notranslate\">config.dom_testing_default_html_version\n</code></pre></div>\n<p dir=\"auto\">As a result, by setting this config to either <code class=\"notranslate\">:html4</code> or <code class=\"notranslate\">:html5</code>, a developer can control the HTML parser used by all the test helpers in Action View, Action Dispatch, and Rails::Dom::Testing; and some assertions support overriding that default for individual tests.</p>\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>new config parameter <code class=\"notranslate\">config.dom_testing_default_html_version</code>, which is injected into <code class=\"notranslate\">Dom::Rails::Testing</code> via the railstie in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1792114069\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails-dom-testing/issues/109\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails-dom-testing/pull/109/hovercard\" href=\"https://github.com/rails/rails-dom-testing/pull/109\">rails/rails-dom-testing#109</a>\n<ul dir=\"auto\">\n<li>the value of that param is <code class=\"notranslate\">:html5</code> in Rails 7.1, and <code class=\"notranslate\">:html4</code> in earlier config versions</li>\n<li>though, on JRuby, where Nokogiri::HTML5 is not supported, this will always be <code class=\"notranslate\">:html4</code></li>\n</ul>\n</li>\n<li>Action View and Dispatch test helpers use <code class=\"notranslate\">Rails::Dom::Testing.html_document</code> or <code class=\"notranslate\">.html_document_fragment</code> to ensure the desired HTML parser is used</li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">If and when <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1792114069\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails-dom-testing/issues/109\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails-dom-testing/pull/109/hovercard\" href=\"https://github.com/rails/rails-dom-testing/pull/109\">rails/rails-dom-testing#109</a> is merged and a new version is cut, then this PR should be updated to require that new version (presumably <code class=\"notranslate\">~&gt;2.2</code>).</p>\n<p dir=\"auto\">Note that integration testing across gems like this is challenging, but I have actually fired up a Rails app using this PR and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1792114069\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails-dom-testing/issues/109\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails-dom-testing/pull/109/hovercard\" href=\"https://github.com/rails/rails-dom-testing/pull/109\">rails/rails-dom-testing#109</a> together, and it worked as expected.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48682",
            "title": "Introduce `config.dom_testing_default_html_version` and use Rails::Dom::Testing to parse HTML in test helpers",
            "date_modified": "2023-07-09T01:42:10.000Z",
            "date_published": "2023-07-06T20:03:36.000Z",
            "author": {
                "name": "flavorjones",
                "url": "https://github.com/flavorjones"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/129938?u=7637e813584057fbf1a3fa83dca8b4d444c16f79&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1765439665\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48530\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48530/hovercard\" href=\"https://github.com/rails/rails/pull/48530\">#48530</a> introduced a problem for the system that extends AR queries involving deterministically encrypted attributes. The problem is that this option added the same \"previous scheme\" for all the attributes, when the only intended ones were the \"non deterministic\" ones. A side effect of this is that, when encrypting query param values, it was using the wrong encryption scheme.</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48204.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1707228995\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48204\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48204/hovercard?comment_id=1623301440&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/issues/48204#issuecomment-1623301440\">#48204 (comment)</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48676",
            "title": "Fix queries for deterministically encrypted attributed for data migrated from 7.0",
            "date_modified": "2023-07-07T14:06:49.000Z",
            "date_published": "2023-07-06T10:45:43.000Z",
            "author": {
                "name": "jorgemanrubia",
                "url": "https://github.com/jorgemanrubia"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/347652?u=211403a9eea104300ae30c2b63600214c7180e80&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created to resolve race conditions in threaded code when loading instances of <code class=\"notranslate\">CollectionAssociation</code> on an object which is shared across threads, as described in issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1790337154\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48671\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48671/hovercard\" href=\"https://github.com/rails/rails/issues/48671\">#48671</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the implementation of two methods to prevent them from mutating an instance variable in ways that would violate the expectations of other methods which rely on the state of that variable.</p>\n<p dir=\"auto\">Specifically, in the current state, the instance variable <code class=\"notranslate\">@target</code> is:</p>\n<ol dir=\"auto\">\n<li>Initialized as <code class=\"notranslate\">nil</code>, then subsequently reinitialized to an empty array (many methods depend on it being enumerable and will raise errors if called during the window of time in which it is <code class=\"notranslate\">nil</code>)</li>\n<li>Mutated by calling <code class=\"notranslate\">delete</code> on each of its elements prior to overwriting it with a new value (creating a window of time where it contains partial data or no data)</li>\n</ol>\n<p dir=\"auto\">Both of these situations present a race condition when the object is shared by multiple threads.</p>\n<p dir=\"auto\">The changes in this pull request:</p>\n<ol dir=\"auto\">\n<li>Resolve the first issue by replacing a call to <code class=\"notranslate\">super</code> with explicit initializations appropriate to the subclass</li>\n<li>Resolve the second issue by replacing the call to <code class=\"notranslate\">delete</code> with an index lookup, which makes the reassignment behavior atomic.</li>\n</ol>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\"><strong>Performance</strong>: the array lookup in <code class=\"notranslate\">merge_target_lists</code> could be done in other ways; the <code class=\"notranslate\">index</code> lookup measures at least as fast as <code class=\"notranslate\">delete</code> on my hardware; other approaches using enumerable methods like <code class=\"notranslate\">detect</code> would be slower.</p>\n<p dir=\"auto\"><strong>Testing:</strong> although the linked issue includes a test script that can demonstrate the problem, the nature of it is timing-dependent in a way that makes it difficult to write explicit tests to reproduce, and the changes are straightforward. I think that a lack of regression in existing tests should be sufficient verification.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> <del>Tests are added or updated if you fix a bug or add a feature.</del></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> <del>CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</del></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48672",
            "title": "Refactor CollectionAssociation to improve thread-safety; Fixes #48671",
            "date_modified": "2023-07-11T14:24:44.000Z",
            "date_published": "2023-07-05T21:22:38.000Z",
            "author": {
                "name": "mullican",
                "url": "https://github.com/mullican"
            }
        }
    ]
}