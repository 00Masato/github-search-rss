{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/347652?u=211403a9eea104300ae30c2b63600214c7180e80&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created to resolve race conditions in threaded code when loading instances of <code class=\"notranslate\">CollectionAssociation</code> on an object which is shared across threads.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the implementation of two methods to prevent them from mutating an instance variable in ways that violate the expectations of methods which rely on that variable.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The array lookup in <code class=\"notranslate\">merge_target_lists</code> could be done in other ways; the <code class=\"notranslate\">index</code> lookup appears at least as fast as <code class=\"notranslate\">delete</code> on my hardware; other approaches using enumerable methods would be slower.</p>\n<p dir=\"auto\">The nature of the issue is timing-dependent in a way that would make it difficult to write explicit tests to reproduce; I think that a lack of regression in existing tests would be sufficient verification.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> <del>Tests are added or updated if you fix a bug or add a feature.</del></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> <del>CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</del></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48672",
            "title": "Refactor CollectionAssociation to improve thread-safety; Fixes #48671",
            "date_modified": "2023-07-05T21:22:42.000Z",
            "date_published": "2023-07-05T21:22:38.000Z",
            "author": {
                "name": "mullican",
                "url": "https://github.com/mullican"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/131752?u=32ddf1119b1d189c9bd241a721b36ea01c29f61e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This improves <code class=\"notranslate\">.to_json</code> performance to be another ~2x faster (now ~4.5 faster than Rails 7.0)</p>\n<p dir=\"auto\">In this case (likely not others!), running <code class=\"notranslate\">gsub!</code> 5 times with string arguments seems to be faster than running it once with a regex and Hash.</p>\n<p dir=\"auto\">When there are matches to the regex (there are characters to escape) this is faster in part because CRuby will allocate a new match object and string as a key to lookup in the map hash provided. It's possible that could be optimized upstream, but at the moment this avoids those allocations.</p>\n<p dir=\"auto\">Surprisingly (at least to me) this is still much faster when there is no replacement needed: in my test ~3x faster on a short ~200 byte string, and ~5x faster on a pre-escaped ~600k twitter.json.</p>\n<h2 dir=\"auto\">Benchmarks</h2>\n<h3 dir=\"auto\">Just escaping</h3>\n<details>\n<summary>script</summary>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"require &quot;rails/all&quot;\nrequire &quot;benchmark/ips&quot;\nrequire &quot;json_escape&quot;\n\n\nsource_file = ENV[&quot;FILE&quot;] || &quot;twitter.json&quot;\njson = File.read(source_file).freeze\n\nESCAPED_CHARS = {\n  &quot;\\u2028&quot; =&gt; '\\u2028',\n  &quot;\\u2029&quot; =&gt; '\\u2029',\n  &quot;&gt;&quot;      =&gt; '\\u003e',\n  &quot;&lt;&quot;      =&gt; '\\u003c',\n  &quot;&amp;&quot;      =&gt; '\\u0026',\n}\n\nescaped_json = json.gsub(/[\\u2028\\u2029&gt;&lt;&amp;]/u, ESCAPED_CHARS).freeze\n\nBenchmark.ips do |x|\n  x.report(&quot;original&quot;) do\n    s = json.dup\n    s.gsub!(/[\\u2028\\u2029&gt;&lt;&amp;]/u, ESCAPED_CHARS)\n  end\n  x.report(&quot;original (noop)&quot;) do\n    s = escaped_json.dup\n    s.gsub!(/[\\u2028\\u2029&gt;&lt;&amp;]/u, ESCAPED_CHARS)\n  end\n  x.report(&quot;gsub(str) x 5&quot;) do\n    s = json.dup\n    s.gsub!(&quot;&gt;&quot;, '\\u003e')\n    s.gsub!(&quot;&lt;&quot;, '\\u003c')\n    s.gsub!(&quot;&amp;&quot;, '\\u0026')\n    s.gsub!(&quot;\\u2028&quot;, '\\u2028')\n    s.gsub!(&quot;\\u2029&quot;, '\\u2029')\n  end\n  x.report(&quot;gsub(str) x 5 (noop)&quot;) do\n    s = escaped_json.dup\n    s.gsub!(&quot;&gt;&quot;, '\\u003e')\n    s.gsub!(&quot;&lt;&quot;, '\\u003c')\n    s.gsub!(&quot;&amp;&quot;, '\\u0026')\n    s.gsub!(&quot;\\u2028&quot;, '\\u2028')\n    s.gsub!(&quot;\\u2029&quot;, '\\u2029')\n  end\n  x.report(&quot;gsub(ascii_re) + gsub(utf8)&quot;) do\n    s = json.dup\n    s.gsub!(/[&lt;&gt;&amp;]/, ESCAPED_CHARS)\n    s.gsub!(&quot;\\u2028&quot;, '\\u2028')\n    s.gsub!(&quot;\\u2029&quot;, '\\u2029')\n  end\n  x.report(&quot;gsub(ascii_re) + gsub(utf8) (noop)&quot;) do\n    s = escaped_json.dup\n    s.gsub!(/[&lt;&gt;&amp;]/, ESCAPED_CHARS)\n    s.gsub!(&quot;\\u2028&quot;, '\\u2028')\n    s.gsub!(&quot;\\u2029&quot;, '\\u2029')\n  end\n  x.report(&quot;json_escape gem&quot;) do\n    JsonEscape.json_escape(json)\n  end\n  x.compare!\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">require</span> <span class=\"pl-s\">\"rails/all\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"benchmark/ips\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"json_escape\"</span>\n\n\n<span class=\"pl-s1\">source_file</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"FILE\"</span><span class=\"pl-kos\">]</span> || <span class=\"pl-s\">\"twitter.json\"</span>\n<span class=\"pl-s1\">json</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">File</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">read</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">source_file</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">freeze</span>\n\n<span class=\"pl-c1\">ESCAPED_CHARS</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2028</span>\"</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">'\\u2028'</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2029</span>\"</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">'\\u2029'</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-s\">\"&gt;\"</span>      <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">'\\u003e'</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-s\">\"&lt;\"</span>      <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">'\\u003c'</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-s\">\"&amp;\"</span>      <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">'\\u0026'</span><span class=\"pl-kos\">,</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-s1\">escaped_json</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/[<span class=\"pl-cce\">\\u2028</span><span class=\"pl-cce\">\\u2029</span>&gt;&lt;&amp;]/u</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">ESCAPED_CHARS</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">freeze</span>\n\n<span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"original\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">s</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/[<span class=\"pl-cce\">\\u2028</span><span class=\"pl-cce\">\\u2029</span>&gt;&lt;&amp;]/u</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">ESCAPED_CHARS</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"original (noop)\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">s</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">escaped_json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/[<span class=\"pl-cce\">\\u2028</span><span class=\"pl-cce\">\\u2029</span>&gt;&lt;&amp;]/u</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">ESCAPED_CHARS</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"gsub(str) x 5\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">s</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"&gt;\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u003e'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"&lt;\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u003c'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"&amp;\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u0026'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2028</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2028'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2029</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2029'</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"gsub(str) x 5 (noop)\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">s</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">escaped_json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"&gt;\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u003e'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"&lt;\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u003c'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"&amp;\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u0026'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2028</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2028'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2029</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2029'</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"gsub(ascii_re) + gsub(utf8)\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">s</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/[&lt;&gt;&amp;]/</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">ESCAPED_CHARS</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2028</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2028'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2029</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2029'</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"gsub(ascii_re) + gsub(utf8) (noop)\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">s</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">escaped_json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/[&lt;&gt;&amp;]/</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">ESCAPED_CHARS</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2028</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2028'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2029</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2029'</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"json_escape gem\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-v\">JsonEscape</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">json_escape</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">json</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">compare!</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\"><code class=\"notranslate\">short.json</code> is</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{&quot;locale&quot;:&quot;en&quot;,&quot;featureFlags&quot;:[&quot;redactedredactedredact&quot;,&quot;redactedredactedredac&quot;,&quot;redactedredactedre&quot;,&quot;redactedredactedred&quot;,&quot;redactedredact&quot;,&quot;redactedredactedredacted&quot;,&quot;redactedredactedredactedr&quot;]}\"><pre class=\"notranslate\"><code class=\"notranslate\">{\"locale\":\"en\",\"featureFlags\":[\"redactedredactedredact\",\"redactedredactedredac\",\"redactedredactedre\",\"redactedredactedred\",\"redactedredact\",\"redactedredactedredacted\",\"redactedredactedredactedr\"]}\n</code></pre></div>\n</details>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ FILE=twitter.json be ruby benchmark_escaping2.rb\nWarming up --------------------------------------\n            original     9.000  i/100ms\n     original (noop)    10.000  i/100ms\n       gsub(str) x 5    44.000  i/100ms\ngsub(str) x 5 (noop)   229.000  i/100ms\ngsub(ascii_re) + gsub(utf8)\n                        25.000  i/100ms\ngsub(ascii_re) + gsub(utf8) (noop)\n                        32.000  i/100ms\n     json_escape gem   919.000  i/100ms\nCalculating -------------------------------------\n            original     94.573  (± 0.0%) i/s -    477.000  in   5.043877s\n     original (noop)    100.715  (± 0.0%) i/s -    510.000  in   5.063885s\n       gsub(str) x 5    496.012  (± 7.9%) i/s -      2.464k in   5.002329s\ngsub(str) x 5 (noop)      2.302k (± 0.7%) i/s -     11.679k in   5.074632s\ngsub(ascii_re) + gsub(utf8)\n                        257.878  (± 0.8%) i/s -      1.300k in   5.041332s\ngsub(ascii_re) + gsub(utf8) (noop)\n                        321.248  (± 0.6%) i/s -      1.632k in   5.080333s\n     json_escape gem      8.958k (± 0.3%) i/s -     45.031k in   5.026965s\n\nComparison:\n     json_escape gem:     8958.0 i/s\ngsub(str) x 5 (noop):     2301.5 i/s - 3.89x  slower\n       gsub(str) x 5:      496.0 i/s - 18.06x  slower\ngsub(ascii_re) + gsub(utf8) (noop):      321.2 i/s - 27.88x  slower\ngsub(ascii_re) + gsub(utf8):      257.9 i/s - 34.74x  slower\n     original (noop):      100.7 i/s - 88.94x  slower\n            original:       94.6 i/s - 94.72x  slower\"><pre class=\"notranslate\"><code class=\"notranslate\">$ FILE=twitter.json be ruby benchmark_escaping2.rb\nWarming up --------------------------------------\n            original     9.000  i/100ms\n     original (noop)    10.000  i/100ms\n       gsub(str) x 5    44.000  i/100ms\ngsub(str) x 5 (noop)   229.000  i/100ms\ngsub(ascii_re) + gsub(utf8)\n                        25.000  i/100ms\ngsub(ascii_re) + gsub(utf8) (noop)\n                        32.000  i/100ms\n     json_escape gem   919.000  i/100ms\nCalculating -------------------------------------\n            original     94.573  (± 0.0%) i/s -    477.000  in   5.043877s\n     original (noop)    100.715  (± 0.0%) i/s -    510.000  in   5.063885s\n       gsub(str) x 5    496.012  (± 7.9%) i/s -      2.464k in   5.002329s\ngsub(str) x 5 (noop)      2.302k (± 0.7%) i/s -     11.679k in   5.074632s\ngsub(ascii_re) + gsub(utf8)\n                        257.878  (± 0.8%) i/s -      1.300k in   5.041332s\ngsub(ascii_re) + gsub(utf8) (noop)\n                        321.248  (± 0.6%) i/s -      1.632k in   5.080333s\n     json_escape gem      8.958k (± 0.3%) i/s -     45.031k in   5.026965s\n\nComparison:\n     json_escape gem:     8958.0 i/s\ngsub(str) x 5 (noop):     2301.5 i/s - 3.89x  slower\n       gsub(str) x 5:      496.0 i/s - 18.06x  slower\ngsub(ascii_re) + gsub(utf8) (noop):      321.2 i/s - 27.88x  slower\ngsub(ascii_re) + gsub(utf8):      257.9 i/s - 34.74x  slower\n     original (noop):      100.7 i/s - 88.94x  slower\n            original:       94.6 i/s - 94.72x  slower\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ FILE=short.json be ruby benchmark_escaping2.rb\nWarming up --------------------------------------\n            original    26.846k i/100ms\n     original (noop)    27.998k i/100ms\n       gsub(str) x 5    82.923k i/100ms\ngsub(str) x 5 (noop)    83.683k i/100ms\ngsub(ascii_re) + gsub(utf8)\n                       103.509k i/100ms\ngsub(ascii_re) + gsub(utf8) (noop)\n                       103.445k i/100ms\n     json_escape gem     1.424M i/100ms\nCalculating -------------------------------------\n            original    279.761k (± 1.6%) i/s -      1.423M in   5.087410s\n     original (noop)    279.118k (± 2.1%) i/s -      1.400M in   5.017966s\n       gsub(str) x 5    835.196k (± 0.5%) i/s -      4.229M in   5.063709s\ngsub(str) x 5 (noop)    832.362k (± 0.9%) i/s -      4.184M in   5.027225s\ngsub(ascii_re) + gsub(utf8)\n                          1.028M (± 0.7%) i/s -      5.175M in   5.035134s\ngsub(ascii_re) + gsub(utf8) (noop)\n                          1.032M (± 0.5%) i/s -      5.172M in   5.014163s\n     json_escape gem     14.476M (± 0.7%) i/s -     72.617M in   5.016768s\n\nComparison:\n     json_escape gem: 14475588.1 i/s\ngsub(ascii_re) + gsub(utf8) (noop):  1031551.3 i/s - 14.03x  slower\ngsub(ascii_re) + gsub(utf8):  1027913.4 i/s - 14.08x  slower\n       gsub(str) x 5:   835196.3 i/s - 17.33x  slower\ngsub(str) x 5 (noop):   832361.5 i/s - 17.39x  slower\n            original:   279761.3 i/s - 51.74x  slower\n     original (noop):   279117.6 i/s - 51.86x  slower\"><pre class=\"notranslate\"><code class=\"notranslate\">$ FILE=short.json be ruby benchmark_escaping2.rb\nWarming up --------------------------------------\n            original    26.846k i/100ms\n     original (noop)    27.998k i/100ms\n       gsub(str) x 5    82.923k i/100ms\ngsub(str) x 5 (noop)    83.683k i/100ms\ngsub(ascii_re) + gsub(utf8)\n                       103.509k i/100ms\ngsub(ascii_re) + gsub(utf8) (noop)\n                       103.445k i/100ms\n     json_escape gem     1.424M i/100ms\nCalculating -------------------------------------\n            original    279.761k (± 1.6%) i/s -      1.423M in   5.087410s\n     original (noop)    279.118k (± 2.1%) i/s -      1.400M in   5.017966s\n       gsub(str) x 5    835.196k (± 0.5%) i/s -      4.229M in   5.063709s\ngsub(str) x 5 (noop)    832.362k (± 0.9%) i/s -      4.184M in   5.027225s\ngsub(ascii_re) + gsub(utf8)\n                          1.028M (± 0.7%) i/s -      5.175M in   5.035134s\ngsub(ascii_re) + gsub(utf8) (noop)\n                          1.032M (± 0.5%) i/s -      5.172M in   5.014163s\n     json_escape gem     14.476M (± 0.7%) i/s -     72.617M in   5.016768s\n\nComparison:\n     json_escape gem: 14475588.1 i/s\ngsub(ascii_re) + gsub(utf8) (noop):  1031551.3 i/s - 14.03x  slower\ngsub(ascii_re) + gsub(utf8):  1027913.4 i/s - 14.08x  slower\n       gsub(str) x 5:   835196.3 i/s - 17.33x  slower\ngsub(str) x 5 (noop):   832361.5 i/s - 17.39x  slower\n            original:   279761.3 i/s - 51.74x  slower\n     original (noop):   279117.6 i/s - 51.86x  slower\n</code></pre></div>\n<p dir=\"auto\"><code class=\"notranslate\">json_escape</code> is the same escaping implemented in C (please don't use this gem, if it's something we need we should find a different home for it)</p>\n<p dir=\"auto\">On a short string, performing the ASCII portion of escaping as a regex and then the unicode portion as strings seems optimal, but it's not that much faster than the 5 gsub! approach, so I stick with that for simplicity and for the significantly better performance on long strings.</p>\n<h3 dir=\"auto\">to_json</h3>\n<p dir=\"auto\">Using the same benchmark as <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1781582685\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48614\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48614/hovercard\" href=\"https://github.com/rails/rails/pull/48614\">#48614</a>. <code class=\"notranslate\">JSON.generate</code> and <code class=\"notranslate\">RapidJSON.generate</code> are for scale, they don't perform the extra escaping described here.</p>\n<p dir=\"auto\"><strong>Before:</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Calculating -------------------------------------\n source_data.to_json     74.671  (± 1.3%) i/s -    378.000  in   5.062521s\nsource_data_sym.to_json\n                         76.969  (± 0.0%) i/s -    385.000  in   5.002087s\nJSON.generate(source_data)\n                        576.164  (± 1.2%) i/s -      2.916k in   5.061908s\nRapidJSON.generate(source_data)\n                        852.714  (± 3.2%) i/s -      4.316k in   5.067053s\"><pre class=\"notranslate\"><code class=\"notranslate\">Calculating -------------------------------------\n source_data.to_json     74.671  (± 1.3%) i/s -    378.000  in   5.062521s\nsource_data_sym.to_json\n                         76.969  (± 0.0%) i/s -    385.000  in   5.002087s\nJSON.generate(source_data)\n                        576.164  (± 1.2%) i/s -      2.916k in   5.061908s\nRapidJSON.generate(source_data)\n                        852.714  (± 3.2%) i/s -      4.316k in   5.067053s\n</code></pre></div>\n<p dir=\"auto\"><strong>After:</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Calculating -------------------------------------\n source_data.to_json    142.762  (± 2.1%) i/s -    715.000  in   5.010974s\nsource_data_sym.to_json\n                        150.613  (± 2.0%) i/s -    756.000  in   5.021137s\nJSON.generate(source_data)\n                        575.412  (± 1.0%) i/s -      2.915k in   5.066603s\nRapidJSON.generate(source_data)\n                        873.174  (± 2.9%) i/s -      4.368k in   5.006853s\"><pre class=\"notranslate\"><code class=\"notranslate\">Calculating -------------------------------------\n source_data.to_json    142.762  (± 2.1%) i/s -    715.000  in   5.010974s\nsource_data_sym.to_json\n                        150.613  (± 2.0%) i/s -    756.000  in   5.021137s\nJSON.generate(source_data)\n                        575.412  (± 1.0%) i/s -      2.915k in   5.066603s\nRapidJSON.generate(source_data)\n                        873.174  (± 2.9%) i/s -      4.368k in   5.006853s\n</code></pre></div>\n<p dir=\"auto\">About 2x faster than <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1781582685\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48614\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48614/hovercard\" href=\"https://github.com/rails/rails/pull/48614\">#48614</a> and 4.5x faster than Rails 7.0.</p>\n<h2 dir=\"auto\">Next?</h2>\n<p dir=\"auto\">This is much faster but escaping still has an impact on performance (though it's no longer the majority). One thing we could do is rewrite the escaping in a C extension (ideally upstreaming it into a standard library). However I think first we need to confirm that this is really how we should be escaping in 2023 and beyond.</p>\n<p dir=\"auto\"><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a> and I looked into this and we may only need to escape <a href=\"https://html.spec.whatwg.org/multipage/scripting.html#restrictions-for-contents-of-script-elements\" rel=\"nofollow\"><code class=\"notranslate\">&lt;script</code>, <code class=\"notranslate\">&lt;/script&gt;</code>, and <code class=\"notranslate\">&lt;!--</code></a> (assuming we're only targeting HTML5 vs this was likely intended for XHTML). The quirk of JSON/JavaScript interop which required our handling of U+2028 and U+2029 is also <a href=\"https://github.com/tc39/proposal-json-superset\">no longer a concern as of ES2019</a> which is now <a href=\"https://caniuse.com/mdn-javascript_builtins_json_json_superset\" rel=\"nofollow\">widely available</a>.</p>\n<p dir=\"auto\">That's all outside the scope of this PR though, which provides a performance gain without any change to escaping behaviour.</p>",
            "url": "https://github.com/rails/rails/pull/48669",
            "title": "Improve performance of JSON HTML entity escaping",
            "date_modified": "2023-07-05T23:00:30.000Z",
            "date_published": "2023-07-05T19:41:19.000Z",
            "author": {
                "name": "jhawthorn",
                "url": "https://github.com/jhawthorn"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/3660805?u=d06f0923c5f6478f935e317ad901a0a3aef06903&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because RSpec predicates in helper tests fail with the following error:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"expect(helper).to be_something(project: project)\"><pre class=\"notranslate\"><span class=\"pl-en\">expect</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">helper</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to</span> <span class=\"pl-en\">be_something</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">project</span>: <span class=\"pl-en\">project</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">Error:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"ArgumentError:\n  wrong number of arguments (given 1, expected 0; required keyword: project)\"><pre class=\"notranslate\"><span class=\"pl-v\">ArgumentError</span>:\n  <span class=\"pl-en\">wrong</span> <span class=\"pl-en\">number</span> <span class=\"pl-en\">of</span> <span class=\"pl-en\">arguments</span> <span class=\"pl-kos\">(</span><span class=\"pl-en\">given</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-en\">expected</span> <span class=\"pl-c1\">0</span><span class=\"pl-kos\">;</span> <span class=\"pl-en\">required</span> <span class=\"pl-pds\">keyword</span>: <span class=\"pl-en\">project</span><span class=\"pl-kos\">)</span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">These matches rely on method_missing chain and Ruby 3.2 requires every method in the chain to use ruby2_keywords (if it uses <code class=\"notranslate\">*args</code>): <a href=\"https://www.ruby-lang.org/en/news/2022/12/25/ruby-3-2-0-released/\" rel=\"nofollow\">https://www.ruby-lang.org/en/news/2022/12/25/ruby-3-2-0-released/</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48667",
            "title": "Add ruby2_keywords to ActionView::TestCase#method_missing",
            "date_modified": "2023-07-05T19:33:53.000Z",
            "date_published": "2023-07-05T17:26:32.000Z",
            "author": {
                "name": "igor-drozdov",
                "url": "https://github.com/igor-drozdov"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #41250.\">Fix</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"794673794\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/41250\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/41250/hovercard\" href=\"https://github.com/rails/rails/issues/41250\">#41250</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #41321.\">Fix</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"800216193\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/41321\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/41321/hovercard\" href=\"https://github.com/rails/rails/pull/41321\">#41321</a></p>\n<p dir=\"auto\">Fix when multiple <code class=\"notranslate\">belongs_to</code> maps to the same counter_cache column. In such situation <code class=\"notranslate\">inverse_which_updates_counter_cache</code> may find the wrong relation which leads into an invalid increment of the counter_cache.</p>\n<p dir=\"auto\">This is done by releying on the <code class=\"notranslate\">inverse_of</code> property of the relation as well as comparing the models the association points two.</p>\n<p dir=\"auto\">Note however that this second check doesn't work for polymorphic associations.</p>\n<p dir=\"auto\">Most if not al of the credit goes to <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/intrip/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/intrip\">@intrip</a> as this is just a cleanup of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"800216193\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/41321\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/41321/hovercard\" href=\"https://github.com/rails/rails/pull/41321\">#41321</a>. I simply replaced the <code class=\"notranslate\">rescue</code> by a proper check for <code class=\"notranslate\">polymorphic?</code>.</p>\n<p dir=\"auto\">FYI: <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/kylefox/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/kylefox\">@kylefox</a></p>",
            "url": "https://github.com/rails/rails/pull/48665",
            "title": "Fix counter_cache create/concat with overlapping counter_cache_column",
            "date_modified": "2023-07-05T15:52:24.000Z",
            "date_published": "2023-07-05T15:52:20.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48611.\">Fix</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1780472225\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48611\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48611/hovercard\" href=\"https://github.com/rails/rails/issues/48611\">#48611</a></p>\n<p dir=\"auto\">This help treating caches entries as expandable.</p>\n<p dir=\"auto\">Because Marshal will hapily serialize almost everything, It's not uncommon to inadvertently cache a class that's not particularly stable, and cause deserialization errors on rollout when the implementation changes.</p>\n<p dir=\"auto\">E.g. <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1686765909\" data-permission-text=\"Title is private\" data-url=\"https://github.com/sporkmonger/addressable/issues/508\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/sporkmonger/addressable/pull/508/hovercard\" href=\"https://github.com/sporkmonger/addressable/pull/508\">sporkmonger/addressable#508</a></p>\n<p dir=\"auto\">FYI: <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/jonathanhefner/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jonathanhefner\">@jonathanhefner</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthutchinson/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthutchinson\">@matthutchinson</a></p>",
            "url": "https://github.com/rails/rails/pull/48663",
            "title": "Make Active Support Cache treat deserialization errors like cache misses",
            "date_modified": "2023-07-05T23:11:42.000Z",
            "date_published": "2023-07-05T14:37:47.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">While working on fixing some deprecation warnings introduced when the 6.1 cache_format deprecation was <a href=\"https://github.com/rails/rails/commit/088551c802bb4005a667aaa33814cfbb1feb3927\">moved</a> to be on usage, I found that the MemCacheStore actually has its own <code class=\"notranslate\">default_coder</code> method.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This adds the warning to MemCacheStore's <code class=\"notranslate\">default_coder</code> method so that every cache store will warn on using the 6.1 format.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48662",
            "title": "Fix MemCacheStore not warning on 6.1 cache format",
            "date_modified": "2023-07-05T16:06:51.000Z",
            "date_published": "2023-07-05T14:01:04.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/28561?u=095779352a57f75e734987829f3f67a10e5780ed&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><code class=\"notranslate\">delete_multi</code> returns the number of deleted entries.<br>\nThis is behavior is asserted in the following test:</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/495cbe9f8fec01ed3f2c0128dda39ca07bad00b3/activesupport/test/cache/behaviors/cache_store_behavior.rb#L433\">rails/activesupport/test/cache/behaviors/cache_store_behavior.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 433\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/495cbe9f8fec01ed3f2c0128dda39ca07bad00b3\">495cbe9</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L433\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"433\"></td>\n          <td id=\"LC433\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">assert_equal</span> <span class=\"pl-c1\">2</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">@cache</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">delete_multi</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">SecureRandom</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">uuid</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">other_key</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48661",
            "title": "Document return value of `Rails.cache.delete_multi`",
            "date_modified": "2023-07-05T13:57:58.000Z",
            "date_published": "2023-07-05T13:50:29.000Z",
            "author": {
                "name": "p8",
                "url": "https://github.com/p8"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/25950768?u=056c73263e9916cea227c9a58ea5106d0cf8c09e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The current <a href=\"https://api.rubyonrails.org/v7.0.4/classes/ActionView/Helpers/FormHelper.html#method-i-file_field\" rel=\"nofollow\">documentation</a> implies calling <code class=\"notranslate\">multiple: true</code> and <code class=\"notranslate\">include_hidden: true</code> will stop existing files from being replaced when saving a record that has ActiveStorage attached. However it appears <code class=\"notranslate\">include_hidden: false</code> is needed to achieve this functionality.</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48006.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1677646911\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48006\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48006/hovercard\" href=\"https://github.com/rails/rails/issues/48006\">#48006</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Updating documentation to reflect the current functionality of <code class=\"notranslate\">multiple: true</code> and <code class=\"notranslate\">include_hidden: false</code></p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48658",
            "title": "Fix `include_hidden` documentation for File Upload",
            "date_modified": "2023-07-05T08:34:31.000Z",
            "date_published": "2023-07-05T08:34:27.000Z",
            "author": {
                "name": "alexpapworth",
                "url": "https://github.com/alexpapworth"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1688137?u=6e2ec05e392b37648521c2f1cd824a9bf4415b8e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Currently, there is a bug that changes the duplicity elimination depending on whether the association is <code class=\"notranslate\">#loaded?</code> or not as the followings, but this change will fix it.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"human = Human.create!\ninterest = Interest.new(human: human)\nhuman.interests &lt;&lt; interest\nhuman.interests.size #=&gt; 1\"><pre class=\"notranslate\"><span class=\"pl-s1\">human</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Human</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create!</span>\n<span class=\"pl-s1\">interest</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Interest</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">human</span>: <span class=\"pl-s1\">human</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">human</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">interests</span> &lt;&lt; <span class=\"pl-s1\">interest</span>\n<span class=\"pl-s1\">human</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">interests</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">size</span> <span class=\"pl-c\">#=&gt; 1</span></pre></div>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"human = Human.create!\ninterest = Interest.new(human: human)\nhuman.interests.load\nhuman.interests &lt;&lt; interest\nhuman.interests.size #=&gt; expected 1, got 2\"><pre class=\"notranslate\"><span class=\"pl-s1\">human</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Human</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create!</span>\n<span class=\"pl-s1\">interest</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Interest</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">human</span>: <span class=\"pl-s1\">human</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">human</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">interests</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">load</span>\n<span class=\"pl-s1\">human</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">interests</span> &lt;&lt; <span class=\"pl-s1\">interest</span>\n<span class=\"pl-s1\">human</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">interests</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">size</span> <span class=\"pl-c\">#=&gt; expected 1, got 2</span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">The existing process was attempting to detect duplicates by storing added records in <code class=\"notranslate\">Set.new</code>.<br>\nWhen a record is added to <code class=\"notranslate\">Set.new</code>, the identity is calculated using <a href=\"https://github.com/rails/rails//blob/f256e1f085f25f1c2cc4e4d1a533c6b103ff7aee/activerecord/lib/active_record/core.rb#L564-L572\"><code class=\"notranslate\">ActiveRecord::Core#hash</code></a>, but this value changes before and after saving, so duplicates were not detected before and after saving even for the same object.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This PR fixed the problem by using the <code class=\"notranslate\">#object_id</code> of the record to detect duplicates. Note that when storing a new object obtained by <code class=\"notranslate\">ActiveRecord::Base.find</code> etc., duplicates are not eliminated because the <code class=\"notranslate\">#object_id</code> is different.<br>\nThis is the same behavior as the current <code class=\"notranslate\">ActiveRecord::Associations::CollectionProxy#&lt;&lt;</code>.</p>\n<p dir=\"auto\">The mechanism to eliminate the duplicate nature of newly added records using <code class=\"notranslate\">Set.new</code> was added in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"924057773\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/42524\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/42524/hovercard\" href=\"https://github.com/rails/rails/pull/42524\">#42524</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48657",
            "title": "Fix de-duplication of unsaved records for `ActiveRecord::Associations::CollectionProxy#<<`",
            "date_modified": "2023-07-05T20:20:13.000Z",
            "date_published": "2023-07-05T08:27:02.000Z",
            "author": {
                "name": "alpaca-tc",
                "url": "https://github.com/alpaca-tc"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/15172605?u=c9831ccf188358c7be46eb4c634002b47ebb1068&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #47559.\">Resolves</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1607337313\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47559\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/47559/hovercard\" href=\"https://github.com/rails/rails/issues/47559\">#47559</a></p>\n<p dir=\"auto\">Properly handle an intermediate model with has_many_inversing when creating two records with the same references.</p>\n<ul dir=\"auto\">\n<li>Prevents database error when references have a NOT NULL constraint</li>\n<li>When NULLS are permitted avoid an extra UPDATE statement by inserting the correct values from the outset</li>\n</ul>\n<h3 dir=\"auto\">Detail</h3>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"ActiveRecord::Base.has_many_inversing = true\n\nclass Comment &lt; ActiveRecord::Base\n  belongs_to :post, inverse_of: :comments\n  belongs_to :author, inverse_of: :comments\nend\n\nclass Post &lt; ActiveRecord::Base\n  has_many :comments\nend\n\nclass Author &lt; ActiveRecord::Base\n  has_many :comments\nend\n\npost = Post.new\nauthor = Author.new\npost.comments.build(author: author)\npost.comments.build(author: author)\npost.save!\"><pre class=\"notranslate\"><span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">has_many_inversing</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Comment</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:post</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">inverse_of</span>: <span class=\"pl-pds\">:comments</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:author</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">inverse_of</span>: <span class=\"pl-pds\">:comments</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">has_many</span> <span class=\"pl-pds\">:comments</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Author</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">has_many</span> <span class=\"pl-pds\">:comments</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">author</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Author</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">comments</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">build</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">author</span>: <span class=\"pl-s1\">author</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">comments</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">build</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">author</span>: <span class=\"pl-s1\">author</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">save!</span></pre></div>\n<p dir=\"auto\">Before:</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"BEGIN\n  INSERT INTO &quot;posts&quot; DEFAULT VALUES RETURNING &quot;id&quot;\n  INSERT INTO &quot;authors&quot; DEFAULT VALUES RETURNING &quot;id&quot;\n  INSERT INTO &quot;comments&quot; (&quot;post_id&quot;, &quot;author_id&quot;) VALUES ($1, $2) RETURNING &quot;id&quot;  [[&quot;post_id&quot;, 1], [&quot;author_id&quot;, 1]]\n  INSERT INTO &quot;comments&quot; (&quot;author_id&quot;) VALUES ($1) RETURNING &quot;id&quot;  [[&quot;author_id&quot;, 1]]\n  -- Error if NOT NULL constraint on post_id\n  UPDATE &quot;comments&quot; SET &quot;post_id&quot; = $1 WHERE &quot;comments&quot;.&quot;id&quot; = $2  [[&quot;post_id&quot;, 1], [&quot;id&quot;, 2]]\nCOMMIT\"><pre class=\"notranslate\"><span class=\"pl-k\">BEGIN</span>\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>posts<span class=\"pl-pds\">\"</span></span> DEFAULT <span class=\"pl-k\">VALUES</span> RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>authors<span class=\"pl-pds\">\"</span></span> DEFAULT <span class=\"pl-k\">VALUES</span> RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>comments<span class=\"pl-pds\">\"</span></span> (<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>) <span class=\"pl-k\">VALUES</span> ($<span class=\"pl-c1\">1</span>, $<span class=\"pl-c1\">2</span>) RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>  [[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>], [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>]]\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>comments<span class=\"pl-pds\">\"</span></span> (<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>) <span class=\"pl-k\">VALUES</span> ($<span class=\"pl-c1\">1</span>) RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>  [[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>]]\n  <span class=\"pl-c\"><span class=\"pl-c\">--</span> Error if NOT NULL constraint on post_id</span>\n  <span class=\"pl-k\">UPDATE</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>comments<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">SET</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">=</span> $<span class=\"pl-c1\">1</span> <span class=\"pl-k\">WHERE</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>comments<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">=</span> $<span class=\"pl-c1\">2</span>  [[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>], [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">2</span>]]\n<span class=\"pl-k\">COMMIT</span></pre></div>\n<p dir=\"auto\">After:</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"BEGIN\n  INSERT INTO &quot;posts&quot; DEFAULT VALUES RETURNING &quot;id&quot;\n  INSERT INTO &quot;authors&quot; DEFAULT VALUES RETURNING &quot;id&quot;\n  INSERT INTO &quot;comments&quot; (&quot;post_id&quot;, &quot;author_id&quot;) VALUES ($1, $2) RETURNING &quot;id&quot;  [[&quot;post_id&quot;, 1], [&quot;author_id&quot;, 1]]\n  INSERT INTO &quot;comments&quot; (&quot;post_id&quot;, &quot;author_id&quot;) VALUES ($1, $2) RETURNING &quot;id&quot;  [[&quot;post_id&quot;, 1], [&quot;author_id&quot;, 1]]\nCOMMIT\"><pre class=\"notranslate\"><span class=\"pl-k\">BEGIN</span>\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>posts<span class=\"pl-pds\">\"</span></span> DEFAULT <span class=\"pl-k\">VALUES</span> RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>authors<span class=\"pl-pds\">\"</span></span> DEFAULT <span class=\"pl-k\">VALUES</span> RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>comments<span class=\"pl-pds\">\"</span></span> (<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>) <span class=\"pl-k\">VALUES</span> ($<span class=\"pl-c1\">1</span>, $<span class=\"pl-c1\">2</span>) RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>  [[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>], [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>]]\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>comments<span class=\"pl-pds\">\"</span></span> (<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>) <span class=\"pl-k\">VALUES</span> ($<span class=\"pl-c1\">1</span>, $<span class=\"pl-c1\">2</span>) RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>  [[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>], [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>]]\n<span class=\"pl-k\">COMMIT</span></pre></div>\n<p dir=\"auto\"><code class=\"notranslate\">insert_record</code> within <code class=\"notranslate\">save_collection_association</code> will trigger a recursive call. By fully processing <code class=\"notranslate\">set_inverse_instance</code> for each layer we ensure associations are up to date before <code class=\"notranslate\">INSERT INTO comments</code> statements are sent to the database.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48647",
            "title": "Fix has_many_inversing records with same references",
            "date_modified": "2023-07-04T15:06:39.000Z",
            "date_published": "2023-07-04T14:08:03.000Z",
            "author": {
                "name": "abaldwin88",
                "url": "https://github.com/abaldwin88"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/248174?u=679698ae9aa6ac1cd046737efadd767c154326c6&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">Uniqueness validators no longer works on <code class=\"notranslate\">create_association</code> when using <code class=\"notranslate\">dependent: :destroy</code> option in the commit below.<br>\nrefs: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/bdbe58b50461dc44c42df4d5427fa78aeb1debcb/hovercard\" href=\"https://github.com/rails/rails/commit/bdbe58b50461dc44c42df4d5427fa78aeb1debcb\"><tt>bdbe58b</tt></a>, <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/3255411981f4a64eea77ff65431ce92d201b4d0a/hovercard\" href=\"https://github.com/rails/rails/commit/3255411981f4a64eea77ff65431ce92d201b4d0a\"><tt>3255411</tt></a></p>\n<p dir=\"auto\">However, we often expect validation errors as well.<br>\nrefs <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1730182935\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48330\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48330/hovercard\" href=\"https://github.com/rails/rails/issues/48330\">#48330</a>, <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1785808864\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48632\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48632/hovercard\" href=\"https://github.com/rails/rails/issues/48632\">#48632</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit adds new option <code class=\"notranslate\">existing</code> to <code class=\"notranslate\">has_one</code> to run validations before deleting an existing record.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48643",
            "title": "Add a new option `existing` to `has_one` to run validations before deleting",
            "date_modified": "2023-07-04T06:46:52.000Z",
            "date_published": "2023-07-04T06:23:56.000Z",
            "author": {
                "name": "sinsoku",
                "url": "https://github.com/sinsoku"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/9624059?u=0a4d0129b07a8c5e4a643891f16861edd9658e5c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48633.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1785850610\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48633\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48633/hovercard\" href=\"https://github.com/rails/rails/issues/48633\">#48633</a></p>\n<p dir=\"auto\">Previously, failure to autosave a <code class=\"notranslate\">has_one</code> association returned <code class=\"notranslate\">nil</code> instead of raising an exception.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Supplier &lt; ActiveRecord::Base\n  has_one :account, autosave: true\nend\n\nclass Account &lt; ActiveRecord::Base\n  before_save { throw(:abort) }\nend\n\nsupplier = Supplier.new\nsupplier.build_account\nsupplier.save! # =&gt; nil\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Supplier</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">has_one</span> <span class=\"pl-pds\">:account</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">autosave</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Account</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">before_save</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">throw</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:abort</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">supplier</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Supplier</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">supplier</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">build_account</span>\n<span class=\"pl-s1\">supplier</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">save!</span> <span class=\"pl-c\"># =&gt; nil</span></pre></div>\n<p dir=\"auto\">But it's counter-intuitive for <code class=\"notranslate\">save!</code> to fail without raising an exception.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This pull request changes the <code class=\"notranslate\">save_has_one_association</code> to raise <code class=\"notranslate\">ActiveRecord::RecordInvalid</code> instead of <code class=\"notranslate\">ActiveRecord::Rollback</code>. This allows it to raise an exception if it fails to autosave the <code class=\"notranslate\">has_one</code> association with <code class=\"notranslate\">save!</code>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">This pull request is very similar to <a href=\"https://github.com/rails/rails/pull/36210\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/36210/hovercard\">the pull request for <code class=\"notranslate\">has_many</code> association</a>.</p>\n<p dir=\"auto\">Also, it seems that the reason why <code class=\"notranslate\">ActiveRecord::Rollback</code> was raised was to return <code class=\"notranslate\">false</code> while rolling back with <code class=\"notranslate\">save</code>, but there is also no problem with <code class=\"notranslate\">ActiveRecord::RecordInvalid</code>.<br>\n<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/f2aacd51405724cdf7cfd36a439c9dbfce16973a/hovercard\" href=\"https://github.com/rails/rails/commit/f2aacd51405724cdf7cfd36a439c9dbfce16973a\"><tt>f2aacd5</tt></a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48640",
            "title": "fix: Raise an exception on `has_one` failed to autosave",
            "date_modified": "2023-07-05T15:23:41.000Z",
            "date_published": "2023-07-03T17:12:25.000Z",
            "author": {
                "name": "wata727",
                "url": "https://github.com/wata727"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/28561?u=095779352a57f75e734987829f3f67a10e5780ed&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><code class=\"notranslate\">Rails.cache.delete('key')</code> is supposed to return <code class=\"notranslate\">true</code> if an entry exists and <code class=\"notranslate\">false</code> otherwise. This is how most stores behave.</p>\n<p dir=\"auto\">However, the <code class=\"notranslate\">RedisCacheStore</code> would return a <code class=\"notranslate\">1</code> when deleting an entry that does exist and a <code class=\"notranslate\">0</code> otherwise.<br>\nAs <code class=\"notranslate\">0</code> is truthy this is unexpected behaviour.</p>\n<p dir=\"auto\"><code class=\"notranslate\">RedisCacheStore</code> now returns <code class=\"notranslate\">true</code> if the entry exists and <code class=\"notranslate\">false</code> otherwise, making it consistent with the other cache stores.</p>\n<p dir=\"auto\">Similarly the <code class=\"notranslate\">FileCacheStore</code> now returns <code class=\"notranslate\">false</code> instead of <code class=\"notranslate\">nil</code> if the entry doesn't exist.</p>\n<p dir=\"auto\">A test is added to make sure this behaviour applies to all stores.</p>\n<p dir=\"auto\">The documentation for <code class=\"notranslate\">delete</code> has been updated to make the behaviour explicit.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48638",
            "title": "Ensure `Rails.cache.delete('key')` returns a boolean",
            "date_modified": "2023-07-05T09:50:21.000Z",
            "date_published": "2023-07-03T13:55:16.000Z",
            "author": {
                "name": "p8",
                "url": "https://github.com/p8"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This is just a shot in the dark, but my gut tells me this commit fixes this flaky test.</p>\n<p dir=\"auto\">Most recently failed today in CI:<br>\n<a href=\"https://buildkite.com/rails/rails/builds/97733#018919b9-fd8e-4fef-8536-671e68ffd2ac/1080-2620\" rel=\"nofollow\">https://buildkite.com/rails/rails/builds/97733#018919b9-fd8e-4fef-8536-671e68ffd2ac/1080-2620</a></p>\n<p dir=\"auto\">/cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a></p>",
            "url": "https://github.com/rails/rails/pull/48636",
            "title": "[7-0-stable] Backport: \"Warm-up to avoid autoloads interfering with class serial\"",
            "date_modified": "2023-07-03T12:19:18.000Z",
            "date_published": "2023-07-03T12:19:14.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/15172605?u=c9831ccf188358c7be46eb4c634002b47ebb1068&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Extends Active Record to automatically reload virtual attributes on update when using PostgreSQL. This is done by issuing a single UPDATE query that includes a RETURNING clause.</p>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Saves an extra round trip to the database for reload and removes a developer pitfall around stale virtual attribute values.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Given a <code class=\"notranslate\">Post</code> model represented by the following schema:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"create_table :posts do |t|\n  t.integer :upvotes_count\n  t.integer :downvotes_count\n  t.virtual :total_votes_count, type: :integer, as: &quot;upvotes_count + downvotes_count&quot;, stored: true\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:posts</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">integer</span> <span class=\"pl-pds\">:upvotes_count</span>\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">integer</span> <span class=\"pl-pds\">:downvotes_count</span>\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">virtual</span> <span class=\"pl-pds\">:total_votes_count</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">type</span>: <span class=\"pl-pds\">:integer</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">as</span>: <span class=\"pl-s\">\"upvotes_count + downvotes_count\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">stored</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\"><code class=\"notranslate\">total_votes_count</code> will reflect the sum of upvotes and downvotes after <code class=\"notranslate\">update</code> is successfully called. Prior to this change calling <code class=\"notranslate\">reload</code> would have been necessary to obtain the value calculated by the database.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"post = Post.find(1)\npost.update(upvotes_count: 2, downvotes_count: 2)\n# Calling `post.reload` no longer necessary\npost.total_votes =&gt; 4\"><pre class=\"notranslate\"><span class=\"pl-s1\">post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">find</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">update</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">upvotes_count</span>: <span class=\"pl-c1\">2</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">downvotes_count</span>: <span class=\"pl-c1\">2</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\"># Calling `post.reload` no longer necessary</span>\n<span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">total_votes</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-c1\">4</span></pre></div>\n<ul dir=\"auto\">\n<li>At this moment MySQL and SQLite adapters do not support this behavior</li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<ul dir=\"auto\">\n<li>Follow-up from PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1712735611\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48241\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48241/hovercard\" href=\"https://github.com/rails/rails/pull/48241\">#48241</a></li>\n<li>Related to PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1750183204\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48434\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48434/hovercard\" href=\"https://github.com/rails/rails/pull/48434\">#48434</a></li>\n<li><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48423.\">Closes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1747958155\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48423\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48423/hovercard\" href=\"https://github.com/rails/rails/issues/48423\">#48423</a> when using Postgresql</li>\n</ul>\n<p dir=\"auto\">CC: <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/nvasilevski/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/nvasilevski\">@nvasilevski</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.<br>\n<del>* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</del>.</li>\n<li>I'll update the docs and changelog after a core team member confirms this is the right approach</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48628",
            "title": "PostgreSQL reload virtual attributes on update",
            "date_modified": "2023-07-02T11:30:40.000Z",
            "date_published": "2023-07-02T11:30:36.000Z",
            "author": {
                "name": "abaldwin88",
                "url": "https://github.com/abaldwin88"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/18253416?u=034aae4fab87712e64aa0db80bf6c653bb434339&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because get attributes with aliases.</p>\n<p dir=\"auto\">For more information, please check here.<br>\n<a href=\"https://discuss.rubyonrails.org/t/i-would-like-an-idea-to-create-an-issue-about-add-alias-attribute-to-method-attributes/82793\" rel=\"nofollow\">https://discuss.rubyonrails.org/t/i-would-like-an-idea-to-create-an-issue-about-add-alias-attribute-to-method-attributes/82793</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes ActiveModel and ActiveRecord</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"% cd activemodel\n% bin/test test/cases/attributes_test.rb \nRun options: --seed 887\n\n# Running:\n\n................\n\nFinished in 0.009967s, 1605.2975 runs/s, 3411.2571 assertions/s.\n16 runs, 34 assertions, 0 failures, 0 errors, 0 skips\"><pre class=\"notranslate\"><code class=\"notranslate\">% cd activemodel\n% bin/test test/cases/attributes_test.rb \nRun options: --seed 887\n\n# Running:\n\n................\n\nFinished in 0.009967s, 1605.2975 runs/s, 3411.2571 assertions/s.\n16 runs, 34 assertions, 0 failures, 0 errors, 0 skips\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"% cd activerecord\n% bin/test test/cases/attribute_methods_test.rb\nUsing sqlite3\nRun options: --seed 19232\n\n# Running:\n\n................................................................................................................\n\nFinished in 0.629886s, 177.8100 runs/s, 779.5061 assertions/s.\n112 runs, 491 assertions, 0 failures, 0 errors, 0 skips\"><pre class=\"notranslate\"><code class=\"notranslate\">% cd activerecord\n% bin/test test/cases/attribute_methods_test.rb\nUsing sqlite3\nRun options: --seed 19232\n\n# Running:\n\n................................................................................................................\n\nFinished in 0.629886s, 177.8100 runs/s, 779.5061 assertions/s.\n112 runs, 491 assertions, 0 failures, 0 errors, 0 skips\n</code></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48619",
            "title": "Add attributes_with_aliases and attribute_names_with_aliases",
            "date_modified": "2023-07-01T03:21:54.000Z",
            "date_published": "2023-06-30T21:34:32.000Z",
            "author": {
                "name": "kawamotosatoshi",
                "url": "https://github.com/kawamotosatoshi"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8122246?u=2dbe607a66a7616297b78647eeb4e0dbff657c3a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Context</h3>\n<p dir=\"auto\">While working on <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1169368712\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/44695\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/44695/hovercard\" href=\"https://github.com/rails/rails/pull/44695\">#44695</a>, I realised that Broadcasting was still a private API, although it’s commonly used. <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a> mentioned that making it public would require some refactor because of the original implementation which was hard<br>\nto understand and maintain.</p>\n<h3 dir=\"auto\">Broadcasting</h3>\n<p dir=\"auto\">Broadcasting in a nutshell worked by “transforming” an existing logger into a broadcasted one.<br>\nThe logger would then be responsible to log and format its own messages as well as passing the message along to other logger it broadcasts to.</p>\n<p dir=\"auto\">The problem with this approach was the following:</p>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">Heavy use of metaprogramming.</p>\n</li>\n<li>\n<p dir=\"auto\">Accessing the loggers in the broadcast wasn’t possible. Removing a logger from the broadcast either.</p>\n</li>\n<li>\n<p dir=\"auto\">More importantly, modifying the main logger (the one that broadcasts logs to the others) wasn’t possible and the main source of misunderstanding.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"  logger = Logger.new(STDOUT)\n  stderr_logger = Logger.new(STDER))\n  logger.extend(AS::Logger.broadcast(stderr_logger))\n\n  logger.level = DEBUG # This modifies the level on all other loggers\n  logger.formatter = … # Modified the formatter on all other loggers\"><pre class=\"notranslate\">  <span class=\"pl-s1\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-s1\">stderr_logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDER</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-s1\">logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">extend</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">AS</span>::<span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">broadcast</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">stderr_logger</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n\n  <span class=\"pl-s1\">logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">level</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">DEBUG</span> <span class=\"pl-c\"># This modifies the level on all other loggers</span>\n  <span class=\"pl-s1\">logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">formatter</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">…</span> <span class=\"pl-c\"># Modified the formatter on all other loggers</span></pre></div>\n</li>\n</ul>\n<p dir=\"auto\">To keep the contract unchanged on what <code class=\"notranslate\">Rails.logger</code> returns, the new <code class=\"notranslate\">BroadcastLogger</code> class implement duck typing with all methods that has the vanilla Ruby Logger class.<br>\nIt's a simple and boring PORO that keeps an array of all the loggers that are part of the broadcast and iterate over whenever a log is sent.</p>\n<p dir=\"auto\">Now, users can access all loggers inside the broadcast and modify them on the fly. They can also remove any logger from the broadcast at any time.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# Before\n\nstdout_logger = Logger.new(STDOUT)\nstderr_logger = Logger.new(STDER)\nfile_logger = Logger.new(“development.log”)\nstdout_logger.extend(AS::Logger.broadcast(stderr_logger))\nstdout_logger.extend(AS::Logger.broadcast(file_logger))\n\n# After\n\nbroadcast = BroadcastLogger.new(stdout_logger, stderr_logger, file_logger)\"><pre class=\"notranslate\"><span class=\"pl-c\"># Before</span>\n\n<span class=\"pl-s1\">stdout_logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">stderr_logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDER</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">file_logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">“development</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log”</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">stdout_logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">extend</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">AS</span>::<span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">broadcast</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">stderr_logger</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">stdout_logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">extend</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">AS</span>::<span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">broadcast</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">file_logger</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-c\"># After</span>\n\n<span class=\"pl-s1\">broadcast</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">BroadcastLogger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">stdout_logger</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">stderr_logger</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">file_logger</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">I also think that now, it should be more clear for users that the broadcast sole job is to pass everything to the whole loggers in the broadcast. So there should be no surprise that all loggers in the broadcast get their level modified when they call <code class=\"notranslate\">broadcast.level = DEBUG</code> .</p>\n<p dir=\"auto\">It’s also easier to wrap your head around more complex setup such as broadcasting logs to another broadcast: <code class=\"notranslate\">broadcast.broadcast_to(stdout_logger, other_broadcast)</code></p>",
            "url": "https://github.com/rails/rails/pull/48615",
            "title": "Add a public API for broadcasting logs",
            "date_modified": "2023-07-04T14:57:07.000Z",
            "date_published": "2023-06-30T02:55:14.000Z",
            "author": {
                "name": "Edouard-chin",
                "url": "https://github.com/Edouard-chin"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/67890?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">PostgreSQL 15 introduced <code class=\"notranslate\">NULLS NOT DISTINCT</code> in order to support unique indexes where you want to treat NULLs as equal. Otherwise, and by default, unique indexes allow any rows with null column values.</p>\n<p dir=\"auto\">This Pull Request has been created because creating unique indexes where rows can have only one null value is helpful, and it is a good idea to keep up with new PostgreSQL features.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the PostgreSQL connection adapter, schema detection, and schema generation. Prior work was done in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1480756107\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46659\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/46659/hovercard\" href=\"https://github.com/rails/rails/pull/46659\">#46659</a> but was incomplete--a DB created from schema.rb would not have <code class=\"notranslate\">NULLS NOT DISTINCT</code> set. Additionally, <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1185784153\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/44803\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/44803/hovercard\" href=\"https://github.com/rails/rails/pull/44803\">#44803</a> added <code class=\"notranslate\">INCLUDE</code> to the index schema regex, but this must come <strong>before</strong> <code class=\"notranslate\">NULLS [NOT] DISTINCT</code> per the <a href=\"https://www.postgresql.org/docs/15/sql-createindex.html\" rel=\"nofollow\">Postgres</a> docs.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Check out the PostreSQL docs <a href=\"https://www.postgresql.org/docs/15/sql-createindex.html\" rel=\"nofollow\">here</a>, in particular to confirm the correct ordering of SQL parts. My intent was to put it immediately after <code class=\"notranslate\">INCLUDE</code> in regex detection and ruby argument order.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48608",
            "title": "Support NULLS NOT DISTINCT in Postgres 15+",
            "date_modified": "2023-07-02T15:49:58.000Z",
            "date_published": "2023-06-29T03:38:44.000Z",
            "author": {
                "name": "grjones",
                "url": "https://github.com/grjones"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2651240?u=97e6903620ef2874e2231cee9eb2654b7811d750&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Add option to merge association scopes to subqueries.</p>\n<p dir=\"auto\">It removes a breaking change introduced by <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1759321614\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48487\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48487/hovercard\" href=\"https://github.com/rails/rails/pull/48487\">#48487</a>. Conditions that were not applied in<br>\nprevious versions would be applied giving people different results.</p>\n<p dir=\"auto\">Set the option on an association:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Author &lt; ApplicationRecord\n  has_many :welcome_posts, -&gt; { where(title: &quot;welcome&quot;) } , class_name: &quot;Post&quot;\n  has_many :welcome_posts_scoped, -&gt; { where(title: &quot;Welcome&quot;) }, class_name: &quot;Post&quot;, apply_on_subqueries: true\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Author</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">has_many</span> <span class=\"pl-pds\">:welcome_posts</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">title</span>: <span class=\"pl-s\">\"welcome\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span> <span class=\"pl-kos\">,</span> <span class=\"pl-pds\">class_name</span>: <span class=\"pl-s\">\"Post\"</span>\n  <span class=\"pl-en\">has_many</span> <span class=\"pl-pds\">:welcome_posts_scoped</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">title</span>: <span class=\"pl-s\">\"Welcome\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">class_name</span>: <span class=\"pl-s\">\"Post\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">apply_on_subqueries</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Then the association scope will be merged into the subquery.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Author.where(welcome_posts: Post.all)\n#=&gt; SELECT (...) WHERE &quot;authors&quot;.&quot;id&quot; IN (SELECT &quot;posts&quot;.&quot;author_id&quot; FROM &quot;posts&quot;)\n\nAuthor.where(welcome_posts_scoped: Post.all)\n#=&gt; SELECT (...) WHERE &quot;authors&quot;.&quot;id&quot; IN (SELECT &quot;posts&quot;.&quot;author_id&quot; FROM &quot;posts&quot; WHERE &quot;posts&quot;.&quot;title&quot; = 'welcome')    \"><pre class=\"notranslate\"><span class=\"pl-v\">Author</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">welcome_posts</span>: <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">all</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\">#=&gt; SELECT (...) WHERE \"authors\".\"id\" IN (SELECT \"posts\".\"author_id\" FROM \"posts\")</span>\n\n<span class=\"pl-v\">Author</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">welcome_posts_scoped</span>: <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">all</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\">#=&gt; SELECT (...) WHERE \"authors\".\"id\" IN (SELECT \"posts\".\"author_id\" FROM \"posts\" WHERE \"posts\".\"title\" = 'welcome')    </span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1759321614\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48487\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48487/hovercard?comment_id=1612150489&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/pull/48487#issuecomment-1612150489\">#48487 (comment)</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48607",
            "title": "Add option apply_on_subqueries to associations",
            "date_modified": "2023-06-29T15:45:49.000Z",
            "date_published": "2023-06-29T02:35:40.000Z",
            "author": {
                "name": "lazaronixon",
                "url": "https://github.com/lazaronixon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #45017.\">Fix</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1225413007\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45017\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/45017/hovercard\" href=\"https://github.com/rails/rails/issues/45017\">#45017</a><br>\nRef: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"233272702\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/29333\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/29333/hovercard\" href=\"https://github.com/rails/rails/pull/29333\">#29333</a><br>\nRef: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1723090266\" data-permission-text=\"Title is private\" data-url=\"https://github.com/ruby/timeout/issues/30\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/ruby/timeout/pull/30/hovercard\" href=\"https://github.com/ruby/timeout/pull/30\">ruby/timeout#30</a></p>\n<p dir=\"auto\">Historically only raised errors would trigger a rollback, but in Ruby <code class=\"notranslate\">2.3</code>, the <code class=\"notranslate\">timeout</code> library started using <code class=\"notranslate\">throw</code> to interupt execution which had the adverse effect of committing open transactions.</p>\n<p dir=\"auto\">To solve this, in Active Record 6.1 the behavior was changed to instead rollback the transaction as it was safer than to potentially commit an incomplete transaction.</p>\n<p dir=\"auto\">Using <code class=\"notranslate\">return</code>, <code class=\"notranslate\">break</code> or <code class=\"notranslate\">throw</code> inside a <code class=\"notranslate\">transaction</code> block was essentially deprecated from Rails 6.1 onwards.</p>\n<p dir=\"auto\">However with the release of <code class=\"notranslate\">timeout 0.4.0</code>, <code class=\"notranslate\">Timeout.timeout</code> now raises an error again, and Active Record is able to return to its original, less surprising, behavior.</p>",
            "url": "https://github.com/rails/rails/pull/48600",
            "title": "Active Record commit transaction on `return`, `break` and `throw`",
            "date_modified": "2023-06-29T12:42:38.000Z",
            "date_published": "2023-06-28T14:09:44.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        }
    ]
}