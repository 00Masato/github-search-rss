{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/131752?u=32ddf1119b1d189c9bd241a721b36ea01c29f61e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Previously, callbacks which were shared with subclasses would not share between them the procs generated in <code class=\"notranslate\">Filters::Before</code> and <code class=\"notranslate\">Filters::After</code>. This was also lazily generated so would cause memory growth after an application is booted (and not sharable between workers via Cope on Write).</p>\n<p dir=\"auto\">This was because we would rebuild the objects used to invoke the callbacks via <code class=\"notranslate\">CallbackChain#compile</code>, so any difference in the callback chain would result in all of the callback procs being rebuilt.</p>\n<p dir=\"auto\">This commit changes before and after callbacks (but not around!) to be shared between all subclasses of where it was defined. This is done by changing <code class=\"notranslate\">Filters::Before</code> and <code class=\"notranslate\">Filters::After</code> to plain classes which respond to call instead of generating procs (which wasn't strictly necessary but was easier to implement, and also results in simpler objects which use less memory). These objects avoid referencing and tied to a specific callback sequence and so can be memoized and reused.</p>\n<p dir=\"auto\">This has the most impact on applications with many Controllers, and many callbacks in the <code class=\"notranslate\">ApplicationController</code> (or similar).</p>\n<p dir=\"auto\">I also took this opportunity to merge together all the different forms of procs generated (halting, halting_and_conditional, conditional, simple) into one form with if statements. There isn't any significant performance benefit from the specialization previously being done.</p>\n<p dir=\"auto\">I didn't make this eagerly build the callable filter objects, but that's probably worth doing in a follow-up.</p>\n<p dir=\"auto\">I think <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a> will appreciate this ðŸ˜Š</p>\n<h3 dir=\"auto\">Reproduction</h3>\n<p dir=\"auto\">This is a self contained app which created 1000 controllers all inheriting from an <code class=\"notranslate\">ApplicationController</code> with 50 before callbacks (numbers which are pretty comparable to GitHub's largest application), and makes one request to each controller going through the whole stack. Measuring live objects and RSS we see:</p>\n<p dir=\"auto\"><a href=\"https://gist.github.com/jhawthorn/1540799e0d5c0a4be7f929fa6edd8d5b\">https://gist.github.com/jhawthorn/1540799e0d5c0a4be7f929fa6edd8d5b</a></p>\n<p dir=\"auto\"><strong>main</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ be ruby benchmark_controller_callback.rb\nlive objects before: 252506\nRSS before: 70044\n\nlive objects after: 594812\nRSS after: 126052\n\nobject delta: 342306\nRSS delta: 56008\"><pre class=\"notranslate\"><code class=\"notranslate\">$ be ruby benchmark_controller_callback.rb\nlive objects before: 252506\nRSS before: 70044\n\nlive objects after: 594812\nRSS after: 126052\n\nobject delta: 342306\nRSS delta: 56008\n</code></pre></div>\n<p dir=\"auto\"><strong>this branch</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ be ruby benchmark_controller_callback.rb\nlive objects before: 252517\nRSS before: 70036\n\nlive objects after: 339032\nRSS after: 97756\n\nobject delta: 86515\nRSS delta: 27720\"><pre class=\"notranslate\"><code class=\"notranslate\">$ be ruby benchmark_controller_callback.rb\nlive objects before: 252517\nRSS before: 70036\n\nlive objects after: 339032\nRSS after: 97756\n\nobject delta: 86515\nRSS delta: 27720\n</code></pre></div>\n<p dir=\"auto\">This removes half of the memory growth from boot to post-request-serving (most of the remainder being I believe callcaches).</p>",
            "url": "https://github.com/rails/rails/pull/49728",
            "title": "Reduce memory used by ActiveSupport::Callbacks",
            "date_modified": "2023-10-21T13:51:26.000Z",
            "date_published": "2023-10-21T01:26:57.000Z",
            "author": {
                "name": "jhawthorn",
                "url": "https://github.com/jhawthorn"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/99301559?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created in order to <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49707.\">fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1953127535\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49707\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49707/hovercard\" href=\"https://github.com/rails/rails/issues/49707\">#49707</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds a new function called inspect_without_attributes in core.rb. This gives the user the option to inspect a record without printing its attributes.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49724",
            "title": "Added option in ActiveRecord::Core for user to inspect a record without printing its attributes",
            "date_modified": "2023-10-20T23:57:00.000Z",
            "date_published": "2023-10-20T19:24:07.000Z",
            "author": {
                "name": "mguan2020",
                "url": "https://github.com/mguan2020"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/17757590?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created to allow more control over ActiveStorage configuration, specifically touching the <code class=\"notranslate\">ActiveStorage::Attachment</code>'s <code class=\"notranslate\">record</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds a config option called <code class=\"notranslate\">touch_attachment_records</code>. By default (current behavior), it is true.<br>\nThis is used in the <code class=\"notranslate\">belongs_to :record</code> relationship on <code class=\"notranslate\">ActiveStorage::Attachment</code></p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\"><a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/294c2710620871a691e4ca5fefb5e5ace279195d/hovercard\" href=\"https://github.com/rails/rails/commit/294c2710620871a691e4ca5fefb5e5ace279195d\"><tt>294c271</tt></a> added in an <code class=\"notranslate\">ActiveStorage::Blob</code> touching each of its <code class=\"notranslate\">ActiveStorage::Attachment</code>'s on <code class=\"notranslate\">update</code>.  This means that upon an <code class=\"notranslate\">ActiveStorage::Blob</code> being updated, both the <code class=\"notranslate\">ActiveStorage::Attachment</code> and its <code class=\"notranslate\">record</code> will be updated.</p>\n<p dir=\"auto\">This behavior may not be desired by all ActiveStorage users. They may not want timestamps of <code class=\"notranslate\">ActiveStorage</code> activity normalized to the <code class=\"notranslate\">updated_at</code> column of the <code class=\"notranslate\">record</code>. My personal motivation behind this is that I also use <code class=\"notranslate\">ActsAsTenant</code> (<a href=\"https://github.com/ErwinM/acts_as_tenant\">https://github.com/ErwinM/acts_as_tenant</a>) on many models that use <code class=\"notranslate\">ActiveStorage</code>. Many times, updating of the <code class=\"notranslate\">ActiveStorage::Blob</code> happens asynchornously (<code class=\"notranslate\">analyze_later</code>, <code class=\"notranslate\">purge_later</code>), in an <code class=\"notranslate\">ActiveJob</code> that is not tenanted by default. This will result in errors which would be difficult to track down as I don't expect any tenanted model changes to be happening deep in the workflow of <code class=\"notranslate\">ActiveStorage</code>.<br>\nOther solutions I could do:</p>\n<ol dir=\"auto\">\n<li>prepend or monkey patch <code class=\"notranslate\">ActiveJob</code> (which I do not use directly in my application) to set/disregard tenant</li>\n<li>prepend or monkey patch the <code class=\"notranslate\">ActiveStorage::Blob</code> callback that touches its <code class=\"notranslate\">ActiveStorage::Attachment</code></li>\n</ol>\n<p dir=\"auto\">I understand that these might be the solutions I'm left with, but wanted to put this in for consideration.</p>\n<p dir=\"auto\">I realize that this is a really specific config option. The difficult part is that the <code class=\"notranslate\">touch: true</code> on <code class=\"notranslate\">belongs_to :record</code> necessarily means that <code class=\"notranslate\">ActiveStorage</code> is modifying models that it doesn't directly own. In my opinion, this should be defaulted to false, but of course that would be breaking behavior and require more planning/thought.</p>\n<p dir=\"auto\">Thank you for your time in reviewing and giving feedback!</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49723",
            "title": "Add config option to not touch records",
            "date_modified": "2023-10-20T18:42:07.000Z",
            "date_published": "2023-10-20T18:28:06.000Z",
            "author": {
                "name": "mylesboone",
                "url": "https://github.com/mylesboone"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/39735028?u=91330295c614cf3cec0b64bf242a14fc2ceb358f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because, I want to easily duplicate instances of <code class=\"notranslate\">BroadcastLogger</code> in my app. Just calling <code class=\"notranslate\">dup</code> is no good because it does not duplicate the <code class=\"notranslate\">broadcasts</code>. So I believe we could use a <code class=\"notranslate\">deep_dup</code> method.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds a <code class=\"notranslate\">ActiveSupport::BroadcastLogger#deep_dup</code>. Calling <code class=\"notranslate\">deep_dup</code> dups the broadcast logger, and then iterates through each of it's broadcasts and duplicates them.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">N/A</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49720",
            "title": "Add `BroadcastLogger#deep_dup`",
            "date_modified": "2023-10-20T22:20:02.000Z",
            "date_published": "2023-10-20T14:42:03.000Z",
            "author": {
                "name": "andrewn617",
                "url": "https://github.com/andrewn617"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/7480?u=7e61e73cc5bdaed0e4c654b640f3d02956e280a1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I would like to be able to serve precompiled and compressed WASM files with ActionDispatch::Static.</p>\n<p dir=\"auto\">This Pull Request has been created because I currently don't see how to customize the list of <code class=\"notranslate\">compressible_content_types</code> without monkey-patching the middleware. The PR simply adds <code class=\"notranslate\">application/wasm</code> to the matched content types.</p>\n<p dir=\"auto\">I was wondering if this simple approach is good enough or if you see a better way to support his. If yes I am happy to add a test with a <code class=\"notranslate\">.wasm</code> file-fixture.</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49719",
            "title": "Add application/wasm to the compressible content types",
            "date_modified": "2023-10-20T10:51:05.000Z",
            "date_published": "2023-10-20T10:46:35.000Z",
            "author": {
                "name": "haberbyte",
                "url": "https://github.com/haberbyte"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1753245?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">SQLite is becoming a more capable database and there are more companies using it in production. It's really good for self-hosted/small environments where you don't want to boot a separate server for the DB. There's no more need to discourage his usage via a warning.</p>\n<p dir=\"auto\">See <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1943103461\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49633\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49633/hovercard\" href=\"https://github.com/rails/rails/pull/49633\">#49633</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49715",
            "title": "Remove SQLite production warning",
            "date_modified": "2023-10-20T16:45:12.000Z",
            "date_published": "2023-10-20T07:33:22.000Z",
            "author": {
                "name": "intrip",
                "url": "https://github.com/intrip"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/4085?u=1a6686201552c6d1ef1136ee76bbbeaa8317a41f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because allows actionview to be required with defining the<code class=\"notranslate\">Rails</code> constant.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Once the <code class=\"notranslate\">Rails</code> constant is defined, it makes it more challenging to use with frameworks like <a href=\"https://rubyonjets.com/\" rel=\"nofollow\">Jets</a> with actionview because other gems that do this:</p>\n<p dir=\"auto\">some_gem/railtie.rb</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"require &quot;some_gem/railtie&quot; if defined?(Rails)\"><pre class=\"notranslate\"><span class=\"pl-en\">require</span> <span class=\"pl-s\">\"some_gem/railtie\"</span> <span class=\"pl-k\">if</span> <span class=\"pl-en\">defined?</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Rails</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">won't be able to be used with Jets. Renaming to actionview-html-sanitizer gives other gems a chance to work with Jets, also.</p>\n<p dir=\"auto\">Note: The ideal way to check would be for the other gems to use this instead:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"require &quot;some_gem/railtie&quot; if defined?(Rails::Railtie)\"><pre class=\"notranslate\"><span class=\"pl-en\">require</span> <span class=\"pl-s\">\"some_gem/railtie\"</span> <span class=\"pl-k\">if</span> <span class=\"pl-en\">defined?</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Rails</span>::<span class=\"pl-v\">Railtie</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">It's a bummer, gems authors are not always aware of this.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Related:</p>\n<ul dir=\"auto\">\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1943740617\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49643\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49643/hovercard\" href=\"https://github.com/rails/rails/pull/49643\">#49643</a></li>\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1953519304\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails-html-sanitizer/issues/171\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails-html-sanitizer/pull/171/hovercard\" href=\"https://github.com/rails/rails-html-sanitizer/pull/171\">rails/rails-html-sanitizer#171</a></li>\n</ul>\n<p dir=\"auto\">Note, there would need to be some sequencing for this to be release.</p>\n<ol dir=\"auto\">\n<li>The renamed actionview-html-sanitizer gem would first need to be release.</li>\n<li>Then it would be available for this PR to work.</li>\n</ol>\n<p dir=\"auto\">I tested it by installing the renamed actionview-html-sanitizer gem locally with rake install.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49714",
            "title": "use actionview-html-sanitizer",
            "date_modified": "2023-10-20T05:01:48.000Z",
            "date_published": "2023-10-20T04:56:55.000Z",
            "author": {
                "name": "tongueroo",
                "url": "https://github.com/tongueroo"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/20938712?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49656.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1946035487\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49656\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49656/hovercard\" href=\"https://github.com/rails/rails/issues/49656\">#49656</a></p>\n<p dir=\"auto\">Unlike controllers, mailers can't infer the protocol from the request, so users need to specify it.</p>",
            "url": "https://github.com/rails/rails/pull/49712",
            "title": "[ci skip] Update Action Mailer guide on how to add images",
            "date_modified": "2023-10-20T04:35:57.000Z",
            "date_published": "2023-10-20T02:18:34.000Z",
            "author": {
                "name": "MatheusRich",
                "url": "https://github.com/MatheusRich"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/96156234?u=9ced8d6ac6128a8dea78e7f0d9233669ff0ffecf&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This fix allows the <code class=\"notranslate\">polymorphic_method</code> in the <code class=\"notranslate\">HelperMethodBuilder</code> class in <code class=\"notranslate\">polymorphic_routes.rb</code> to discern whether or not a singular resource is being passed into it.  If it finds a singular resource it will pass in <code class=\"notranslate\">format: nil</code> to the options(if it doesn't already have a format set) so that we can have an edited object using the patch method get sent to the proper URL  instead of appending a period and number to the end.</p>\n<p dir=\"auto\">This is trying to make the method a little smarter as suggested in the Issue thread so we can render urls properly.</p>\n<p dir=\"auto\">The current bug behavior in 7.1:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Started PATCH &quot;/author.1&quot; for ::1 at 2023-10-12 15:03:31 -0400\"><pre class=\"notranslate\"><span class=\"pl-en\">Started</span> <span class=\"pl-c1\">PATCH</span> <span class=\"pl-s\">\"/author.1\"</span> <span class=\"pl-k\">for</span> ::<span class=\"pl-c1\">1</span> <span class=\"pl-en\">at</span> <span class=\"pl-c1\">2023</span>-<span class=\"pl-c1\">10</span>-<span class=\"pl-c1\">12</span> <span class=\"pl-c1\">15</span><span class=\"pl-pds\">:03</span><span class=\"pl-pds\">:31</span> -<span class=\"pl-c1\">0400</span></pre></div>\n<p dir=\"auto\">This fix corrects this to:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Started PATCH &quot;/author&quot; for ::1 at 2023-10-12 15:03:31 -0400\"><pre class=\"notranslate\"><span class=\"pl-en\">Started</span> <span class=\"pl-c1\">PATCH</span> <span class=\"pl-s\">\"/author\"</span> <span class=\"pl-k\">for</span> ::<span class=\"pl-c1\">1</span> <span class=\"pl-en\">at</span> <span class=\"pl-c1\">2023</span>-<span class=\"pl-c1\">10</span>-<span class=\"pl-c1\">12</span> <span class=\"pl-c1\">15</span><span class=\"pl-pds\">:03</span><span class=\"pl-pds\">:31</span> -<span class=\"pl-c1\">0400</span></pre></div>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49604.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1940028753\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49604\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49604/hovercard\" href=\"https://github.com/rails/rails/issues/49604\">#49604</a></p>\n\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because [REPLACE ME]</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes [REPLACE ME]</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49705",
            "title": "Render proper URLs for singular resource routes",
            "date_modified": "2023-10-21T16:51:08.000Z",
            "date_published": "2023-10-19T19:28:11.000Z",
            "author": {
                "name": "paulreece",
                "url": "https://github.com/paulreece"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2651240?u=97e6903620ef2874e2231cee9eb2654b7811d750&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">It is a very common pattern to replace the title in other views, I find myself doing it on every single new project I create.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49702",
            "title": "Use content_for for titles in the application layout",
            "date_modified": "2023-10-20T15:46:42.000Z",
            "date_published": "2023-10-19T17:04:29.000Z",
            "author": {
                "name": "lazaronixon",
                "url": "https://github.com/lazaronixon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Add documentation for <code class=\"notranslate\">ActionText::RichText#to_s</code> and <code class=\"notranslate\">ActionText::Content#to_s</code> that demonstrates Action Text's ability to sanitize and scrub its content.</p>",
            "url": "https://github.com/rails/rails/pull/49696",
            "title": "Document Action Text Sanitization",
            "date_modified": "2023-10-21T15:07:01.000Z",
            "date_published": "2023-10-19T13:56:51.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/248174?u=679698ae9aa6ac1cd046737efadd767c154326c6&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">We often use <code class=\"notranslate\">dig</code> with credentials and custom configurations, but the method<br>\nreturns <code class=\"notranslate\">nil</code> instead of an error if a non-existent key is specified by a typo.</p>\n<p dir=\"auto\">It is possible to write without dig to quickly notice a wrong key, but this is tedious.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# Before\nRails.application.credentials.fetch(:aws).fetch(:access_key_id)\nRails.application.config_for(:example).fetch(:foo).fetch(:bar)\"><pre class=\"notranslate\"><span class=\"pl-c\"># Before</span>\n<span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">credentials</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">fetch</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:aws</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">fetch</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:access_key_id</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">config_for</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:example</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">fetch</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:foo</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">fetch</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:bar</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">To make this simple to write, this commit adds a bang version method.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# After\nRails.application.credentials.dig!(:aws, :access_key_id)\nRails.application.config_for(:example).dig!(:foo, :bar)\"><pre class=\"notranslate\"><span class=\"pl-c\"># After</span>\n<span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">credentials</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dig!</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:aws</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:access_key_id</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">config_for</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:example</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dig!</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:foo</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:bar</span><span class=\"pl-kos\">)</span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request implements <code class=\"notranslate\">OrderedOptions#dig!</code> to raise an exception if a non-existent key is specified.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">There was discussion about a similar feature in Ruby, but it was last updated a year ago.</p>\n<ul dir=\"auto\">\n<li><a href=\"https://bugs.ruby-lang.org/issues/14602\" rel=\"nofollow\">Version of dig that raises error if a key is not present</a></li>\n<li><a href=\"https://bugs.ruby-lang.org/issues/15563\" rel=\"nofollow\">#dig that throws an exception if a key doesn't exist</a></li>\n</ul>\n<p dir=\"auto\">In my use case, <code class=\"notranslate\">OrderedOptions#dig!</code> is sufficient, so I avoided <code class=\"notranslate\">Hash#dig!</code> which has a large impact.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49693",
            "title": "Implement `OrderedOptions#dig!`",
            "date_modified": "2023-10-20T02:37:13.000Z",
            "date_published": "2023-10-19T09:51:43.000Z",
            "author": {
                "name": "sinsoku",
                "url": "https://github.com/sinsoku"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/99301559?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created in order to fix issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1946043368\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49657\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49657/hovercard\" href=\"https://github.com/rails/rails/issues/49657\">#49657</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the logic of the insert method in database_statements.rb such that if a list of returning columns is specified, a list of values corresponding to the columns will be returned. Previously, it was possible for an integer to be returned even if the list of returning columns was not nil.</p>\n<p dir=\"auto\">A test file create_new_entry.rb is provided to ensure the correct functionality of the insert method.</p>\n<p dir=\"auto\">The sample code provided by <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/nicoco007/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/nicoco007\">@nicoco007</a> is now functioning correctly.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49692",
            "title": "Fix issue with wrong argument type when using prefetch_primary_key?",
            "date_modified": "2023-10-19T16:44:45.000Z",
            "date_published": "2023-10-18T23:09:03.000Z",
            "author": {
                "name": "mguan2020",
                "url": "https://github.com/mguan2020"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8397222?u=cf1686c0219f38bb87d552ea5131863c43992f1a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">A recent PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1907831891\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49349\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49349/hovercard\" href=\"https://github.com/rails/rails/pull/49349\">#49349</a> introduced a number of SQLite optimizations to improve database performance.</p>\n<p dir=\"auto\">Those optimizations were hard coded in the SQLite adapter which left developers in the same position they were before - that if they wanted to configure SQLite beyond that default configuration, they still needed to rely on monkey patching the adapter.</p>\n<p dir=\"auto\">Hard coding those parameters also introduce the potential for breakage.   For example, the write ahead log is now the default journal mode.  The side effect of this is that SQLite will use three files instead of one for the database which may break any operational scripts (e.g. the backup strategy must change).</p>\n<p dir=\"auto\">Another issue is that WAL mode is an optimization for writing to databases, and now with Rails 7.1 it makes a false assumption that you'll always want to write to any SQLite database.</p>\n<p dir=\"auto\">Rails 7.1 now throws an error connecting to read-only sqlite database that isn't already in WAL mode.</p>\n<p dir=\"auto\">A use case where that is problematic. Let's say on each build of my application I embed the latest version of a Zipcode database that we receive from a 3rd party.  The database, since it is readonly, has the correct file permissions (readonly) and is embedded with journal mode turned off (no -shm or -wal files).   7.1 will throw an error now since it can't change the database to use WAL.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request moves those performance optimizations into the database configuration file.   Developers will now have the option to tune their SQLite configurations by specifying PRAGMA values along with the rest of their database configuration, in <code class=\"notranslate\">config/database.yml</code>.</p>\n<p dir=\"auto\">The defaults that were introduced in 7.1 have been moved to the database.yml generator so new applications can benefit from them while existing applications upgrading 7.1+ won't be impacted side effects.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49691",
            "title": "Move SQLite pragma configuration to the database configuration file",
            "date_modified": "2023-10-19T18:33:57.000Z",
            "date_published": "2023-10-18T18:59:05.000Z",
            "author": {
                "name": "suwyn",
                "url": "https://github.com/suwyn"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR addressed several unrelated issues in the Railties test suite, in order to reduce the amount of noise.</p>\n<p dir=\"auto\"><strong>After</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ bundle exec rake test &gt;&gt; railties_output_patched 2&gt;&amp;1\n$ wc -l railties_output_patched\n    1491 railties_output_patched\"><pre class=\"notranslate\"><code class=\"notranslate\">$ bundle exec rake test &gt;&gt; railties_output_patched 2&gt;&amp;1\n$ wc -l railties_output_patched\n    1491 railties_output_patched\n</code></pre></div>\n<p dir=\"auto\"><strong>Before</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ bundle exec rake test &gt;&gt; railties_output_unpatched 2&gt;&amp;1\n$ wc -l railties_output_unpatched\n   19023 railties_output_unpatched\"><pre class=\"notranslate\"><code class=\"notranslate\">$ bundle exec rake test &gt;&gt; railties_output_unpatched 2&gt;&amp;1\n$ wc -l railties_output_unpatched\n   19023 railties_output_unpatched\n</code></pre></div>\n<p dir=\"auto\">I've kept the commits separate as they are intended to be atomic and preserve context for the git history. It's preferred to review them by commit.</p>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/rails/rails/commit/b85463d72517945ef22df4a3646772e79324965b\">Quiet sqlite3_production_warning on railties/configuration_test</a></li>\n<li><a href=\"https://github.com/rails/rails/commit/eedef9ee22b96b74592d627a546235e00b119a51\">Quiet deprecated cache_format_version = 6.1 warnings</a></li>\n<li><a href=\"https://github.com/rails/rails/commit/3f069aa744c3f7d06d9d3830e50dea6d352bcd3f\">Quiet \"Ignoring db/schema_cache.yml because it has expired.\"</a></li>\n<li><a href=\"https://github.com/rails/rails/commit/c455e02358e4b4d935bfb715e3b999556ce98729\">Fix shared_generator_tests.rb:410 on arm64</a></li>\n<li><a href=\"https://github.com/rails/rails/commit/2dae15cb54227db4126c55c4d070aaff4a74bc33\">Fix railties bundle install tests to stub rails_gemfile_entry</a></li>\n<li><a href=\"https://github.com/rails/rails/commit/ae206cea81d9303b902fdbb000ea25c0c0716a4c\">Change railties default log_level to :error</a></li>\n</ul>\n<p dir=\"auto\">Since this came up in a private review, my intention with <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/eedef9ee22b96b74592d627a546235e00b119a51/hovercard\" href=\"https://github.com/rails/rails/commit/eedef9ee22b96b74592d627a546235e00b119a51\"><tt>eedef9e</tt></a> is that although <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1942177428\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49624\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49624/hovercard\" href=\"https://github.com/rails/rails/pull/49624\">#49624</a> was opened to remove all deprecated code, (1) it didn't include this change and (2) this PR could still be backported without that, so stable branches also benefit.</p>",
            "url": "https://github.com/rails/rails/pull/49679",
            "title": "ðŸ¤« Quiet down railties tests",
            "date_modified": "2023-10-20T15:50:27.000Z",
            "date_published": "2023-10-17T23:01:18.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The private <code class=\"notranslate\">#assign_nested_parameter_attributes</code> was introduced in <a href=\"https://github.com/rails/rails/commit/774ff18c095145f544e845dbb940378546748969\">774ff18</a> (Dec 15, 2011), moved to <code class=\"notranslate\">ActiveRecord::AttributeAssignment</code> in <a href=\"https://github.com/rails/rails/commit/ceb33f84933639d3b61aac62e5e71fd087ab65ed\">ceb33f8</a> (also Dec 15, 2011), then most recently modified in <a href=\"https://github.com/rails/rails/commit/2606fb339797a99c50e531105fc92071cef3db01\">2606fb3</a> (Jan 23, 2015) when <code class=\"notranslate\">ActiveModel::AttributeAssignment</code> was extracted.</p>\n<p dir=\"auto\">Support for <code class=\"notranslate\">accepts_nested_attributes_for</code> (introduced in <a href=\"https://github.com/rails/rails/commit/ec8f04584479aff895b0b511a7ba1e9d33f84067\">ec8f045</a> Feb 1, 2009) pre-dates those commits, and has evolved enough to cover this behavior in other ways.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">With its removal, Active Record's test suite still passes, so if it's a crucial piece of code to retain, we should expand the suite to exercise it.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The fact that removing these methods doesn't fail the test suite came out of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1947803413\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49675\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49675/hovercard\" href=\"https://github.com/rails/rails/pull/49675\">#49675</a>. If that PR isn't deemed to be viable, removing the code in this PR might still have value. If that PR <strong>is</strong> deemed to be viable, we might want to merge this PR ahead of it, then <strong>make similar changes to remove the calls</strong> from <a href=\"https://github.com/rails/rails/pull/49675/files#diff-bd47ea9eef412ec5aca24908af217592cef01d24fd54eeec976bd37bd9a18151R80\">https://github.com/rails/rails/pull/49675/files#diff-bd47ea9eef412ec5aca24908af217592cef01d24fd54eeec976bd37bd9a18151R80</a>.</p>",
            "url": "https://github.com/rails/rails/pull/49678",
            "title": "Remove `ActiveRecord::AttributeAssignment#assign_nested_parameter_attributes`",
            "date_modified": "2023-10-18T15:49:45.000Z",
            "date_published": "2023-10-17T21:46:45.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Prior to this commit, the only difference between<br>\n<code class=\"notranslate\">ActiveRecord::AttributeAssignment</code> and<br>\n<code class=\"notranslate\">ActiveModel::AttributeAssignment</code> was support for multi-parameter attributes like those generated by Action View form helpers.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit reduces <code class=\"notranslate\">ActiveRecord::AttributeAssignment</code>'s responsibility, and instead relies on its inclusion of <code class=\"notranslate\">ActiveModel::AttributeAssignment</code> to implement that behavior.</p>\n<p dir=\"auto\">The added benefit of upstreaming this behavior is that Active Model POROs can be designed to be compatible with Action View Date, DateTime, and Time <code class=\"notranslate\">&lt;select&gt;</code> elements:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Topic\n  include ActiveModel::Model\n  include ActiveModel::Attributes\n\n  attribute :last_read_on, :date\nend\n\ntopic = Topic.new(last_read_on: {\n  &quot;last_read(1i)&quot; =&gt; &quot;2023&quot;,\n  &quot;last_read(2i)&quot; =&gt; &quot;10&quot;,\n  &quot;last_read(3i)&quot; =&gt; &quot;17&quot;\n})\ntopic.last_read_on == Date.new(2023, 10, 17) # =&gt; true\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Topic</span>\n  <span class=\"pl-en\">include</span> <span class=\"pl-v\">ActiveModel</span>::<span class=\"pl-v\">Model</span>\n  <span class=\"pl-en\">include</span> <span class=\"pl-v\">ActiveModel</span>::<span class=\"pl-v\">Attributes</span>\n\n  <span class=\"pl-en\">attribute</span> <span class=\"pl-pds\">:last_read_on</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:date</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">topic</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Topic</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">last_read_on</span>: <span class=\"pl-kos\">{</span>\n  <span class=\"pl-s\">\"last_read(1i)\"</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">\"2023\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-s\">\"last_read(2i)\"</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">\"10\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-s\">\"last_read(3i)\"</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">\"17\"</span>\n<span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">topic</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">last_read_on</span> == <span class=\"pl-v\">Date</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">2023</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">10</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">17</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\"># =&gt; true</span></pre></div>\n<p dir=\"auto\">To maintain backwards compatibility, this commit preserves the <code class=\"notranslate\">ActiveRecord::AttributeAssignment</code> module, despite the fact that it's mostly empty. Additionally, it makes sure that<br>\n<code class=\"notranslate\">ActiveRecord::AttributeAssignmentError</code> and<br>\n<code class=\"notranslate\">ActiveRecord::MultiparameterAssignmentErrors</code> are still thrown. This is important for applications that have generic<br>\n<code class=\"notranslate\">ActiveRecord::ActiveRecordError</code> handling, since the new <code class=\"notranslate\">ActiveModel::AttributeAssignmentError</code> and<br>\n<code class=\"notranslate\">ActiveModel::MultiparameterAssignmentErrors</code> do not inherit from <code class=\"notranslate\">ActiveRecord::ActiveRecordError</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49675",
            "title": "Backport `ActiveRecord::AttributeAssignment` support for multiparameter attributes to Active Model",
            "date_modified": "2023-10-18T21:55:28.000Z",
            "date_published": "2023-10-17T16:23:06.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1753245?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Data encoded using a non-String purpose and <code class=\"notranslate\">use_message_serializer_for_metadata == false</code> was incorrectly decoded,<br>\ntriggering a \"mismatched purpose\" error during decode.<br>\nFix this by ensuring that we compare both sides as a String.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49669",
            "title": "Fix decoding data encoded using a non-String purpose",
            "date_modified": "2023-10-18T17:50:02.000Z",
            "date_published": "2023-10-17T08:01:17.000Z",
            "author": {
                "name": "intrip",
                "url": "https://github.com/intrip"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">An issue was recently raised that users were seeing an error when upgrading <code class=\"notranslate\">@rails/ujs</code> to 7.1.0+:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Uncaught Error: rails-ujs has already been loaded!\"><pre class=\"notranslate\"><code class=\"notranslate\">Uncaught Error: rails-ujs has already been loaded!\n</code></pre></div>\n<p dir=\"auto\">Generally this issue appears due to the difference in how rails-ujs is expected to behave in a pure sprockets environment (js appending) vs a bundled environment (webpack, esbuild, etc.). The sprockets environment is supposed to call start() automatically, while the bundled environment is supposed to require users to import and call start() themselves.</p>\n<p dir=\"auto\">As part of the transition from coffeescript to javascript, a condition was added that was intended to detect whether the current environment was a bundler so that it would only call start() when in sprockets. However, this condition is not working as expected, and I was able to reproduce the error appearing when using rails-ujs with importmaps and esbuild. Interestingly, the issue did not appear when using Webpack as a bundler.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">I believe the best fix here is to make the condition very explicit. Since sprockets users should not be using the esm version of rails-ujs, we can use the rollup replace plugin to explicitly opt the esm bundle out of <em>ever</em> calling start() automatically. This works because terser will run after the replace plugin and remove the whole condition as dead code (since it sees true == false).</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49499.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1928198301\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49499\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49499/hovercard\" href=\"https://github.com/rails/rails/issues/49499\">#49499</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #49606.\">Closes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1940209893\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49606\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49606/hovercard\" href=\"https://github.com/rails/rails/pull/49606\">#49606</a></p>\n<p dir=\"auto\">I tested sprockets, importmaps, esbuild, and webpack using this app: <a href=\"https://github.com/skipkayhil/rails-ujs-app\">https://github.com/skipkayhil/rails-ujs-app</a></p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/tricknotes/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tricknotes\">@tricknotes</a> I added you as a co-author for your work on this issue as well<br>\ncc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/Earlopain/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/Earlopain\">@Earlopain</a> I'd really appreciate if you'd be able to test this out</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49668",
            "title": "Fix rails-ujs auto start() in bundled environments",
            "date_modified": "2023-10-19T07:46:48.000Z",
            "date_published": "2023-10-17T06:32:15.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49597.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1939478732\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49597\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49597/hovercard\" href=\"https://github.com/rails/rails/issues/49597\">#49597</a></p>\n<p dir=\"auto\">Currently Rails generates an invalid SQL when using <code class=\"notranslate\">update_all</code>/<code class=\"notranslate\">delete_all</code> on composite primary models relations with a join subquery due to composite primary key being treated as a single key:</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"UPDATE &quot;my_table&quot; SET &quot;my_column&quot; = ? WHERE &quot;my_table&quot;.&quot;[&quot;&quot;pk_col1&quot;&quot;, &quot;&quot;pk_col2&quot;&quot;]&quot; IN (SELECT &quot;my_table&quot;.&quot;[&quot;&quot;pk_col1&quot;&quot;, &quot;&quot;pk_col2&quot;&quot;]&quot;\"><pre class=\"notranslate\"><span class=\"pl-k\">UPDATE</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>my_table<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">SET</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>my_column<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">=</span> ? <span class=\"pl-k\">WHERE</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>my_table<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>[<span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span>pk_col1<span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span>, <span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span>pk_col2<span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span>]<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">IN</span> (<span class=\"pl-k\">SELECT</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>my_table<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>[<span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span>pk_col1<span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span>, <span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span>pk_col2<span class=\"pl-pds\">\"</span><span class=\"pl-pds\">\"</span>]<span class=\"pl-pds\">\"</span></span></pre></div>\n<p dir=\"auto\">This PR changes <code class=\"notranslate\">update_all</code> and <code class=\"notranslate\">delete_all</code> SQL to build a proper subquery which utilizes what sometimes referred as a row-constructor statement:</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"UPDATE &quot;my_table&quot; SET &quot;my_column&quot; = ? WHERE (&quot;my_table&quot;.&quot;pk_col1&quot;, &quot;my_table&quot;.&quot;pk_col2&quot;) IN (SELECT &quot;my_table&quot;.&quot;pk_col1&quot;, &quot;my_table&quot;.&quot;pk_col2&quot; ...\"><pre class=\"notranslate\"><span class=\"pl-k\">UPDATE</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>my_table<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">SET</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>my_column<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">=</span> ? <span class=\"pl-k\">WHERE</span> (<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>my_table<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>pk_col1<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>my_table<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>pk_col2<span class=\"pl-pds\">\"</span></span>) <span class=\"pl-k\">IN</span> (<span class=\"pl-k\">SELECT</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>my_table<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>pk_col1<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>my_table<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>pk_col2<span class=\"pl-pds\">\"</span></span> ...</pre></div>\n<h3 dir=\"auto\">Biggest concern</h3>\n<p dir=\"auto\">The solution is not as clean as I wish it was due to Arel having no proper way of representing a composite identifier or a group of attributes that represent a composite identifier of a row. Which results in us having an instance of <code class=\"notranslate\">Arel::Attributes::Attribute</code> with <code class=\"notranslate\">name</code> being an array. Relying on <code class=\"notranslate\">name</code> being an Array doesn't feel solid but may be suitable for this bugfix to avoid unnecessary complexity. However, for the long-term I think we need to find a better solution which will allow us to properly represent a group of arel attributes.<br>\nIn my vision this solution will start from <code class=\"notranslate\">Arel::Table#[]</code> method being capable of returning a new abstraction<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/d9e62875ca096ef9cd44a9e97ebc252b04d2455b/activerecord/lib/arel/table.rb#L86-L90\">rails/activerecord/lib/arel/table.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 86 to 90\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/d9e62875ca096ef9cd44a9e97ebc252b04d2455b\">d9e6287</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L86\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"86\"></td>\n          <td id=\"LC86\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> []<span class=\"pl-kos\">(</span><span class=\"pl-s1\">name</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">table</span> <span class=\"pl-c1\">=</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L87\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"87\"></td>\n          <td id=\"LC87\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">name</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">name</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_s</span> <span class=\"pl-k\">if</span> <span class=\"pl-s1\">name</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">is_a?</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Symbol</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L88\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"88\"></td>\n          <td id=\"LC88\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">name</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">@klass</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">attribute_aliases</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">name</span><span class=\"pl-kos\">]</span> || <span class=\"pl-s1\">name</span> <span class=\"pl-k\">if</span> <span class=\"pl-c1\">@klass</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L89\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"89\"></td>\n          <td id=\"LC89\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-v\">Attribute</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">table</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">name</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L90\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"90\"></td>\n          <td id=\"LC90\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n that will allow to correctly represent multiple attributes. So as <code class=\"notranslate\">MyModel.arel_table[[\"col1\", \"col2\"]]</code> doesn't return just an <code class=\"notranslate\">Attribute</code> with a <code class=\"notranslate\">name</code> being an array but something different. This \"something different\" could be one of two things:<p></p>\n<ol dir=\"auto\">\n<li>A new <code class=\"notranslate\">Arel::Attributes::CompositeAttribute</code> type representing a combination of attributes</li>\n<li>A simpler option - an array of <code class=\"notranslate\">Attributes::Attribute</code>. This option might work better as it's simpler and also many existing APIs are capable of processing an array of arel attributes. However at first glance we may end up with a problem of not being able to <code class=\"notranslate\">quote</code> an array here:<br>\n<div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/d9e62875ca096ef9cd44a9e97ebc252b04d2455b/activerecord/lib/active_record/connection_adapters/abstract/quoting.rb#L29\">rails/activerecord/lib/active_record/connection_adapters/abstract/quoting.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 29\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/d9e62875ca096ef9cd44a9e97ebc252b04d2455b\">d9e6287</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L29\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"29\"></td>\n          <td id=\"LC29\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">else</span> <span class=\"pl-en\">raise</span> <span class=\"pl-v\">TypeError</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"can't quote <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">class</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span><span class=\"pl-kos\">}</span></span>\"</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\nbut perhaps it's just me not being familiar enough with arel internals to fit the \"array of arel attributes\" solution into the existing logic.</li>\n</ol>",
            "url": "https://github.com/rails/rails/pull/49655",
            "title": "Fix `update_all/delete_all` on CPK model relation with join subquery",
            "date_modified": "2023-10-16T21:08:56.000Z",
            "date_published": "2023-10-16T19:16:03.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        }
    ]
}