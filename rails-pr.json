{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/15572959?u=524a32c40db55e38d5fd9b1e6920e2a157998a12&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR fixes <code class=\"notranslate\">AbstractController#internal_methods</code> to exclude <code class=\"notranslate\">action_methods</code>.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I tried enabling <a href=\"https://github.com/rails/rails/pull/43487\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/43487/hovercard\"><code class=\"notranslate\">raise_on_missing_callback_actions</code></a> and I found out that <code class=\"notranslate\">MyController#action_methods</code> is missing a method that <code class=\"notranslate\">MyController</code> actually defines. It only happens when a method is also defined by an ancestor abstract controller.</p>\n<p dir=\"auto\">xref <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1769404472\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48559\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48559/hovercard?comment_id=1624321279&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/pull/48559#issuecomment-1624321279\">#48559 (comment)</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48699",
            "title": "AbstractController#internal_methods: ignore action_methods",
            "date_modified": "2023-07-09T19:06:11.000Z",
            "date_published": "2023-07-09T19:03:22.000Z",
            "author": {
                "name": "kamil-gwozdz",
                "url": "https://github.com/kamil-gwozdz"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1773614?u=ddeb4c8dcd174d1b6cb73cfa9ab91808eaba47a0&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveRecord::Base</code> has a dedicated ActiveSupport load hook. This adds a hook for <code class=\"notranslate\">ActiveModel::Model</code>, so that when ActiveModel is being used without ActiveRecord, it can still be modified.</p>\n<p dir=\"auto\">Kredis would be able to use this hook <a href=\"https://github.com/rails/kredis/blob/6e4f77ca7745efe0878bb408c1242db58d99caf8/lib/kredis/railtie.rb#L25-L27\">here</a>. Instead of:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"config.after_initialize do\n  ActiveModel::Model.include Kredis::Attributes if defined?(ActiveModel::Model)\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">after_initialize</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-v\">ActiveModel</span>::<span class=\"pl-v\">Model</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">include</span> <span class=\"pl-v\">Kredis</span>::<span class=\"pl-v\">Attributes</span> <span class=\"pl-k\">if</span> <span class=\"pl-en\">defined?</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">ActiveModel</span>::<span class=\"pl-v\">Model</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">we could write</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"ActiveSupport.on_load(:active_model) do\n  include Kredis::Attributes\nend\"><pre class=\"notranslate\"><span class=\"pl-v\">ActiveSupport</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">on_load</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:active_model</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">include</span> <span class=\"pl-v\">Kredis</span>::<span class=\"pl-v\">Attributes</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">This change would help fix a reported issue at <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1089364457\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/kredis/issues/60\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/kredis/issues/60/hovercard\" href=\"https://github.com/rails/kredis/issues/60\">rails/kredis#60</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">See the motivating issue at <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1089364457\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/kredis/issues/60\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/kredis/issues/60/hovercard\" href=\"https://github.com/rails/kredis/issues/60\">rails/kredis#60</a> and additional comment by <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/fxn/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/fxn\">@fxn</a> here: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1089364457\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/kredis/issues/60\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/kredis/issues/60/hovercard?comment_id=1045966571&amp;comment_type=issue_comment\" href=\"https://github.com/rails/kredis/issues/60#issuecomment-1045966571\">rails/kredis#60 (comment)</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48698",
            "title": "Add a load hook for `ActiveModel::Model`",
            "date_modified": "2023-07-09T12:08:53.000Z",
            "date_published": "2023-07-09T12:06:07.000Z",
            "author": {
                "name": "lewispb",
                "url": "https://github.com/lewispb"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Backports <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1759386886\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48488\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48488/hovercard\" href=\"https://github.com/rails/rails/pull/48488\">#48488</a> to <code class=\"notranslate\">7-0-stable</code>.</p>\n<p dir=\"auto\">It wasn't a clean cherry-pick, so commit by hand. <g-emoji class=\"g-emoji\" alias=\"pray\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f64f.png\">üôè</g-emoji></p>\n<p dir=\"auto\">/cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/eileencodes/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/eileencodes\">@eileencodes</a></p>",
            "url": "https://github.com/rails/rails/pull/48697",
            "title": "[7-0-stable] Backport: Remove no connection primary key test",
            "date_modified": "2023-07-09T09:54:26.000Z",
            "date_published": "2023-07-09T09:54:22.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54629302?u=be8de5137bf940532cddd05aff823129ab8a39db&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48694.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1795195618\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48694\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48694/hovercard\" href=\"https://github.com/rails/rails/issues/48694\">#48694</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes <code class=\"notranslate\">#structurally_incompatible_values_for</code> to always compare the relation value methods in the two relations when using <code class=\"notranslate\">#or</code> and raise when they're incompatible. I've pretty much just reverted the changes <a href=\"https://github.com/rails/rails/pull/39634\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/39634/hovercard\">in this PR</a>, meaning that the tests added/amended there will begin to fail.</p>\n<p dir=\"auto\">The only tests introduced in that PR seem to be when unscoping ordering inside <code class=\"notranslate\">#or</code> but the related changes allow for any incompatible structure so long as it's not explicitly set inside inside <code class=\"notranslate\">#or</code>. This 'fix' is pending feedback on whether such cases should raise an error or whether the changes introduced in that PR are valid.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48695",
            "title": "[Fix #48694] Ensure `ArgumentError` is always raised on structurally incompatible relations with `#or`",
            "date_modified": "2023-07-09T09:47:07.000Z",
            "date_published": "2023-07-09T02:01:13.000Z",
            "author": {
                "name": "joshuay03",
                "url": "https://github.com/joshuay03"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">The previous examples were causing failures in CI, after <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1783993755\" data-permission-text=\"Title is private\" data-url=\"https://github.com/ruby/bigdecimal/issues/264\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/ruby/bigdecimal/pull/264/hovercard\" href=\"https://github.com/ruby/bigdecimal/pull/264\">ruby/bigdecimal#264</a> was merged.</p>\n<p dir=\"auto\">For example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Failure:\nNumericExtFormattingTest#test_default_to_fs [/rails/activesupport/test/core_ext/numeric_ext_test.rb:446]:\n--- expected\n+++ actual\n@@ -1 +1,3 @@\n-&quot;10000 10.0&quot;\n+# encoding: US-ASCII\n+#    valid: true\n+&quot;10 00010.0&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">Failure:\nNumericExtFormattingTest#test_default_to_fs [/rails/activesupport/test/core_ext/numeric_ext_test.rb:446]:\n--- expected\n+++ actual\n@@ -1 +1,3 @@\n-\"10000 10.0\"\n+# encoding: US-ASCII\n+#    valid: true\n+\"10 00010.0\"\n</code></pre></div>\n<p dir=\"auto\">The recommendation was to adjust the test to deal with the upstream change more flexibly.</p>",
            "url": "https://github.com/rails/rails/pull/48693",
            "title": "Use a consistent format when testing BigDecimal.to_s",
            "date_modified": "2023-07-09T08:31:21.000Z",
            "date_published": "2023-07-08T07:46:45.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/47554?u=7f919feee43d319ec01c7b135f4d1868a31bddc3&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">Rails has some configuration options that explicitly type-check on <code class=\"notranslate\">Proc</code> instead of allowing duck-typing. This PR introduces <code class=\"notranslate\">ActiveSupport::Callable</code> which case-equals any object that responds to <code class=\"notranslate\">call</code>.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class CustomQueryWarningsAction\n  def self.call\n    new.very_complex_method\n  end\n  # ....\nend\n\n# This PR allows this:\nconfig.active_record.db_warnings_action = CustomQueryWarningsAction\n\n# ...instead of previously requiring this:\nconfig.active_record.db_warnings_action = CustomQueryWarningsAction.method(:call).to_proc\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">CustomQueryWarningsAction</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">call</span>\n    <span class=\"pl-en\">new</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">very_complex_method</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-c\"># ....</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-c\"># This PR allows this:</span>\n<span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_record</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">db_warnings_action</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">CustomQueryWarningsAction</span>\n\n<span class=\"pl-c\"># ...instead of previously requiring this:</span>\n<span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_record</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">db_warnings_action</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">CustomQueryWarningsAction</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">method</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:call</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_proc</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48691",
            "title": "Create an `ActiveSupport::Callable` object to do case-equality with objects that implement `#call`",
            "date_modified": "2023-07-07T23:41:56.000Z",
            "date_published": "2023-07-07T23:12:18.000Z",
            "author": {
                "name": "bensheldon",
                "url": "https://github.com/bensheldon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/22918438?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This PR addresses a bug with composite primary key models where loading a collection association causes the <code class=\"notranslate\">id</code> column to be set to <code class=\"notranslate\">nil</code> while merging persisted and in-memory records.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">When merging persisted and in-memory records in <code class=\"notranslate\">#merge_target_list</code>, we use <code class=\"notranslate\">record[name]</code> to get the value of the attribute. For records with a composite primary key, the full CPK is returned from <code class=\"notranslate\">record[\"id\"]</code>, which is incompatible with <code class=\"notranslate\">#_write_attribute</code>: we attempt to assign an Array to the <code class=\"notranslate\">id</code> column, which results in the column being set to nil.</p>\n<p dir=\"auto\">When dealing with a record with a composite primary key, we need to write each part of the primary key individually via <code class=\"notranslate\">#_write_attribute</code>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">One alternative to calling <code class=\"notranslate\">#_write_attribute</code> for each part of the primary key would be to simply delegate to the <code class=\"notranslate\">id=</code> method, which is already capable of assigning each part of the CPK accordingly and ultimately delegates to <code class=\"notranslate\">#_write_attribute</code>:<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/a5fc471b3f4bbd02e6be38dae023526a49e7d049/activerecord/lib/active_record/attribute_methods/primary_key.rb#L32-L39\">rails/activerecord/lib/active_record/attribute_methods/primary_key.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 32 to 39\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/a5fc471b3f4bbd02e6be38dae023526a49e7d049\">a5fc471</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L32\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"32\"></td>\n          <td id=\"LC32\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">id</span><span class=\"pl-c1\">=</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L33\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"33\"></td>\n          <td id=\"LC33\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">if</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">class</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">composite_primary_key?</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L34\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"34\"></td>\n          <td id=\"LC34\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">raise</span> <span class=\"pl-v\">TypeError</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"Expected value matching <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">class</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">primary_key</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">inspect</span><span class=\"pl-kos\">}</span></span>, got <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">inspect</span><span class=\"pl-kos\">}</span></span>.\"</span> <span class=\"pl-k\">unless</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">is_a?</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Enumerable</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L35\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"35\"></td>\n          <td id=\"LC35\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-c1\">@primary_key</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">zip</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">attr</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">value</span>| <span class=\"pl-en\">_write_attribute</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attr</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L36\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"36\"></td>\n          <td id=\"LC36\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">else</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L37\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"37\"></td>\n          <td id=\"LC37\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">_write_attribute</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">@primary_key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L38\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"38\"></td>\n          <td id=\"LC38\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">end</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L39\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"39\"></td>\n          <td id=\"LC39\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">However, this duplicates the check to <code class=\"notranslate\">composite_primary_key?</code>, and I felt it would be more appropriate to go through <code class=\"notranslate\">#_write_attribute</code> directly in both branches of the conditional.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48690",
            "title": "Prevent `#merge_target_lists` from clearing id column on composite primary key records",
            "date_modified": "2023-07-07T20:52:49.000Z",
            "date_published": "2023-07-07T20:48:10.000Z",
            "author": {
                "name": "adrianna-chang-shopify",
                "url": "https://github.com/adrianna-chang-shopify"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/58582?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created to <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48685.\">fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1793527161\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48685\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48685/hovercard\" href=\"https://github.com/rails/rails/issues/48685\">#48685</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">[<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48685.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1793527161\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48685\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48685/hovercard\" href=\"https://github.com/rails/rails/issues/48685\">#48685</a>] Make the encryptor agnostic of the type of data to decrypt</p>\n<p dir=\"auto\">The default message serializer will raise a <code class=\"notranslate\">TypeError</code> when invoking <code class=\"notranslate\">JSON.parse</code> on any non-<code class=\"notranslate\">String</code> input. This error will subsequently be translated into an <code class=\"notranslate\">ActiveRecord::Encryption::Errors::Encoding</code> error and then a <code class=\"notranslate\">ActiveRecord::Encryption::Errors::Decryption</code> error by the encryptor, which does not change the current behavior at the encryptor level.</p>\n<p dir=\"auto\">This change clarifies that it is the role of the underlying serializer to accept or reject the data to decrypt depending on its type. This behavior mirrors what is done at encryption, where the serializer asserts that the input is an <code class=\"notranslate\">ActiveRecord::Encryption::Message</code>.</p>\n<p dir=\"auto\">This change is a no-op when using the default <code class=\"notranslate\">MessageSerializer</code> class, but it enables the use a wider variety of custom serializers.</p>\n<p dir=\"auto\">By being agnostic of the type of data to decrypt at the encryptor level, it is now possible to serialize and store messages in a binary format (e.g. in a <code class=\"notranslate\">bytea</code> column in PostgreSQL). A custom message serializer is now able to decrypt binary values coming from the database (<code class=\"notranslate\">String</code>) or from user input (<code class=\"notranslate\">ActiveModel::Type::Binary::Data</code>) without having an exception raised at the encryptor level because the type is not <code class=\"notranslate\">String</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48686",
            "title": "[Fix #48685] Make the encryptor agnostic of the type of data to decrypt",
            "date_modified": "2023-07-07T20:30:26.000Z",
            "date_published": "2023-07-07T13:18:03.000Z",
            "author": {
                "name": "maximerety",
                "url": "https://github.com/maximerety"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">The goal is to raise an exception when calling <code class=\"notranslate\">create_association</code> which would replace an already persisted association.</p>\n<p dir=\"auto\">Here is a failing test report as well:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire &quot;bundler/inline&quot;\n\ngemfile(true) do\n  source &quot;https://rubygems.org&quot;\n\n  gem &quot;rails&quot;, github: &quot;rails/rails&quot;, branch: &quot;main&quot;\n  gem &quot;sqlite3&quot;\nend\n\nrequire &quot;active_record&quot;\nrequire &quot;active_support/testing/assertions&quot;\nrequire &quot;minitest/autorun&quot;\nrequire &quot;logger&quot;\n\n# This connection will do for database-independent bug reports.\nActiveRecord::Base.establish_connection(adapter: &quot;sqlite3&quot;, database: &quot;:memory:&quot;)\nActiveRecord::Base.logger = Logger.new(STDOUT)\n\nActiveRecord::Schema.define do\n  create_table :authors, force: true\n\n  create_table :books, force: true do |t|\n    t.integer :author_id\n  end\nend\n\nclass Author &lt; ActiveRecord::Base\n  has_one :book\nend\n\nclass Book &lt; ActiveRecord::Base\n  belongs_to :author\n  validates :author_id, uniqueness: true\nend\n\nclass BugTest &lt; Minitest::Test\n  include ActiveSupport::Testing::Assertions\n\n  def test_association_stuff\n    author = Author.create!\n    author.create_book!\n\n    assert_no_difference -&gt; { Book.count } do\n      assert_raises ActiveRecord::RecordNotSaved do\n        author.create_book!\n      end\n    end\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/inline\"</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">\"https://rubygems.org\"</span>\n\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"rails\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">github</span>: <span class=\"pl-s\">\"rails/rails\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">branch</span>: <span class=\"pl-s\">\"main\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"sqlite3\"</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_record\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/testing/assertions\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"minitest/autorun\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"logger\"</span>\n\n<span class=\"pl-c\"># This connection will do for database-independent bug reports.</span>\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">establish_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">adapter</span>: <span class=\"pl-s\">\"sqlite3\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">database</span>: <span class=\"pl-s\">\":memory:\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Schema</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">define</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:authors</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span>\n\n  <span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:books</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">integer</span> <span class=\"pl-pds\">:author_id</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Author</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">has_one</span> <span class=\"pl-pds\">:book</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Book</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:author</span>\n  <span class=\"pl-en\">validates</span> <span class=\"pl-pds\">:author_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">uniqueness</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">BugTest</span> &lt; <span class=\"pl-v\">Minitest</span>::<span class=\"pl-v\">Test</span>\n  <span class=\"pl-en\">include</span> <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">Testing</span>::<span class=\"pl-v\">Assertions</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_association_stuff</span>\n    <span class=\"pl-s1\">author</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Author</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create!</span>\n    <span class=\"pl-s1\">author</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create_book!</span>\n\n    <span class=\"pl-en\">assert_no_difference</span> <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-v\">Book</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">count</span> <span class=\"pl-kos\">}</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-en\">assert_raises</span> <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">RecordNotSaved</span> <span class=\"pl-k\">do</span>\n        <span class=\"pl-s1\">author</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create_book!</span>\n      <span class=\"pl-k\">end</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>",
            "url": "https://github.com/rails/rails/pull/48683",
            "title": "HasOne `create_association` should raise if association already exists",
            "date_modified": "2023-07-09T09:32:24.000Z",
            "date_published": "2023-07-07T06:13:00.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8207?u=519e0cd2eb38c2b5c30ce471f5801c3b77b37f31&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><g-emoji class=\"g-emoji\" alias=\"warning\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/26a0.png\">‚ö†</g-emoji> NOTE: this PR is dependent upon <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1792114069\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails-dom-testing/issues/109\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails-dom-testing/pull/109/hovercard\" href=\"https://github.com/rails/rails-dom-testing/pull/109\">rails/rails-dom-testing#109</a></p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Some early users of Rails edge reported test breakage due to the change in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1764190810\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48523\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48523/hovercard\" href=\"https://github.com/rails/rails/pull/48523\">#48523</a> that updated test helpers to use Nokogiri's HTML5 parser.</p>\n<p dir=\"auto\">After discussing with Rafael, he suggested that we introduce a Rails config parameter so users may opt into this change at their convenience, essentially wrapping a config param around the changes in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1764190810\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48523\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48523/hovercard\" href=\"https://github.com/rails/rails/pull/48523\">#48523</a>.</p>\n<p dir=\"auto\">This PR takes that idea a step further and groups all the test helpers from <code class=\"notranslate\">ActionView::TestCase</code>, <code class=\"notranslate\">ActionDispatch::Assertions</code>, and everything in <code class=\"notranslate\">Rails::Dom::Testing</code> under a single config param:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"config.dom_testing_default_html_version\"><pre class=\"notranslate\"><code class=\"notranslate\">config.dom_testing_default_html_version\n</code></pre></div>\n<p dir=\"auto\">As a result, by setting this config to either <code class=\"notranslate\">:html4</code> or <code class=\"notranslate\">:html5</code>, a developer can control the HTML parser used by all the test helpers in Action View, Action Dispatch, and Rails::Dom::Testing; and some assertions support overriding that default for individual tests.</p>\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>new config parameter <code class=\"notranslate\">config.dom_testing_default_html_version</code>, which is injected into <code class=\"notranslate\">Dom::Rails::Testing</code> via the railstie in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1792114069\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails-dom-testing/issues/109\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails-dom-testing/pull/109/hovercard\" href=\"https://github.com/rails/rails-dom-testing/pull/109\">rails/rails-dom-testing#109</a>\n<ul dir=\"auto\">\n<li>the value of that param is <code class=\"notranslate\">:html5</code> in Rails 7.1, and <code class=\"notranslate\">:html4</code> in earlier config versions</li>\n<li>though, on JRuby, where Nokogiri::HTML5 is not supported, this will always be <code class=\"notranslate\">:html4</code></li>\n</ul>\n</li>\n<li>Action View and Dispatch test helpers use <code class=\"notranslate\">Rails::Dom::Testing.html_document</code> or <code class=\"notranslate\">.html_document_fragment</code> to ensure the desired HTML parser is used</li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">If and when <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1792114069\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails-dom-testing/issues/109\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails-dom-testing/pull/109/hovercard\" href=\"https://github.com/rails/rails-dom-testing/pull/109\">rails/rails-dom-testing#109</a> is merged and a new version is cut, then this PR should be updated to require that new version (presumably <code class=\"notranslate\">~&gt;2.2</code>).</p>\n<p dir=\"auto\">Note that integration testing across gems like this is challenging, but I have actually fired up a Rails app using this PR and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1792114069\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails-dom-testing/issues/109\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails-dom-testing/pull/109/hovercard\" href=\"https://github.com/rails/rails-dom-testing/pull/109\">rails/rails-dom-testing#109</a> together, and it worked as expected.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48682",
            "title": "Introduce `config.dom_testing_default_html_version` and use Rails::Dom::Testing to parse HTML in test helpers",
            "date_modified": "2023-07-09T01:42:10.000Z",
            "date_published": "2023-07-06T20:03:36.000Z",
            "author": {
                "name": "flavorjones",
                "url": "https://github.com/flavorjones"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/28561?u=095779352a57f75e734987829f3f67a10e5780ed&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">If anyone calls a cypher in the console it will show the secret of the encryptor.</p>\n<p dir=\"auto\">By overriding the inspect method to only show the class name we can avoid accidentally outputting sensitive information.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Before:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"ActiveSupport::MessageVerifier.new(secret).inspect\n&quot;#&lt;ActiveSupport::MessageVerifier:0x0000000104888038 ... @secret=\\&quot;\\\\xAF\\\\bFh]LV}q\\\\nl\\\\xB2U\\\\xB3 ... &gt;&quot;\nActiveSupport::KeyGenerator.new(secret).inspect\n&quot;#&lt;ActiveSupport::KeyGenerator:0x0000000104888038 ... @secret=\\&quot;\\\\xAF\\\\bFh]LV}q\\\\nl\\\\xB2U\\\\xB3 ... &gt;&quot;\"><pre class=\"notranslate\"><span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">MessageVerifier</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">secret</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">inspect</span>\n<span class=\"pl-s\">\"#&lt;ActiveSupport::MessageVerifier:0x0000000104888038 ... @secret=<span class=\"pl-cce\">\\\"</span><span class=\"pl-cce\">\\\\</span>xAF<span class=\"pl-cce\">\\\\</span>bFh]LV}q<span class=\"pl-cce\">\\\\</span>nl<span class=\"pl-cce\">\\\\</span>xB2U<span class=\"pl-cce\">\\\\</span>xB3 ... &gt;\"</span>\n<span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">KeyGenerator</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">secret</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">inspect</span>\n<span class=\"pl-s\">\"#&lt;ActiveSupport::KeyGenerator:0x0000000104888038 ... @secret=<span class=\"pl-cce\">\\\"</span><span class=\"pl-cce\">\\\\</span>xAF<span class=\"pl-cce\">\\\\</span>bFh]LV}q<span class=\"pl-cce\">\\\\</span>nl<span class=\"pl-cce\">\\\\</span>xB2U<span class=\"pl-cce\">\\\\</span>xB3 ... &gt;\"</span></pre></div>\n<p dir=\"auto\">After:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"ActiveSupport::MessageVerifier::Aes256Gcm(secret).inspect\n&quot;#&lt;ActiveSupport::MessageVerifier:0x0000000104888038&gt;&quot;\nActiveSupport::KeyGenerator::Aes256Gcm(secret).inspect\n&quot;#&lt;ActiveSupport::KeyGenerator:0x0000000104888038&gt;&quot;\"><pre class=\"notranslate\"><span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">MessageVerifier</span>::<span class=\"pl-en\">Aes256Gcm</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">secret</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">inspect</span>\n<span class=\"pl-s\">\"#&lt;ActiveSupport::MessageVerifier:0x0000000104888038&gt;\"</span>\n<span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">KeyGenerator</span>::<span class=\"pl-en\">Aes256Gcm</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">secret</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">inspect</span>\n<span class=\"pl-s\">\"#&lt;ActiveSupport::KeyGenerator:0x0000000104888038&gt;\"</span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48680",
            "title": "Don't show secrets for `MessageVerifier#inspect` and `KeyGenerator#inspect`",
            "date_modified": "2023-07-06T19:55:26.000Z",
            "date_published": "2023-07-06T19:55:12.000Z",
            "author": {
                "name": "p8",
                "url": "https://github.com/p8"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/28561?u=095779352a57f75e734987829f3f67a10e5780ed&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">If anyone calls a cypher in the console it will show the secret of the encryptor.</p>\n<p dir=\"auto\">By overriding the <code class=\"notranslate\">inspect</code> method to only show the class name we can avoid accidentally outputting sensitive information.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Before:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"ActiveRecord::Encryption::Cipher::Aes256Gcm.new(secret).inspect\n&quot;#&lt;ActiveRecord::Encryption::Cipher::Aes256Gcm:0x0000000104888038 ... @secret=\\&quot;\\\\xAF\\\\bFh]LV}q\\\\nl\\\\xB2U\\\\xB3 ... &gt;&quot;\"><pre class=\"notranslate\"><span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Encryption</span>::<span class=\"pl-v\">Cipher</span>::<span class=\"pl-v\">Aes256Gcm</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">secret</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">inspect</span>\n<span class=\"pl-s\">\"#&lt;ActiveRecord::Encryption::Cipher::Aes256Gcm:0x0000000104888038 ... @secret=<span class=\"pl-cce\">\\\"</span><span class=\"pl-cce\">\\\\</span>xAF<span class=\"pl-cce\">\\\\</span>bFh]LV}q<span class=\"pl-cce\">\\\\</span>nl<span class=\"pl-cce\">\\\\</span>xB2U<span class=\"pl-cce\">\\\\</span>xB3 ... &gt;\"</span></pre></div>\n<p dir=\"auto\">After:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"ActiveRecord::Encryption::Cipher::Aes256Gcm(secret).inspect\n&quot;#&lt;ActiveRecord::Encryption::Cipher::Aes256Gcm:0x0000000104888038&gt;&quot;\"><pre class=\"notranslate\"><span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Encryption</span>::<span class=\"pl-v\">Cipher</span>::<span class=\"pl-en\">Aes256Gcm</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">secret</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">inspect</span>\n<span class=\"pl-s\">\"#&lt;ActiveRecord::Encryption::Cipher::Aes256Gcm:0x0000000104888038&gt;\"</span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48679",
            "title": "Don't show secrets for Active Record's `Cipher::Aes256Gcm#inspect`.",
            "date_modified": "2023-07-06T19:41:42.000Z",
            "date_published": "2023-07-06T19:36:22.000Z",
            "author": {
                "name": "p8",
                "url": "https://github.com/p8"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/4289625?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because the recent updates in contribution guide are good for backport to 7-0-stable branch.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds the following to 7-0-stable branch.</p>\n<ul dir=\"auto\">\n<li><a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/e4002fcc40de73894ba416d5e932fbf11bd002b6/hovercard\" href=\"https://github.com/rails/rails/commit/e4002fcc40de73894ba416d5e932fbf11bd002b6\"><tt>e4002fc</tt></a></li>\n<li><a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/11213ce8eb2f98435b0f642989fc3dbfd47ed8ef/hovercard\" href=\"https://github.com/rails/rails/commit/11213ce8eb2f98435b0f642989fc3dbfd47ed8ef\"><tt>11213ce</tt></a></li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48677",
            "title": "[ci-skip] Backport update in contribution guide to 7-0-stable branch",
            "date_modified": "2023-07-06T11:14:46.000Z",
            "date_published": "2023-07-06T11:14:18.000Z",
            "author": {
                "name": "hachi8833",
                "url": "https://github.com/hachi8833"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/129938?u=7637e813584057fbf1a3fa83dca8b4d444c16f79&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1765439665\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48530\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48530/hovercard\" href=\"https://github.com/rails/rails/pull/48530\">#48530</a> introduced a problem for the system that extends AR queries involving deterministically encrypted attributes. The problem is that this option added the same \"previous scheme\" for all the attributes, when the only intended ones were the \"non deterministic\" ones. A side effect of this is that, when encrypting query param values, it was using the wrong encryption scheme.</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48204.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1707228995\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48204\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48204/hovercard?comment_id=1623301440&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/issues/48204#issuecomment-1623301440\">#48204 (comment)</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48676",
            "title": "Fix queries for deterministically encrypted attributed for data migrated from 7.0",
            "date_modified": "2023-07-07T14:06:49.000Z",
            "date_published": "2023-07-06T10:45:43.000Z",
            "author": {
                "name": "jorgemanrubia",
                "url": "https://github.com/jorgemanrubia"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/347652?u=211403a9eea104300ae30c2b63600214c7180e80&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created to resolve race conditions in threaded code when loading instances of <code class=\"notranslate\">CollectionAssociation</code> on an object which is shared across threads. Issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1790337154\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48671\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48671/hovercard\" href=\"https://github.com/rails/rails/issues/48671\">#48671</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the implementation of two methods to prevent them from mutating an instance variable in ways that violate the expectations of methods which rely on that variable.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The array lookup in <code class=\"notranslate\">merge_target_lists</code> could be done in other ways; the <code class=\"notranslate\">index</code> lookup appears at least as fast as <code class=\"notranslate\">delete</code> on my hardware; other approaches using enumerable methods would be slower.</p>\n<p dir=\"auto\">The nature of the issue is timing-dependent in a way that would make it difficult to write explicit tests to reproduce; I think that a lack of regression in existing tests would be sufficient verification.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> <del>Tests are added or updated if you fix a bug or add a feature.</del></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> <del>CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</del></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48672",
            "title": "Refactor CollectionAssociation to improve thread-safety; Fixes #48671",
            "date_modified": "2023-07-07T16:44:01.000Z",
            "date_published": "2023-07-05T21:22:38.000Z",
            "author": {
                "name": "mullican",
                "url": "https://github.com/mullican"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/131752?u=32ddf1119b1d189c9bd241a721b36ea01c29f61e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This improves <code class=\"notranslate\">.to_json</code> performance to be another ~2x faster (now ~4.5 faster than Rails 7.0)</p>\n<p dir=\"auto\">In this case (likely not others!), running <code class=\"notranslate\">gsub!</code> 5 times with string arguments seems to be faster than running it once with a regex and Hash.</p>\n<p dir=\"auto\">When there are matches to the regex (there are characters to escape) this is faster in part because CRuby will allocate a new match object and string as a key to lookup in the map hash provided. It's possible that could be optimized upstream, but at the moment this avoids those allocations.</p>\n<p dir=\"auto\">Surprisingly (at least to me) this is still much faster when there is no replacement needed: in my test ~3x faster on a short ~200 byte string, and ~5x faster on a pre-escaped ~600k twitter.json.</p>\n<h2 dir=\"auto\">Benchmarks</h2>\n<h3 dir=\"auto\">Just escaping</h3>\n<details>\n<summary>script</summary>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"require &quot;rails/all&quot;\nrequire &quot;benchmark/ips&quot;\nrequire &quot;json_escape&quot;\n\n\nsource_file = ENV[&quot;FILE&quot;] || &quot;twitter.json&quot;\njson = File.read(source_file).freeze\n\nESCAPED_CHARS = {\n  &quot;\\u2028&quot; =&gt; '\\u2028',\n  &quot;\\u2029&quot; =&gt; '\\u2029',\n  &quot;&gt;&quot;      =&gt; '\\u003e',\n  &quot;&lt;&quot;      =&gt; '\\u003c',\n  &quot;&amp;&quot;      =&gt; '\\u0026',\n}\n\nescaped_json = json.gsub(/[\\u2028\\u2029&gt;&lt;&amp;]/u, ESCAPED_CHARS).freeze\n\nBenchmark.ips do |x|\n  x.report(&quot;original&quot;) do\n    s = json.dup\n    s.gsub!(/[\\u2028\\u2029&gt;&lt;&amp;]/u, ESCAPED_CHARS)\n  end\n  x.report(&quot;original (noop)&quot;) do\n    s = escaped_json.dup\n    s.gsub!(/[\\u2028\\u2029&gt;&lt;&amp;]/u, ESCAPED_CHARS)\n  end\n  x.report(&quot;gsub(str) x 5&quot;) do\n    s = json.dup\n    s.gsub!(&quot;&gt;&quot;, '\\u003e')\n    s.gsub!(&quot;&lt;&quot;, '\\u003c')\n    s.gsub!(&quot;&amp;&quot;, '\\u0026')\n    s.gsub!(&quot;\\u2028&quot;, '\\u2028')\n    s.gsub!(&quot;\\u2029&quot;, '\\u2029')\n  end\n  x.report(&quot;gsub(str) x 5 (noop)&quot;) do\n    s = escaped_json.dup\n    s.gsub!(&quot;&gt;&quot;, '\\u003e')\n    s.gsub!(&quot;&lt;&quot;, '\\u003c')\n    s.gsub!(&quot;&amp;&quot;, '\\u0026')\n    s.gsub!(&quot;\\u2028&quot;, '\\u2028')\n    s.gsub!(&quot;\\u2029&quot;, '\\u2029')\n  end\n  x.report(&quot;gsub(ascii_re) + gsub(utf8)&quot;) do\n    s = json.dup\n    s.gsub!(/[&lt;&gt;&amp;]/, ESCAPED_CHARS)\n    s.gsub!(&quot;\\u2028&quot;, '\\u2028')\n    s.gsub!(&quot;\\u2029&quot;, '\\u2029')\n  end\n  x.report(&quot;gsub(ascii_re) + gsub(utf8) (noop)&quot;) do\n    s = escaped_json.dup\n    s.gsub!(/[&lt;&gt;&amp;]/, ESCAPED_CHARS)\n    s.gsub!(&quot;\\u2028&quot;, '\\u2028')\n    s.gsub!(&quot;\\u2029&quot;, '\\u2029')\n  end\n  x.report(&quot;json_escape gem&quot;) do\n    JsonEscape.json_escape(json)\n  end\n  x.compare!\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">require</span> <span class=\"pl-s\">\"rails/all\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"benchmark/ips\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"json_escape\"</span>\n\n\n<span class=\"pl-s1\">source_file</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"FILE\"</span><span class=\"pl-kos\">]</span> || <span class=\"pl-s\">\"twitter.json\"</span>\n<span class=\"pl-s1\">json</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">File</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">read</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">source_file</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">freeze</span>\n\n<span class=\"pl-c1\">ESCAPED_CHARS</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2028</span>\"</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">'\\u2028'</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2029</span>\"</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">'\\u2029'</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-s\">\"&gt;\"</span>      <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">'\\u003e'</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-s\">\"&lt;\"</span>      <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">'\\u003c'</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-s\">\"&amp;\"</span>      <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">'\\u0026'</span><span class=\"pl-kos\">,</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-s1\">escaped_json</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/[<span class=\"pl-cce\">\\u2028</span><span class=\"pl-cce\">\\u2029</span>&gt;&lt;&amp;]/u</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">ESCAPED_CHARS</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">freeze</span>\n\n<span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"original\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">s</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/[<span class=\"pl-cce\">\\u2028</span><span class=\"pl-cce\">\\u2029</span>&gt;&lt;&amp;]/u</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">ESCAPED_CHARS</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"original (noop)\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">s</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">escaped_json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/[<span class=\"pl-cce\">\\u2028</span><span class=\"pl-cce\">\\u2029</span>&gt;&lt;&amp;]/u</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">ESCAPED_CHARS</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"gsub(str) x 5\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">s</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"&gt;\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u003e'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"&lt;\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u003c'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"&amp;\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u0026'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2028</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2028'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2029</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2029'</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"gsub(str) x 5 (noop)\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">s</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">escaped_json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"&gt;\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u003e'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"&lt;\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u003c'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"&amp;\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u0026'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2028</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2028'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2029</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2029'</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"gsub(ascii_re) + gsub(utf8)\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">s</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/[&lt;&gt;&amp;]/</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">ESCAPED_CHARS</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2028</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2028'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2029</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2029'</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"gsub(ascii_re) + gsub(utf8) (noop)\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">s</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">escaped_json</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/[&lt;&gt;&amp;]/</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">ESCAPED_CHARS</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2028</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2028'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub!</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\u2029</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\u2029'</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"json_escape gem\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-v\">JsonEscape</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">json_escape</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">json</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">compare!</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\"><code class=\"notranslate\">short.json</code> is</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{&quot;locale&quot;:&quot;en&quot;,&quot;featureFlags&quot;:[&quot;redactedredactedredact&quot;,&quot;redactedredactedredac&quot;,&quot;redactedredactedre&quot;,&quot;redactedredactedred&quot;,&quot;redactedredact&quot;,&quot;redactedredactedredacted&quot;,&quot;redactedredactedredactedr&quot;]}\"><pre class=\"notranslate\"><code class=\"notranslate\">{\"locale\":\"en\",\"featureFlags\":[\"redactedredactedredact\",\"redactedredactedredac\",\"redactedredactedre\",\"redactedredactedred\",\"redactedredact\",\"redactedredactedredacted\",\"redactedredactedredactedr\"]}\n</code></pre></div>\n</details>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ FILE=twitter.json be ruby benchmark_escaping2.rb\nWarming up --------------------------------------\n            original     9.000  i/100ms\n     original (noop)    10.000  i/100ms\n       gsub(str) x 5    44.000  i/100ms\ngsub(str) x 5 (noop)   229.000  i/100ms\ngsub(ascii_re) + gsub(utf8)\n                        25.000  i/100ms\ngsub(ascii_re) + gsub(utf8) (noop)\n                        32.000  i/100ms\n     json_escape gem   919.000  i/100ms\nCalculating -------------------------------------\n            original     94.573  (¬± 0.0%) i/s -    477.000  in   5.043877s\n     original (noop)    100.715  (¬± 0.0%) i/s -    510.000  in   5.063885s\n       gsub(str) x 5    496.012  (¬± 7.9%) i/s -      2.464k in   5.002329s\ngsub(str) x 5 (noop)      2.302k (¬± 0.7%) i/s -     11.679k in   5.074632s\ngsub(ascii_re) + gsub(utf8)\n                        257.878  (¬± 0.8%) i/s -      1.300k in   5.041332s\ngsub(ascii_re) + gsub(utf8) (noop)\n                        321.248  (¬± 0.6%) i/s -      1.632k in   5.080333s\n     json_escape gem      8.958k (¬± 0.3%) i/s -     45.031k in   5.026965s\n\nComparison:\n     json_escape gem:     8958.0 i/s\ngsub(str) x 5 (noop):     2301.5 i/s - 3.89x  slower\n       gsub(str) x 5:      496.0 i/s - 18.06x  slower\ngsub(ascii_re) + gsub(utf8) (noop):      321.2 i/s - 27.88x  slower\ngsub(ascii_re) + gsub(utf8):      257.9 i/s - 34.74x  slower\n     original (noop):      100.7 i/s - 88.94x  slower\n            original:       94.6 i/s - 94.72x  slower\"><pre class=\"notranslate\"><code class=\"notranslate\">$ FILE=twitter.json be ruby benchmark_escaping2.rb\nWarming up --------------------------------------\n            original     9.000  i/100ms\n     original (noop)    10.000  i/100ms\n       gsub(str) x 5    44.000  i/100ms\ngsub(str) x 5 (noop)   229.000  i/100ms\ngsub(ascii_re) + gsub(utf8)\n                        25.000  i/100ms\ngsub(ascii_re) + gsub(utf8) (noop)\n                        32.000  i/100ms\n     json_escape gem   919.000  i/100ms\nCalculating -------------------------------------\n            original     94.573  (¬± 0.0%) i/s -    477.000  in   5.043877s\n     original (noop)    100.715  (¬± 0.0%) i/s -    510.000  in   5.063885s\n       gsub(str) x 5    496.012  (¬± 7.9%) i/s -      2.464k in   5.002329s\ngsub(str) x 5 (noop)      2.302k (¬± 0.7%) i/s -     11.679k in   5.074632s\ngsub(ascii_re) + gsub(utf8)\n                        257.878  (¬± 0.8%) i/s -      1.300k in   5.041332s\ngsub(ascii_re) + gsub(utf8) (noop)\n                        321.248  (¬± 0.6%) i/s -      1.632k in   5.080333s\n     json_escape gem      8.958k (¬± 0.3%) i/s -     45.031k in   5.026965s\n\nComparison:\n     json_escape gem:     8958.0 i/s\ngsub(str) x 5 (noop):     2301.5 i/s - 3.89x  slower\n       gsub(str) x 5:      496.0 i/s - 18.06x  slower\ngsub(ascii_re) + gsub(utf8) (noop):      321.2 i/s - 27.88x  slower\ngsub(ascii_re) + gsub(utf8):      257.9 i/s - 34.74x  slower\n     original (noop):      100.7 i/s - 88.94x  slower\n            original:       94.6 i/s - 94.72x  slower\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ FILE=short.json be ruby benchmark_escaping2.rb\nWarming up --------------------------------------\n            original    26.846k i/100ms\n     original (noop)    27.998k i/100ms\n       gsub(str) x 5    82.923k i/100ms\ngsub(str) x 5 (noop)    83.683k i/100ms\ngsub(ascii_re) + gsub(utf8)\n                       103.509k i/100ms\ngsub(ascii_re) + gsub(utf8) (noop)\n                       103.445k i/100ms\n     json_escape gem     1.424M i/100ms\nCalculating -------------------------------------\n            original    279.761k (¬± 1.6%) i/s -      1.423M in   5.087410s\n     original (noop)    279.118k (¬± 2.1%) i/s -      1.400M in   5.017966s\n       gsub(str) x 5    835.196k (¬± 0.5%) i/s -      4.229M in   5.063709s\ngsub(str) x 5 (noop)    832.362k (¬± 0.9%) i/s -      4.184M in   5.027225s\ngsub(ascii_re) + gsub(utf8)\n                          1.028M (¬± 0.7%) i/s -      5.175M in   5.035134s\ngsub(ascii_re) + gsub(utf8) (noop)\n                          1.032M (¬± 0.5%) i/s -      5.172M in   5.014163s\n     json_escape gem     14.476M (¬± 0.7%) i/s -     72.617M in   5.016768s\n\nComparison:\n     json_escape gem: 14475588.1 i/s\ngsub(ascii_re) + gsub(utf8) (noop):  1031551.3 i/s - 14.03x  slower\ngsub(ascii_re) + gsub(utf8):  1027913.4 i/s - 14.08x  slower\n       gsub(str) x 5:   835196.3 i/s - 17.33x  slower\ngsub(str) x 5 (noop):   832361.5 i/s - 17.39x  slower\n            original:   279761.3 i/s - 51.74x  slower\n     original (noop):   279117.6 i/s - 51.86x  slower\"><pre class=\"notranslate\"><code class=\"notranslate\">$ FILE=short.json be ruby benchmark_escaping2.rb\nWarming up --------------------------------------\n            original    26.846k i/100ms\n     original (noop)    27.998k i/100ms\n       gsub(str) x 5    82.923k i/100ms\ngsub(str) x 5 (noop)    83.683k i/100ms\ngsub(ascii_re) + gsub(utf8)\n                       103.509k i/100ms\ngsub(ascii_re) + gsub(utf8) (noop)\n                       103.445k i/100ms\n     json_escape gem     1.424M i/100ms\nCalculating -------------------------------------\n            original    279.761k (¬± 1.6%) i/s -      1.423M in   5.087410s\n     original (noop)    279.118k (¬± 2.1%) i/s -      1.400M in   5.017966s\n       gsub(str) x 5    835.196k (¬± 0.5%) i/s -      4.229M in   5.063709s\ngsub(str) x 5 (noop)    832.362k (¬± 0.9%) i/s -      4.184M in   5.027225s\ngsub(ascii_re) + gsub(utf8)\n                          1.028M (¬± 0.7%) i/s -      5.175M in   5.035134s\ngsub(ascii_re) + gsub(utf8) (noop)\n                          1.032M (¬± 0.5%) i/s -      5.172M in   5.014163s\n     json_escape gem     14.476M (¬± 0.7%) i/s -     72.617M in   5.016768s\n\nComparison:\n     json_escape gem: 14475588.1 i/s\ngsub(ascii_re) + gsub(utf8) (noop):  1031551.3 i/s - 14.03x  slower\ngsub(ascii_re) + gsub(utf8):  1027913.4 i/s - 14.08x  slower\n       gsub(str) x 5:   835196.3 i/s - 17.33x  slower\ngsub(str) x 5 (noop):   832361.5 i/s - 17.39x  slower\n            original:   279761.3 i/s - 51.74x  slower\n     original (noop):   279117.6 i/s - 51.86x  slower\n</code></pre></div>\n<p dir=\"auto\"><code class=\"notranslate\">json_escape</code> is the same escaping implemented in C (please don't use this gem, if it's something we need we should find a different home for it)</p>\n<p dir=\"auto\">On a short string, performing the ASCII portion of escaping as a regex and then the unicode portion as strings seems optimal, but it's not that much faster than the 5 gsub! approach, so I stick with that for simplicity and for the significantly better performance on long strings.</p>\n<h3 dir=\"auto\">to_json</h3>\n<p dir=\"auto\">Using the same benchmark as <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1781582685\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48614\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48614/hovercard\" href=\"https://github.com/rails/rails/pull/48614\">#48614</a>. <code class=\"notranslate\">JSON.generate</code> and <code class=\"notranslate\">RapidJSON.generate</code> are for scale, they don't perform the extra escaping described here.</p>\n<p dir=\"auto\"><strong>Before:</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Calculating -------------------------------------\n source_data.to_json     74.671  (¬± 1.3%) i/s -    378.000  in   5.062521s\nsource_data_sym.to_json\n                         76.969  (¬± 0.0%) i/s -    385.000  in   5.002087s\nJSON.generate(source_data)\n                        576.164  (¬± 1.2%) i/s -      2.916k in   5.061908s\nRapidJSON.generate(source_data)\n                        852.714  (¬± 3.2%) i/s -      4.316k in   5.067053s\"><pre class=\"notranslate\"><code class=\"notranslate\">Calculating -------------------------------------\n source_data.to_json     74.671  (¬± 1.3%) i/s -    378.000  in   5.062521s\nsource_data_sym.to_json\n                         76.969  (¬± 0.0%) i/s -    385.000  in   5.002087s\nJSON.generate(source_data)\n                        576.164  (¬± 1.2%) i/s -      2.916k in   5.061908s\nRapidJSON.generate(source_data)\n                        852.714  (¬± 3.2%) i/s -      4.316k in   5.067053s\n</code></pre></div>\n<p dir=\"auto\"><strong>After:</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Calculating -------------------------------------\n source_data.to_json    142.762  (¬± 2.1%) i/s -    715.000  in   5.010974s\nsource_data_sym.to_json\n                        150.613  (¬± 2.0%) i/s -    756.000  in   5.021137s\nJSON.generate(source_data)\n                        575.412  (¬± 1.0%) i/s -      2.915k in   5.066603s\nRapidJSON.generate(source_data)\n                        873.174  (¬± 2.9%) i/s -      4.368k in   5.006853s\"><pre class=\"notranslate\"><code class=\"notranslate\">Calculating -------------------------------------\n source_data.to_json    142.762  (¬± 2.1%) i/s -    715.000  in   5.010974s\nsource_data_sym.to_json\n                        150.613  (¬± 2.0%) i/s -    756.000  in   5.021137s\nJSON.generate(source_data)\n                        575.412  (¬± 1.0%) i/s -      2.915k in   5.066603s\nRapidJSON.generate(source_data)\n                        873.174  (¬± 2.9%) i/s -      4.368k in   5.006853s\n</code></pre></div>\n<p dir=\"auto\">About 2x faster than <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1781582685\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48614\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48614/hovercard\" href=\"https://github.com/rails/rails/pull/48614\">#48614</a> and 4.5x faster than Rails 7.0.</p>\n<h2 dir=\"auto\">Next?</h2>\n<p dir=\"auto\">This is much faster but escaping still has an impact on performance (though it's no longer the majority). One thing we could do is rewrite the escaping in a C extension (ideally upstreaming it into a standard library). However I think first we need to confirm that this is really how we should be escaping in 2023 and beyond.</p>\n<p dir=\"auto\"><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a> and I looked into this and we may only need to escape <a href=\"https://html.spec.whatwg.org/multipage/scripting.html#restrictions-for-contents-of-script-elements\" rel=\"nofollow\"><code class=\"notranslate\">&lt;script</code>, <code class=\"notranslate\">&lt;/script&gt;</code>, and <code class=\"notranslate\">&lt;!--</code></a> (assuming we're only targeting HTML5 vs this was likely intended for XHTML). The quirk of JSON/JavaScript interop which required our handling of U+2028 and U+2029 is also <a href=\"https://github.com/tc39/proposal-json-superset\">no longer a concern as of ES2019</a> which is now <a href=\"https://caniuse.com/mdn-javascript_builtins_json_json_superset\" rel=\"nofollow\">widely available</a>.</p>\n<p dir=\"auto\">That's all outside the scope of this PR though, which provides a performance gain without any change to escaping behaviour.</p>",
            "url": "https://github.com/rails/rails/pull/48669",
            "title": "Improve performance of JSON HTML entity escaping",
            "date_modified": "2023-07-05T23:00:30.000Z",
            "date_published": "2023-07-05T19:41:19.000Z",
            "author": {
                "name": "jhawthorn",
                "url": "https://github.com/jhawthorn"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #41250.\">Fix</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"794673794\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/41250\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/41250/hovercard\" href=\"https://github.com/rails/rails/issues/41250\">#41250</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #41321.\">Fix</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"800216193\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/41321\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/41321/hovercard\" href=\"https://github.com/rails/rails/pull/41321\">#41321</a></p>\n<p dir=\"auto\">Fix when multiple <code class=\"notranslate\">belongs_to</code> maps to the same counter_cache column. In such situation <code class=\"notranslate\">inverse_which_updates_counter_cache</code> may find the wrong relation which leads into an invalid increment of the counter_cache.</p>\n<p dir=\"auto\">This is done by releying on the <code class=\"notranslate\">inverse_of</code> property of the relation as well as comparing the models the association points two.</p>\n<p dir=\"auto\">Note however that this second check doesn't work for polymorphic associations.</p>\n<p dir=\"auto\">Most if not al of the credit goes to <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/intrip/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/intrip\">@intrip</a> as this is just a cleanup of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"800216193\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/41321\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/41321/hovercard\" href=\"https://github.com/rails/rails/pull/41321\">#41321</a>. I simply replaced the <code class=\"notranslate\">rescue</code> by a proper check for <code class=\"notranslate\">polymorphic?</code>.</p>\n<p dir=\"auto\">FYI: <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/kylefox/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/kylefox\">@kylefox</a></p>",
            "url": "https://github.com/rails/rails/pull/48665",
            "title": "Fix counter_cache create/concat with overlapping counter_cache_column",
            "date_modified": "2023-07-05T15:52:24.000Z",
            "date_published": "2023-07-05T15:52:20.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/25950768?u=056c73263e9916cea227c9a58ea5106d0cf8c09e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The current <a href=\"https://api.rubyonrails.org/v7.0.4/classes/ActionView/Helpers/FormHelper.html#method-i-file_field\" rel=\"nofollow\">documentation</a> implies calling <code class=\"notranslate\">multiple: true</code> and <code class=\"notranslate\">include_hidden: true</code> will stop existing files from being replaced when saving a record that has ActiveStorage attached. However it appears <code class=\"notranslate\">include_hidden: false</code> is needed to achieve this functionality.</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48006.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1677646911\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48006\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48006/hovercard\" href=\"https://github.com/rails/rails/issues/48006\">#48006</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Updating documentation to reflect the current functionality of <code class=\"notranslate\">multiple: true</code> and <code class=\"notranslate\">include_hidden: false</code></p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48658",
            "title": "Fix `include_hidden` documentation for File Upload",
            "date_modified": "2023-07-05T08:34:31.000Z",
            "date_published": "2023-07-05T08:34:27.000Z",
            "author": {
                "name": "alexpapworth",
                "url": "https://github.com/alexpapworth"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/15172605?u=c9831ccf188358c7be46eb4c634002b47ebb1068&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #47559.\">Resolves</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1607337313\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47559\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/47559/hovercard\" href=\"https://github.com/rails/rails/issues/47559\">#47559</a></p>\n<p dir=\"auto\">Properly handle an intermediate model with has_many_inversing when creating two records with the same references.</p>\n<ul dir=\"auto\">\n<li>Prevents database error when references have a NOT NULL constraint</li>\n<li>When NULLS are permitted avoid an extra UPDATE statement by inserting the correct values from the outset</li>\n</ul>\n<h3 dir=\"auto\">Detail</h3>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"ActiveRecord::Base.has_many_inversing = true\n\nclass Comment &lt; ActiveRecord::Base\n  belongs_to :post, inverse_of: :comments\n  belongs_to :author, inverse_of: :comments\nend\n\nclass Post &lt; ActiveRecord::Base\n  has_many :comments\nend\n\nclass Author &lt; ActiveRecord::Base\n  has_many :comments\nend\n\npost = Post.new\nauthor = Author.new\npost.comments.build(author: author)\npost.comments.build(author: author)\npost.save!\"><pre class=\"notranslate\"><span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">has_many_inversing</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Comment</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:post</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">inverse_of</span>: <span class=\"pl-pds\">:comments</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:author</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">inverse_of</span>: <span class=\"pl-pds\">:comments</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">has_many</span> <span class=\"pl-pds\">:comments</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Author</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">has_many</span> <span class=\"pl-pds\">:comments</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">author</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Author</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">comments</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">build</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">author</span>: <span class=\"pl-s1\">author</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">comments</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">build</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">author</span>: <span class=\"pl-s1\">author</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">save!</span></pre></div>\n<p dir=\"auto\">Before:</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"BEGIN\n  INSERT INTO &quot;posts&quot; DEFAULT VALUES RETURNING &quot;id&quot;\n  INSERT INTO &quot;authors&quot; DEFAULT VALUES RETURNING &quot;id&quot;\n  INSERT INTO &quot;comments&quot; (&quot;post_id&quot;, &quot;author_id&quot;) VALUES ($1, $2) RETURNING &quot;id&quot;  [[&quot;post_id&quot;, 1], [&quot;author_id&quot;, 1]]\n  INSERT INTO &quot;comments&quot; (&quot;author_id&quot;) VALUES ($1) RETURNING &quot;id&quot;  [[&quot;author_id&quot;, 1]]\n  -- Error if NOT NULL constraint on post_id\n  UPDATE &quot;comments&quot; SET &quot;post_id&quot; = $1 WHERE &quot;comments&quot;.&quot;id&quot; = $2  [[&quot;post_id&quot;, 1], [&quot;id&quot;, 2]]\nCOMMIT\"><pre class=\"notranslate\"><span class=\"pl-k\">BEGIN</span>\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>posts<span class=\"pl-pds\">\"</span></span> DEFAULT <span class=\"pl-k\">VALUES</span> RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>authors<span class=\"pl-pds\">\"</span></span> DEFAULT <span class=\"pl-k\">VALUES</span> RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>comments<span class=\"pl-pds\">\"</span></span> (<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>) <span class=\"pl-k\">VALUES</span> ($<span class=\"pl-c1\">1</span>, $<span class=\"pl-c1\">2</span>) RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>  [[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>], [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>]]\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>comments<span class=\"pl-pds\">\"</span></span> (<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>) <span class=\"pl-k\">VALUES</span> ($<span class=\"pl-c1\">1</span>) RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>  [[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>]]\n  <span class=\"pl-c\"><span class=\"pl-c\">--</span> Error if NOT NULL constraint on post_id</span>\n  <span class=\"pl-k\">UPDATE</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>comments<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">SET</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">=</span> $<span class=\"pl-c1\">1</span> <span class=\"pl-k\">WHERE</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>comments<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">=</span> $<span class=\"pl-c1\">2</span>  [[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>], [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">2</span>]]\n<span class=\"pl-k\">COMMIT</span></pre></div>\n<p dir=\"auto\">After:</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"BEGIN\n  INSERT INTO &quot;posts&quot; DEFAULT VALUES RETURNING &quot;id&quot;\n  INSERT INTO &quot;authors&quot; DEFAULT VALUES RETURNING &quot;id&quot;\n  INSERT INTO &quot;comments&quot; (&quot;post_id&quot;, &quot;author_id&quot;) VALUES ($1, $2) RETURNING &quot;id&quot;  [[&quot;post_id&quot;, 1], [&quot;author_id&quot;, 1]]\n  INSERT INTO &quot;comments&quot; (&quot;post_id&quot;, &quot;author_id&quot;) VALUES ($1, $2) RETURNING &quot;id&quot;  [[&quot;post_id&quot;, 1], [&quot;author_id&quot;, 1]]\nCOMMIT\"><pre class=\"notranslate\"><span class=\"pl-k\">BEGIN</span>\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>posts<span class=\"pl-pds\">\"</span></span> DEFAULT <span class=\"pl-k\">VALUES</span> RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>authors<span class=\"pl-pds\">\"</span></span> DEFAULT <span class=\"pl-k\">VALUES</span> RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>comments<span class=\"pl-pds\">\"</span></span> (<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>) <span class=\"pl-k\">VALUES</span> ($<span class=\"pl-c1\">1</span>, $<span class=\"pl-c1\">2</span>) RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>  [[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>], [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>]]\n  <span class=\"pl-k\">INSERT INTO</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>comments<span class=\"pl-pds\">\"</span></span> (<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>) <span class=\"pl-k\">VALUES</span> ($<span class=\"pl-c1\">1</span>, $<span class=\"pl-c1\">2</span>) RETURNING <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span>  [[<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>post_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>], [<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>author_id<span class=\"pl-pds\">\"</span></span>, <span class=\"pl-c1\">1</span>]]\n<span class=\"pl-k\">COMMIT</span></pre></div>\n<p dir=\"auto\"><code class=\"notranslate\">insert_record</code> within <code class=\"notranslate\">save_collection_association</code> will trigger a recursive call. By fully processing <code class=\"notranslate\">set_inverse_instance</code> for each layer we ensure associations are up to date before <code class=\"notranslate\">INSERT INTO comments</code> statements are sent to the database.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48647",
            "title": "Fix has_many_inversing records with same references",
            "date_modified": "2023-07-04T15:06:39.000Z",
            "date_published": "2023-07-04T14:08:03.000Z",
            "author": {
                "name": "abaldwin88",
                "url": "https://github.com/abaldwin88"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/248174?u=679698ae9aa6ac1cd046737efadd767c154326c6&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">Uniqueness validators no longer works on <code class=\"notranslate\">create_association</code> when using <code class=\"notranslate\">dependent: :destroy</code> option in the commit below.<br>\nrefs: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/bdbe58b50461dc44c42df4d5427fa78aeb1debcb/hovercard\" href=\"https://github.com/rails/rails/commit/bdbe58b50461dc44c42df4d5427fa78aeb1debcb\"><tt>bdbe58b</tt></a>, <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/3255411981f4a64eea77ff65431ce92d201b4d0a/hovercard\" href=\"https://github.com/rails/rails/commit/3255411981f4a64eea77ff65431ce92d201b4d0a\"><tt>3255411</tt></a></p>\n<p dir=\"auto\">However, we often expect validation errors as well.<br>\nrefs <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1730182935\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48330\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48330/hovercard\" href=\"https://github.com/rails/rails/issues/48330\">#48330</a>, <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1785808864\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48632\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48632/hovercard\" href=\"https://github.com/rails/rails/issues/48632\">#48632</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit adds new option <code class=\"notranslate\">existing</code> to <code class=\"notranslate\">has_one</code> to run validations before deleting an existing record.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48643",
            "title": "Add a new option `existing` to `has_one` to run validations before deleting",
            "date_modified": "2023-07-04T06:46:52.000Z",
            "date_published": "2023-07-04T06:23:56.000Z",
            "author": {
                "name": "sinsoku",
                "url": "https://github.com/sinsoku"
            }
        }
    ]
}