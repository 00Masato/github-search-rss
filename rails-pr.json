{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/13696143?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1964535188\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49802\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49802/hovercard\" href=\"https://github.com/rails/rails/pull/49802\">#49802</a> (we may want both PRs)</p>\n<p dir=\"auto\">Prior to this commit <code class=\"notranslate\">with_raw_connection</code> would always mark the connection as <code class=\"notranslate\">@verified = true</code> after yielding it. But yielding a connection is not enough to determine that a connection is healthy. Marking a broken connection as verified can prevent further reconnects, leaving us with a broken connection for longer than expected.</p>\n<p dir=\"auto\">For example,</p>\n<ul dir=\"auto\">\n<li>Connection is broken and not verified</li>\n<li>Quote string succeeds, and marks the broken connection as verified</li>\n<li>Because the connection is verified, querying will not trigger a reconnect</li>\n<li>Query fails and the connection is no longer verified</li>\n<li>Repeat ad infinitum (or until we reach a query with <code class=\"notranslate\">allow_retry: true</code>, or one that isn't preceded by a call to quote string)</li>\n</ul>\n<p dir=\"auto\">This commit solves the problem by only marking the connection as verified if we have definitively exercised that connection. This is safer, but it does put more responsibility on each individual adapter. If a call to <code class=\"notranslate\">verified!</code> is missing things should still work OK, but we'll end up pinging the connection more to see if it is active.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a></p>",
            "url": "https://github.com/rails/rails/pull/49811",
            "title": "Prevent marking broken connections as verified",
            "date_modified": "2023-10-27T15:30:33.000Z",
            "date_published": "2023-10-27T15:19:19.000Z",
            "author": {
                "name": "composerinteralia",
                "url": "https://github.com/composerinteralia"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/32258?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The current Rails CSP uses <code class=\"notranslate\">report-uri</code> which is deprecated. There is a newer Reporting API which uses endpoints that can be references from the CSP policy using <code class=\"notranslate\">report-to</code>.</p>\n<p dir=\"auto\">For more info see <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/report-to\" rel=\"nofollow\">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/report-to</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Adds Reporting API endpoint to CSP policy using <code class=\"notranslate\">report-to</code>.</p>\n<p dir=\"auto\">This requires the Report-To HTTP header to be set manually. Example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"response.set_header('Report-To', '{&quot;group&quot;:&quot;csp-endpoint&quot;,&quot;max_age&quot;:31536000,&quot;endpoints&quot;:[{&quot;url&quot;:&quot;https://example.org/csp-endpoint&quot;}],&quot;include_subdomains&quot;:true}')\"><pre class=\"notranslate\"><code class=\"notranslate\">response.set_header('Report-To', '{\"group\":\"csp-endpoint\",\"max_age\":31536000,\"endpoints\":[{\"url\":\"https://example.org/csp-endpoint\"}],\"include_subdomains\":true}')\n</code></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This is my first PR to Rails so let me know if there is any improvement to be made. I wasn't sure whether to include info about the Report-To HTTP header in the docs or code.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49810",
            "title": "CSP Report-to reponse header field for browser Reporting API",
            "date_modified": "2023-10-27T14:20:53.000Z",
            "date_published": "2023-10-27T12:20:19.000Z",
            "author": {
                "name": "espen",
                "url": "https://github.com/espen"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #49798.\">Fix</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1963746565\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49798\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49798/hovercard\" href=\"https://github.com/rails/rails/pull/49798\">#49798</a></p>\n<p dir=\"auto\">Having to check on every access whether the model has a composite primary key adds a small but non-negligible overhead, even though CPK is envisoned as the exception, not the rule.</p>\n<p dir=\"auto\">By moving all the CPK support in a dedicated module, we can late-include it when a CPK is defined on a model. This is essentially a \"de-optimization\" phase.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/nvasilevski/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/nvasilevski\">@nvasilevski</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/ptolts/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ptolts\">@ptolts</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a></p>",
            "url": "https://github.com/rails/rails/pull/49808",
            "title": "Optimize ActiveRecord::AttributeMethods::PrimaryKey",
            "date_modified": "2023-10-27T14:13:46.000Z",
            "date_published": "2023-10-27T08:24:08.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>",
            "url": "https://github.com/rails/rails/pull/49804",
            "title": "[7-1-stable] Quiet deprecated cache_format_version = 6.1 warnings",
            "date_modified": "2023-10-27T05:11:54.000Z",
            "date_published": "2023-10-27T05:02:54.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>",
            "url": "https://github.com/rails/rails/pull/49803",
            "title": "Railties TestHelper remove_from_config should remove all occurrences",
            "date_modified": "2023-10-27T02:04:51.000Z",
            "date_published": "2023-10-27T02:04:47.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/13696143?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49781.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1961443092\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49781\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49781/hovercard\" href=\"https://github.com/rails/rails/issues/49781\">#49781</a></p>\n<p dir=\"auto\">Prior to this commit, the PostgreSQL adapter could end up holding onto a broken connection longer than expected, potentially <strong>into the next request after the executor checkin/checkout</strong>.</p>\n<p dir=\"auto\">The problem is that the PostgreSQL adapter was using <a href=\"https://github.com/rails/rails/blob/e33dbe1b3d423143685154b97ae0992f4ab821b8/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb#L910-L917\">two separate calls</a> to <code class=\"notranslate\">with_raw_connection</code>, one for preparing a statement and another for executing it. That's fine before the statement is added to the statement pool, but once it the statement exists the first call to <code class=\"notranslate\">with_raw_connection</code> <a href=\"https://github.com/rails/rails/blob/490b9fc22faefca30565a970a8727c915de589ff/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb#L964-L966\">does not actually use the connection</a>. But that doesn't stop us from marking the connection as <a href=\"https://github.com/rails/rails/blob/e33dbe1b3d423143685154b97ae0992f4ab821b8/activerecord/lib/active_record/connection_adapters/abstract_adapter.rb#L1032\"><code class=\"notranslate\">@verified</code></a>, thereby preventing the second <code class=\"notranslate\">with_raw_connection</code> from verifying and getting a chance to reconnect.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Post.first\n#=&gt; prepare_statement verifies the connection (if needed) and populates the statement pool\n#=&gt; exec_prepared succeeds\n\n#=&gt; Oops!, we lost the connection for whatever reason\n\nPost.first\n#=&gt; prepare_statement returns the statement from the statement pool, connection still marked as verified\n#=&gt; exec_prepared fails, marks the connection as unverified\n\nPost.first\n#=&gt; prepare_statement returns the statement from the statement pool, marks the connection as verified!!!\n#=&gt; exec_prepared fails, marks the connection as unverified\n\n#=&gt; request finishes, connection gets marked as unverified for the next request\n\nPost.first\n#=&gt; prepare_statement returns the statement from the statement pool, marks the connection as verified!!!\n#=&gt; exec_prepared fails, marks the connection as unverified\"><pre class=\"notranslate\"><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n<span class=\"pl-c\">#=&gt; prepare_statement verifies the connection (if needed) and populates the statement pool</span>\n<span class=\"pl-c\">#=&gt; exec_prepared succeeds</span>\n\n<span class=\"pl-c\">#=&gt; Oops!, we lost the connection for whatever reason</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n<span class=\"pl-c\">#=&gt; prepare_statement returns the statement from the statement pool, connection still marked as verified</span>\n<span class=\"pl-c\">#=&gt; exec_prepared fails, marks the connection as unverified</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n<span class=\"pl-c\">#=&gt; prepare_statement returns the statement from the statement pool, marks the connection as verified!!!</span>\n<span class=\"pl-c\">#=&gt; exec_prepared fails, marks the connection as unverified</span>\n\n<span class=\"pl-c\">#=&gt; request finishes, connection gets marked as unverified for the next request</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n<span class=\"pl-c\">#=&gt; prepare_statement returns the statement from the statement pool, marks the connection as verified!!!</span>\n<span class=\"pl-c\">#=&gt; exec_prepared fails, marks the connection as unverified</span></pre></div>\n<p dir=\"auto\">The only way to recover is to execute a statement that hasn't been prepared yet, one that isn't prepared because it has no binds, or one that has <code class=\"notranslate\">allow_retry: true</code> (which I think is limited to a few internal queries at the moment—we don't pass the value through to <code class=\"notranslate\">with_raw_connection</code> for prepared statements anyway).</p>\n<p dir=\"auto\">This commit fixes the problem by preparing and executing the statement within a single <code class=\"notranslate\">with_raw_connection</code> block. This is what the other adapters with prepared statements already do.</p>\n<p dir=\"auto\">It makes more sense this way—even if we managed to reconnect before executing the statement in the old code, we'd be referencing a prepared statement from a different connection, so it'd fail anyway. Having the prepare and execute in the same <code class=\"notranslate\">with_raw_connection</code> means if we do need to reconnect, we'll start from the beginning and prepare the statement again on the fresh connection.</p>\n<p dir=\"auto\">Note that this change does get rid of connection retries on preparing statements, but I think that's OK. It matches the other adapters, matches the Rails 7.0 behavior, and it's still better than ending up with a broken connection.</p>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49802",
            "title": "Recover from failed connections in PostgreSQL",
            "date_modified": "2023-10-27T15:20:18.000Z",
            "date_published": "2023-10-26T23:51:51.000Z",
            "author": {
                "name": "composerinteralia",
                "url": "https://github.com/composerinteralia"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Implements - <a href=\"https://discuss.rubyonrails.org/t/feature-proposal-alias-association/83439/4\" rel=\"nofollow\">https://discuss.rubyonrails.org/t/feature-proposal-alias-association/83439/4</a></p>\n<p dir=\"auto\">Rails 7.1 deprecated using <code class=\"notranslate\">alias_attribute</code> for anything other than an attribute. Many applications end up using <code class=\"notranslate\">alias_attribute</code> to alias associations and removing such usages would be challenging in many cases. Recognizing this, Rails introduces a new feature to alias associations called <code class=\"notranslate\">alias_association</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Given an alias like <code class=\"notranslate\">BlogPost.alias_association :author, :user</code> where <code class=\"notranslate\">author</code> is an alias and <code class=\"notranslate\">user</code> is the original association name of the <code class=\"notranslate\">belong_to :user</code> association the feature provides the following capabilities:</p>\n<h4 dir=\"auto\">Aliased association methods</h4>\n<p dir=\"auto\">Defines association reader and writer: <code class=\"notranslate\">BlogPost#author</code> and <code class=\"notranslate\">BlogPost#author=</code><br>\n(<code class=\"notranslate\">belongs_to</code> only) Defines <code class=\"notranslate\">build_#{assoc_name}</code> and <code class=\"notranslate\">create_#{assoc_name}</code> constructors: <code class=\"notranslate\">BlogPost#build_author</code>,  <code class=\"notranslate\">BlogPost#create_author</code> and <code class=\"notranslate\">BlogPost#create_author!</code><br>\n(<code class=\"notranslate\">belongs_to</code> only)  Defines change tracking methods: <code class=\"notranslate\">BlogPost#author_changed?</code> and <code class=\"notranslate\">BlogPost#author_previously_changed?</code></p>\n<h4 dir=\"auto\">Aliases support in <code class=\"notranslate\">where()</code> clauses</h4>\n<p dir=\"auto\"><code class=\"notranslate\">BlogPost.where(author: User.find_by(name: \"Nikita\")).to_a</code> #=&gt; searches by <code class=\"notranslate\">user_id</code></p>\n<h4 dir=\"auto\">Aliases support in <code class=\"notranslate\">includes()</code> clauses</h4>\n<p dir=\"auto\"><code class=\"notranslate\">BlogPost.all.includes(:author).to_a</code> # =&gt; preloads <code class=\"notranslate\">user</code> association</p>\n<h3 dir=\"auto\">Implementation details</h3>\n<h4 dir=\"auto\">Aliased association methods</h4>\n<p dir=\"auto\">A new <code class=\"notranslate\">define_association_methods </code> method was defined on <code class=\"notranslate\">ActiveRecord::Associations::Builder::Association</code> builder. Its job to define association-related instance methods. This method is being reused in the original <code class=\"notranslate\">build</code> method.<br>\n<code class=\"notranslate\">define_accessors</code>, <code class=\"notranslate\">define_change_tracking_methods</code> and all downstream methods now accept <code class=\"notranslate\">as:</code> to serve as a publicly facing name of the new methods while the method body itself will point to the original association.</p>\n<p dir=\"auto\">Since <code class=\"notranslate\">alias_association</code> methods needs to know which builder to use for method definition builders now self-register themselves into a registry using <code class=\"notranslate\">register_builder_for</code> method by providing a <code class=\"notranslate\">macro</code> which later can be used to fetch the builder for a given reflection.</p>\n<h4 dir=\"auto\">Aliases support in <code class=\"notranslate\">where()</code> clauses</h4>\n<p dir=\"auto\">To support aliased association names in <code class=\"notranslate\">where()</code> clauses we introduced <code class=\"notranslate\">querying_aliases</code> storage which will serve as a registry of aliases for both associations and attributes. This way we can avoid checking two places (attribute aliases &amp; association aliases) when processing <code class=\"notranslate\">where()</code> arguments.</p>\n<h4 dir=\"auto\">Aliases support in <code class=\"notranslate\">includes()</code> clauses</h4>\n<p dir=\"auto\">To support aliases in <code class=\"notranslate\">includes()</code> (and most likely more capabilities that look into the <code class=\"notranslate\">_reflections</code> hash) we register the same reflection under the new name<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/8917147631838b5c5b85240a61027b39f3adbde2/activerecord/lib/active_record/associations.rb#L1900\">rails/activerecord/lib/active_record/associations.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 1900\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/8917147631838b5c5b85240a61027b39f3adbde2\">8917147</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L1900\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1900\"></td>\n          <td id=\"LC1900\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">Reflection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">add_reflection</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">new_name</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">existing_reflection</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The capabilities this feature provides are pretty standalone and could be extracted or completely descoped from this PR if needed.</p>\n<p dir=\"auto\">Also while the utility of this feature might be concerning the feature comes at no cost for applications that are not interested in utilizing it.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49801",
            "title": "Introduce `alias_association` feature",
            "date_modified": "2023-10-26T22:01:00.000Z",
            "date_published": "2023-10-26T21:41:30.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/11673?u=ef80073b0bb2ee07a241e85af0bb51e892955811&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">I've often had the need to desire a to create a duration type for Ruby classes including <code class=\"notranslate\">ActiveModel::Attributes</code> or for ActiveRecord models backed by non-PostgreSQL database adapters, similar to <a href=\"https://stackoverflow.com/a/45359178/771838\" rel=\"nofollow\">this StackOverflow answer</a>.</p>\n<p dir=\"auto\">The Rails community would benefit from having this type available as an <code class=\"notranslate\">ActiveModel</code> attribute whereas currently only <code class=\"notranslate\">ActiveRecord</code> models with the PostgreSQL adapter support <code class=\"notranslate\">ActiveSupport::Duration</code> through the <code class=\"notranslate\">:interval</code> data type. .</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This changeset adds <code class=\"notranslate\">ActiveModel::Type::Duration</code> to provide representation for <code class=\"notranslate\">ActiveSupport::Duration</code> via the <code class=\"notranslate\">:duration</code> key.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Run\n  include ActiveModel::Attributes\n\n  attribute :lasted, :duration\nend\n\nrun = Run.new\nrun.lasted = 2.hours\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Run</span>\n  <span class=\"pl-en\">include</span> <span class=\"pl-v\">ActiveModel</span>::<span class=\"pl-v\">Attributes</span>\n\n  <span class=\"pl-en\">attribute</span> <span class=\"pl-pds\">:lasted</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:duration</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">run</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">2</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">hours</span></pre></div>\n<p dir=\"auto\">Numeric values are cast to <code class=\"notranslate\">ActiveSupport::Duration</code> as seconds.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"run = Run.new\nrun.lasted = 120 # =&gt; 120 seconds\"><pre class=\"notranslate\"><span class=\"pl-s1\">run</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">120</span> <span class=\"pl-c\"># =&gt; 120 seconds</span></pre></div>\n<p dir=\"auto\">String values are parsed using the ISO 8601 duration format.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"run = Run.new\nrun.lasted = &quot;PT2H&quot;\n\nrun.lasted.class # =&gt; ActiveSupport::Duration\nrun.lasted       # =&gt; 2 hours\"><pre class=\"notranslate\"><span class=\"pl-s1\">run</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"PT2H\"</span>\n\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">class</span> <span class=\"pl-c\"># =&gt; ActiveSupport::Duration</span>\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span>       <span class=\"pl-c\"># =&gt; 2 hours</span></pre></div>\n<p dir=\"auto\">The serialization/deserialization logic is extracted from <code class=\"notranslate\">ActiveRecord::ConnectionAdapters::PostreSQL::OID::Interval</code>, which is here modified to inherit from <code class=\"notranslate\">ActiveModel::Type::Duration</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49799",
            "title": "Add ActiveModel attribute type for duration",
            "date_modified": "2023-10-26T16:24:54.000Z",
            "date_published": "2023-10-26T15:56:47.000Z",
            "author": {
                "name": "rossta",
                "url": "https://github.com/rossta"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><code class=\"notranslate\">ActiveRecord::Base#id</code> became <code class=\"notranslate\">~10%</code> slower in 7.1 following the introduction of composite primary keys.</p>\n<p dir=\"auto\">Some production profile revealed a significant amount of time spent in <code class=\"notranslate\">@primary_key.is_a?(Array)</code>. Some of it may be the common StackProf bias, but it's still significant.</p>\n<p dir=\"auto\">By storing whether the primary key is composite as a boolean we can reclaim about half of the overhead:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ruby 3.2.2 (2023-03-30 revision e51014f9c0) [arm64-darwin22]\nWarming up --------------------------------------\n       User#id (7.0)   507.375k i/100ms\n       User#id (7.1)   460.049k i/100ms\n       User#id (opt)   486.487k i/100ms\nCalculating -------------------------------------\n       User#id (7.0)      5.058M (± 1.1%) i/s -     25.369M in   5.016103s\n       User#id (7.1)      4.592M (± 0.8%) i/s -     23.002M in   5.009319s\n       User#id (opt)      4.872M (± 0.9%) i/s -     24.811M in   5.093091s\n\nComparison:\n       User#id (7.0):  5058058.8 i/s\n       User#id (opt):  4871876.3 i/s - 1.04x  slower\n       User#id (7.1):  4592198.3 i/s - 1.10x  slower\"><pre class=\"notranslate\"><code class=\"notranslate\">ruby 3.2.2 (2023-03-30 revision e51014f9c0) [arm64-darwin22]\nWarming up --------------------------------------\n       User#id (7.0)   507.375k i/100ms\n       User#id (7.1)   460.049k i/100ms\n       User#id (opt)   486.487k i/100ms\nCalculating -------------------------------------\n       User#id (7.0)      5.058M (± 1.1%) i/s -     25.369M in   5.016103s\n       User#id (7.1)      4.592M (± 0.8%) i/s -     23.002M in   5.009319s\n       User#id (opt)      4.872M (± 0.9%) i/s -     24.811M in   5.093091s\n\nComparison:\n       User#id (7.0):  5058058.8 i/s\n       User#id (opt):  4871876.3 i/s - 1.04x  slower\n       User#id (7.1):  4592198.3 i/s - 1.10x  slower\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ruby 3.1.4p223 (2023-03-30 revision 957bb7cb81) [arm64-darwin22]\nWarming up --------------------------------------\n       User#id (7.0)   502.562k i/100ms\n       User#id (7.1)   430.043k i/100ms\n       User#id (opt)   482.961k i/100ms\nCalculating -------------------------------------\n       User#id (7.0)      5.060M (± 0.9%) i/s -     25.631M in   5.065498s\n       User#id (7.1)      4.325M (± 0.8%) i/s -     21.932M in   5.071700s\n       User#id (opt)      4.804M (± 0.8%) i/s -     24.148M in   5.027168s\n\nComparison:\n       User#id (7.0):  5060312.9 i/s\n       User#id (opt):  4803851.1 i/s - 1.05x  slower\n       User#id (7.1):  4324672.3 i/s - 1.17x  slower\"><pre class=\"notranslate\"><code class=\"notranslate\">ruby 3.1.4p223 (2023-03-30 revision 957bb7cb81) [arm64-darwin22]\nWarming up --------------------------------------\n       User#id (7.0)   502.562k i/100ms\n       User#id (7.1)   430.043k i/100ms\n       User#id (opt)   482.961k i/100ms\nCalculating -------------------------------------\n       User#id (7.0)      5.060M (± 0.9%) i/s -     25.631M in   5.065498s\n       User#id (7.1)      4.325M (± 0.8%) i/s -     21.932M in   5.071700s\n       User#id (opt)      4.804M (± 0.8%) i/s -     24.148M in   5.027168s\n\nComparison:\n       User#id (7.0):  5060312.9 i/s\n       User#id (opt):  4803851.1 i/s - 1.05x  slower\n       User#id (7.1):  4324672.3 i/s - 1.17x  slower\n</code></pre></div>\n<details><summary>Benchmark</summary>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"begin\n  require &quot;bundler/inline&quot;\nrescue LoadError =&gt; e\n  $stderr.puts &quot;Bundler version 1.10 or later is required. Please update your Bundler&quot;\n  raise e\nend\n\ngemfile(true) do\n  source &quot;https://rubygems.org&quot;\n  gem &quot;rails&quot;, path: &quot;/Users/byroot/src/github.com/Shopify/rails&quot;\n  gem &quot;sqlite3&quot;\n  gem &quot;benchmark-ips&quot;\nend\n\nrequire &quot;active_record&quot;\n\nActiveRecord::Base.establish_connection(adapter: &quot;sqlite3&quot;, database: &quot;:memory:&quot;)\nActiveRecord::Base.logger = Logger.new(STDOUT)\n\nActiveRecord::Schema.define do\n  create_table :users do |t|\n    t.string :first_name\n    t.string :last_name\n  end\nend\n\nclass User &lt; ActiveRecord::Base\nend\n\nmodule ActiveRecord\n  module AttributeMethods\n    # = Active Record Attribute Methods Primary Key\n    module PrimaryKey\n      def initialize(...)\n        @composite_primary_key = self.class.composite_primary_key?\n        super\n      end\n\n      def rails_71_id\n        return _read_attribute(@primary_key) unless @primary_key.is_a?(Array)\n\n        @primary_key.map { |pk| _read_attribute(pk) }\n      end\n\n      def rails_70_id\n        _read_attribute(@primary_key)\n      end\n\n      def optimized_id\n        if @composite_primary_key\n          @primary_key.map { |pk| _read_attribute(pk) }\n        else\n          _read_attribute(@primary_key)\n        end\n      end\n    end\n  end\nend\n\nuser = User.new\n\nputs RUBY_DESCRIPTION\n\nBenchmark.ips do |x|\n  x.report(&quot;User#id (7.0)&quot;) do\n    user.rails_70_id\n  end\n\n  x.report(&quot;User#id (7.1)&quot;) do\n    user.rails_71_id\n  end\n\n  x.report(&quot;User#id (opt)&quot;) do\n    user.optimized_id\n  end\n\n  x.compare!(order: :baseline)\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">begin</span>\n  <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/inline\"</span>\n<span class=\"pl-k\">rescue</span> <span class=\"pl-v\">LoadError</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">e</span>\n  $stderr<span class=\"pl-kos\">.</span><span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Bundler version 1.10 or later is required. Please update your Bundler\"</span>\n  <span class=\"pl-en\">raise</span> <span class=\"pl-en\">e</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">\"https://rubygems.org\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"rails\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">path</span>: <span class=\"pl-s\">\"/Users/byroot/src/github.com/Shopify/rails\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"sqlite3\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"benchmark-ips\"</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_record\"</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">establish_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">adapter</span>: <span class=\"pl-s\">\"sqlite3\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">database</span>: <span class=\"pl-s\">\":memory:\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Schema</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">define</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:users</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:first_name</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:last_name</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">User</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">module</span> <span class=\"pl-v\">ActiveRecord</span>\n  <span class=\"pl-k\">module</span> <span class=\"pl-v\">AttributeMethods</span>\n    <span class=\"pl-c\"># = Active Record Attribute Methods Primary Key</span>\n    <span class=\"pl-k\">module</span> <span class=\"pl-v\">PrimaryKey</span>\n      <span class=\"pl-k\">def</span> <span class=\"pl-en\">initialize</span><span class=\"pl-kos\">(</span>...<span class=\"pl-kos\">)</span>\n        <span class=\"pl-c1\">@composite_primary_key</span> <span class=\"pl-c1\">=</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">class</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">composite_primary_key?</span>\n        <span class=\"pl-smi\">super</span>\n      <span class=\"pl-k\">end</span>\n\n      <span class=\"pl-k\">def</span> <span class=\"pl-en\">rails_71_id</span>\n        <span class=\"pl-k\">return</span> <span class=\"pl-en\">_read_attribute</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">@primary_key</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">unless</span> <span class=\"pl-c1\">@primary_key</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">is_a?</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Array</span><span class=\"pl-kos\">)</span>\n\n        <span class=\"pl-c1\">@primary_key</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">map</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">pk</span>| <span class=\"pl-en\">_read_attribute</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">pk</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n      <span class=\"pl-k\">end</span>\n\n      <span class=\"pl-k\">def</span> <span class=\"pl-en\">rails_70_id</span>\n        <span class=\"pl-en\">_read_attribute</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">@primary_key</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-k\">end</span>\n\n      <span class=\"pl-k\">def</span> <span class=\"pl-en\">optimized_id</span>\n        <span class=\"pl-k\">if</span> <span class=\"pl-c1\">@composite_primary_key</span>\n          <span class=\"pl-c1\">@primary_key</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">map</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">pk</span>| <span class=\"pl-en\">_read_attribute</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">pk</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n        <span class=\"pl-k\">else</span>\n          <span class=\"pl-en\">_read_attribute</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">@primary_key</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-k\">end</span>\n      <span class=\"pl-k\">end</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n\n<span class=\"pl-en\">puts</span> <span class=\"pl-c1\">RUBY_DESCRIPTION</span>\n\n<span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"User#id (7.0)\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rails_70_id</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"User#id (7.1)\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rails_71_id</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"User#id (opt)\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">optimized_id</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">compare!</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">order</span>: <span class=\"pl-pds\">:baseline</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">end</span></pre></div>\n</details>\n<p dir=\"auto\">Another avenue could be to swap the method entirely. e.g. include a module when you activate composite primary keys on a model. But then it would make it tricky to undo it in a child class. So I'm still on the fence, I'll sleep on it.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/ptolts/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ptolts\">@ptolts</a> you reported the profiling.<br>\ncc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/nvasilevski/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/nvasilevski\">@nvasilevski</a> because CPK.</p>",
            "url": "https://github.com/rails/rails/pull/49798",
            "title": "Optimize Active Record primary key methods",
            "date_modified": "2023-10-27T06:58:00.000Z",
            "date_published": "2023-10-26T14:46:55.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/111346?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><code class=\"notranslate\">ActionMailer::InlinePreviewInterceptor</code> is useful not only for previewing the template but also for displaying actual emails loaded from a string/file using <code class=\"notranslate\">Mail.read_from_string</code>. For example, you might want to archive all outgoing emails to the database/filesystem and display these emails in a browser.</p>\n<p dir=\"auto\">The interceptor assumes that attachments are represented as binary data. But if an email is loaded from string, the attachments have already been encoded as base64, so they end up being encoded twice.</p>",
            "url": "https://github.com/rails/rails/pull/49797",
            "title": "Fix double-encoding in `InlinePreviewInterceptor`",
            "date_modified": "2023-10-27T05:29:07.000Z",
            "date_published": "2023-10-26T13:43:42.000Z",
            "author": {
                "name": "c960657",
                "url": "https://github.com/c960657"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5279284?u=40cbc3d0cb818159797fa8856c88c9e87fd8bd49&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">ActionMailer Email Preview - show date header when present or fallback to Time.current.rfc2822</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49788.\">Resolves</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1962469818\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49788\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49788/hovercard\" href=\"https://github.com/rails/rails/issues/49788\">#49788</a></p>\n<p dir=\"auto\">Co-authored-by: <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/allisonphillips/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/allisonphillips\">@allisonphillips</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49790",
            "title": "ActionMailer Email Preview - show date header when present ",
            "date_modified": "2023-10-27T12:55:00.000Z",
            "date_published": "2023-10-26T01:42:47.000Z",
            "author": {
                "name": "sampatbadhe",
                "url": "https://github.com/sampatbadhe"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/18366969?u=e6919af135d360a17f71ab7380f0d57fe08be21a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because there is already <code class=\"notranslate\">destroy_all</code>, but there are cases where you want to raise an exception if it fails. It is useful to have <code class=\"notranslate\">destroy_all!</code>.<br>\nThis change was previously implemented at <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"527539837\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/37782\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/37782/hovercard\" href=\"https://github.com/rails/rails/pull/37782\">#37782</a>, but it was closed. I've re-opened this PR because it was recently mentioned by <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes add <code class=\"notranslate\">#destroy_all!</code> method to <code class=\"notranslate\">ActiveRecord::Relation</code></p>\n<p dir=\"auto\">If the <code class=\"notranslate\">before_destroy</code> callback throws abort the action is cancelled and <code class=\"notranslate\">destroy_all!</code> raises <code class=\"notranslate\">ActiveRecord::RecordNotDestroyed</code>.</p>\n<p dir=\"auto\">If there is more than one target record and you want to ensure that all records are deleted, you should realize this by explicitly using transaction to cause rollback.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class User &lt; ApplicationRecord\n  before_destroy do\n     throw :abort if id == 3\n   end\nend\n\nActiveRecord::Base.transaction do \n  User.where(id: 1..3).destroy_all!  \nend  \n \n=&gt;  TRANSACTION (1.5ms)  BEGIN\n  user Load (1.5ms)  SELECT `users`.* FROM `users` WHERE `users`.`id` BETWEEN 1 AND 3\n  user Destroy (1.2ms)  DELETE FROM `users` WHERE `users`.`id` = 1\n  user Destroy (1.1ms)  DELETE FROM `users` WHERE `users`.`id` = 2\n  TRANSACTION (4.4ms)  ROLLBACK\nActiveRecord::RecordNotDestroyed: Failed to destroy the record\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">User</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">before_destroy</span> <span class=\"pl-k\">do</span>\n     <span class=\"pl-en\">throw</span> <span class=\"pl-pds\">:abort</span> <span class=\"pl-k\">if</span> <span class=\"pl-en\">id</span> == <span class=\"pl-c1\">3</span>\n   <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">transaction</span> <span class=\"pl-k\">do</span> \n  <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">id</span>: <span class=\"pl-c1\">1</span>..<span class=\"pl-c1\">3</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">destroy_all!</span>  \n<span class=\"pl-k\">end</span>  \n \n<span class=\"pl-c1\">=&gt;</span>  <span class=\"pl-c1\">TRANSACTION</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1.5</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  BEGIN\n  <span class=\"pl-en\">user</span> <span class=\"pl-en\">Load</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1.5</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-en\">SELECT</span> <span class=\"pl-s\">`users`</span><span class=\"pl-kos\">.</span>* <span class=\"pl-en\">FROM</span> <span class=\"pl-s\">`users`</span> <span class=\"pl-en\">WHERE</span> <span class=\"pl-s\">`users`</span><span class=\"pl-kos\">.</span>`<span class=\"pl-en\">id</span><span class=\"pl-s\">` BETWEEN 1 AND 3</span>\n<span class=\"pl-s\">  user Destroy (1.2ms)  DELETE FROM `</span><span class=\"pl-en\">users</span><span class=\"pl-s\">` WHERE `</span><span class=\"pl-en\">users</span><span class=\"pl-s\">`.`</span><span class=\"pl-en\">id</span><span class=\"pl-s\">` = 1</span>\n<span class=\"pl-s\">  user Destroy (1.1ms)  DELETE FROM `</span><span class=\"pl-en\">users</span><span class=\"pl-s\">` WHERE `</span><span class=\"pl-en\">users</span><span class=\"pl-s\">`.`</span><span class=\"pl-s1\">id</span>` <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">2</span>\n  <span class=\"pl-en\">TRANSACTION</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">4.4</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-c1\">ROLLBACK</span>\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-en\">RecordNotDestroyed</span>: <span class=\"pl-en\">Failed</span> <span class=\"pl-en\">to</span> <span class=\"pl-en\">destroy</span> <span class=\"pl-en\">the</span> <span class=\"pl-en\">record</span></pre></div>\n<p dir=\"auto\">Also, if the deletion is successful, an Array containing the target object that was successfully deleted is returned.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/rails/rails/pull/37782\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/37782/hovercard\">Previously opened PR</a></li>\n<li><a href=\"https://discuss.rubyonrails.org/t/proposal-add-destroy-all-method-to-activerecord-relation/80959\" rel=\"nofollow\">proposal</a></li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49789",
            "title": "Add `#destroy_all!` method to `ActiveRecord::Relation`",
            "date_modified": "2023-10-26T04:26:16.000Z",
            "date_published": "2023-10-26T01:32:51.000Z",
            "author": {
                "name": "soartec-lab",
                "url": "https://github.com/soartec-lab"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49273.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1896689507\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49273\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49273/hovercard\" href=\"https://github.com/rails/rails/issues/49273\">#49273</a>.</p>\n<p dir=\"auto\">We can remove some code by refactoring <code class=\"notranslate\">db:migrate</code> for multiple dbs to use individual database rake tasks.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/sobrinho/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/sobrinho\">@sobrinho</a></p>",
            "url": "https://github.com/rails/rails/pull/49787",
            "title": "Refactor `db:migrate` task for multiple dbs to use per-database rake tasks",
            "date_modified": "2023-10-26T16:25:18.000Z",
            "date_published": "2023-10-25T22:28:41.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/131752?u=32ddf1119b1d189c9bd241a721b36ea01c29f61e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Previously in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1003663049\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/43282\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/43282/hovercard\" href=\"https://github.com/rails/rails/pull/43282\">#43282</a>, which shipped with Rails 7.0, we added the guarantee that if an exception occurred within an ActiveSupport::Notificaitons subscriber that the remaining subscribers would still be run.</p>\n<p dir=\"auto\">This was broken in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1141875314\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/44469\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/44469/hovercard\" href=\"https://github.com/rails/rails/pull/44469\">#44469</a> (oops 😳), where the different types of subscribers were broken into groups by type for performance. Although we would guard exceptions and always run all (or none) of the same group, that didn't work cross-group with different types of subscriber.</p>",
            "url": "https://github.com/rails/rails/pull/49784",
            "title": "Fix exception guards on multiple subscriber types",
            "date_modified": "2023-10-25T21:01:08.000Z",
            "date_published": "2023-10-25T21:01:04.000Z",
            "author": {
                "name": "jhawthorn",
                "url": "https://github.com/jhawthorn"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Any classes that don't implement #blank? will fall back to Object's implementation, which checks whether #empty? is defined before either using #empty? or implicit truthiness. Since checking whether #empty? is defined is expensive, some core classes (Array/Hash) alias #blank? directly to #empty? to skip the respond_to? check.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit applies the alias optimization to Symbol. #blank? is called on Symbols for many Active Record query methods (select, includes, group, order, joins, etc.) so it seems reasonable to define the #blank? alias on Symbol as well.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49776",
            "title": "Add Symbol#blank? to skip respond_to?(:empty?)",
            "date_modified": "2023-10-25T03:34:05.000Z",
            "date_published": "2023-10-25T03:34:00.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5122678?u=204301f9f9fe8930fd26fe3bfe65b6ffaffd8b59&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because the current <a href=\"https://guides.rubyonrails.org/association_basics.html#single-table-inheritance-sti\" rel=\"nofollow\">STI Guides</a> don't document how to override or disable the <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/ModelSchema.html#method-c-inheritance_column\" rel=\"nofollow\">inheritance_column</a>.</p>\n<p dir=\"auto\"><del>Additionally, it's not clear that you can set <code class=\"notranslate\">inheritance_column = :disabled</code>. Initially, I had tried  <code class=\"notranslate\">inheritance_column = nil</code> which had the same behavior, but is not as clear as the former.</del></p>\n<p dir=\"auto\">Setting <code class=\"notranslate\">inheritance_column = nil</code> disabled STI.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Add new sections to <a href=\"https://guides.rubyonrails.org/association_basics.html#single-table-inheritance-sti\" rel=\"nofollow\">STI Guides</a> demonstrating how to override or disable the <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/ModelSchema.html#method-c-inheritance_column\" rel=\"nofollow\">inheritance_column</a>.</p>\n<p dir=\"auto\">Also improve error message when <code class=\"notranslate\">ActiveRecord::SubclassNotFound</code> is raised.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49774",
            "title": "Improve STI documentation",
            "date_modified": "2023-10-25T17:47:34.000Z",
            "date_published": "2023-10-25T00:49:57.000Z",
            "author": {
                "name": "stevepolitodesign",
                "url": "https://github.com/stevepolitodesign"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49767.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1959594919\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49767\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49767/hovercard\" href=\"https://github.com/rails/rails/issues/49767\">#49767</a>.</p>\n<p dir=\"auto\">All other enum-related methods are already reloading type map.<br>\nI am not sure are tests needed for this?</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/ghiculescu/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ghiculescu\">@ghiculescu</a> (as implementor of the PostgreSQL <code class=\"notranslate\">enum</code>)</p>",
            "url": "https://github.com/rails/rails/pull/49772",
            "title": "Reload type map when creating or dropping PostgreSQL enums",
            "date_modified": "2023-10-25T09:19:35.000Z",
            "date_published": "2023-10-24T20:33:09.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8122246?u=2dbe607a66a7616297b78647eeb4e0dbff657c3a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><ul dir=\"auto\">\n<li>\n<h3 dir=\"auto\">Context</h3>\n<p dir=\"auto\">The Tagged Logging functionality has been a source of a few issues over the years, especially when combined with the broadcasting feature. Initializating a Tagged Logger was also not very intuitive:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"logger = Logger.new(STDOUT)\ntagged_logger = ActiveSupport::TaggedLogging.new(logger)\n# Would expect the `tagged_logger` to be an instance of `AS::TaggedLogging` \n# but it's a clone of the `logger`.\n\ntagged_logger.formatter = -&gt;(_, _, _, message) do\n  { message: message }\nend\n# Modifies the formatter to output JSON formatted logs.\n# This breaks tagged logging.\"><pre class=\"notranslate\"><span class=\"pl-s1\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">tagged_logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">TaggedLogging</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">logger</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\"># Would expect the `tagged_logger` to be an instance of `AS::TaggedLogging` </span>\n<span class=\"pl-c\"># but it's a clone of the `logger`.</span>\n\n<span class=\"pl-s1\">tagged_logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">formatter</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">-&gt;</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">_</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">_</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">_</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">message</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">message</span>: <span class=\"pl-s1\">message</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span>\n<span class=\"pl-c\"># Modifies the formatter to output JSON formatted logs.</span>\n<span class=\"pl-c\"># This breaks tagged logging.</span></pre></div>\n<p dir=\"auto\">I believe the main reason of those issues is because tagged logging is implemented at the wrong level.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">I made a proposal on the Ruby logger upstream in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1790019942\" data-permission-text=\"Title is private\" data-url=\"https://github.com/ruby/logger/issues/90\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/ruby/logger/pull/90/hovercard\" href=\"https://github.com/ruby/logger/pull/90\">ruby/logger#90</a> to help solve this but it hasn't been reviewed yet. So I thought about adding it here for now. The TL;DR is to decouple formatting and adding extra information to logs (which is what tagged logging does).</p>\n<h3 dir=\"auto\">Deprecation</h3>\n<p dir=\"auto\">Since TaggedLogging will no longer access the formatter, there is a few things I'd like to deprecate such as setting a default formatter </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/d68e43922bc11829c52ad9f736ad5549fc97631b/activesupport/lib/active_support/tagged_logging.rb#L124\">rails/activesupport/lib/active_support/tagged_logging.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 124\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/d68e43922bc11829c52ad9f736ad5549fc97631b\">d68e439</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L124\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"124\"></td>\n          <td id=\"LC124\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">formatter</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">Logger</span>::<span class=\"pl-v\">SimpleFormatter</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n but doing so in this PR would increase the size of the diff significantly and would maybe distract for PR reviews.<p></p>\n<p dir=\"auto\">Another thing that I believe should be deprecated is <code class=\"notranslate\">ActiveSupport::TaggedLogging.new</code>. Adding tagging functionality to a logger should be done using a more ruby approach such as <code class=\"notranslate\">logger.extend(AS::TaggedLogging)</code>.</p>\n</li>\n</ul>\n<hr>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49757.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1958722861\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49757\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49757/hovercard\" href=\"https://github.com/rails/rails/issues/49757\">#49757</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49745.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1956771268\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49745\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49745/hovercard\" href=\"https://github.com/rails/rails/issues/49745\">#49745</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #46084.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1379588419\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46084\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/46084/hovercard\" href=\"https://github.com/rails/rails/issues/46084\">#46084</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #44668.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1167130613\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/44668\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/44668/hovercard\" href=\"https://github.com/rails/rails/issues/44668\">#44668</a></p>",
            "url": "https://github.com/rails/rails/pull/49771",
            "title": "Reimplement TaggedLogging:",
            "date_modified": "2023-10-27T12:13:57.000Z",
            "date_published": "2023-10-24T17:24:15.000Z",
            "author": {
                "name": "Edouard-chin",
                "url": "https://github.com/Edouard-chin"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/148003?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">This Pull Request has been created since <code class=\"notranslate\">named_variants</code> can be <code class=\"notranslate\">nil</code> and some code doesn't respect it.</p>\n<p dir=\"auto\">Admittedly I can only trigger the code path with a somewhat contrived example, namely creating an <code class=\"notranslate\">ActiveRecord::Attachment</code> manually without declaring a <code class=\"notranslate\">has_one_attached</code> or similar:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class User &lt; ActiveRecord::Base; end\n\nuser = User.create!\n\nblob = ActiveStorage::Blob.create_and_upload!(\n  io: StringIO.new('xxx'),\n  filename: 'some_filename'\n)\n\nActiveStorage::Attachment.create(\n  name: 'test',\n  blob: blob,\n  record: user\n)\n\n# =&gt; NoMethodError: undefined method `each' for nil:NilClass\n# /.../activestorage/app/models/active_storage/attachment.rb:134:in `transform_variants_later'\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">User</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">;</span> <span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create!</span>\n\n<span class=\"pl-s1\">blob</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveStorage</span>::<span class=\"pl-v\">Blob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create_and_upload!</span><span class=\"pl-kos\">(</span>\n  <span class=\"pl-pds\">io</span>: <span class=\"pl-v\">StringIO</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'xxx'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">filename</span>: <span class=\"pl-s\">'some_filename'</span>\n<span class=\"pl-kos\">)</span>\n\n<span class=\"pl-v\">ActiveStorage</span>::<span class=\"pl-v\">Attachment</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create</span><span class=\"pl-kos\">(</span>\n  <span class=\"pl-pds\">name</span>: <span class=\"pl-s\">'test'</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">blob</span>: <span class=\"pl-s1\">blob</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">record</span>: <span class=\"pl-s1\">user</span>\n<span class=\"pl-kos\">)</span>\n\n<span class=\"pl-c\"># =&gt; NoMethodError: undefined method `each' for nil:NilClass</span>\n<span class=\"pl-c\"># /.../activestorage/app/models/active_storage/attachment.rb:134:in `transform_variants_later'</span></pre></div>\n<h3 dir=\"auto\">Reproduction template</h3>\n<p dir=\"auto\">You can reproduce it yourself with this template:</p>\n<details><summary>Full reproduction template</summary>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire 'bundler/inline'\n\ngemfile(true) do\n  source 'https://rubygems.org'\n\n  git_source(:github) { |repo| &quot;https://github.com/#{repo}.git&quot; }\n\n  gem 'rails', github: 'rails/rails', branch: 'main'\n  gem 'sqlite3'\nend\n\nrequire 'active_record/railtie'\nrequire 'active_storage/engine'\nrequire 'tmpdir'\n\nclass TestApp &lt; Rails::Application\n  config.root = __dir__\n  config.hosts &lt;&lt; 'example.org'\n  config.eager_load = false\n  config.session_store :cookie_store, key: 'cookie_store_key'\n  config.secret_key_base = 'secret_key_base'\n\n  config.logger = Logger.new($stdout)\n  Rails.logger  = config.logger\n\n  config.active_storage.service = :local\n  config.active_storage.service_configurations = {\n    local: {\n      root: Dir.tmpdir,\n      service: 'Disk'\n    }\n  }\nend\n\nENV['DATABASE_URL'] = 'sqlite3::memory:'\n\nRails.application.initialize!\n\nrequire ActiveStorage::Engine.root.join('db/migrate/20170806125915_create_active_storage_tables.rb').to_s\n\nActiveRecord::Schema.define do\n  CreateActiveStorageTables.new.change\n\n  create_table :users, force: true\nend\n\nclass User &lt; ActiveRecord::Base\n  has_one_attached :profile\nend\n\nrequire 'minitest/autorun'\n\nclass BugTest &lt; Minitest::Test\n  def test_upload_and_download\n    user = User.create!\n\n    blob = ActiveStorage::Blob.create_and_upload!(\n      io: StringIO.new('xxx'),\n      filename: 'some_filename'\n    )\n\n    ActiveStorage::Attachment.create(\n      name: 'test',\n      blob: blob,\n      record: user\n    )\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">'bundler/inline'</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">'https://rubygems.org'</span>\n\n  <span class=\"pl-en\">git_source</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:github</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">repo</span>| <span class=\"pl-s\">\"https://github.com/<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">repo</span><span class=\"pl-kos\">}</span></span>.git\"</span> <span class=\"pl-kos\">}</span>\n\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">'rails'</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">github</span>: <span class=\"pl-s\">'rails/rails'</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">branch</span>: <span class=\"pl-s\">'main'</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">'sqlite3'</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">'active_record/railtie'</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">'active_storage/engine'</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">'tmpdir'</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">TestApp</span> &lt; <span class=\"pl-v\">Rails</span>::<span class=\"pl-v\">Application</span>\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">root</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">__dir__</span>\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">hosts</span> &lt;&lt; <span class=\"pl-s\">'example.org'</span>\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">eager_load</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">false</span>\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">session_store</span> <span class=\"pl-pds\">:cookie_store</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">key</span>: <span class=\"pl-s\">'cookie_store_key'</span>\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">secret_key_base</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'secret_key_base'</span>\n\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span>$stdout<span class=\"pl-kos\">)</span>\n  <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span>  <span class=\"pl-c1\">=</span> <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span>\n\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_storage</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">service</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">:local</span>\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_storage</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">service_configurations</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-pds\">local</span>: <span class=\"pl-kos\">{</span>\n      <span class=\"pl-pds\">root</span>: <span class=\"pl-v\">Dir</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">tmpdir</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-pds\">service</span>: <span class=\"pl-s\">'Disk'</span>\n    <span class=\"pl-kos\">}</span>\n  <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">'DATABASE_URL'</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'sqlite3::memory:'</span>\n\n<span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">initialize!</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-v\">ActiveStorage</span>::<span class=\"pl-v\">Engine</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">root</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'db/migrate/20170806125915_create_active_storage_tables.rb'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_s</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Schema</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">define</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-v\">CreateActiveStorageTables</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">change</span>\n\n  <span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:users</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">User</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">has_one_attached</span> <span class=\"pl-pds\">:profile</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">'minitest/autorun'</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">BugTest</span> &lt; <span class=\"pl-v\">Minitest</span>::<span class=\"pl-v\">Test</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_upload_and_download</span>\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create!</span>\n\n    <span class=\"pl-s1\">blob</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveStorage</span>::<span class=\"pl-v\">Blob</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create_and_upload!</span><span class=\"pl-kos\">(</span>\n      <span class=\"pl-pds\">io</span>: <span class=\"pl-v\">StringIO</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'xxx'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-pds\">filename</span>: <span class=\"pl-s\">'some_filename'</span>\n    <span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-v\">ActiveStorage</span>::<span class=\"pl-v\">Attachment</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create</span><span class=\"pl-kos\">(</span>\n      <span class=\"pl-pds\">name</span>: <span class=\"pl-s\">'test'</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-pds\">blob</span>: <span class=\"pl-s1\">blob</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-pds\">record</span>: <span class=\"pl-s1\">user</span>\n    <span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n</details>\n<h3 dir=\"auto\">Background</h3>\n<p dir=\"auto\">I'm doing something like above in an app and I'm not sure if this is even an intended use case.</p>\n<p dir=\"auto\">Though even if not, maybe it could still be merged since <code class=\"notranslate\">#named_variants</code> itself already considers the case where the reflection is <code class=\"notranslate\">nil</code>:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    # app/models/active_storage/attachment.rb:147\n    def named_variants\n      record.attachment_reflections[name]&amp;.named_variants\n    end\"><pre class=\"notranslate\">    <span class=\"pl-c\"># app/models/active_storage/attachment.rb:147</span>\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">named_variants</span>\n      <span class=\"pl-en\">record</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">attachment_reflections</span><span class=\"pl-kos\">[</span><span class=\"pl-en\">name</span><span class=\"pl-kos\">]</span>&amp;.<span class=\"pl-en\">named_variants</span>\n    <span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">So at least it is consistent that other methods using <code class=\"notranslate\">#named_variants</code> can now deal with that possible <code class=\"notranslate\">nil</code>.</p>\n<p dir=\"auto\">For reference: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1596229744\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47473\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47473/hovercard\" href=\"https://github.com/rails/rails/pull/47473\">#47473</a> introduced the code that fails in this example.</p>\n<h3 dir=\"auto\">Test</h3>\n<p dir=\"auto\">I didn't add any test for this. If you think this is merge-worthy and needs tests I can do so, please give me a ping. Thanks!</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49770",
            "title": "respect that `named_variants` can be `nil`",
            "date_modified": "2023-10-25T15:34:56.000Z",
            "date_published": "2023-10-24T16:59:24.000Z",
            "author": {
                "name": "doits",
                "url": "https://github.com/doits"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/39735028?u=91330295c614cf3cec0b64bf242a14fc2ceb358f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49707.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1953127535\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49707\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49707/hovercard\" href=\"https://github.com/rails/rails/issues/49707\">#49707</a></p>\n<p dir=\"auto\">This Pull Request has been created because we noticed that <code class=\"notranslate\">ActiveRecord::Core#inspect</code> was taking &gt;9s to run for some large objects in production. This is because the parameter filter is be executed for every attribute.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request introduces configuration for <code class=\"notranslate\">ActiveRecord::Core#inspect</code>. By default, <code class=\"notranslate\">inspect</code> just returns the object with its id (eg <code class=\"notranslate\">#&lt;Post id: 1&gt;</code>. The attributes to include can be configured with <code class=\"notranslate\">Post.attributes_to_inspect=</code>. If you want to full output with all the attributes you can call <code class=\"notranslate\">Post.full_inspect</code>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">In my first draft I had a config to disable this, if you just always want to use <code class=\"notranslate\">full_inspect</code>. But it seems easy enough just to do <code class=\"notranslate\">alias_method :inspect, :full_inspect</code> on the model, or in <code class=\"notranslate\">ApplicationRecord</code> if you want to disable it globally. So the config didn't seem worth it to me.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49765",
            "title": "Make the output of `ActiveRecord::Core#inspect` configurable.",
            "date_modified": "2023-10-27T13:37:51.000Z",
            "date_published": "2023-10-24T14:20:10.000Z",
            "author": {
                "name": "andrewn617",
                "url": "https://github.com/andrewn617"
            }
        }
    ]
}