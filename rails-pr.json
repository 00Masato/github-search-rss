{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1131536?u=16a9e214d689ef416040ba29ebd9cbcc293bb27e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1723197770\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48287\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48287/hovercard\" href=\"https://github.com/rails/rails/pull/48287\">#48287</a> break some CI in <a href=\"https://git.thape.com.cn/Eric-Guo/coreui-pro-rails-starter/-/jobs/103123#L565\" rel=\"nofollow\">my</a> and other pipeline.</p>\n<p dir=\"auto\"><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a> suggest <a href=\"https://github.com/rails/rails/pull/48287#issuecomment-1563170637\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48287/hovercard\">exclude the vendor folder</a>, I tested and it works.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48323",
            "title": "Exclude the vendor as including vendor will cause CI break after merge #48287",
            "date_modified": "2023-05-28T16:24:16.000Z",
            "date_published": "2023-05-28T16:24:12.000Z",
            "author": {
                "name": "Eric-Guo",
                "url": "https://github.com/Eric-Guo"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48320.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1729408580\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48320\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48320/hovercard\" href=\"https://github.com/rails/rails/issues/48320\">#48320</a>.</p>\n<p dir=\"auto\">When used optimistic locking, it uses custom logic without calling <code class=\"notranslate\">super</code> </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/e9ea600c24bb44317cf6176c34020a7d0e1060f3/activerecord/lib/active_record/locking/optimistic.rb#L125-L137\">rails/activerecord/lib/active_record/locking/optimistic.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 125 to 137\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/e9ea600c24bb44317cf6176c34020a7d0e1060f3\">e9ea600</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L125\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"125\"></td>\n          <td id=\"LC125\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">destroy_row</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L126\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"126\"></td>\n          <td id=\"LC126\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">return</span> <span class=\"pl-smi\">super</span> <span class=\"pl-k\">unless</span> <span class=\"pl-en\">locking_enabled?</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L127\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"127\"></td>\n          <td id=\"LC127\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L128\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"128\"></td>\n          <td id=\"LC128\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">locking_column</span> <span class=\"pl-c1\">=</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">class</span><span class=\"pl-kos\">.</span><span class=\"pl-s1\">locking_column</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L129\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"129\"></td>\n          <td id=\"LC129\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L130\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"130\"></td>\n          <td id=\"LC130\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">delete_constraints</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">_query_constraints_hash</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L131\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"131\"></td>\n          <td id=\"LC131\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">delete_constraints</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">locking_column</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">_lock_value_for_database</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">locking_column</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L132\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"132\"></td>\n          <td id=\"LC132\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L133\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"133\"></td>\n          <td id=\"LC133\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">affected_rows</span> <span class=\"pl-c1\">=</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">class</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">_delete_record</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">delete_constraints</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L134\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"134\"></td>\n          <td id=\"LC134\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L135\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"135\"></td>\n          <td id=\"LC135\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">if</span> <span class=\"pl-s1\">affected_rows</span> != <span class=\"pl-c1\">1</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L136\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"136\"></td>\n          <td id=\"LC136\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">raise</span> <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">StaleObjectError</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-smi\">self</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"destroy\"</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L137\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"137\"></td>\n          <td id=\"LC137\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n without a chance for counter cache to implement its logic. So I swapped the includes. Are there any  pitfalls this can introduce?<p></p>",
            "url": "https://github.com/rails/rails/pull/48322",
            "title": "Fix decrementing counter caches for parent records using optimistic locking",
            "date_modified": "2023-05-28T13:27:20.000Z",
            "date_published": "2023-05-28T13:27:16.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/3938172?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This pull request addresses an integration bug between ActionCable and Redis &gt;= 5.0 when using sentinels configuration. The bug causes issues because the sentinels configuration is a nested array of hashes, whereas the Redis client expects keys to be symbols. The proposed changes in this pull request modify the preparation of the Redis configuration to ensure that all keys are properly represented as symbols. This fix resolves the problem and improves the compatibility between ActionCable and Redis with sentinels.</p>\n<p dir=\"auto\">cc: <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">It is possible to reproduce within this repo <a href=\"https://github.com/moofkit/actioncable-redis-sentinel-bug\">https://github.com/moofkit/actioncable-redis-sentinel-bug</a></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ bundle &amp;&amp; bundle exec rails test\nRunning 1 tests in a single process (parallelization threshold is 50)\nRun options: --seed 7348\n\n# Running:\n\nE\n\nError:\nActioncableTest#test_broadcasts_to_test_channel:\nArgumentError: unknown keywords: &quot;host&quot;, &quot;port&quot;\n    test/integration/actioncable_test.rb:5:in `block in &lt;class:ActioncableTest&gt;'\n\nrails test test/integration/actioncable_test.rb:4\n\nFinished in 0.043971s, 22.7423 runs/s, 0.0000 assertions/s.\n1 runs, 0 assertions, 0 failures, 1 errors, 0 skips\"><pre class=\"notranslate\"><code class=\"notranslate\">$ bundle &amp;&amp; bundle exec rails test\nRunning 1 tests in a single process (parallelization threshold is 50)\nRun options: --seed 7348\n\n# Running:\n\nE\n\nError:\nActioncableTest#test_broadcasts_to_test_channel:\nArgumentError: unknown keywords: \"host\", \"port\"\n    test/integration/actioncable_test.rb:5:in `block in &lt;class:ActioncableTest&gt;'\n\nrails test test/integration/actioncable_test.rb:4\n\nFinished in 0.043971s, 22.7423 runs/s, 0.0000 assertions/s.\n1 runs, 0 assertions, 0 failures, 1 errors, 0 skips\n</code></pre></div>\n<p dir=\"auto\">The problem is <a href=\"https://github.com/moofkit/actioncable-redis-sentinel-bug/blob/ca59d09d7dc992a0685ca8f1f01ae27644cbd47f/config/cable.yml#L4-L6\">config for the cable</a> parsed from YAML file and sentinels are deep nested hash in the array. But redis client expecting keys to be symbols, in the result it raises error <code class=\"notranslate\">ArgumentError: unknown keywords: \"host\", \"port\"</code> in the <a href=\"https://github.com/redis-rb/redis-client/blob/ae29d650c2f9a357727483989cb0b60439f63556/lib/redis_client/sentinel_config.rb#L111\">redis-client</a></p>\n<p dir=\"auto\">This issue can be fixed within application with this initializer code</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# config/initializers/action_cable.rb\nrequire &quot;action_cable/subscription_adapter/redis&quot;\n\n# https://github.com/rails/rails/blob/da309a582e04183a85340ec0e1ed59b2d69ca9c2/actioncable/lib/action_cable/subscription_adapter/redis.rb#LL18C21-L18C61\nActionCable::SubscriptionAdapter::Redis.redis_connector = lambda do |config|\n  # BUG: it needs to symbolize keys for redis gem &gt;= 5.0.0\n  Redis.new(config.deep_symbolize_keys.except(:adapter, :channel_prefix))\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># config/initializers/action_cable.rb</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"action_cable/subscription_adapter/redis\"</span>\n\n<span class=\"pl-c\"># https://github.com/rails/rails/blob/da309a582e04183a85340ec0e1ed59b2d69ca9c2/actioncable/lib/action_cable/subscription_adapter/redis.rb#LL18C21-L18C61</span>\n<span class=\"pl-v\">ActionCable</span>::<span class=\"pl-v\">SubscriptionAdapter</span>::<span class=\"pl-v\">Redis</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">redis_connector</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">lambda</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">config</span>|\n  <span class=\"pl-c\"># BUG: it needs to symbolize keys for redis gem &gt;= 5.0.0</span>\n  <span class=\"pl-v\">Redis</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">deep_symbolize_keys</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">except</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:adapter</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:channel_prefix</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">A redis-client related discussion: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1729319116\" data-permission-text=\"Title is private\" data-url=\"https://github.com/redis-rb/redis-client/issues/121\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/redis-rb/redis-client/pull/121/hovercard\" href=\"https://github.com/redis-rb/redis-client/pull/121\">redis-rb/redis-client#121</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48321",
            "title": "Fix ActionCable Redis configuration with sentinels",
            "date_modified": "2023-05-28T12:20:40.000Z",
            "date_published": "2023-05-28T12:02:30.000Z",
            "author": {
                "name": "moofkit",
                "url": "https://github.com/moofkit"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/984854?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Following on the Arel work in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1717924373\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48261\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48261/hovercard\" href=\"https://github.com/rails/rails/pull/48261\">#48261</a>, this commit adds the ability to provide a materialization hint to a CTE in ActiveRecord. To support the hint, a more verbose syntax for CTE values is introduced:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Post.with(posts_with_comments: { query: Post.where(&quot;comments_count &gt; ?&quot;, 0), materialized: true })\"><pre class=\"notranslate\"><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">with</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">posts_with_comments</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">query</span>: <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"comments_count &gt; ?\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">materialized</span>: <span class=\"pl-c1\">true</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">The CTE value is described as a hash that contains a required <code class=\"notranslate\">:query</code> key and an optional <code class=\"notranslate\">:materialized</code> key. The set of available options could be expanded in the future to accommodate, for example, postgres's various options for recursive CTEs.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I don't know whether there's any appetite within the core team to expose this functionality in AR's public API. But if there is, this approach seemed like the most plausible choice, given the current <code class=\"notranslate\">#with</code> interface. That said, I'm more than happy to talk about alternatives.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48305",
            "title": "Add syntax for CTE materialization hint to ActiveRecord",
            "date_modified": "2023-05-26T12:59:57.000Z",
            "date_published": "2023-05-26T00:35:36.000Z",
            "author": {
                "name": "97jaz",
                "url": "https://github.com/97jaz"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1034?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Follow-up to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1719428798\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48274\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48274/hovercard?comment_id=1562217321&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/pull/48274#issuecomment-1562217321\">#48274 (comment)</a></p>\n<p dir=\"auto\">In settling the behaviour in my head, I found there was still a discrepancy between when attributes get type cast (as exemplified by the int -&gt; string conversion in the test here), vs when the encoding changed on strings destined to be stored in a binary column.</p>\n<p dir=\"auto\">I think this completes the idea that the encoding switch is itself a type cast operation, despite both types using the same class.</p>\n<p dir=\"auto\">I note in passing that this comment: </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/38e8bf76f85ac551db10f4b9825801ad823392f9/activemodel/lib/active_model/type/binary.rb#L10\">rails/activemodel/lib/active_model/type/binary.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 10\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/38e8bf76f85ac551db10f4b9825801ad823392f9\">38e8bf7</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L10\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"10\"></td>\n          <td id=\"LC10\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\"># Non-string values are coerced to strings using their +to_s+ method.</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">is inconsistent with this test: </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/38e8bf76f85ac551db10f4b9825801ad823392f9/activemodel/test/cases/type/binary_test.rb#L12\">rails/activemodel/test/cases/type/binary_test.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 12\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/38e8bf76f85ac551db10f4b9825801ad823392f9\">38e8bf7</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L12\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"12\"></td>\n          <td id=\"LC12\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">assert_equal</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">type</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">cast</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">I had to make the implementation a bit more explicit on that point (by only applying the encoding swap when it sees a string), but I'm reluctant to poke further there.</p>",
            "url": "https://github.com/rails/rails/pull/48297",
            "title": "Ensure binary-destined values have binary encoding during type cast",
            "date_modified": "2023-05-25T16:08:20.000Z",
            "date_published": "2023-05-25T10:53:31.000Z",
            "author": {
                "name": "matthewd",
                "url": "https://github.com/matthewd"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Continuation of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1723747653\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48288\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48288/hovercard\" href=\"https://github.com/rails/rails/pull/48288\">#48288</a></p>\n<p dir=\"auto\">This covers the following cases:</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">&lt;tt&gt;config/application.rb&lt;/tt&gt;</code> -&gt; <code class=\"notranslate\">+config/application.rb+</code></li>\n<li><code class=\"notranslate\">&lt;tt&gt;test/mailers/previews&lt;/tt&gt;</code> -&gt; <code class=\"notranslate\">+test/mailers/previews+</code></li>\n<li><code class=\"notranslate\">&lt;tt&gt;foo!&lt;/tt&gt;</code> -&gt; <code class=\"notranslate\">+foo!+</code></li>\n<li><code class=\"notranslate\">&lt;tt&gt;foo*&lt;/tt&gt;</code> -&gt; <code class=\"notranslate\">+foo*+</code></li>\n<li><code class=\"notranslate\">&lt;tt&gt;foo?&lt;/tt&gt;</code> -&gt; <code class=\"notranslate\">+foo?+</code></li>\n<li><code class=\"notranslate\">&lt;tt&gt;keyword&lt;/tt&gt;</code> -&gt; <code class=\"notranslate\">+keyword+</code></li>\n<li><code class=\"notranslate\">&lt;tt&gt;:symbol&lt;/tt&gt;</code> -&gt; <code class=\"notranslate\">+:symbol+</code></li>\n<li><code class=\"notranslate\">&lt;tt&gt;default_options=&lt;/tt&gt;</code> -&gt; <code class=\"notranslate\">+default_options=+</code></li>\n<li><code class=\"notranslate\">&lt;tt&gt;Time.zone=&lt;/tt&gt;</code> -&gt; <code class=\"notranslate\">+Time.zone=+</code></li>\n<li><code class=\"notranslate\">&lt;tt&gt;activemodel.errors.models.MODEL.attributes.ATTRIBUTE.MESSAGE&lt;/tt&gt;</code> -&gt; <code class=\"notranslate\">+activemodel.errors.models.MODEL.attributes.ATTRIBUTE.MESSAGE+</code></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48296",
            "title": "Use short-form fixed-width RDoc form for symbols",
            "date_modified": "2023-05-25T00:05:40.000Z",
            "date_published": "2023-05-25T00:03:08.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/20481048?u=d1e9cc98c3219014f761a14cb56e40aacd4939e3&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">While investigating database-related errors at GitHub we found ourselves consistently digging through the code to find out more information about the connection, like the cluster or role.</p>\n<p dir=\"auto\">The goal of this PR is to store the <code class=\"notranslate\">connection_pool</code> associated with any exceptions raised from an adapter so the application can easily access it and send it along to an exception tracking system.<br>\nWe believe that's an appropriate feature given Rails supports multiple databases.</p>\n<p dir=\"auto\">Anytime <sup><a href=\"#user-content-fn-almost-b13a14493d144f16478487258379befe\" id=\"user-content-fnref-almost-b13a14493d144f16478487258379befe\" data-footnote-ref=\"\" aria-describedby=\"footnote-label\">1</a></sup> an exception is raised from an adapter we now provide a <code class=\"notranslate\">connection_pool</code> along for the application to further debug what went wrong. This is an important feature when running a multi-database Rails application.</p>\n<p dir=\"auto\">We chose to provide the <code class=\"notranslate\">connection_pool</code> as it has relevant context like connection, role and shard. We wanted to avoid providing the <code class=\"notranslate\">connection</code> directly as it might accidentally be used after it's returned to the pool and been handed to another thread.<br>\nThe <code class=\"notranslate\">ConnectionAdapters::PoolConfig</code> would also have been a reasonable option except it's <code class=\"notranslate\">:nodoc:</code>.</p>\n<section data-footnotes=\"\" class=\"footnotes\"><h2 id=\"footnote-label\" class=\"sr-only\" dir=\"auto\">Footnotes</h2>\n<ol dir=\"auto\">\n<li id=\"user-content-fn-almost-b13a14493d144f16478487258379befe\">\n<p dir=\"auto\">There's one exception I caught: sqlite3's adapter raises an <code class=\"notranslate\">ArgumentError</code> if no database file is specified. I didn't think it was appropriate to change that exception to include the connection pool <a href=\"https://github.com/rails/rails/blob/02df5fe1e77c38f8086ec45e349ba3d1b25605a0/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L106\">https://github.com/rails/rails/blob/02df5fe1e77c38f8086ec45e349ba3d1b25605a0/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L106</a> <a href=\"#user-content-fnref-almost-b13a14493d144f16478487258379befe\" data-footnote-backref=\"\" aria-label=\"Back to reference 1\" class=\"data-footnote-backref\"><g-emoji class=\"g-emoji\" alias=\"leftwards_arrow_with_hook\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/21a9.png\">‚Ü©</g-emoji></a></p>\n</li>\n</ol>\n</section>",
            "url": "https://github.com/rails/rails/pull/48295",
            "title": "Store `connection_pool` in database-related exceptions",
            "date_modified": "2023-05-26T13:26:16.000Z",
            "date_published": "2023-05-24T20:31:58.000Z",
            "author": {
                "name": "luanzeba",
                "url": "https://github.com/luanzeba"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8207?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<h4 dir=\"auto\">The modern web is built on HTML5</h4>\n<p dir=\"auto\">The HTML sanitizers used in Rails 7.0 and earlier, <a href=\"https://github.com/rails/rails-html-sanitizer\">rails/rails-html-sanitizer</a>, use Loofah and Nokogiri, and specifically rely on Nokogiri's HTML4 parser, libxml2.</p>\n<p dir=\"auto\">libxml2's HTML4 parser has not kept up-to-date with the HTML5 standards upon which  most modern web applications rely, and so it does not behave the same way as modern browsers. Some more context about this statement can be found at <a href=\"https://github.com/sparklemotion/nokogiri/issues/2064\" data-hovercard-type=\"issue\" data-hovercard-url=\"/sparklemotion/nokogiri/issues/2064/hovercard\">RFC: Explore alternatives to libxml2 for HTML parsing ¬∑ Issue #2064 ¬∑ sparklemotion/nokogiri</a>, but perhaps the most important bit is this quote from the primary libxml2 maintainer:</p>\n<blockquote>\n<p dir=\"auto\">it's still a bad idea to use a 20+ years old, unmaintained HTML 4 parser to sanitize input for the modern web</p>\n</blockquote>\n<p dir=\"auto\">(source: <a href=\"https://bugzilla.gnome.org/show_bug.cgi?id=769760#c4\" rel=\"nofollow\">https://bugzilla.gnome.org/show_bug.cgi?id=769760#c4</a>)</p>\n<p dir=\"auto\">For the most part this has not prevented users from accomplishing what they need to do. But on occasion it has resulted in security issues, and has at times caused unexpected behavior in Rails applications.</p>\n<h4 dir=\"auto\">Security implications of using HTML4 on the server and HTML5 on the client</h4>\n<p dir=\"auto\">Some background on security issues that have resulted from the behavior differences between the server-side HTML4 sanitizers and the client-side (browser) HTML5 parsers: <a href=\"https://github.com/flavorjones/loofah/blob/main/docs/2022-10-decision-on-cdata-nodes.md\">loofah/2022-10-decision-on-cdata-nodes.md</a>.</p>\n<p dir=\"auto\">I'll call out this statement I made in that document for emphasis:</p>\n<blockquote>\n<p dir=\"auto\">It's important to note that if we use an HTML5 parser for the sanitization pass, this entire class of problem goes away.</p>\n</blockquote>\n<h4 dir=\"auto\">Other behavioral differences</h4>\n<p dir=\"auto\">Because libxml2 does not follow the HTML5 parsing spec, sanitized documents often do not match our expectations. Sometimes this is unnoticeable, but other times it impacts application behavior.</p>\n<p dir=\"auto\">For a recent example of unexpected application behavior, see <a href=\"https://meta.discourse.org/t/markdown-preview-and-result-differ/263878/5\" rel=\"nofollow\">Markdown preview and result differ - bug - Discourse Meta</a>.</p>\n<h4 dir=\"auto\">The last mile</h4>\n<p dir=\"auto\">In any case, there's been a bunch of work that's led up to this PR:</p>\n<ul dir=\"auto\">\n<li>2021: add HTML5 support to Nokogiri - <a href=\"https://github.com/sparklemotion/nokogiri/issues/2204\" data-hovercard-type=\"issue\" data-hovercard-url=\"/sparklemotion/nokogiri/issues/2204/hovercard\">Epic: merge Nokogumbo into Nokogiri ¬∑ Issue #2204 ¬∑ sparklemotion/nokogiri</a></li>\n<li>2022: fix Nokogiri::HTML5 subclassing so that Loofah may inherit - <a href=\"https://github.com/sparklemotion/nokogiri/pull/2534\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/sparklemotion/nokogiri/pull/2534/hovercard\">html5 subclassing by flavorjones ¬∑ Pull Request #2534 ¬∑ sparklemotion/nokogiri</a></li>\n<li>2023: Loofah 2.21 released with HTML5 support - <a href=\"https://github.com/flavorjones/loofah/releases/tag/v2.21.0\">Release 2.21.0 / 2023-05-10 ¬∑ flavorjones/loofah</a></li>\n<li>earlier today: rails-html-sanitizer 1.6.0.rc2 supports HTML5 sanitizers - <a href=\"https://github.com/rails/rails-html-sanitizer/compare/v1.5.0...v1.6.0.rc2\">Comparing v1.5.0...v1.6.0.rc2 ¬∑ rails/rails-html-sanitizer</a></li>\n</ul>\n<p dir=\"auto\">So, now that the rest of the sanitizer stack relied upon by Rails supports HTML5, it's time to update Rails to use it.</p>\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>Action View now depends on rails-html-sanitizer <code class=\"notranslate\">~&gt; 1.6</code></li>\n<li><code class=\"notranslate\">mattr_accessor</code> <code class=\"notranslate\">sanitizer_vendor</code> is added to <code class=\"notranslate\">ActionView::Helpers::SanitizeHelper</code></li>\n<li>new config value <code class=\"notranslate\">action_view.sanitizer_vendor</code> which in 7.0 config and earlier defaults to <code class=\"notranslate\">Rails::HTML4::Sanitizer</code></li>\n<li>7.1 config defaults <code class=\"notranslate\">action_view.sanitizer_vendor</code> to <code class=\"notranslate\">Rails::HTML5::Sanitizer</code> if it's supported, else falls back to <code class=\"notranslate\">Rails::HTML4::Sanitizer</code></li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">There are a few places in Rails where <code class=\"notranslate\">Rails::Html::Sanitizer</code> is being referenced directly (without going through <code class=\"notranslate\">ActionView::Helpers::SanitizeHelper.sanitizer_vendor</code>) or where <code class=\"notranslate\">Nokogiri::HTML</code> is being referenced directly. I haven't updated those callsites here, but intend to address them in a future PR so that HTML5 parsing becomes the default everywhere in Rails.</p>\n<p dir=\"auto\">The decision to pin Rails to <code class=\"notranslate\">rails-html-sanitizer</code> <code class=\"notranslate\">~&gt; 1.6</code>, which itself pins to <code class=\"notranslate\">nokogiri</code> <code class=\"notranslate\">~&gt; 1.14</code> and <code class=\"notranslate\">loofah</code> <code class=\"notranslate\">~&gt; 2.21</code> was made in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1718179352\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails-html-sanitizer/issues/166\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails-html-sanitizer/pull/166/hovercard\" href=\"https://github.com/rails/rails-html-sanitizer/pull/166\">rails/rails-html-sanitizer#166</a>. Note that this stack requires Ruby <code class=\"notranslate\">&gt;= 2.7</code> which is aligned with what Rails 7.1 looks like it's supporting.</p>\n<p dir=\"auto\">Finally, with respect to performance, the libgumbo HTML5 parser used by Nokogiri is slower than the libxml2 HTML4 parser, but these differences are swamped by the overhead of the <em>sanitization</em> pass that's done by rails-html-sanitizer scrubbers.</p>\n<details>\n<summary>Here's a benchmark that compares HTML4 and HTML5 performance on a variety of document sizes and that shows that the differences are well within the margin of error.</summary>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Warming up --------------------------------------\n    HTML4: 656 Bytes    60.000  i/100ms\n    HTML5: 656 Bytes    60.000  i/100ms\nCalculating -------------------------------------\n    HTML4: 656 Bytes    597.913  (¬± 1.5%) i/s -      3.000k in   5.032080s\n    HTML5: 656 Bytes    610.627  (¬± 1.3%) i/s -      3.060k in   5.021411s\n                   with 95.0% confidence\n\nComparison:\n    HTML5: 656 Bytes:      610.6 i/s\n    HTML4: 656 Bytes:      597.9 i/s - same-ish: difference falls within error\n                   with 95.0% confidence\n\nWarming up --------------------------------------\n      HTML4: 68.5 KB     2.000  i/100ms\n      HTML5: 68.5 KB     1.000  i/100ms\nCalculating -------------------------------------\n      HTML4: 68.5 KB     20.069  (¬± 4.9%) i/s -     98.000  in   5.018054s\n      HTML5: 68.5 KB     22.090  (¬± 5.4%) i/s -    103.000  in   5.032758s\n                   with 95.0% confidence\n\nComparison:\n      HTML5: 68.5 KB:       22.1 i/s\n      HTML4: 68.5 KB:       20.1 i/s - same-ish: difference falls within error\n                   with 95.0% confidence\n\nWarming up --------------------------------------\n       HTML4: 665 KB     1.000  i/100ms\n       HTML5: 665 KB     1.000  i/100ms\nCalculating -------------------------------------\n       HTML4: 665 KB      2.227  (¬±11.8%) i/s -     11.000  in   5.099994s\n       HTML5: 665 KB      2.286  (¬±10.4%) i/s -     12.000  in   5.406337s\n                   with 95.0% confidence\n\nComparison:\n       HTML5: 665 KB:        2.3 i/s\n       HTML4: 665 KB:        2.2 i/s - same-ish: difference falls within error\n                   with 95.0% confidence\"><pre class=\"notranslate\"><code class=\"notranslate\">Warming up --------------------------------------\n    HTML4: 656 Bytes    60.000  i/100ms\n    HTML5: 656 Bytes    60.000  i/100ms\nCalculating -------------------------------------\n    HTML4: 656 Bytes    597.913  (¬± 1.5%) i/s -      3.000k in   5.032080s\n    HTML5: 656 Bytes    610.627  (¬± 1.3%) i/s -      3.060k in   5.021411s\n                   with 95.0% confidence\n\nComparison:\n    HTML5: 656 Bytes:      610.6 i/s\n    HTML4: 656 Bytes:      597.9 i/s - same-ish: difference falls within error\n                   with 95.0% confidence\n\nWarming up --------------------------------------\n      HTML4: 68.5 KB     2.000  i/100ms\n      HTML5: 68.5 KB     1.000  i/100ms\nCalculating -------------------------------------\n      HTML4: 68.5 KB     20.069  (¬± 4.9%) i/s -     98.000  in   5.018054s\n      HTML5: 68.5 KB     22.090  (¬± 5.4%) i/s -    103.000  in   5.032758s\n                   with 95.0% confidence\n\nComparison:\n      HTML5: 68.5 KB:       22.1 i/s\n      HTML4: 68.5 KB:       20.1 i/s - same-ish: difference falls within error\n                   with 95.0% confidence\n\nWarming up --------------------------------------\n       HTML4: 665 KB     1.000  i/100ms\n       HTML5: 665 KB     1.000  i/100ms\nCalculating -------------------------------------\n       HTML4: 665 KB      2.227  (¬±11.8%) i/s -     11.000  in   5.099994s\n       HTML5: 665 KB      2.286  (¬±10.4%) i/s -     12.000  in   5.406337s\n                   with 95.0% confidence\n\nComparison:\n       HTML5: 665 KB:        2.3 i/s\n       HTML4: 665 KB:        2.2 i/s - same-ish: difference falls within error\n                   with 95.0% confidence\n</code></pre></div>\n</details>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48293",
            "title": "Update Action View to use HTML5 standards-compliant sanitizers",
            "date_modified": "2023-05-26T22:45:03.000Z",
            "date_published": "2023-05-24T18:53:23.000Z",
            "author": {
                "name": "flavorjones",
                "url": "https://github.com/flavorjones"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/93276?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This change is necessary to address a potential issue that could arise when a button or an input of type submit contains child elements, such as spans, icons, or other HTML elements.</p>\n<p dir=\"auto\">Currently, ActiveStorage's <code class=\"notranslate\">didClick</code> event listener checks the target of the click event to determine if a submit button was clicked. The target property of the event refers to the specific HTML element that was clicked.</p>\n<p dir=\"auto\">In cases where a submit button contains child elements, and one of these child elements is the element that actually gets clicked, the target would refer to this child element, not the button itself.</p>\n<p dir=\"auto\">Since the <code class=\"notranslate\">didClick</code> function checks if the target is a button or an input of type submit, this check would fail, and the button wouldn't be stored in <code class=\"notranslate\">submitButtonsByForm</code>.</p>\n<p dir=\"auto\">As a result, if the form is then submitted after a direct upload, the first submit button in the form could be incorrectly used to submit the form, even if a different button was originally clicked. This could cause unexpected behavior, as different submit buttons might be intended to trigger different actions on form submission.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">By using the <code class=\"notranslate\">Element.closest()</code> method to find the nearest ancestor of the clicked element that is a button or an input of type submit, we ensure that the correct button is stored in <code class=\"notranslate\">submitButtonsByForm</code>, even if the click event was triggered by a child element of the button. This addresses the issue and ensures that the correct button is used to submit the form after a direct upload.</p>",
            "url": "https://github.com/rails/rails/pull/48290",
            "title": "Support nested elements inside <button>",
            "date_modified": "2023-05-24T15:22:12.000Z",
            "date_published": "2023-05-24T15:19:15.000Z",
            "author": {
                "name": "marckohlbrugge",
                "url": "https://github.com/marckohlbrugge"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/52599949?u=3a3e6f882db1807067702b1fee03636e352d3a3d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Currently, when<code class=\"notranslate\">invert_where</code> is called without any existing where conditions, it throws an error with invalid query.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Post.invert_where.to_sql\n#=&gt; SELECT &quot;posts&quot;.* FROM &quot;posts&quot; WHERE NOT ()\"><pre class=\"notranslate\"><code class=\"notranslate\">Post.invert_where.to_sql\n#=&gt; SELECT \"posts\".* FROM \"posts\" WHERE NOT ()\n</code></pre></div>\n<p dir=\"auto\">modified the <code class=\"notranslate\">invert_where</code> to return the receiver as is when there are no <code class=\"notranslate\">where</code> conditions to invert.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Post.order(:id).invert_where.to_sql\n#=&gt;  &quot;SELECT \\&quot;posts\\&quot;.* FROM \\&quot;posts\\&quot; ORDER BY \\&quot;posts\\&quot;.\\&quot;id\\&quot; ASC&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">Post.order(:id).invert_where.to_sql\n#=&gt;  \"SELECT \\\"posts\\\".* FROM \\\"posts\\\" ORDER BY \\\"posts\\\".\\\"id\\\" ASC\"\n</code></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">When the method chain of <code class=\"notranslate\">ActiveRecord_Relation</code> includes an unintentional method such as <code class=\"notranslate\">unscope(:where)</code> and I use invert_where after that, unexpected errors occur.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"relation = Post.where(id: 2)\nrelation = relation.unscope(:where)\nrelation.invert_where\"><pre class=\"notranslate\"><code class=\"notranslate\">relation = Post.where(id: 2)\nrelation = relation.unscope(:where)\nrelation.invert_where\n</code></pre></div>\n<p dir=\"auto\">Also, this change has some kind of consistency with how <code class=\"notranslate\">unscope(:where)</code> behaves when there are no scopes defined, I think <g-emoji class=\"g-emoji\" alias=\"bowing_woman\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f647-2640.png\">üôá‚Äç‚ôÄÔ∏è</g-emoji></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Post.order(:id).unscope(:where)\n#=&gt; &quot;SELECT \\&quot;posts\\&quot;.* FROM \\&quot;posts\\&quot; ORDER BY \\&quot;posts\\&quot;.\\&quot;id\\&quot; ASC&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">Post.order(:id).unscope(:where)\n#=&gt; \"SELECT \\\"posts\\\".* FROM \\\"posts\\\" ORDER BY \\\"posts\\\".\\\"id\\\" ASC\"\n</code></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48284",
            "title": "Fixing invert_where method to handle empty where conditions",
            "date_modified": "2023-05-25T14:49:38.000Z",
            "date_published": "2023-05-23T13:35:39.000Z",
            "author": {
                "name": "a5-stable",
                "url": "https://github.com/a5-stable"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">In my experience, to enable efficient handling of exceptions, network clients must clearly categorize their exceptions in two categories:</p>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">Network/Connection errors: whenever we didn't actually get a response from the server and perhaps the issue is transient and retrying now or later will work. e.g. Timeout, authentication error, DNS error, etc.</p>\n</li>\n<li>\n<p dir=\"auto\">Client errors: when the client did something wrong, and it's likely a bug in the user code and they should fix something. e.g. SQL Syntax error, unkown column, etc.</p>\n</li>\n</ul>\n<p dir=\"auto\">Such categorization allows for better automated handling of exceptions, like retrying or not, sending the exception to a reporting service or just emitting a health metric, etc.</p>\n<p dir=\"auto\">Historically Active Record was quite bad at translating the underlying adapter errors into clean errors of its own, and lots of network related errors were translated into <code class=\"notranslate\">SatementInvalid</code> as a big catch all.</p>\n<p dir=\"auto\">In 2019 we started better tranlating these errors (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"468823980\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/36692\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/36692/hovercard\" href=\"https://github.com/rails/rails/pull/36692\">#36692</a>, <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"468847665\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/36694\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/36694/hovercard\" href=\"https://github.com/rails/rails/pull/36694\">#36694</a>) but for backward compatibility reasons these new errors still inherited from <code class=\"notranslate\">StatementInvalid</code>.</p>\n<p dir=\"auto\">I think now would be a good time to consider fixing this historical cruft.</p>\n<p dir=\"auto\">Note: opening as a draft as this PR isn't necessarily exactly what I want to change, I'm more interested in gathering thoughts from interested parties.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/eileencodes/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/eileencodes\">@eileencodes</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a> any opinions?</p>",
            "url": "https://github.com/rails/rails/pull/48280",
            "title": "ActiveRecord: make query timeout errors inherit from the base connection error",
            "date_modified": "2023-05-23T10:57:55.000Z",
            "date_published": "2023-05-23T08:35:46.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/75765648?u=1dc3ffb2f347af44627baa665b1b2dff0abd7dd1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">Currently, when using the in_batches method on a model with composite primary keys (id_1, id_2), if :asc(:desc) is specified for the order argument, the values are returned with both id_1 and id_2 sorted in ascending (descending) order.<br>\nAllow selection of ascending or descending order for each key in composite primary key.</p>\n<p dir=\"auto\">EXAMPLE</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"class Order &lt; ActiveRecord::Base\n  self.primary_key = [:id_1, :id_2]\nend\nOrder.find_each(order: [:asc, :desc])\"><pre class=\"notranslate\"><code class=\"notranslate\">class Order &lt; ActiveRecord::Base\n  self.primary_key = [:id_1, :id_2]\nend\nOrder.find_each(order: [:asc, :desc])\n</code></pre></div>\n<p dir=\"auto\">In the above code, id_1 is sorted in ascending order, id_2 in descending</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes [REPLACE ME]</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48268",
            "title": "Support batching using composite primary keys and multiple column ordering",
            "date_modified": "2023-05-25T16:10:56.000Z",
            "date_published": "2023-05-21T08:49:23.000Z",
            "author": {
                "name": "TakuyaKurimoto",
                "url": "https://github.com/TakuyaKurimoto"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/75765648?u=1dc3ffb2f347af44627baa665b1b2dff0abd7dd1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Fixed incorrect sorting using order keyword in in_batches method</p>\n\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">Fix incorrect sorting using order keyword in in_batches method.</p>\n<p dir=\"auto\">example (posts table has id as the primary key)</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Post.in_batches(order: :desc, use_ranges: false).first.pluck(:id)\n:actual =&gt; [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]\n:expected  =&gt; [11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]\"><pre class=\"notranslate\"><code class=\"notranslate\">Post.in_batches(order: :desc, use_ranges: false).first.pluck(:id)\n:actual =&gt; [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]\n:expected  =&gt; [11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1]\n</code></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">if use_ranges keyword is true, the sorting does not work either, but I am not sure if this is the expected behavior</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48267",
            "title": "FIX correctly sort records with the in_batches method",
            "date_modified": "2023-05-21T06:18:07.000Z",
            "date_published": "2023-05-21T06:17:51.000Z",
            "author": {
                "name": "TakuyaKurimoto",
                "url": "https://github.com/TakuyaKurimoto"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/419086?u=d0fe8d6b68a77ff6fc46bd57cbc2a37db85a6d34&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">In migrations, the <code class=\"notranslate\">up_only</code> helper and the <code class=\"notranslate\">reverting?</code> predicate allow constraining operations in either direction. Adding <code class=\"notranslate\">down_only</code> and <code class=\"notranslate\">migrating?</code> allows defining blocks that need to run when reverting, or running one-liners when migrating without using double negatives. Plus, you no longer need to remember which ones exist and which ones don't.</p>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48245.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1713995776\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48245\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48245/hovercard\" href=\"https://github.com/rails/rails/issues/48245\">#48245</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds <code class=\"notranslate\">down_only</code> and <code class=\"notranslate\">migrating?</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature. (Original methods are not tested)</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48263",
            "title": "Add down only and migrating helpers to migration",
            "date_modified": "2023-05-22T13:40:31.000Z",
            "date_published": "2023-05-20T12:27:00.000Z",
            "author": {
                "name": "goulvench",
                "url": "https://github.com/goulvench"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/22918438?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Certain applications (e.g. Shopify, GitHub), retry all database queries and have been patching <code class=\"notranslate\">#execute</code> / <code class=\"notranslate\">#raw_execute</code> to change the <code class=\"notranslate\">allow_retry</code> kwarg to true. This is brittle. Enabling retries globally should be an option for apps that are willing to accept the risks.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Wondering if it's safe to retry transaction-related db methods (e.g. <code class=\"notranslate\">#commit_db_transaction</code>, <code class=\"notranslate\">#exec_restart_db_transaction</code>). As it stands, Shopify's retry patch <em>will</em> retry all of these queries, but our retry patch used to be transaction-aware. Should we stick to avoiding retries, even if the the application has configured retries globally, with these methods or are they fine to retry?</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/eileencodes/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/eileencodes\">@eileencodes</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a></p>",
            "url": "https://github.com/rails/rails/pull/48247",
            "title": "Introduce Active Record config to enable database queries to be retried",
            "date_modified": "2023-05-22T16:04:21.000Z",
            "date_published": "2023-05-17T15:26:51.000Z",
            "author": {
                "name": "adrianna-chang-shopify",
                "url": "https://github.com/adrianna-chang-shopify"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/110363331?u=c550f969fbc210d0495a428fa75e6bb29b3ea029&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This is what the file said.</p>\n<p dir=\"auto\"><code class=\"notranslate\">TODO: Consider renaming this method, as it only conditionally extends keys, not always</code>,</p>\n<p dir=\"auto\">so I changed the method name.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Removed the <code class=\"notranslate\">TODO:</code> and renamed it to the <code class=\"notranslate\">append_if_exist_keys_including_timestamps</code>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48244",
            "title": "Fix method name for `InsertAll#keys_including_timestamps`",
            "date_modified": "2023-05-18T00:34:49.000Z",
            "date_published": "2023-05-17T10:32:51.000Z",
            "author": {
                "name": "asberel",
                "url": "https://github.com/asberel"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This commit extends Active Record creation logic to allow for an auto-incremented column to be populated even if it's not being used as a whole or a part of the primary key.</p>\n<p dir=\"auto\">Given a <code class=\"notranslate\">Post</code> model represented by the following schema:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"create_table :posts, id: false do |t|\n  t.integer :sequential_number, auto_increment: true\n  t.string :title, primary_key: true\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:posts</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">id</span>: <span class=\"pl-c1\">false</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">integer</span> <span class=\"pl-pds\">:sequential_number</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">auto_increment</span>: <span class=\"pl-c1\">true</span>\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:title</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">primary_key</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">where <code class=\"notranslate\">title</code> is being used as a primary key and the table has an integer <code class=\"notranslate\">sequential_number</code> column populated by a sequence, creation of <code class=\"notranslate\">Post</code> records should populate the <code class=\"notranslate\">sequential_number</code> attribute:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"new_post = Post.create(title: 'My first post')\nnew_post.sequential_number # =&gt; 1\"><pre class=\"notranslate\"><span class=\"pl-s1\">new_post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">title</span>: <span class=\"pl-s\">'My first post'</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">new_post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">sequential_number</span> <span class=\"pl-c\"># =&gt; 1</span></pre></div>\n<h3 dir=\"auto\">Implementation details</h3>\n<p dir=\"auto\">Overall solution is trying to be generic and extensible to allow for additions while still maintains the fact that currently Rails only populates a single column and only if the column</p>\n<ul dir=\"auto\">\n<li>The most important change I'd like to bring the most attention to is the method signature change for both <code class=\"notranslate\">exec_insert</code> and <code class=\"notranslate\">insert</code> public methods. We are adding a new <code class=\"notranslate\">returning_columns</code> keyword argument with a default value with an intention for the argument to be undocumented  until Rails is ready to support populating more than one column. If keeping an undocumented optional argument is not an option then we'll have to consider defining a new method like <code class=\"notranslate\">DatabaseStatements#insert_with_returning</code> as we can't change <code class=\"notranslate\">insert</code> signature to return more than one value without a deprecation cycle.</li>\n<li><code class=\"notranslate\">ConnectionAdapters::Column</code> gets a new adapter-abstract attribute called <code class=\"notranslate\">auto_incremented_by_db?</code> which indicates whether a given column is being auto-incremented by the database regardless of the way it's being incremented. For mysql we alias it to <code class=\"notranslate\">auto_increment</code> and for postgresql we alias it to <code class=\"notranslate\">serial</code>.</li>\n<li><code class=\"notranslate\">ModelSchema._auto_populated_column_names</code> has been added to gather a list of columns that are either auto-incremented or populated by a default function. It may not be a complete list but it should cover most of the scenarios and sufficient as long as at this point we only looking on a single column in <code class=\"notranslate\">_create_record</code>. Perhaps the <code class=\"notranslate\">Column</code> class itself could have had a <code class=\"notranslate\">auto_populated_by_database?</code> method which could combine the auto-increment and default function checks but we can add this later as a refactoring</li>\n<li><code class=\"notranslate\">_create_record</code> uses <code class=\"notranslate\">_auto_populated_column_names</code> but fetches only one column as <code class=\"notranslate\">insert</code> signature is only capable of returning a single value. <code class=\"notranslate\">primary_key</code> take precedence when choosing the column to populate.</li>\n</ul>\n<p dir=\"auto\">If the change seems too risky for existing models we could consider limiting the change to the composite primary keys models only</p>\n<h3 dir=\"auto\">Long term plans</h3>\n<p dir=\"auto\">Long term we should be looking into extending the capability to be able to populate any number of auto-populated db columns after creation. For postgresql it will be done using the <code class=\"notranslate\">RETURNING</code> statement but MySQL will require an additional <code class=\"notranslate\">SELECT</code> query to be performed to fetch values for every auto-populated columns. An additional query may not be desirable for every application so the behavior should be configurable which brings more complexity and one of the reasons why we are not trying to tackle it all at once. Though for postgresql it's simpler so perhaps we could start supporting postgresql first and add mysql support later.</p>",
            "url": "https://github.com/rails/rails/pull/48241",
            "title": " Fill auto incremented column for models with CPK",
            "date_modified": "2023-05-25T11:18:47.000Z",
            "date_published": "2023-05-16T21:00:17.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/9117775?u=c5242a1b05e8272b9475a772e76fb3c5a7177445&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Please consider viewing the diff with whitespace disabled: <a href=\"https://github.com/rails/rails/pull/48224/files?w=1\">https://github.com/rails/rails/pull/48224/files?w=1</a></p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">A proposal for a way to improve the fix for <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1699572304\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48164\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48164/hovercard\" href=\"https://github.com/rails/rails/issues/48164\">#48164</a> which was added in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1707080058\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48200\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48200/hovercard\" href=\"https://github.com/rails/rails/pull/48200\">#48200</a>. Please see <a href=\"https://github.com/rails/rails/issues/48164#issuecomment-1544018445\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48164/hovercard\">this discussion</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Introduces the concept of a transaction lock. This is used to detect cases where <code class=\"notranslate\">within_new_transaction</code> raises, potentially leaving the connection in a transaction, and the attempt to discard the connection fails.</p>\n<p dir=\"auto\">The idea is to store and acquire a new lock before attempting to begin a transaction, and to only discard the lock once the transaction state is definitely known. If <code class=\"notranslate\">within_new_transaction</code> raises, without the lock being discarded, subsequent attempts to create a transaction will detect this and discard the connection.</p>\n<p dir=\"auto\">Note that no such check is performed in other methods which may use a connection in an unknown transaction state. For instance, it will still be possible to invoke <code class=\"notranslate\">execute</code>. In case this change ends up being acceptable, such checks could be added.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48224",
            "title": "Use locks to detect connections which are in an unknown transaction state",
            "date_modified": "2023-05-17T05:09:27.000Z",
            "date_published": "2023-05-14T06:22:20.000Z",
            "author": {
                "name": "nicholasdower",
                "url": "https://github.com/nicholasdower"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1518299?u=a2dd8dd1835679cfd6b1924ef63a6e61ea62fa2a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48185.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1703067636\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48185\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48185/hovercard\" href=\"https://github.com/rails/rails/issues/48185\">#48185</a></p>\n<p dir=\"auto\">Action Cable can be mounted standalone, but it loses the health check route provided by the railties.<br>\nThis change adds configuration for a health check rack app and a health check route to \"mount\" the rack app.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48222",
            "title": "Add health check on standalone Action Cable",
            "date_modified": "2023-05-28T00:03:03.000Z",
            "date_published": "2023-05-13T23:44:05.000Z",
            "author": {
                "name": "JoeDupuis",
                "url": "https://github.com/JoeDupuis"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Alternative to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1646855043\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47813\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47813/hovercard\" href=\"https://github.com/rails/rails/pull/47813\">#47813</a> to import the linter files directly to Rails source tree</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ zzak@mbp16 rails % ruby -v\nruby 3.2.2 (2023-03-30 revision e51014f9c0) [arm64-darwin22]\n\n\n\n$ zzak@mbp16 rails % bundle exec tools/check-changelogs .\n.............\n\n13 changelogs inspected, 0 offenses detected\n\n\n\n$ zzak@mbp16 rails % bundle exec tools/check-config-docs .\n\n\n\n$ zzak@mbp16 rails % bundle exec tools/check-links .\nhttps://edgeapi.rubyonrails.org/classes/ActiveSupport/MessageEncryptor.html#method-i-encrypt_and_sign\"><pre class=\"notranslate\">$ zzak@mbp16 rails % ruby -v\nruby 3.2.2 (2023-03-30 revision e51014f9c0) [arm64-darwin22]\n\n\n\n$ zzak@mbp16 rails % bundle <span class=\"pl-c1\">exec</span> tools/check-changelogs <span class=\"pl-c1\">.</span>\n.............\n\n13 changelogs inspected, 0 offenses detected\n\n\n\n$ zzak@mbp16 rails % bundle <span class=\"pl-c1\">exec</span> tools/check-config-docs <span class=\"pl-c1\">.</span>\n\n\n\n$ zzak@mbp16 rails % bundle <span class=\"pl-c1\">exec</span> tools/check-links <span class=\"pl-c1\">.</span>\nhttps://edgeapi.rubyonrails.org/classes/ActiveSupport/MessageEncryptor.html#method-i-encrypt_and_sign</pre></div>",
            "url": "https://github.com/rails/rails/pull/48216",
            "title": "Import rails-bin linter to rails internal tools lib",
            "date_modified": "2023-05-16T17:36:25.000Z",
            "date_published": "2023-05-13T06:53:46.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        }
    ]
}