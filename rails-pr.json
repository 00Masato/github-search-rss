{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/22231095?u=4b9ed50e760e192f3d22f1327a15326e70eb5ed4&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request updates the 7.2 release notes, to point <code class=\"notranslate\">7-2-stable</code> instead of <code class=\"notranslate\">main</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51834",
            "title": "Point 7-2-stable branch CHANGELOGS in rails 7-2 release note [ci skip]",
            "date_modified": "2024-05-15T03:50:37.000Z",
            "date_published": "2024-05-15T03:49:30.000Z",
            "author": {
                "name": "akhilgkrishnan",
                "url": "https://github.com/akhilgkrishnan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/22231095?u=4b9ed50e760e192f3d22f1327a15326e70eb5ed4&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request removes the accidentally added Rails 7.2 release note changes from Rails 8 release note</p>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">cc/ <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a></p>",
            "url": "https://github.com/rails/rails/pull/51833",
            "title": "Remove 7.2 release changes from Rails 8.0 release note [ci skip]",
            "date_modified": "2024-05-15T03:17:40.000Z",
            "date_published": "2024-05-15T03:17:36.000Z",
            "author": {
                "name": "akhilgkrishnan",
                "url": "https://github.com/akhilgkrishnan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2741?u=ce0dd0173c534e7e8b72e1cb393fed76e904a91c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">We have too many controls in the default environment files. Only levers that are likely to be moved early or are integral to the specific environment should be there. Deprecation controls do not meet either of those standards.</p>",
            "url": "https://github.com/rails/rails/pull/51831",
            "title": "Don't expose deprecation controls for new apps",
            "date_modified": "2024-05-15T00:22:34.000Z",
            "date_published": "2024-05-14T23:44:20.000Z",
            "author": {
                "name": "dhh",
                "url": "https://github.com/dhh"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/39735028?u=91330295c614cf3cec0b64bf242a14fc2ceb358f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">More clean up based on removing support for Oracle, SQLServer and Jbdc adapters.</p>\n<p dir=\"auto\">Previous work:<br>\n<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/8eae75379cf3156228028006c54c82f5cf6c712d/hovercard\" href=\"https://github.com/rails/rails/commit/8eae75379cf3156228028006c54c82f5cf6c712d\"><tt>8eae753</tt></a><br>\n<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/5b91084f20ed9a15c3137e5c84c09edc1b81ba3d/hovercard\" href=\"https://github.com/rails/rails/commit/5b91084f20ed9a15c3137e5c84c09edc1b81ba3d\"><tt>5b91084</tt></a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Remove all the branching from tests where we have specific logic for those adapters. And I removed all the test db configs for those adapters.</p>\n<p dir=\"auto\"><del>I also removed the <code class=\"notranslate\">database.yml.tt</code> for those adapters, which I missed doing in my previous PR.</del></p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51826",
            "title": "Remove oracle sqlserver from tests",
            "date_modified": "2024-05-14T18:59:07.000Z",
            "date_published": "2024-05-14T18:05:49.000Z",
            "author": {
                "name": "andrewn617",
                "url": "https://github.com/andrewn617"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/67093?u=ae38721048300d0786fffecd87c5651a4ab67c35&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">As I was working on my RailsConf 2024 talk, I realized the Rails plugin generator had not been updated to include the new rubocop and GitHub Actions files that ship with the app generator. These are particularly useful for plugin developers to make it easier to get started.</p>\n<p dir=\"auto\">I spoke briefly with <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a> about making these additions which he agreed was a good idea. I also asked about brakeman, but he said that didn't make sense.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request updates the plugin generator to include templates for GitHub Actions and rubocop. It also updated a couple of files to ensure they pass the rubocop linting.</p>\n<p dir=\"auto\">I have kept these templates separate from the app templates as they are likely to diverge slightly over time.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I decided not to include any functionality for testing CI against multiple Rails versions, but this could be added in the future.<br>\nSame for testing multiple Ruby versions. This could be added later.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51822",
            "title": "Add rubocop and GitHub Actions to plugin generator",
            "date_modified": "2024-05-14T18:56:33.000Z",
            "date_published": "2024-05-14T16:19:04.000Z",
            "author": {
                "name": "excid3",
                "url": "https://github.com/excid3"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1380104?u=31e2e5f4843b2850387af04bc7400712d86112c6&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h2 dir=\"auto\">Triggers Callbacks when an attachment has been uploaded</h2>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because during our migration process from <strong>paperclip</strong> to ActiveStorage we couldn't find any straightforward mechanism to notify our system exactly when the attachment was uploaded.</p>\n<p dir=\"auto\">Our use case was very particular but long story short, we needed to run a process that validated some uploaded files after they were attached.</p>\n<p dir=\"auto\">The lack of this feature made this effort extremely painful as we needed to execute several rake tasks to re-process hundreds of files that were uploaded incorrectly.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes <code class=\"notranslate\">ActiveStorage::Blob#upload_without_unfurling</code> and adds some helpers to <code class=\"notranslate\">ActiveStorage::Attachment</code> to invoke a specific method <code class=\"notranslate\">:before</code> and <code class=\"notranslate\">:after</code> uploading to the configured service.<br>\nThis is achieved by checking if the active record model <code class=\"notranslate\">respond_to?</code> a method with the following signature pattern:</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">before_{attachment_name}_attached</code> or <code class=\"notranslate\">after_{attachment_name}_attached</code></li>\n<li><code class=\"notranslate\">before_{attachment_name}_variant_attached</code> or <code class=\"notranslate\">after_{attachment_name}_variant_attached</code></li>\n</ul>\n<blockquote>\n<p dir=\"auto\">It also passes the processed <code class=\"notranslate\">blob</code> object to the method in order to do any required post-processing on it.</p>\n</blockquote>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The development of this feature started during RailsConf 2024 during the HackDay Workshop with the Rails Core Team.<br>\nContributors and participating members of this process were:</p>\n<ul dir=\"auto\">\n<li><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/tenderlove/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tenderlove\">@tenderlove</a></li>\n<li><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/mattboldt/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mattboldt\">@mattboldt</a></li>\n<li><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/garyhtou/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/garyhtou\">@garyhtou</a></li>\n</ul>\n<p dir=\"auto\">(Thanks for the help!, great working with you! üôåüèª )</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51814",
            "title": "Trigger before and after callbacks when Attachments are uploaded.",
            "date_modified": "2024-05-15T00:12:25.000Z",
            "date_published": "2024-05-14T05:31:23.000Z",
            "author": {
                "name": "rapito",
                "url": "https://github.com/rapito"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2741?u=ce0dd0173c534e7e8b72e1cb393fed76e904a91c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Sprockets has served us well, but it's time to hand over the torch to <a href=\"https://github.com/rails/propshaft\">Propshaft</a> in Rails 8.</p>",
            "url": "https://github.com/rails/rails/pull/51799",
            "title": "Change asset pipeline default to Propshaft in Rails 8",
            "date_modified": "2024-05-14T21:19:18.000Z",
            "date_published": "2024-05-12T20:39:04.000Z",
            "author": {
                "name": "dhh",
                "url": "https://github.com/dhh"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/43936240?u=7130066eeca24a7a93cf0b9867da279a7c8a6406&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created to <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #51679.\">fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2267574463\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51679\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51679/hovercard\" href=\"https://github.com/rails/rails/issues/51679\">#51679</a>, a bug that appears when working with time field and timezones.</p>\n<p dir=\"auto\">Basically, the bug occurs when ActiveRecord deserialized time field's day in other day but not the default one (01-01-2000), and it impacts validations and comparisons.</p>\n<p dir=\"auto\">More details from the bug in the issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2267574463\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51679\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51679/hovercard\" href=\"https://github.com/rails/rails/issues/51679\">#51679</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the deserialized method <code class=\"notranslate\">TimeZoneConverter</code> to always set the day for  (01-01-2000) when we are working with the default time field.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">For alternative solutions, we have some options thanks to <a href=\"https://github.com/mkbehbehani\">mkbehbehani</a> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2267574463\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51679\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51679/hovercard?comment_id=2083414034&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/issues/51679#issuecomment-2083414034\">#51679 (comment)</a></p>\n<ul dir=\"auto\">\n<li>Using the ToD :time_only <a href=\"https://github.com/JackC/tod?tab=readme-ov-file#activerecord-attribute-support\">ActiveRecord attribute</a> for Time of Day representation in application logic</li>\n<li>In Postgres, using the time column type.</li>\n<li>Timezone config for both Rails and Postgres set to UTC and performing changes into desired local timezone before read/write/comparison using .in_time_zone(location_timezone).</li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51797",
            "title": "[ActiveRecord] Fixes wrong time field's default day with timezone",
            "date_modified": "2024-05-12T18:32:15.000Z",
            "date_published": "2024-05-12T18:32:11.000Z",
            "author": {
                "name": "PedroAugustoRamalhoDuarte",
                "url": "https://github.com/PedroAugustoRamalhoDuarte"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/22231095?u=4b9ed50e760e192f3d22f1327a15326e70eb5ed4&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #41811.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"846815677\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/41811\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/41811/hovercard\" href=\"https://github.com/rails/rails/issues/41811\">#41811</a></p>\n<p dir=\"auto\">Addresses the issue with bi-directional accepts_nested_attributes where validation of a collection fails due to only the last record being considered. This occurs because each child item triggers a valid? call on the parent record, which overwrites previous validation errors.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Post &lt; ActiveRecord::Base\n  has_many :comments, inverse_of: :post\n  accepts_nested_attributes_for :comments\n\n  validates :title, presence: true\nend\n\nclass Comment &lt; ActiveRecord::Base\n  belongs_to :post, inverse_of: :comments\n  accepts_nested_attributes_for :post\n\n  validates :body, presence: true\nend\n\nclass BugTest &lt; Minitest::Test\n  # currently fails\n  def test_invalid_attributes\n    post = Post.new(title: &quot;foo&quot;, comments_attributes: [{ body: &quot;body 1&quot; }, { body: nil }, { body: &quot;body 3&quot; }])\n\n    refute post.valid?\n    refute post.errors.empty?\n  end\n\n  # currently passes\n  def test_invalid_attributes_end_of_list\n    post = Post.new(title: &quot;foo&quot;, comments_attributes: [{ body: &quot;bar&quot; }, { body: &quot;baz&quot; }, { body: nil }])\n\n    refute post.valid?\n    refute post.errors.empty?\n  end\n\n  # currently passes\n  def test_invalid_attributes_one_attribute\n    post = Post.new(title: &quot;foo&quot;, comments_attributes: [{ body: nil }])\n\n    refute post.valid?\n    refute post.errors.empty?\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">has_many</span> <span class=\"pl-pds\">:comments</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">inverse_of</span>: <span class=\"pl-pds\">:post</span>\n  <span class=\"pl-en\">accepts_nested_attributes_for</span> <span class=\"pl-pds\">:comments</span>\n\n  <span class=\"pl-en\">validates</span> <span class=\"pl-pds\">:title</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">presence</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Comment</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:post</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">inverse_of</span>: <span class=\"pl-pds\">:comments</span>\n  <span class=\"pl-en\">accepts_nested_attributes_for</span> <span class=\"pl-pds\">:post</span>\n\n  <span class=\"pl-en\">validates</span> <span class=\"pl-pds\">:body</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">presence</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">BugTest</span> &lt; <span class=\"pl-v\">Minitest</span>::<span class=\"pl-v\">Test</span>\n  <span class=\"pl-c\"># currently fails</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_invalid_attributes</span>\n    <span class=\"pl-s1\">post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">title</span>: <span class=\"pl-s\">\"foo\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">comments_attributes</span>: <span class=\"pl-kos\">[</span><span class=\"pl-kos\">{</span> <span class=\"pl-pds\">body</span>: <span class=\"pl-s\">\"body 1\"</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">body</span>: <span class=\"pl-c1\">nil</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">body</span>: <span class=\"pl-s\">\"body 3\"</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-en\">refute</span> <span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">valid?</span>\n    <span class=\"pl-en\">refute</span> <span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">errors</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">empty?</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-c\"># currently passes</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_invalid_attributes_end_of_list</span>\n    <span class=\"pl-s1\">post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">title</span>: <span class=\"pl-s\">\"foo\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">comments_attributes</span>: <span class=\"pl-kos\">[</span><span class=\"pl-kos\">{</span> <span class=\"pl-pds\">body</span>: <span class=\"pl-s\">\"bar\"</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">body</span>: <span class=\"pl-s\">\"baz\"</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">body</span>: <span class=\"pl-c1\">nil</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-en\">refute</span> <span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">valid?</span>\n    <span class=\"pl-en\">refute</span> <span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">errors</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">empty?</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-c\"># currently passes</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_invalid_attributes_one_attribute</span>\n    <span class=\"pl-s1\">post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">title</span>: <span class=\"pl-s\">\"foo\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">comments_attributes</span>: <span class=\"pl-kos\">[</span><span class=\"pl-kos\">{</span> <span class=\"pl-pds\">body</span>: <span class=\"pl-c1\">nil</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-en\">refute</span> <span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">valid?</span>\n    <span class=\"pl-en\">refute</span> <span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">errors</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">empty?</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR is followup of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"853285432\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/41878\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/41878/hovercard\" href=\"https://github.com/rails/rails/pull/41878\">#41878</a> which done by <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/intrip/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/intrip\">@intrip</a> in 2 years back, additionally I've a added minor change for initialising the variable. This fix involves tracking the current record under validation and avoiding cyclic valid? calls.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">cc/ <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a></p>",
            "url": "https://github.com/rails/rails/pull/51795",
            "title": "Fix: bi-direction accepts_nested_attributes_for validation.",
            "date_modified": "2024-05-12T11:58:29.000Z",
            "date_published": "2024-05-12T11:55:53.000Z",
            "author": {
                "name": "akhilgkrishnan",
                "url": "https://github.com/akhilgkrishnan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1518299?u=d3dda61ebb16317ded64f166b59e35e1e160b9b1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">I am working on a couple of flakes that have been bugging me for a while.<br>\nThis one is testing that <code class=\"notranslate\">--fail-fast</code> forces an early return and doesn't run all the tests when running tests in parallel.</p>\n<p dir=\"auto\"><a href=\"https://buildkite.com/rails/rails/builds/107007#018f64d9-8d94-48fe-b63b-3cab9951fa63\" rel=\"nofollow\">Example of a failed test run</a></p>\n<p dir=\"auto\">I've ran the test in a loop to test the variability.<br>\nRunning the current version 50 times, I got these results:<br>\n<code class=\"notranslate\">{\"3\"=&gt;1, \"5\"=&gt;36, \"4\"=&gt;8, \"6\"=&gt;5}</code></p>\n<p dir=\"auto\">The keys are the number of tests that ran and the value is the number of times we got that result in the outer loop (I ran the test 50 times). I've inserted the script I've used to get these numbers at the end.</p>\n<p dir=\"auto\">A short sleep eliminates all variability:<br>\n<code class=\"notranslate\">{\"4\"=&gt;50}</code></p>\n<p dir=\"auto\">Sleeping in a test is not ideal. It is slow and it is not a true fix, but in this particular case I believe it could make sense:<br>\n1- The test is already not perfect. It seems prone to race condition / flake<br>\n2- Benchmark show negligible impact on test performance<br>\n3- A true fix would be quite complex<br>\n4- It's not a new pattern in the code base (Rails)</p>\n<p dir=\"auto\">Since we eliminated variability, we can lower down the number of tests from 10 to 4. Making it, in some instances, even faster than the original test!</p>\n<p dir=\"auto\">I ran a benchmark with 4 versions:<br>\n1- \"Current test\" (10 tests with no sleep)<br>\n2- \"With sleep\" (10 tests with sleep)<br>\n3- \"Short\" (4 tests)<br>\n4- \"Short with sleep\" (4 tests with sleep)</p>\n<p dir=\"auto\">Here are the results:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ruby 3.2.0 (2022-12-25 revision a528908271) [x86_64-linux]\nWarming up --------------------------------------\n             Current     1.000 i/100ms\n          with sleep     1.000 i/100ms\n               short     1.000 i/100ms\n    short with sleep     1.000 i/100ms\nCalculating -------------------------------------\n             Current      1.032 (¬± 0.0%) i/s -      6.000 in   5.812659s\n          with sleep      1.018 (¬± 0.0%) i/s -      6.000 in   5.897112s\n               short      1.033 (¬± 0.0%) i/s -      6.000 in   5.807960s\n    short with sleep      1.031 (¬± 0.0%) i/s -      6.000 in   5.822803s\n\nComparison:\n               short:        1.0 i/s\n             Current:        1.0 i/s - 1.00x  slower\n    short with sleep:        1.0 i/s - 1.00x  slower\n          with sleep:        1.0 i/s - 1.01x  slower\n\"><pre class=\"notranslate\"><code class=\"notranslate\">ruby 3.2.0 (2022-12-25 revision a528908271) [x86_64-linux]\nWarming up --------------------------------------\n             Current     1.000 i/100ms\n          with sleep     1.000 i/100ms\n               short     1.000 i/100ms\n    short with sleep     1.000 i/100ms\nCalculating -------------------------------------\n             Current      1.032 (¬± 0.0%) i/s -      6.000 in   5.812659s\n          with sleep      1.018 (¬± 0.0%) i/s -      6.000 in   5.897112s\n               short      1.033 (¬± 0.0%) i/s -      6.000 in   5.807960s\n    short with sleep      1.031 (¬± 0.0%) i/s -      6.000 in   5.822803s\n\nComparison:\n               short:        1.0 i/s\n             Current:        1.0 i/s - 1.00x  slower\n    short with sleep:        1.0 i/s - 1.00x  slower\n          with sleep:        1.0 i/s - 1.01x  slower\n\n</code></pre></div>\n<p dir=\"auto\">Here are the results on variability:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Current test 50 times\nTime:\n  0.018374   0.016918  43.072536 ( 49.452285)\ncount:\n{&quot;3&quot;=&gt;1, &quot;5&quot;=&gt;36, &quot;4&quot;=&gt;8, &quot;6&quot;=&gt;5}\n------------------------------------------------------------\nWith sleep 50 times\nTime:\n  0.024689   0.018993  43.850807 ( 53.411969)\ncount:\n{&quot;4&quot;=&gt;50}\n------------------------------------------------------------\nShort 50 times\nTime:\n  0.015890   0.014887  42.154732 ( 48.472620)\ncount:\n{&quot;3&quot;=&gt;47, &quot;2&quot;=&gt;3}\n------------------------------------------------------------\nShort with sleep 50 times\nTime:\n  0.021356   0.013760  41.751833 ( 48.164752)\ncount:\n{&quot;2&quot;=&gt;50}\"><pre class=\"notranslate\"><code class=\"notranslate\">Current test 50 times\nTime:\n  0.018374   0.016918  43.072536 ( 49.452285)\ncount:\n{\"3\"=&gt;1, \"5\"=&gt;36, \"4\"=&gt;8, \"6\"=&gt;5}\n------------------------------------------------------------\nWith sleep 50 times\nTime:\n  0.024689   0.018993  43.850807 ( 53.411969)\ncount:\n{\"4\"=&gt;50}\n------------------------------------------------------------\nShort 50 times\nTime:\n  0.015890   0.014887  42.154732 ( 48.472620)\ncount:\n{\"3\"=&gt;47, \"2\"=&gt;3}\n------------------------------------------------------------\nShort with sleep 50 times\nTime:\n  0.021356   0.013760  41.751833 ( 48.164752)\ncount:\n{\"2\"=&gt;50}\n</code></pre></div>\n<h1 dir=\"auto\">Benchmark Script</h1>\n<p dir=\"auto\">Here's the (rough) benchmark script I used. It's a test in the same file as the original test.</p>\n<div class=\"highlight highlight-source-diff notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"diff --git a/railties/test/application/test_runner_test.rb b/railties/test/application/test_runner_test.rb\nindex f30bdb2890..80565899a2 100644\n--- a/railties/test/application/test_runner_test.rb\n+++ b/railties/test/application/test_runner_test.rb\n@@ -802,6 +802,133 @@ def test_verify_fail_fast\n       assert_operator matches[1].to_i, :&lt;, 11\n     end\n \n+\n+    def test_flake_fix\n+      require 'benchmark/ips'\n+      exercise_parallelization_regardless_of_machine_core_count(with: :processes)\n+\n+      app_file &quot;test/unit/parallel_test_current.rb&quot;, &lt;&lt;-RUBY\n+        require &quot;test_helper&quot;\n+\n+        class ParallelTest &lt; ActiveSupport::TestCase\n+          def test_verify_fail_fast\n+            assert false\n+          end\n+\n+          10.times do |n|\n+            define_method(&quot;test_verify_fail_fast_\\#{n}&quot;) do\n+              assert true\n+            end\n+          end\n+        end\n+      RUBY\n+\n+      app_file &quot;test/unit/parallel_test_sleep.rb&quot;, &lt;&lt;-RUBY\n+        require &quot;test_helper&quot;\n+\n+        class ParallelTest &lt; ActiveSupport::TestCase\n+          def test_verify_fail_fast\n+            assert false\n+          end\n+\n+          10.times do |n|\n+            define_method(&quot;test_verify_fail_fast_\\#{n}&quot;) do\n+              sleep 0.1\n+              assert true\n+            end\n+          end\n+        end\n+      RUBY\n+\n+      app_file &quot;test/unit/parallel_test_sleep_short.rb&quot;, &lt;&lt;-RUBY\n+        require &quot;test_helper&quot;\n+\n+        class ParallelTest &lt; ActiveSupport::TestCase\n+          def test_verify_fail_fast\n+            assert false\n+          end\n+\n+          4.times do |n|\n+            define_method(&quot;test_verify_fail_fast_\\#{n}&quot;) do\n+              sleep 0.1\n+              assert true\n+            end\n+          end\n+        end\n+      RUBY\n+\n+      app_file &quot;test/unit/parallel_test_short.rb&quot;, &lt;&lt;-RUBY\n+        require &quot;test_helper&quot;\n+\n+        class ParallelTest &lt; ActiveSupport::TestCase\n+          def test_verify_fail_fast\n+            assert false\n+          end\n+\n+          4.times do |n|\n+            define_method(&quot;test_verify_fail_fast_\\#{n}&quot;) do\n+              assert true\n+            end\n+          end\n+        end\n+      RUBY\n+\n+      sample_size = 50\n+      count = {}\n+      test_output = &quot;&quot;\n+\n+\n+      run = -&gt;(filename, sample_size) do\n+        count = {}\n+        test_output = &quot;&quot;\n+        Benchmark.measure {\n+          sample_size.times do\n+            capture(:stderr) do\n+              test_output = run_test_command(&quot;#{filename} --fail-fast --seed 31992&quot;, stderr: true)\n+            end\n+            matches = test_output.match(/(\\d+) runs, (\\d+) assertions, (\\d+) failures/)\n+            count[matches[1]] = count[matches[1]].to_i + 1\n+          end\n+        }\n+      end\n+\n+      puts &quot;Current test #{sample_size} times&quot;\n+      time = run.call(&quot;test/unit/parallel_test_current.rb&quot;, sample_size)\n+      puts &quot;Time:&quot;, time\n+      puts &quot;count:&quot;, count\n+\n+      puts '------------------------------------------------------------'\n+\n+      puts &quot;With sleep #{sample_size} times&quot;\n+      time = run.call(&quot;test/unit/parallel_test_sleep.rb&quot;, sample_size)\n+      puts &quot;Time:&quot;, time\n+      puts &quot;count:&quot;, count\n+\n+      puts '------------------------------------------------------------'\n+\n+      puts &quot;Short #{sample_size} times&quot;\n+      time = run.call(&quot;test/unit/parallel_test_short.rb&quot;, sample_size)\n+      puts &quot;Time:&quot;, time\n+      puts &quot;count:&quot;, count\n+\n+      puts '------------------------------------------------------------'\n+\n+      puts &quot;Short with sleep #{sample_size} times&quot;\n+      time = run.call(&quot;test/unit/parallel_test_sleep_short.rb&quot;, sample_size)\n+      puts &quot;Time:&quot;, time\n+      puts &quot;count:&quot;, count\n+\n+\n+      Benchmark.ips do |x|\n+        x.report(&quot;Current&quot;) { run.call(&quot;test/unit/parallel_test_current.rb&quot;, 1) }\n+        x.report(&quot;with sleep&quot;) { run.call(&quot;test/unit/parallel_test_current.rb&quot;, 1) }\n+        x.report(&quot;short&quot;) { run.call(&quot;test/unit/parallel_test_short.rb&quot;, 1)  }\n+        x.report(&quot;short with sleep&quot;) { run.call(&quot;test/unit/parallel_test_sleep_short.rb&quot;, 1)  }\n+        x.compare!\n+      end\n+    end\n+\n+\n     def test_run_in_parallel_with_processes\n       exercise_parallelization_regardless_of_machine_core_count(with: :processes)\n \n\"><pre class=\"notranslate\"><span class=\"pl-c1\">diff --git a/railties/test/application/test_runner_test.rb b/railties/test/application/test_runner_test.rb</span>\nindex f30bdb2890..80565899a2 100644\n<span class=\"pl-md\">--- a/railties/test/application/test_runner_test.rb</span>\n<span class=\"pl-mi1\">+++ b/railties/test/application/test_runner_test.rb</span>\n<span class=\"pl-mdr\">@@ -802,6 +802,133 @@</span> def test_verify_fail_fast\n       assert_operator matches[1].to_i, :&lt;, 11\n     end\n \n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>    def test_flake_fix</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      require 'benchmark/ips'</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      exercise_parallelization_regardless_of_machine_core_count(with: :processes)</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      app_file \"test/unit/parallel_test_current.rb\", &lt;&lt;-RUBY</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        require \"test_helper\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        class ParallelTest &lt; ActiveSupport::TestCase</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          def test_verify_fail_fast</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            assert false</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          10.times do |n|</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            define_method(\"test_verify_fail_fast_\\#{n}\") do</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>              assert true</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      RUBY</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      app_file \"test/unit/parallel_test_sleep.rb\", &lt;&lt;-RUBY</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        require \"test_helper\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        class ParallelTest &lt; ActiveSupport::TestCase</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          def test_verify_fail_fast</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            assert false</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          10.times do |n|</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            define_method(\"test_verify_fail_fast_\\#{n}\") do</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>              sleep 0.1</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>              assert true</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      RUBY</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      app_file \"test/unit/parallel_test_sleep_short.rb\", &lt;&lt;-RUBY</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        require \"test_helper\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        class ParallelTest &lt; ActiveSupport::TestCase</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          def test_verify_fail_fast</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            assert false</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          4.times do |n|</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            define_method(\"test_verify_fail_fast_\\#{n}\") do</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>              sleep 0.1</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>              assert true</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      RUBY</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      app_file \"test/unit/parallel_test_short.rb\", &lt;&lt;-RUBY</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        require \"test_helper\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        class ParallelTest &lt; ActiveSupport::TestCase</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          def test_verify_fail_fast</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            assert false</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          4.times do |n|</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            define_method(\"test_verify_fail_fast_\\#{n}\") do</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>              assert true</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      RUBY</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      sample_size = 50</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      count = {}</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      test_output = \"\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      run = -&gt;(filename, sample_size) do</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        count = {}</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        test_output = \"\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        Benchmark.measure {</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          sample_size.times do</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            capture(:stderr) do</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>              test_output = run_test_command(\"#{filename} --fail-fast --seed 31992\", stderr: true)</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            matches = test_output.match(/(\\d+) runs, (\\d+) assertions, (\\d+) failures/)</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>            count[matches[1]] = count[matches[1]].to_i + 1</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>          end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        }</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts \"Current test #{sample_size} times\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      time = run.call(\"test/unit/parallel_test_current.rb\", sample_size)</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts \"Time:\", time</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts \"count:\", count</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts '------------------------------------------------------------'</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts \"With sleep #{sample_size} times\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      time = run.call(\"test/unit/parallel_test_sleep.rb\", sample_size)</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts \"Time:\", time</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts \"count:\", count</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts '------------------------------------------------------------'</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts \"Short #{sample_size} times\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      time = run.call(\"test/unit/parallel_test_short.rb\", sample_size)</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts \"Time:\", time</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts \"count:\", count</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts '------------------------------------------------------------'</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts \"Short with sleep #{sample_size} times\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      time = run.call(\"test/unit/parallel_test_sleep_short.rb\", sample_size)</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts \"Time:\", time</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      puts \"count:\", count</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      Benchmark.ips do |x|</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        x.report(\"Current\") { run.call(\"test/unit/parallel_test_current.rb\", 1) }</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        x.report(\"with sleep\") { run.call(\"test/unit/parallel_test_current.rb\", 1) }</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        x.report(\"short\") { run.call(\"test/unit/parallel_test_short.rb\", 1)  }</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        x.report(\"short with sleep\") { run.call(\"test/unit/parallel_test_sleep_short.rb\", 1)  }</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        x.compare!</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>    end</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span></span>\n     def test_run_in_parallel_with_processes\n       exercise_parallelization_regardless_of_machine_core_count(with: :processes)\n \n</pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51783",
            "title": "Fix test runner --fail-fast test flake",
            "date_modified": "2024-05-13T02:54:17.000Z",
            "date_published": "2024-05-11T02:24:32.000Z",
            "author": {
                "name": "JoeDupuis",
                "url": "https://github.com/JoeDupuis"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Prior to this commit, models that inherit from<br>\n<a href=\"https://edgeapi.rubyonrails.org/classes/ActiveModel/AttributeAssignment.html\" rel=\"nofollow\">ActiveModel::AttributeAssignment</a> (either directly or through including <a href=\"https://edgeapi.rubyonrails.org/classes/ActiveModel/API.html\" rel=\"nofollow\">ActiveModel::API</a>) lose their ability to override the attribute assignment utilized during calls to<br>\n<a href=\"https://edgeapi.rubyonrails.org/classes/ActiveModel/Serializers/JSON.html#method-i-from_json\" rel=\"nofollow\">ActiveModel::Serializers::JSON#from_json</a>.</p>\n<p dir=\"auto\">Incidentally, <code class=\"notranslate\">#from_json</code> calls <code class=\"notranslate\">#attributes=</code> (instead of <code class=\"notranslate\">#assign_attributes</code>), whereas models that inherit from <code class=\"notranslate\">ActiveModel::AttributeAssignment</code> have <code class=\"notranslate\">#attributes=</code> <a href=\"https://github.com/rails/rails/blob/be0cb4e8f9aa0b105ddd035061202a5d23491b5a/activemodel/lib/active_model/attribute_assignment.rb#L37\">automatically aliased to <code class=\"notranslate\">#assign_attributes</code></a>.</p>\n<p dir=\"auto\">This has two unintended side effects:</p>\n<ol dir=\"auto\">\n<li>\n<p dir=\"auto\">calls to <code class=\"notranslate\">#from_json</code> will never invoke <code class=\"notranslate\">#assign_attributes</code> overrides, since they invoke <code class=\"notranslate\">#attributes=</code> directly</p>\n</li>\n<li>\n<p dir=\"auto\">overrides to <code class=\"notranslate\">#assign_attributes</code> won't have any effects on <code class=\"notranslate\">#attributes=</code>, since that alias is defined on the original implementation</p>\n</li>\n</ol>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit attempts to remedy that issue by attempting to call <code class=\"notranslate\">#assign_attributes</code> first before falling back to <code class=\"notranslate\">#attributes=</code>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">A change-free solution would be to encourage (through documentation) a corresponding <code class=\"notranslate\">alias :attributes= assign_attributes</code> line any time models override <code class=\"notranslate\">assign_attributes</code>.</p>\n<p dir=\"auto\">Alternatively, the <code class=\"notranslate\">ActiveModel::AttributeAssignment#assign_attributes</code> method could be defined as <code class=\"notranslate\">#attributes=</code> instead (with a complementary <code class=\"notranslate\">alias assign_attributes attributes=</code> call). This is likely a backwards-incompatible change.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51781",
            "title": "Make `ActiveModel::Serializers::JSON#from_json` compatible with `#assign_attributes`",
            "date_modified": "2024-05-12T23:30:35.000Z",
            "date_published": "2024-05-10T22:18:47.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/15008564?u=7b8600ee57984adadeb05aaee08e5764d437f516&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Ensuring the correctness of validations in Rails models is a fundamental aspect of robust testing. However, the current approach to such validations can often lead to cluttered and less readable test code. For instance, manually asserting validation errors requires multiple lines of code, detracting from the clarity of the test suite. This PR addresses this issue by introducing a streamlined solution that enhances readability and conciseness in model testing.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"test &quot;name cannot be blank&quot; do\n    user = users(:one)\n    \n   user.validate\n   refute_empty user.errors.where(:name, :blank)\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">test</span> <span class=\"pl-s\">\"name cannot be blank\"</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">users</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:one</span><span class=\"pl-kos\">)</span>\n    \n   <span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">validate</span>\n   <span class=\"pl-en\">refute_empty</span> <span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">errors</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:blank</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">or</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"test &quot;name cannot be blank&quot; do\n    user = users(:one)\n    \n   user.validate\n   assert user.errors.added? :name, :blank\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">test</span> <span class=\"pl-s\">\"name cannot be blank\"</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">users</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:one</span><span class=\"pl-kos\">)</span>\n    \n   <span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">validate</span>\n   <span class=\"pl-en\">assert</span> <span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">errors</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">added?</span> <span class=\"pl-pds\">:name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:blank</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR introduces a new assertion method, <code class=\"notranslate\">assert_error</code> and <code class=\"notranslate\">assert_invalid</code>, designed to simplify the validation testing process. With them developers can now verify the presence of specific validation errors with a single, expressive line of code. This enhancement not only improves the readability of tests but also promotes better understanding and maintenance of the validation logic within Rails models.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"test &quot;name cannot be blank&quot; do\n    user = users(:one)\n    \n   assert_not_valid :name, :blank, user\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">test</span> <span class=\"pl-s\">\"name cannot be blank\"</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">users</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:one</span><span class=\"pl-kos\">)</span>\n    \n   <span class=\"pl-en\">assert_not_valid</span> <span class=\"pl-pds\">:name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:blank</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">user</span>\n<span class=\"pl-k\">end</span></pre></div>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"test &quot;name cannot be blank&quot; do\n    user = users(:one)\n    user.validate\n    \n   assert_error :name, :blank, user\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">test</span> <span class=\"pl-s\">\"name cannot be blank\"</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">users</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:one</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">validate</span>\n    \n   <span class=\"pl-en\">assert_error</span> <span class=\"pl-pds\">:name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:blank</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">user</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">In the same way the validation <code class=\"notranslate\">assert_valid</code> and <code class=\"notranslate\">assert_no_error</code> ensures that the model has no errors for a specific field</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"test &quot;name is not blank&quot; do\n    user = users(:one)\n    \n   assert_no_error :name, :blank, user\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">test</span> <span class=\"pl-s\">\"name is not blank\"</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">users</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:one</span><span class=\"pl-kos\">)</span>\n    \n   <span class=\"pl-en\">assert_no_error</span> <span class=\"pl-pds\">:name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:blank</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">user</span>\n<span class=\"pl-k\">end</span></pre></div>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"test &quot;name is not blank&quot; do\n    user = users(:one)\n    \n   assert_valid :name, :blank, user\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">test</span> <span class=\"pl-s\">\"name is not blank\"</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">users</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:one</span><span class=\"pl-kos\">)</span>\n    \n   <span class=\"pl-en\">assert_valid</span> <span class=\"pl-pds\">:name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:blank</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">user</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51774",
            "title": "Adds `assert_error` and `assert_no_error`",
            "date_modified": "2024-05-15T01:14:30.000Z",
            "date_published": "2024-05-09T22:12:09.000Z",
            "author": {
                "name": "DanielaVelasquez",
                "url": "https://github.com/DanielaVelasquez"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1688137?u=9cc5d69effb6ce4503eb090bded4cad0e09d1e77&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">If you accidentally have an irrelevant association with inverse_of, it has been implicitly ignored until now. This change causes an exception to be raised if the wrong association is specified.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Before:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# NOTE: valid inverse_of is `:post`\nPost.belongs_to(:user, inverse_of: :comment)\nuser = User.create!\nPost.new(user: user) #=&gt; No error. Ignored invalid inverse_of.\"><pre class=\"notranslate\"><span class=\"pl-c\"># NOTE: valid inverse_of is `:post`</span>\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">belongs_to</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:user</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">inverse_of</span>: <span class=\"pl-pds\">:comment</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create!</span>\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">user</span>: <span class=\"pl-s1\">user</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\">#=&gt; No error. Ignored invalid inverse_of.</span></pre></div>\n<p dir=\"auto\">After:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Post.belongs_to(:user, inverse_of: :comment)\nuser = User.create!\nPost.new(user: user) #=&gt; ActiveRecord::InverseOfAssociationTableNameMismatchError: Inverse association user (:comment in User) is mismatch table_name. Expected table_name: 'posts', got 'comments'.\"><pre class=\"notranslate\"><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">belongs_to</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:user</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">inverse_of</span>: <span class=\"pl-pds\">:comment</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create!</span>\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">user</span>: <span class=\"pl-s1\">user</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\">#=&gt; ActiveRecord::InverseOfAssociationTableNameMismatchError: Inverse association user (:comment in User) is mismatch table_name. Expected table_name: 'posts', got 'comments'.</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">In consideration of STI, the wrong relation is checked by comparing table names instead of comparing class.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51767",
            "title": "Raise `ActiveRecord::InverseOfAssociationTableNameMismatchError` if invalid inverse_of is specified",
            "date_modified": "2024-05-10T08:41:26.000Z",
            "date_published": "2024-05-08T15:43:03.000Z",
            "author": {
                "name": "alpaca-tc",
                "url": "https://github.com/alpaca-tc"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1518299?u=d3dda61ebb16317ded64f166b59e35e1e160b9b1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Add <code class=\"notranslate\">active_record.postgresql_adapter_decode_dates</code> config<br>\nto toggle automatic decoding of dates column with the PostgresqlAdapter.</p>\n<p dir=\"auto\">PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2224165865\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51483\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/51483/hovercard\" href=\"https://github.com/rails/rails/pull/51483\">#51483</a> is a breaking change and should have been gated behind a config.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51763",
            "title": "Add `active_record.postgresql_adapter_decode_dates` config",
            "date_modified": "2024-05-13T02:49:16.000Z",
            "date_published": "2024-05-08T04:11:27.000Z",
            "author": {
                "name": "JoeDupuis",
                "url": "https://github.com/JoeDupuis"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/53313927?u=5d783b260641251696757911bd0714cc8e90456f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because currently, <code class=\"notranslate\">in_order_of</code> method always use where clause to filter the results only with the values specified in <code class=\"notranslate\">values</code>. Sometimes, we only want to put some values as priority in the sorting but we want the entire search scope without caring about the rest of the sorting. The propose here is add an option to specify to filter scope by values or not.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"order = [3, 4, 1]\n\n# Without specify option\nPost.in_order_of(:id, order).to_sql\n# SELECT \n  # &quot;posts&quot;.* FROM &quot;posts&quot; \n# WHERE \n  # &quot;posts&quot;.&quot;id&quot; IN (3, 4, 1) \n# ORDER BY \n  # CASE WHEN &quot;posts&quot;.&quot;id&quot; = 3 THEN 1 WHEN &quot;posts&quot;.&quot;id&quot; = 4 THEN 2 WHEN &quot;posts&quot;.&quot;id&quot; = 1 THEN 3 END ASC\n\n# With option seted to false\nPost.in_order_of(:id, order, only_values: false)\n# SELECT \n  # &quot;posts&quot;.* FROM &quot;posts&quot; \n# ORDER BY \n  # CASE WHEN &quot;posts&quot;.&quot;id&quot; = 3 THEN 1 WHEN &quot;posts&quot;.&quot;id&quot; = 4 THEN 2 WHEN &quot;posts&quot;.&quot;id&quot; = 1 THEN 3 ELSE 4 END ASC\"><pre class=\"notranslate\"><span class=\"pl-s1\">order</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-c1\">3</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">4</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">]</span>\n\n<span class=\"pl-c\"># Without specify option</span>\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">in_order_of</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:id</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">order</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_sql</span>\n<span class=\"pl-c\"># SELECT </span>\n  <span class=\"pl-c\"># \"posts\".* FROM \"posts\" </span>\n<span class=\"pl-c\"># WHERE </span>\n  <span class=\"pl-c\"># \"posts\".\"id\" IN (3, 4, 1) </span>\n<span class=\"pl-c\"># ORDER BY </span>\n  <span class=\"pl-c\"># CASE WHEN \"posts\".\"id\" = 3 THEN 1 WHEN \"posts\".\"id\" = 4 THEN 2 WHEN \"posts\".\"id\" = 1 THEN 3 END ASC</span>\n\n<span class=\"pl-c\"># With option seted to false</span>\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">in_order_of</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:id</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">order</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">only_values</span>: <span class=\"pl-c1\">false</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\"># SELECT </span>\n  <span class=\"pl-c\"># \"posts\".* FROM \"posts\" </span>\n<span class=\"pl-c\"># ORDER BY </span>\n  <span class=\"pl-c\"># CASE WHEN \"posts\".\"id\" = 3 THEN 1 WHEN \"posts\".\"id\" = 4 THEN 2 WHEN \"posts\".\"id\" = 1 THEN 3 ELSE 4 END ASC</span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51761",
            "title": "Add option `only_values` on `in_order_of`",
            "date_modified": "2024-05-09T21:05:08.000Z",
            "date_published": "2024-05-07T23:17:49.000Z",
            "author": {
                "name": "igordepolli",
                "url": "https://github.com/igordepolli"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/104796188?u=f55da8c2af2ac5d2031ccae15167032aa923d44b&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Adds information about how to pass additional arguments to transformations.</p>\n\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because the right syntax for passing optional arguments for transformation methods in an attachment variant call is not documented anywhere and it is not intuitive. Yet, it is probably needed by many people who use ActiveStorage to create variants of attachments.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds a few lines to the ActiveStorage guide showing how to pass additional arguments to a transformation method in an attachment variant call.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Doesn't apply.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51759",
            "title": "Update active_storage_overview.md",
            "date_modified": "2024-05-07T17:17:29.000Z",
            "date_published": "2024-05-07T17:17:25.000Z",
            "author": {
                "name": "trebeil",
                "url": "https://github.com/trebeil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5238698?u=891eeb449bcb179b920fd08ed86c18eb6d477a04&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #51606.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2252182200\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51606\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51606/hovercard\" href=\"https://github.com/rails/rails/issues/51606\">#51606</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51746",
            "title": "Use the given `form` in `html_options` for the hidden field in `collection_check_boxes`",
            "date_modified": "2024-05-06T12:36:57.000Z",
            "date_published": "2024-05-06T09:41:35.000Z",
            "author": {
                "name": "3v0k4",
                "url": "https://github.com/3v0k4"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Using the samebenchmark as <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2277609055\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51726\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/51726/hovercard\" href=\"https://github.com/rails/rails/pull/51726\">#51726</a></p>\n<p dir=\"auto\">A significant part of the memory footprint comes from <code class=\"notranslate\">Result#each</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Total allocated: 4.61 MB (43077 objects)\nTotal retained: 3.76 MB (27621 objects)\n\nallocated memory by file\n-----------------------------------\n 391.52 kB  activerecord/lib/active_record/result.rb\n\nretained memory by file\n-----------------------------------\n 374.40 kB  activerecord/lib/active_record/result.rb\"><pre class=\"notranslate\"><code class=\"notranslate\">Total allocated: 4.61 MB (43077 objects)\nTotal retained: 3.76 MB (27621 objects)\n\nallocated memory by file\n-----------------------------------\n 391.52 kB  activerecord/lib/active_record/result.rb\n\nretained memory by file\n-----------------------------------\n 374.40 kB  activerecord/lib/active_record/result.rb\n</code></pre></div>\n<p dir=\"auto\">Rows are initially stored as arrays, but <code class=\"notranslate\">Result#each</code> convert them to hashes. Depending on how many elements they contain, hashes use between 2 and 5 times as much memory than arrays.</p>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Length</th>\n<th>Hash</th>\n<th>Array</th>\n<th>Diff</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td>160B</td>\n<td>40B</td>\n<td>-120B</td>\n</tr>\n<tr>\n<td>2</td>\n<td>160B</td>\n<td>40B</td>\n<td>-120B</td>\n</tr>\n<tr>\n<td>3</td>\n<td>160B</td>\n<td>40B</td>\n<td>-120B</td>\n</tr>\n<tr>\n<td>4</td>\n<td>160B</td>\n<td>80B</td>\n<td>-80B</td>\n</tr>\n<tr>\n<td>5</td>\n<td>160B</td>\n<td>80B</td>\n<td>-80B</td>\n</tr>\n<tr>\n<td>6</td>\n<td>160B</td>\n<td>80B</td>\n<td>-80B</td>\n</tr>\n<tr>\n<td>7</td>\n<td>160B</td>\n<td>80B</td>\n<td>-80B</td>\n</tr>\n<tr>\n<td>8</td>\n<td>160B</td>\n<td>80B</td>\n<td>-80B</td>\n</tr>\n<tr>\n<td>9</td>\n<td>464B</td>\n<td>160B</td>\n<td>-304B</td>\n</tr>\n<tr>\n<td>10</td>\n<td>464B</td>\n<td>160B</td>\n<td>-304B</td>\n</tr>\n<tr>\n<td>11</td>\n<td>464B</td>\n<td>160B</td>\n<td>-304B</td>\n</tr>\n<tr>\n<td>12</td>\n<td>464B</td>\n<td>160B</td>\n<td>-304B</td>\n</tr>\n<tr>\n<td>13</td>\n<td>464B</td>\n<td>160B</td>\n<td>-304B</td>\n</tr>\n<tr>\n<td>14</td>\n<td>464B</td>\n<td>160B</td>\n<td>-304B</td>\n</tr>\n<tr>\n<td>15</td>\n<td>464B</td>\n<td>160B</td>\n<td>-304B</td>\n</tr>\n<tr>\n<td>16</td>\n<td>464B</td>\n<td>160B</td>\n<td>-304B</td>\n</tr>\n<tr>\n<td>17</td>\n<td>912B</td>\n<td>160B</td>\n<td>-752B</td>\n</tr>\n<tr>\n<td>18</td>\n<td>912B</td>\n<td>160B</td>\n<td>-752B</td>\n</tr>\n<tr>\n<td>19</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>20</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>21</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>22</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>23</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>24</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>25</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>26</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>27</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>28</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>29</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>30</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>31</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>32</td>\n<td>912B</td>\n<td>320B</td>\n<td>-592B</td>\n</tr>\n<tr>\n<td>33</td>\n<td>1744B</td>\n<td>320B</td>\n<td>-1424B</td>\n</tr>\n<tr>\n<td>34</td>\n<td>1744B</td>\n<td>320B</td>\n<td>-1424B</td>\n</tr>\n<tr>\n<td>35</td>\n<td>1744B</td>\n<td>320B</td>\n<td>-1424B</td>\n</tr>\n<tr>\n<td>36</td>\n<td>1744B</td>\n<td>320B</td>\n<td>-1424B</td>\n</tr>\n<tr>\n<td>37</td>\n<td>1744B</td>\n<td>320B</td>\n<td>-1424B</td>\n</tr>\n<tr>\n<td>38</td>\n<td>1744B</td>\n<td>320B</td>\n<td>-1424B</td>\n</tr>\n<tr>\n<td>39</td>\n<td>1744B</td>\n<td>640B</td>\n<td>-1104B</td>\n</tr>\n<tr>\n<td>40</td>\n<td>1744B</td>\n<td>640B</td>\n<td>-1104B</td>\n</tr>\n<tr>\n<td>41</td>\n<td>1744B</td>\n<td>640B</td>\n<td>-1104B</td>\n</tr>\n<tr>\n<td>42</td>\n<td>1744B</td>\n<td>640B</td>\n<td>-1104B</td>\n</tr>\n<tr>\n<td>43</td>\n<td>1744B</td>\n<td>640B</td>\n<td>-1104B</td>\n</tr>\n<tr>\n<td>44</td>\n<td>1744B</td>\n<td>640B</td>\n<td>-1104B</td>\n</tr>\n<tr>\n<td>45</td>\n<td>1744B</td>\n<td>640B</td>\n<td>-1104B</td>\n</tr>\n<tr>\n<td>46</td>\n<td>1744B</td>\n<td>640B</td>\n<td>-1104B</td>\n</tr>\n<tr>\n<td>47</td>\n<td>1744B</td>\n<td>640B</td>\n<td>-1104B</td>\n</tr>\n<tr>\n<td>48</td>\n<td>1744B</td>\n<td>640B</td>\n<td>-1104B</td>\n</tr>\n<tr>\n<td>49</td>\n<td>1744B</td>\n<td>640B</td>\n<td>-1104B</td>\n</tr>\n<tr>\n<td>50</td>\n<td>1744B</td>\n<td>640B</td>\n<td>-1104B</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">Rather than to convert rows into hashes, we can loopkup the column index into a single hash common to all rows. To not complexify the code too much, rather than to pass the row array and the column index, we wrap both into an <code class=\"notranslate\">IndexedRow</code> object, which uses an extra <code class=\"notranslate\">40B</code> object, but that's still less memory even in the worst case.</p>\n<p dir=\"auto\">After:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Total allocated: 4.32 MB (43079 objects)\nTotal retained: 3.65 MB (29725 objects)\n\nallocated memory by file\n-----------------------------------\n 101.66 kB  activerecord/lib/active_record/result.rb\n\nretained memory by file\n-----------------------------------\n  84.70 kB  activerecord/lib/active_record/result.rb\"><pre class=\"notranslate\"><code class=\"notranslate\">Total allocated: 4.32 MB (43079 objects)\nTotal retained: 3.65 MB (29725 objects)\n\nallocated memory by file\n-----------------------------------\n 101.66 kB  activerecord/lib/active_record/result.rb\n\nretained memory by file\n-----------------------------------\n  84.70 kB  activerecord/lib/active_record/result.rb\n</code></pre></div>\n<p dir=\"auto\">As for access speed, it's of course a bit slower, but not by much, it's between <code class=\"notranslate\">1.5</code> and <code class=\"notranslate\">2</code> times slower, but remains in the 10's of M iterations per second, so I think this overhead is negligible compared to all the work needed to access a model attribute.</p>\n<p dir=\"auto\">Also the <code class=\"notranslate\">LazyAttributeSet</code> class only access this once, after the attribute is casted, the resulting value is still stored in a regular <code class=\"notranslate\">Hash</code>.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/tenderlove/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tenderlove\">@tenderlove</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/jhawthorn/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jhawthorn\">@jhawthorn</a> I'd like your opinion on this idea. I think it's worth it. We could potentially only do this when there is more than 1 row and more than 8 columns if we think the gains aren't quite big enough for small models.</p>\n<p dir=\"auto\">Also NB: <code class=\"notranslate\">Result#each</code> is public API, I changed it because it's a proof of concept, but this should be an alternate private API.</p>",
            "url": "https://github.com/rails/rails/pull/51744",
            "title": "PoC: Index Result rows rather than to convert them into hashes",
            "date_modified": "2024-05-07T10:11:14.000Z",
            "date_published": "2024-05-06T08:56:00.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/66666?u=fc14df8d5703b2ccf5d15dda2a212ae6b6a2c0e7&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">As suggested by the docs for <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/FormOptionsHelper.html#method-i-select\" rel=\"nofollow\">FormOptionsHelper#select</a>, the helper can be called with a block to customize option tag attributes:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"select(report, :campaign_ids) do\n  available_campaigns.each do |c|\n    tag.option(c.name, value: c.id, data: { tags: c.tags.to_json })\n  end\nend\"><pre class=\"notranslate\"><code class=\"notranslate\">select(report, :campaign_ids) do\n  available_campaigns.each do |c|\n    tag.option(c.name, value: c.id, data: { tags: c.tags.to_json })\n  end\nend\n</code></pre></div>\n<p dir=\"auto\">Prior to this commit, a NoMethodError error would be raised when available_campaigns in the above example was the empty array. This happened because the block passed to select would return a non-string value (the empty array) causing the call to capture in Helpers::Tags::Select#initialize to return nil:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"def initialize(object_name, method_name, template_object, choices, options, html_options)\n  @choices = block_given? ? template_object.capture { yield || &quot;&quot; } : choices\"><pre class=\"notranslate\"><code class=\"notranslate\">def initialize(object_name, method_name, template_object, choices, options, html_options)\n  @choices = block_given? ? template_object.capture { yield || \"\" } : choices\n</code></pre></div>\n<p dir=\"auto\">This commit fixes this by moving the <code class=\"notranslate\">|| \"\"</code> outside the block passed to capture.</p>",
            "url": "https://github.com/rails/rails/pull/51743",
            "title": "Fix select helper with block returning non-string",
            "date_modified": "2024-05-08T12:36:24.000Z",
            "date_published": "2024-05-06T08:26:38.000Z",
            "author": {
                "name": "calleluks",
                "url": "https://github.com/calleluks"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/44280450?u=5d0b7f0d7535c39131a9d2d513cbf4691236b6e4&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created to remove <code class=\"notranslate\">FIXME</code> comment of <code class=\"notranslate\">ActiveStorage::Service::MirrorService</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request use thread pool to parallelize <code class=\"notranslate\">delete</code> and <code class=\"notranslate\">delete_prefixed</code> in <code class=\"notranslate\">ActiveStorage::Service::MirrorService</code>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">If this is a nit performance boost than complexity, how about remove comment?</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51740",
            "title": "Improve performance in `ActiveStorage::Service::MirrorService`",
            "date_modified": "2024-05-12T08:07:32.000Z",
            "date_published": "2024-05-05T08:34:21.000Z",
            "author": {
                "name": "heka1024",
                "url": "https://github.com/heka1024"
            }
        }
    ]
}