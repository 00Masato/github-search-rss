{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/53901866?u=242dfe71d3fe9103a0440b29a4d275f336592a73&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because the general Cheat Sheet Series are a great source of security recommendations, as well as more reader-friendly than the markdown linked earlier. I kept the specific link to the cross-site scripting cheat sheet to preserve the original intention of the author (or, rather, my assumption of it).</p>\n<p dir=\"auto\">Full disclosure: affiliated with OWASP.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the last line of the security guide to link to the general more reader-friendly web page of the cheat sheet series rather than the markdown file in the repository.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">N.A.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53234",
            "title": "Change OWASP security reference to the general OWASP Cheat Sheet Series",
            "date_modified": "2024-10-08T14:00:35.000Z",
            "date_published": "2024-10-08T14:00:30.000Z",
            "author": {
                "name": "bendehaan",
                "url": "https://github.com/bendehaan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/12642?u=76645b9234fbbeb252f789a670b62927cf998541&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">As of MySQL 8.0.19, provides SQL standard syntax to DROP constraint.</p>\n<p dir=\"auto\"><a href=\"https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-19.html#mysqld-8-0-19-sql-syntax\" rel=\"nofollow\">https://dev.mysql.com/doc/relnotes/mysql/8.0/en/news-8-0-19.html#mysqld-8-0-19-sql-syntax</a></p>\n<p dir=\"auto\">See also: <a href=\"https://mariadb.com/kb/en/alter-table/#drop-constraint\" rel=\"nofollow\">https://mariadb.com/kb/en/alter-table/#drop-constraint</a></p>\n<p dir=\"auto\">So if we drop support for old MySQL in the future, we can get rid of the generation of old MySQL-specific DROP CHECK/FOREIGN KEY syntaxes.</p>",
            "url": "https://github.com/rails/rails/pull/53232",
            "title": "Extract `remove_constraint` for SQL standard `DROP CONSTRAINT` syntax",
            "date_modified": "2024-10-08T12:12:17.000Z",
            "date_published": "2024-10-08T12:12:13.000Z",
            "author": {
                "name": "kamipo",
                "url": "https://github.com/kamipo"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/50046077?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #53229.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2572656435\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/53229\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/53229/hovercard\" href=\"https://github.com/rails/rails/issues/53229\">#53229</a><br>\nThis Pull Request has been created because of fixing the issue 53229.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the method <code class=\"notranslate\">table_name_matches?</code> to check matching table in ActiveReocrd::QueryMethods module. If from clause matches with main table name, it will use the corresponding field of the table as the projections of the arel. When the query is built, it will have the select statement look like \"table_name\".\"field_name\".</p>\n<p dir=\"auto\">In the example of the issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2572656435\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/53229\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/53229/hovercard\" href=\"https://github.com/rails/rails/issues/53229\">#53229</a>, the select statement should have been \"users\".\"id\". However, table_name_matches? = false, so the select statement is \"id\". As the result, ambiguous column name error happens.</p>\n<p dir=\"auto\">To fix this issue, table_name_matches? should handle case that from clause is TableAlias</p>\n<p dir=\"auto\">Currently, it uses from.to_s to compare to the regex. Therefore, when from is a table alias (Arel::Nodes:TableAlias), it will work incorrectly. It should have used from.name in case type of from is TableAlias.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53231",
            "title": "Fix issue-53229: Ambiguous column name id when count all",
            "date_modified": "2024-10-08T14:21:37.000Z",
            "date_published": "2024-10-08T10:27:47.000Z",
            "author": {
                "name": "HuuTrieu1999",
                "url": "https://github.com/HuuTrieu1999"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/14258779?u=a386e08490920b3e8346651d2c963d1765bf7abc&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">prefer the example to use hash method to access custom credentials values<br>\nthis is beneficial to avoid issues like this<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2364576058\" data-permission-text=\"Title is private\" data-url=\"https://github.com/basecamp/kamal/issues/849\" data-hovercard-type=\"issue\" data-hovercard-url=\"/basecamp/kamal/issues/849/hovercard\" href=\"https://github.com/basecamp/kamal/issues/849\">basecamp/kamal#849</a></p>\n<p dir=\"auto\">the problem is there is no dig that raise error if the key is not found</p>",
            "url": "https://github.com/rails/rails/pull/53228",
            "title": "[docs] prefer the example  to use hash method to access custom credentials values [ci skip]",
            "date_modified": "2024-10-08T09:01:11.000Z",
            "date_published": "2024-10-08T08:53:59.000Z",
            "author": {
                "name": "buncis",
                "url": "https://github.com/buncis"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/545604?u=f4a12e38b365d7686f15e93391b6ffa88c0545cd&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This is related to the authentication generator.</p>\n<p dir=\"auto\">Currently, if you call <code class=\"notranslate\">allow_unauthenticated_access</code> in a controller, <code class=\"notranslate\">Current.session</code> won't be set. This can result in rendered views making the user appear to be signed out if they are already signed in.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This updates <code class=\"notranslate\">allow_unauthenticated_access</code> to set a <code class=\"notranslate\">before_action</code> of <code class=\"notranslate\">resume_session</code> to allow the user to still be signed in for requests that do not require authentication.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Also included in this PR are two quick fixup commits:</p>\n<ul dir=\"auto\">\n<li>Skip querying the <code class=\"notranslate\">Session</code> model needlessly if the cookie isn't set.</li>\n<li><code class=\"notranslate\">SessionsController#destroy</code> should redirect with <code class=\"notranslate\">see_other</code> to match existing scaffolding controller destroy actions.</li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53220",
            "title": "Set Current.session if signed-in in unauthenticated access",
            "date_modified": "2024-10-08T00:41:55.000Z",
            "date_published": "2024-10-07T16:52:35.000Z",
            "author": {
                "name": "t27duck",
                "url": "https://github.com/t27duck"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/14993828?u=8ed3978d4be4f3a0ed1eb48dc0e5e039b5f885e7&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #53219.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2570335364\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/53219\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/53219/hovercard\" href=\"https://github.com/rails/rails/issues/53219\">#53219</a></p>\n<p dir=\"auto\">This Pull Request has been created because <code class=\"notranslate\">db:system:change</code> is unable to match the regexp due to an additional package <code class=\"notranslate\">libjemalloc2</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes <code class=\"notranslate\">rails db:system:change</code> - </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/a2f2dc8afd38b2d4ebd0170a75be2910fd7e4e45/railties/lib/rails/generators/rails/db/system/change/change_generator.rb#L14\">rails/railties/lib/rails/generators/rails/db/system/change/change_generator.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 14\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/a2f2dc8afd38b2d4ebd0170a75be2910fd7e4e45\">a2f2dc8</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L14\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"14\"></td>\n          <td id=\"LC14\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">BASE_PACKAGES</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">%w(</span> <span class=\"pl-s\">curl</span> <span class=\"pl-s\">libvips</span> <span class=\"pl-kos\">)</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">We add <code class=\"notranslate\">libjemalloc2</code> to the <code class=\"notranslate\">BASE_PACKAGES</code> as this is added to the default <code class=\"notranslate\">Dockerfile</code> here - </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/a2f2dc8afd38b2d4ebd0170a75be2910fd7e4e45/railties/lib/rails/generators/app_base.rb#L588\">rails/railties/lib/rails/generators/app_base.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 588\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/a2f2dc8afd38b2d4ebd0170a75be2910fd7e4e45\">a2f2dc8</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L588\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"588\"></td>\n          <td id=\"LC588\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">packages</span> &lt;&lt; <span class=\"pl-s\">\"libjemalloc2\"</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">Locally tested the change with:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"rails db:system:change --to=sqlite3\nrails db:system:change --to=postgresql\nrails db:system:change --to=mysql\"><pre class=\"notranslate\">rails db:system:change --to=sqlite3\nrails db:system:change --to=postgresql\nrails db:system:change --to=mysql</pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53217",
            "title": "Fix db system change generator",
            "date_modified": "2024-10-07T15:33:38.000Z",
            "date_published": "2024-10-07T11:56:40.000Z",
            "author": {
                "name": "deepakmahakale",
                "url": "https://github.com/deepakmahakale"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/816901?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Alright, I'm not going to pretend that I understand exactly what's happening, but the fact is that this seems to fix something, so I'll try to explain what I understand.</p>\n<h2 dir=\"auto\">The problem</h2>\n<p dir=\"auto\">Running the following test hangs forever:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ bin/test test/engine/commands_test.rb:62\nRun options: -v --seed 4349\n\n# Running:\n\nRails::Engine::CommandsTest#test_server_command_broadcast_logs = ðŸ’¥ Hangs here\"><pre class=\"notranslate\">$ <span class=\"pl-s1\">bin/test test/engine/commands_test.rb:62</span>\n<span class=\"pl-c1\">Run options: -v --seed 4349</span>\n\n# <span class=\"pl-s1\">Running:</span>\n\n<span class=\"pl-c1\">Rails::Engine::CommandsTest#test_server_command_broadcast_logs = ðŸ’¥ Hangs here</span></pre></div>\n<p dir=\"auto\">Somehow I seem to have reproduced it with the command that would run on<br>\nCI:</p>\n<div class=\"highlight highlight-text-shell-session notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ TEST_DIR=engine TESTOPTS=&quot;-v -n test_server_command_broadcast_logs&quot;  bundle exec rake test\n\n--- test/engine/commands_test.rb\n/Users/sto/.rubies/ruby-3.3.5/bin/ruby -w -Itest -Ilib -I../activesupport/lib -I../actionpack/lib -I../actionview/lib -I../activemodel/lib test/engine/commands_test.rb\nRun options: -v -n test_server_command_broadcast_logs --seed 59220\n\n# Running:\n\nRails::Engine::CommandsTest#test_server_command_broadcast_logs = ðŸ’¥ Hangs here\"><pre class=\"notranslate\">$ <span class=\"pl-s1\">TEST_DIR=engine TESTOPTS=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-v -n test_server_command_broadcast_logs<span class=\"pl-pds\">\"</span></span>  bundle <span class=\"pl-c1\">exec</span> rake <span class=\"pl-c1\">test</span></span>\n\n<span class=\"pl-c1\">--- test/engine/commands_test.rb</span>\n<span class=\"pl-c1\">/Users/sto/.rubies/ruby-3.3.5/bin/ruby -w -Itest -Ilib -I../activesupport/lib -I../actionpack/lib -I../actionview/lib -I../activemodel/lib test/engine/commands_test.rb</span>\n<span class=\"pl-c1\">Run options: -v -n test_server_command_broadcast_logs --seed 59220</span>\n\n# <span class=\"pl-s1\">Running:</span>\n\n<span class=\"pl-c1\">Rails::Engine::CommandsTest#test_server_command_broadcast_logs = ðŸ’¥ Hangs here</span></pre></div>\n<p dir=\"auto\">I'm gonna venture a guess and assume that maybe this test (and 3 others) do not run in CI because of this condition:</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/aacbb5c0f5bdd11f0dee78da03bd6859f0cabeba/railties/test/engine/commands_test.rb#L36\">rails/railties/test/engine/commands_test.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 36\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/aacbb5c0f5bdd11f0dee78da03bd6859f0cabeba\">aacbb5c</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L36\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"36\"></td>\n          <td id=\"LC36\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> <span class=\"pl-en\">available_pty?</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/aacbb5c0f5bdd11f0dee78da03bd6859f0cabeba/railties/test/console_helpers.rb#L23-L25\">rails/railties/test/console_helpers.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 23 to 25\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/aacbb5c0f5bdd11f0dee78da03bd6859f0cabeba\">aacbb5c</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L23\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"23\"></td>\n          <td id=\"LC23\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">available_pty?</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L24\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"24\"></td>\n          <td id=\"LC24\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">defined?</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">PTY</span><span class=\"pl-kos\">)</span> &amp;&amp; <span class=\"pl-c1\">PTY</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">respond_to?</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:open</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L25\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"25\"></td>\n          <td id=\"LC25\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Is there a way we can check if these tests ever ran on CI?</p>\n<h2 dir=\"auto\">What seems to be happening</h2>\n<p dir=\"auto\">I do not understand much of how <code class=\"notranslate\">PTY</code> works, but what I have identified is that:</p>\n<ol dir=\"auto\">\n<li>The test hangs at <code class=\"notranslate\">net.get(\"/\")</code>. Using a bit of debugging, I confirmed that I was not able to <code class=\"notranslate\">curl http://localhost:3000</code> after spawning <code class=\"notranslate\">rails server</code>.</li>\n<li>It appears the process is entering a lock where:\n<ul dir=\"auto\">\n<li>it will not continue processing and complete the request until <code class=\"notranslate\">rails server</code>'s output has been \"consumed\" (<code class=\"notranslate\">read</code>, <code class=\"notranslate\">readlines</code>) out of the <code class=\"notranslate\">IO</code> object returned by <code class=\"notranslate\">PTY.new</code>.</li>\n<li>we won't be reading more output out of <code class=\"notranslate\">primary</code> since <code class=\"notranslate\">net.get(\"/\")</code> is blocked</li>\n</ul>\n</li>\n</ol>\n<h2 dir=\"auto\">The workaround</h2>\n<p dir=\"auto\">I have no idea whether this is an acceptable fix, but parallelizing, and allowing our test thread to try and read (blocking) the PTY's output, while a different thread makes the HTTP request (blocking too), seems to be fixing the problem.</p>\n<p dir=\"auto\">You can try running any of the two commands I shared above and confirm the test will succeed now.</p>\n<h2 dir=\"auto\">Questions</h2>\n<ul dir=\"auto\">\n<li>Is there a way we can check if these tests ever ran on CI?</li>\n<li>Is my fix an acceptable approach?</li>\n<li>Has this test ever worked in the past? (Locally/On CI)</li>\n<li>Has anything changed (maybe in Puma), making Puma's output blocking, and preventing it to continue processing a request until all its output has been consumed?</li>\n</ul>\n\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because [REPLACE ME]</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53215",
            "title": "Fix hanging test due to interlocking(?)",
            "date_modified": "2024-10-08T00:20:53.000Z",
            "date_published": "2024-10-07T08:55:46.000Z",
            "author": {
                "name": "davidstosik",
                "url": "https://github.com/davidstosik"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54629302?u=87f48b6c8977eca031c6b84a5b1f21b241270c4d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Uses <code class=\"notranslate\">concurrent-ruby</code>'s <code class=\"notranslate\">FixedThreadPool</code> with a default size of 4 (configurable) instead of its parent <code class=\"notranslate\">ThreadPoolExecutor</code> with a min and max size of 1 and 4 (configurable) for the Action Cable server's worker pool.</p>\n<p dir=\"auto\">Refs:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/ruby-concurrency/concurrent-ruby/blob/b16af1e977c20e47bbab287ae92f2d397c7694b0/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb\">https://github.com/ruby-concurrency/concurrent-ruby/blob/b16af1e977c20e47bbab287ae92f2d397c7694b0/lib/concurrent-ruby/concurrent/executor/ruby_thread_pool_executor.rb</a></li>\n<li><a href=\"https://github.com/ruby-concurrency/concurrent-ruby/blob/b16af1e977c20e47bbab287ae92f2d397c7694b0/lib/concurrent-ruby/concurrent/executor/thread_pool_executor.rb\">https://github.com/ruby-concurrency/concurrent-ruby/blob/b16af1e977c20e47bbab287ae92f2d397c7694b0/lib/concurrent-ruby/concurrent/executor/thread_pool_executor.rb</a></li>\n<li><a href=\"https://github.com/ruby-concurrency/concurrent-ruby/blob/b16af1e977c20e47bbab287ae92f2d397c7694b0/lib/concurrent-ruby/concurrent/executor/fixed_thread_pool.rb\">https://github.com/ruby-concurrency/concurrent-ruby/blob/b16af1e977c20e47bbab287ae92f2d397c7694b0/lib/concurrent-ruby/concurrent/executor/fixed_thread_pool.rb</a></li>\n</ul>\n<p dir=\"auto\">Why:</p>\n<ol dir=\"auto\">\n<li>\n<p dir=\"auto\"><code class=\"notranslate\">concurrent-ruby</code>'s thread pool scaling behaviour (compared to puma's for example) seems to be a bit unconventional and unpredictable due to the lack of a master / control event loop or trimmer thread. Scaling down / pruning the pool doesn't happen as soon as (or as soon as the idle time per-thread has elapsed after) there's less / no work, but only when the next bit of work comes in and there's an excess number of threads.</p>\n<p dir=\"auto\">Consider this simulated example where the server is idling on start, and receives work with varying gaps:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"begin\n  require &quot;concurrent-ruby&quot;\n  \n  pool = Concurrent::ThreadPoolExecutor.new(\n    min_threads: 1,\n    max_threads: 4,\n    max_queue: 0,\n    idletime: 3\n  )\n  # First thread is lazily spawned.\n  pp pool.length #=&gt; 0\n  \n  work = -&gt; { sleep 2 }\n  \n  # Batch (gap-less individual units) of work.\n  10.times { pool &lt;&lt; work }\n  # Wait for state updates.\n  sleep 0.25\n  # Expected scale up.\n  pp pool.length #=&gt; 4\n  # Wait for all work to be processed.\n  # This is sufficient cause work is I/O bound and parallel.\n  sleep 10\n  pp pool.length #=&gt; 4\n  # Wait until idle time of all threads has elapsed.\n  # This is sufficient; only needs to be greater than the idle time of the last busy thread.\n  sleep 5\n  # Not scaled down.\n  # Prune will only take place when next unit of work is received, despite idle time elapse.\n  pp pool.length #=&gt; 4\n\n  # Wait for a while to show no change.\n  sleep 20\n  pp pool.length #=&gt; 4\n  \n  # Another batch of work.\n  10.times { pool &lt;&lt; work }\n  # Wait for state updates.\n  sleep 0.25\n  # This case is the most interesting, and might need to be addressed in concurrent-ruby.\n  # If bulk work comes in, since prune is called right after assignment / queuing, there's a race\n  # condition between when the ready workers size is checked for prune, and the threads start\n  # processing the work, which is when the ready size is updated. As a result, we end up with a\n  # single thread handling all the work i.e. the pool is prematurely scaled down, and stays that way\n  # since all units of work have been assigned / queued.\n  pp pool.length #=&gt; 1\n  # Wait for all work to be processed.\n  # Work is now sequential.\n  sleep 25\n  pp pool.length #=&gt; 1\n  # Wait until idle time of all threads has elapsed.\n  sleep 5\n  pp pool.length #=&gt; 1\n\n  # Wait for a while to show no change.\n  sleep 20\n  pp pool.length #=&gt; 1\n  \n  # Individual units of work, spaced apart.\n  # No work will be completed by the time the last unit is added.\n  1.times { pool &lt;&lt; work }\n  sleep 0.25\n  1.times { pool &lt;&lt; work }\n  sleep 0.25\n  1.times { pool &lt;&lt; work }\n  sleep 0.25\n  1.times { pool &lt;&lt; work }\n  # Wait for state updates.\n  sleep 0.25\n  # Expected scale up.\n  pp pool.length #=&gt; 4\n  # Wait for all work to be processed.\n  sleep 10\n  pp pool.length #=&gt; 4\n  # Wait until idle time of all threads has elapsed.\n  sleep 5\n  # Once again, won't scale down till the next unit.\n  pp pool.length #=&gt; 4\n\n  # Wait for a while to show no change.\n  sleep 20\n  pp pool.length #=&gt; 4\n  \n  # Single unit of work.\n  1.times { pool &lt;&lt; work }\n  # Wait for state updates.\n  sleep 0.25 \n  # Expected scale down.\n  pp pool.length #=&gt; 1\n  # Wait for all work to be processed.\n  sleep 10\n  pp pool.length #=&gt; 1\n  # Wait until idle time of all threads has elapsed.\n  sleep 5\n  pp pool.length #=&gt; 1\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">begin</span>\n  <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"concurrent-ruby\"</span>\n  \n  <span class=\"pl-s1\">pool</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Concurrent</span>::<span class=\"pl-v\">ThreadPoolExecutor</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span>\n    <span class=\"pl-pds\">min_threads</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span>\n    <span class=\"pl-pds\">max_threads</span>: <span class=\"pl-c1\">4</span><span class=\"pl-kos\">,</span>\n    <span class=\"pl-pds\">max_queue</span>: <span class=\"pl-c1\">0</span><span class=\"pl-kos\">,</span>\n    <span class=\"pl-pds\">idletime</span>: <span class=\"pl-c1\">3</span>\n  <span class=\"pl-kos\">)</span>\n  <span class=\"pl-c\"># First thread is lazily spawned.</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 0</span>\n  \n  <span class=\"pl-s1\">work</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">2</span> <span class=\"pl-kos\">}</span>\n  \n  <span class=\"pl-c\"># Batch (gap-less individual units) of work.</span>\n  <span class=\"pl-c1\">10</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">times</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">pool</span> &lt;&lt; <span class=\"pl-s1\">work</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-c\"># Wait for state updates.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">0.25</span>\n  <span class=\"pl-c\"># Expected scale up.</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 4</span>\n  <span class=\"pl-c\"># Wait for all work to be processed.</span>\n  <span class=\"pl-c\"># This is sufficient cause work is I/O bound and parallel.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">10</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 4</span>\n  <span class=\"pl-c\"># Wait until idle time of all threads has elapsed.</span>\n  <span class=\"pl-c\"># This is sufficient; only needs to be greater than the idle time of the last busy thread.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">5</span>\n  <span class=\"pl-c\"># Not scaled down.</span>\n  <span class=\"pl-c\"># Prune will only take place when next unit of work is received, despite idle time elapse.</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 4</span>\n\n  <span class=\"pl-c\"># Wait for a while to show no change.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">20</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 4</span>\n  \n  <span class=\"pl-c\"># Another batch of work.</span>\n  <span class=\"pl-c1\">10</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">times</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">pool</span> &lt;&lt; <span class=\"pl-s1\">work</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-c\"># Wait for state updates.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">0.25</span>\n  <span class=\"pl-c\"># This case is the most interesting, and might need to be addressed in concurrent-ruby.</span>\n  <span class=\"pl-c\"># If bulk work comes in, since prune is called right after assignment / queuing, there's a race</span>\n  <span class=\"pl-c\"># condition between when the ready workers size is checked for prune, and the threads start</span>\n  <span class=\"pl-c\"># processing the work, which is when the ready size is updated. As a result, we end up with a</span>\n  <span class=\"pl-c\"># single thread handling all the work i.e. the pool is prematurely scaled down, and stays that way</span>\n  <span class=\"pl-c\"># since all units of work have been assigned / queued.</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 1</span>\n  <span class=\"pl-c\"># Wait for all work to be processed.</span>\n  <span class=\"pl-c\"># Work is now sequential.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">25</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 1</span>\n  <span class=\"pl-c\"># Wait until idle time of all threads has elapsed.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">5</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 1</span>\n\n  <span class=\"pl-c\"># Wait for a while to show no change.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">20</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 1</span>\n  \n  <span class=\"pl-c\"># Individual units of work, spaced apart.</span>\n  <span class=\"pl-c\"># No work will be completed by the time the last unit is added.</span>\n  <span class=\"pl-c1\">1</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">times</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">pool</span> &lt;&lt; <span class=\"pl-s1\">work</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">0.25</span>\n  <span class=\"pl-c1\">1</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">times</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">pool</span> &lt;&lt; <span class=\"pl-s1\">work</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">0.25</span>\n  <span class=\"pl-c1\">1</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">times</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">pool</span> &lt;&lt; <span class=\"pl-s1\">work</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">0.25</span>\n  <span class=\"pl-c1\">1</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">times</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">pool</span> &lt;&lt; <span class=\"pl-s1\">work</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-c\"># Wait for state updates.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">0.25</span>\n  <span class=\"pl-c\"># Expected scale up.</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 4</span>\n  <span class=\"pl-c\"># Wait for all work to be processed.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">10</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 4</span>\n  <span class=\"pl-c\"># Wait until idle time of all threads has elapsed.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">5</span>\n  <span class=\"pl-c\"># Once again, won't scale down till the next unit.</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 4</span>\n\n  <span class=\"pl-c\"># Wait for a while to show no change.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">20</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 4</span>\n  \n  <span class=\"pl-c\"># Single unit of work.</span>\n  <span class=\"pl-c1\">1</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">times</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">pool</span> &lt;&lt; <span class=\"pl-s1\">work</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-c\"># Wait for state updates.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">0.25</span> \n  <span class=\"pl-c\"># Expected scale down.</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 1</span>\n  <span class=\"pl-c\"># Wait for all work to be processed.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">10</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 1</span>\n  <span class=\"pl-c\"># Wait until idle time of all threads has elapsed.</span>\n  <span class=\"pl-en\">sleep</span> <span class=\"pl-c1\">5</span>\n  <span class=\"pl-en\">pp</span> <span class=\"pl-s1\">pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">length</span> <span class=\"pl-c\">#=&gt; 1</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">We can see that most of the time the pool is actually idling at its max despite there being no work after a number of units equal to or exceeding its max size comes in, either in 'batches' or with gaps small enough such that a scale up / maintaining the current size is required.</p>\n<p dir=\"auto\">In other words, it'll always idle at the size it last scaled up / down to, until the next unit of work comes in. I think it therefore makes more sense to simply keep the pool at a sensible fixed size which users can tune to match their workload, considering it already mostly behaves that way, and that scaling for mixed workloads is quite unpredictable.</p>\n</li>\n<li>\n<p dir=\"auto\">Auto-scaling / reaping and spawning threads has an (imo) unnecessary overhead with not much benefit. A fixed pool size also means more predictable and measurable resource usage and throughput capacity.</p>\n</li>\n</ol>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53211",
            "title": "Use a fixed worker pool size for Action Cable server",
            "date_modified": "2024-10-07T09:15:28.000Z",
            "date_published": "2024-10-06T10:29:08.000Z",
            "author": {
                "name": "joshuay03",
                "url": "https://github.com/joshuay03"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/419086?u=d0fe8d6b68a77ff6fc46bd57cbc2a37db85a6d34&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h2 dir=\"auto\">Motivation / Background</h2>\n<p dir=\"auto\">The <code class=\"notranslate\">up_only (block)</code> helper allows running operations when migrating up, but sometimes a block needs to run when reverting instead. It is possible to wrap the block in <code class=\"notranslate\">if reverting? [â€¦] end</code> but this is slightly less readable. Also, since there are <code class=\"notranslate\">up</code> and <code class=\"notranslate\">down</code> methods, and an <code class=\"notranslate\">up_only</code> helper, one would expect a <code class=\"notranslate\">down_only</code> helper to match.</p>\n<p dir=\"auto\">See issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1713995776\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48245\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48245/hovercard\" href=\"https://github.com/rails/rails/issues/48245\">#48245</a></p>",
            "url": "https://github.com/rails/rails/pull/53209",
            "title": "Add down_only migration helper",
            "date_modified": "2024-10-08T11:00:51.000Z",
            "date_published": "2024-10-06T10:11:59.000Z",
            "author": {
                "name": "goulvench",
                "url": "https://github.com/goulvench"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6393110?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because there are two different migration file name formats as below.</p>\n<ul dir=\"auto\">\n<li>db/migrate/&lt;timestamp&gt;_create_articles.rb</li>\n<li>db/migrate/20140120201010_create_comments.rb with a comment: \"your name will include a different timestamp\"</li>\n</ul>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request unifies the format as below.</p>\n<ul dir=\"auto\">\n<li>db/migrate/&lt;timestamp&gt;_create_articles.rb</li>\n<li>db/migrate/&lt;timestamp&gt;_create_comments.rb</li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53208",
            "title": "Unify migration file name formats in \"Getting Started with Rails\" [ci skip]",
            "date_modified": "2024-10-06T10:09:01.000Z",
            "date_published": "2024-10-06T10:08:57.000Z",
            "author": {
                "name": "wakairo",
                "url": "https://github.com/wakairo"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/122436?u=ec54cf625a213bbe6cf0ed04a3d14551dac7875d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">When the new rails app is made while it behaves like default timezone is UTC, the following configuration is set:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"ActiveRecord.default_timezone # =&gt; :utc\nRails.config.active_record.default_timezone # =&gt; nil\"><pre class=\"notranslate\"><span class=\"pl-v\">ActiveRecord</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">default_timezone</span> <span class=\"pl-c\"># =&gt; :utc</span>\n<span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_record</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">default_timezone</span> <span class=\"pl-c\"># =&gt; nil</span></pre></div>\n<p dir=\"auto\">Which is inconsistent and also contradicts the <a href=\"https://guides.rubyonrails.org/configuring.html#config-active-record-default-timezone\" rel=\"nofollow\">guide</a> that says:</p>\n<blockquote>\n<p dir=\"auto\">The default is :utc.</p>\n</blockquote>\n<p dir=\"auto\">The pull request makes sure <code class=\"notranslate\">config</code> variable is set to <code class=\"notranslate\">:utc</code> by default.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I didn't find any test related to default configuration made in <code class=\"notranslate\">lib/active_record/railties.rb</code>. It seems like its considered unnecessary. Let me know if I missed it or it needs to be made.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53206",
            "title": "Make sure Rails.config.active_record.default_timezone set to :utc",
            "date_modified": "2024-10-06T13:17:45.000Z",
            "date_published": "2024-10-06T08:32:49.000Z",
            "author": {
                "name": "bogdan",
                "url": "https://github.com/bogdan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/122436?u=ec54cf625a213bbe6cf0ed04a3d14551dac7875d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">AS::TimeZone exposes MAPPING as way to normalize TZ name But using it is pretty inconvinient</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    zone = ActiveSupport::TimeZone['Hawaii']\n    # Old way\n    ActiveSupport::TimeZone::MAPPING[zone.name]\n    # New way\n    zone.standard_name\"><pre class=\"notranslate\">    <span class=\"pl-s1\">zone</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">TimeZone</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">'Hawaii'</span><span class=\"pl-kos\">]</span>\n    <span class=\"pl-c\"># Old way</span>\n    <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">TimeZone</span>::<span class=\"pl-c1\">MAPPING</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">zone</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span><span class=\"pl-kos\">]</span>\n    <span class=\"pl-c\"># New way</span>\n    <span class=\"pl-s1\">zone</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">standard_name</span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds <code class=\"notranslate\">AS::TimeZone#standard_name</code> method</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53199",
            "title": "Add AS::TimeZone#standard_name method",
            "date_modified": "2024-10-06T08:43:49.000Z",
            "date_published": "2024-10-05T14:02:07.000Z",
            "author": {
                "name": "bogdan",
                "url": "https://github.com/bogdan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/151224?u=85901a0a1d5c58fb953d17b754f7b980ffab2cab&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">It would be nice to rely on built-in extract dimensions logic when writing custom image analyzer like this:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class CustomeImageAnalyzer &lt; ActiveStorage::Analyzer::ImageAnalyzer::Vips\n  def metadata\n    read_image do |image|\n      extract_dimensions_metadata(image).tap do |metadata|\n        metadata[:aspect_ratio] = metadata[:width].to_f / metadata[:height]\n      end\n    end\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">CustomeImageAnalyzer</span> &lt; <span class=\"pl-v\">ActiveStorage</span>::<span class=\"pl-v\">Analyzer</span>::<span class=\"pl-v\">ImageAnalyzer</span>::<span class=\"pl-v\">Vips</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">metadata</span>\n    <span class=\"pl-en\">read_image</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">image</span>|\n      <span class=\"pl-en\">extract_dimensions_metadata</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">image</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">tap</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">metadata</span>|\n        <span class=\"pl-s1\">metadata</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:aspect_ratio</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">metadata</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:width</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_f</span> / <span class=\"pl-s1\">metadata</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:height</span><span class=\"pl-kos\">]</span>\n      <span class=\"pl-k\">end</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">This pull request introduces <code class=\"notranslate\">extract_dimensions_metadata</code>, the method idea is <a href=\"https://github.com/rails/rails/blob/main/activestorage/lib/active_storage/analyzer/image_analyzer.rb#L21\">similar</a> to<code class=\"notranslate\">rotated_image?</code>. Not a big deal, but still.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53195",
            "title": "Add extract_dimensions_metadata to image analyzer",
            "date_modified": "2024-10-05T08:22:21.000Z",
            "date_published": "2024-10-05T08:22:17.000Z",
            "author": {
                "name": "aishek",
                "url": "https://github.com/aishek"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1709692?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This commit addresses the issue by ensuring that the id is always passed</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">Currently, calling reload does not pass the id information to the exception when the record is not found.</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #52598.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2464301253\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52598\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/52598/hovercard\" href=\"https://github.com/rails/rails/issues/52598\">#52598</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the <code class=\"notranslate\">_find_record</code> method in the <code class=\"notranslate\">Persistence</code> module to stop using <code class=\"notranslate\">find_by!</code> and instead use <code class=\"notranslate\">find_by</code>. This way if the record is not found the method can populate the exception message with the right id information.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">It seems that the original change (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1432226606\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46402\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/46402/hovercard\" href=\"https://github.com/rails/rails/pull/46402\">#46402</a>) was introduced to support <code class=\"notranslate\">query_constraints_list</code>. I have tried to ensure that <code class=\"notranslate\">query_constraints_list</code> is used in generating the error object, but I couldn't find any prior art, so I had to come up with my own approach.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53194",
            "title": "`ActiveRecord::Persistence#reload` set id on RecordNotFound exception",
            "date_modified": "2024-10-06T14:08:18.000Z",
            "date_published": "2024-10-05T06:29:26.000Z",
            "author": {
                "name": "cmaruz",
                "url": "https://github.com/cmaruz"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1034?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Rack is looking at some minor changes to how they parse query strings, but we have learned hard-won lessons about changing even edge case behaviours.</p>\n<p dir=\"auto\">Simultaneously, this narrow instance has highlighted a more general situation: prior to Rack 3, we always had the option to adopt our own parameter parsing strategy (e.g. if we wanted to invent some meaning for a structured parameter name of <code class=\"notranslate\">foo[@]/bar</code> or something). As Rack 3 eliminated the obligation for the input body to be rewindable, only the first-to-read is guaranteed to be able to see the full set of parameters.</p>\n<p dir=\"auto\">The Rack side of this has been alleviated via <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1768882464\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rack/rack/issues/2088\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rack/rack/pull/2088/hovercard\" href=\"https://github.com/rack/rack/pull/2088\">rack/rack#2088</a> -- it's still true that only the first reader can parse the input, and ecosystem consistency requires that reader to be Rack... but it will now provide a more literal, less processed, view of the parameters it saw.</p>\n<p dir=\"auto\">Here, we adopt that new raw parameter list (where available), and do the structured parsing for ourselves.</p>\n<p dir=\"auto\">Interestingly, this allows us to be more direct in getting to a true Rails parameter set: indifferent hash access, nil munging, and string encoding controls can all be applied as we go, instead of through post-processing.</p>\n<hr>\n<p dir=\"auto\">The intention is that there are no observable behaviour changes here: the only short-term effect will be to insulate us from future-Rack's <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1812208010\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rack/rack/issues/2098\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rack/rack/pull/2098/hovercard\" href=\"https://github.com/rack/rack/pull/2098\">rack/rack#2098</a>.</p>\n<p dir=\"auto\">This PR <em>will</em> result in new/different exception classes being raised for various invalid-parameter situations, but apart from changing spelling of some log messages, I'm not sure it's practical, let alone likely, for an application to be rescuing them.</p>",
            "url": "https://github.com/rails/rails/pull/53193",
            "title": "Do more request parameter parsing ourselves",
            "date_modified": "2024-10-05T05:29:33.000Z",
            "date_published": "2024-10-05T05:29:29.000Z",
            "author": {
                "name": "matthewd",
                "url": "https://github.com/matthewd"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5122678?u=204301f9f9fe8930fd26fe3bfe65b6ffaffd8b59&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The current guidance on how to initialize a custom serializer does not work. Instead, it raises a <code class=\"notranslate\">NameError</code>.</p>\n<p dir=\"auto\">I found I needed to use the <code class=\"notranslate\">to_prepare</code> <a href=\"https://guides.rubyonrails.org/configuring.html#initialization-events\" rel=\"nofollow\">initialization events</a><br>\nto correctly configure a custom serializer:</p>\n<p dir=\"auto\">Additionally, add the private <code class=\"notranslate\">klass</code> instance method to match the example in the API.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53192",
            "title": "Guides: Update serialization section [ci skip]",
            "date_modified": "2024-10-07T08:49:09.000Z",
            "date_published": "2024-10-05T02:11:56.000Z",
            "author": {
                "name": "stevepolitodesign",
                "url": "https://github.com/stevepolitodesign"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/55020167?u=3e0880f7916aeabde344be62e94e72f2bd1c0596&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I try to deploy a brand-new rails \"8.0.0.beta1\" app with esbuild and deploy it with the shiny Kamal V2.1.<br>\nDocker image build step fails due to yarn installation :</p>\n<p dir=\"auto\"><strong>the default Dockerfile :</strong></p>\n<div class=\"highlight highlight-source-dockerfile notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# syntax=docker/dockerfile:1\n# check=error=true\n\n# This Dockerfile is designed for production, not development. Use with Kamal or build'n'run by hand:\n# docker build -t fix_yarn .\n# docker run -d -p 80:80 -e RAILS_MASTER_KEY=&lt;value from config/master.key&gt; --name fix_yarn fix_yarn\n\n# For a containerized dev environment, see Dev Containers: https://guides.rubyonrails.org/getting_started_with_devcontainer.html\n\n# Make sure RUBY_VERSION matches the Ruby version in .ruby-version\nARG RUBY_VERSION=3.3.5\nFROM docker.io/library/ruby:$RUBY_VERSION-slim AS base\n\n# Rails app lives here\nWORKDIR /rails\n\n# Install base packages\nRUN apt-get update -qq &amp;&amp; \\\n    apt-get install --no-install-recommends -y curl libjemalloc2 libvips sqlite3 &amp;&amp; \\\n    rm -rf /var/lib/apt/lists /var/cache/apt/archives\n\n# Set production environment\nENV RAILS_ENV=&quot;production&quot; \\\n    BUNDLE_DEPLOYMENT=&quot;1&quot; \\\n    BUNDLE_PATH=&quot;/usr/local/bundle&quot; \\\n    BUNDLE_WITHOUT=&quot;development&quot;\n\n# Throw-away build stage to reduce size of final image\nFROM base AS build\n\n# Install packages needed to build gems and node modules\nRUN apt-get update -qq &amp;&amp; \\\n    apt-get install --no-install-recommends -y build-essential git node-gyp pkg-config python-is-python3 &amp;&amp; \\\n    rm -rf /var/lib/apt/lists /var/cache/apt/archives\n\n# Install JavaScript dependencies\nARG NODE_VERSION=22.9.0\nARG YARN_VERSION=3.3.1\nENV PATH=/usr/local/node/bin:$PATH\nRUN curl -sL https://github.com/nodenv/node-build/archive/master.tar.gz | tar xz -C /tmp/ &amp;&amp; \\\n    /tmp/node-build-master/bin/node-build &quot;${NODE_VERSION}&quot; /usr/local/node &amp;&amp; \\\n    npm install -g yarn@$YARN_VERSION &amp;&amp; \\\n    rm -rf /tmp/node-build-master\n\n# Install application gems\nCOPY Gemfile Gemfile.lock ./\nRUN bundle install &amp;&amp; \\\n    rm -rf ~/.bundle/ &quot;${BUNDLE_PATH}&quot;/ruby/*/cache &quot;${BUNDLE_PATH}&quot;/ruby/*/bundler/gems/*/.git &amp;&amp; \\\n    bundle exec bootsnap precompile --gemfile\n\n# Install node modules\nCOPY package.json yarn.lock ./\nRUN yarn install --frozen-lockfile\n\n# Copy application code\nCOPY . .\n\n# Precompile bootsnap code for faster boot times\nRUN bundle exec bootsnap precompile app/ lib/\n\n# Precompiling assets for production without requiring secret RAILS_MASTER_KEY\nRUN SECRET_KEY_BASE_DUMMY=1 ./bin/rails assets:precompile\n\n\nRUN rm -rf node_modules\n\n\n# Final stage for app image\nFROM base\n\n# Copy built artifacts: gems, application\nCOPY --from=build &quot;${BUNDLE_PATH}&quot; &quot;${BUNDLE_PATH}&quot;\nCOPY --from=build /rails /rails\n\n# Run and own only the runtime files as a non-root user for security\nRUN groupadd --system --gid 1000 rails &amp;&amp; \\\n    useradd rails --uid 1000 --gid 1000 --create-home --shell /bin/bash &amp;&amp; \\\n    chown -R rails:rails db log storage tmp\nUSER 1000:1000\n\n# Entrypoint prepares the database.\nENTRYPOINT [&quot;/rails/bin/docker-entrypoint&quot;]\n\n# Start server via Thruster by default, this can be overwritten at runtime\nEXPOSE 80\nCMD [&quot;./bin/thrust&quot;, &quot;./bin/rails&quot;, &quot;server&quot;]\n\"><pre class=\"notranslate\"><span class=\"pl-c\"><span class=\"pl-c\">#</span> syntax=docker/dockerfile:1</span>\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> check=error=true</span>\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> This Dockerfile is designed for production, not development. Use with Kamal or build'n'run by hand:</span>\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> docker build -t fix_yarn .</span>\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> docker run -d -p 80:80 -e RAILS_MASTER_KEY=&lt;value from config/master.key&gt; --name fix_yarn fix_yarn</span>\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> For a containerized dev environment, see Dev Containers: https://guides.rubyonrails.org/getting_started_with_devcontainer.html</span>\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Make sure RUBY_VERSION matches the Ruby version in .ruby-version</span>\n<span class=\"pl-k\">ARG</span> RUBY_VERSION=3.3.5\n<span class=\"pl-k\">FROM</span> docker.io/library/ruby:$RUBY_VERSION-slim AS base\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Rails app lives here</span>\n<span class=\"pl-k\">WORKDIR</span> /rails\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Install base packages</span>\n<span class=\"pl-k\">RUN</span> apt-get update -qq &amp;&amp; \\\n    apt-get install --no-install-recommends -y curl libjemalloc2 libvips sqlite3 &amp;&amp; \\\n    rm -rf /var/lib/apt/lists /var/cache/apt/archives\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Set production environment</span>\n<span class=\"pl-k\">ENV</span> RAILS_ENV=<span class=\"pl-s\">\"production\"</span> \\\n    BUNDLE_DEPLOYMENT=<span class=\"pl-s\">\"1\"</span> \\\n    BUNDLE_PATH=<span class=\"pl-s\">\"/usr/local/bundle\"</span> \\\n    BUNDLE_WITHOUT=<span class=\"pl-s\">\"development\"</span>\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Throw-away build stage to reduce size of final image</span>\n<span class=\"pl-k\">FROM</span> base AS build\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Install packages needed to build gems and node modules</span>\n<span class=\"pl-k\">RUN</span> apt-get update -qq &amp;&amp; \\\n    apt-get install --no-install-recommends -y build-essential git node-gyp pkg-config python-is-python3 &amp;&amp; \\\n    rm -rf /var/lib/apt/lists /var/cache/apt/archives\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Install JavaScript dependencies</span>\n<span class=\"pl-k\">ARG</span> NODE_VERSION=22.9.0\n<span class=\"pl-k\">ARG</span> YARN_VERSION=3.3.1\n<span class=\"pl-k\">ENV</span> PATH=/usr/local/node/bin:$PATH\n<span class=\"pl-k\">RUN</span> curl -sL https://github.com/nodenv/node-build/archive/master.tar.gz | tar xz -C /tmp/ &amp;&amp; \\\n    /tmp/node-build-master/bin/node-build <span class=\"pl-s\">\"${NODE_VERSION}\"</span> /usr/local/node &amp;&amp; \\\n    npm install -g yarn@$YARN_VERSION &amp;&amp; \\\n    rm -rf /tmp/node-build-master\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Install application gems</span>\n<span class=\"pl-k\">COPY</span> Gemfile Gemfile.lock ./\n<span class=\"pl-k\">RUN</span> bundle install &amp;&amp; \\\n    rm -rf ~/.bundle/ <span class=\"pl-s\">\"${BUNDLE_PATH}\"</span>/ruby/*/cache <span class=\"pl-s\">\"${BUNDLE_PATH}\"</span>/ruby/*/bundler/gems/*/.git &amp;&amp; \\\n    bundle exec bootsnap precompile --gemfile\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Install node modules</span>\n<span class=\"pl-k\">COPY</span> package.json yarn.lock ./\n<span class=\"pl-k\">RUN</span> yarn install --frozen-lockfile\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Copy application code</span>\n<span class=\"pl-k\">COPY</span> . .\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Precompile bootsnap code for faster boot times</span>\n<span class=\"pl-k\">RUN</span> bundle exec bootsnap precompile app/ lib/\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Precompiling assets for production without requiring secret RAILS_MASTER_KEY</span>\n<span class=\"pl-k\">RUN</span> SECRET_KEY_BASE_DUMMY=1 ./bin/rails assets:precompile\n\n\n<span class=\"pl-k\">RUN</span> rm -rf node_modules\n\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Final stage for app image</span>\n<span class=\"pl-k\">FROM</span> base\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Copy built artifacts: gems, application</span>\n<span class=\"pl-k\">COPY</span> --from=build <span class=\"pl-s\">\"${BUNDLE_PATH}\"</span> <span class=\"pl-s\">\"${BUNDLE_PATH}\"</span>\n<span class=\"pl-k\">COPY</span> --from=build /rails /rails\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Run and own only the runtime files as a non-root user for security</span>\n<span class=\"pl-k\">RUN</span> groupadd --system --gid 1000 rails &amp;&amp; \\\n    useradd rails --uid 1000 --gid 1000 --create-home --shell /bin/bash &amp;&amp; \\\n    chown -R rails:rails db log storage tmp\n<span class=\"pl-k\">USER</span> 1000:1000\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Entrypoint prepares the database.</span>\n<span class=\"pl-k\">ENTRYPOINT</span> [<span class=\"pl-s\">\"/rails/bin/docker-entrypoint\"</span>]\n\n<span class=\"pl-c\"><span class=\"pl-c\">#</span> Start server via Thruster by default, this can be overwritten at runtime</span>\n<span class=\"pl-k\">EXPOSE</span> 80\n<span class=\"pl-k\">CMD</span> [<span class=\"pl-s\">\"./bin/thrust\"</span>, <span class=\"pl-s\">\"./bin/rails\"</span>, <span class=\"pl-s\">\"server\"</span>]\n</pre></div>\n<p dir=\"auto\"><strong>The failure :</strong></p>\n<details>\n<summary>Details</summary>\n<div class=\"highlight highlight-source-red notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"#11 [build  2/10] RUN curl -sL https://github.com/nodenv/node-build/archive/master.tar.gz | tar xz -C /tmp/ &amp;&amp;     /tmp/node-build-master/bin/node-build &quot;22.9.0&quot; /usr/local/node &amp;&amp;     npm install -g yarn@3.3.1 &amp;&amp;     rm -rf /tmp/node-build-master\n#11 1.522 To follow progress, use 'tail -f /tmp/node-build.20241004094359.13.log' or pass --verbose\n#11 1.619 Downloading node-v22.9.0-linux-x64.tar.gz...\n#11 1.619 -&gt; https://nodejs.org/dist/v22.9.0/node-v22.9.0-linux-x64.tar.gz\n#11 13.82 Installing node-v22.9.0-linux-x64...\n#11 21.34 Installed node-v22.9.0-linux-x64 to /usr/local/node\n#11 21.34 \n#11 23.34 npm error code ETARGET\n#11 23.34 npm error notarget No matching version found for yarn@3.3.1.\n#11 23.34 npm error notarget In most cases you or one of your dependencies are requesting\n#11 23.34 npm error notarget a package version that doesn't exist.\n#11 23.35 npm notice\n#11 23.35 npm notice New minor version of npm available! 10.8.3 -&gt; 10.9.0\n#11 23.35 npm notice Changelog: https://github.com/npm/cli/releases/tag/v10.9.0\n#11 23.35 npm notice To update run: npm install -g npm@10.9.0\n#11 23.35 npm notice\n#11 23.35 npm error A complete log of this run can be found in: /root/.npm/_logs/2024-10-04T09_44_19_632Z-debug-0.log\n#11 ERROR: process &quot;/bin/sh -c curl -sL https://github.com/nodenv/node-build/archive/master.tar.gz | tar xz -C /tmp/ &amp;&amp;     /tmp/node-build-master/bin/node-build \\&quot;${NODE_VERSION}\\&quot; /usr/local/node &amp;&amp;     npm install -g yarn@$YARN_VERSION &amp;&amp;     rm -rf /tmp/node-build-master&quot; did not complete successfully: exit code: 1\n------\n &gt; [build  2/10] RUN curl -sL https://github.com/nodenv/node-build/archive/master.tar.gz | tar xz -C /tmp/ &amp;&amp;     /tmp/node-build-master/bin/node-build &quot;22.9.0&quot; /usr/local/node &amp;&amp;     npm install -g yarn@3.3.1 &amp;&amp;     rm -rf /tmp/node-build-master:\n23.34 npm error code ETARGET\n23.34 npm error notarget No matching version found for yarn@3.3.1.\n23.34 npm error notarget In most cases you or one of your dependencies are requesting\n23.34 npm error notarget a package version that doesn't exist.\n23.35 npm notice\n23.35 npm notice New minor version of npm available! 10.8.3 -&gt; 10.9.0\n23.35 npm notice Changelog: https://github.com/npm/cli/releases/tag/v10.9.0\n23.35 npm notice To update run: npm install -g npm@10.9.0\n23.35 npm notice\n23.35 npm error A complete log of this run can be found in: /root/.npm/_logs/2024-10-04T09_44_19_632Z-debug-0.log\n------\nDockerfile:40\n--------------------\n  39 |     ENV PATH=/usr/local/node/bin:$PATH\n  40 | &gt;&gt;&gt; RUN curl -sL https://github.com/nodenv/node-build/archive/master.tar.gz | tar xz -C /tmp/ &amp;&amp; \\\n  41 | &gt;&gt;&gt;     /tmp/node-build-master/bin/node-build &quot;${NODE_VERSION}&quot; /usr/local/node &amp;&amp; \\\n  42 | &gt;&gt;&gt;     npm install -g yarn@$YARN_VERSION &amp;&amp; \\\n  43 | &gt;&gt;&gt;     rm -rf /tmp/node-build-master\n  44 |     \n--------------------\nERROR: failed to solve: process &quot;/bin/sh -c curl -sL https://github.com/nodenv/node-build/archive/master.tar.gz | tar xz -C /tmp/ &amp;&amp;     /tmp/node-build-master/bin/node-build \\&quot;${NODE_VERSION}\\&quot; /usr/local/node &amp;&amp;     npm install -g yarn@$YARN_VERSION &amp;&amp;     rm -rf /tmp/node-build-master&quot; did not complete successfully: exit code: 1\"><pre class=\"notranslate\"><span class=\"pl-s\">#11</span> [build  <span class=\"pl-c1\">2</span><span class=\"pl-k\">/10</span>] RUN curl -sL <span class=\"pl-s\">https://github.com/nodenv/node-build/archive/master.tar.gz</span> | tar xz -C <span class=\"pl-k\">/tmp/</span> &amp;&amp;     <span class=\"pl-k\">/tmp/node-build-master/bin/node-build</span> <span class=\"pl-s\">\"22.9.0\"</span> <span class=\"pl-k\">/usr/local/node</span> &amp;&amp;     npm install -g <span class=\"pl-s\">yarn@3.3.1</span> &amp;&amp;     rm -rf <span class=\"pl-k\">/tmp/node-build-master</span>\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">1.522</span> To follow progress, <span class=\"pl-c1\">use</span> 'tail -f <span class=\"pl-k\">/tmp/node-build.20241004094359.13.log'</span> <span class=\"pl-k\">or</span> pass --verbose\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">1.619</span> Downloading node-v22.9.0-linux-x64.tar.gz...\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">1.619</span> -<span class=\"pl-k\">&gt;</span> <span class=\"pl-s\">https://nodejs.org/dist/v22.9.0/node-v22.9.0-linux-x64.tar.gz</span>\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">13.82</span> Installing node-v22.9.0-linux-x64...\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">21.34</span> Installed node-v22.9.0-linux-x64 <span class=\"pl-c1\">to</span> <span class=\"pl-k\">/usr/local/node</span>\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">21.34</span> \n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">23.34</span> npm error code ETARGET\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">23.34</span> npm error notarget No matching version found <span class=\"pl-c1\">for</span> <span class=\"pl-s\">yarn@3.3.1.</span>\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">23.34</span> npm error notarget <span class=\"pl-c1\">In</span> most cases you <span class=\"pl-k\">or</span> one of your dependencies are requesting\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">23.34</span> npm error notarget a package version that doesn't exist.\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">23.35</span> npm notice\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">23.35</span> npm notice New minor version of npm <span class=\"pl-c1\">available!</span> 10.8.3 -<span class=\"pl-k\">&gt;</span> 10.9.0\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">23.35</span> npm notice <span class=\"pl-c1\">Changelog:</span> <span class=\"pl-s\">https://github.com/npm/cli/releases/tag/v10.9.0</span>\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">23.35</span> npm notice To <span class=\"pl-c1\">update</span> <span class=\"pl-c1\">run:</span> npm install -g <span class=\"pl-s\">npm@10.9.0</span>\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">23.35</span> npm notice\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">23.35</span> npm error A complete log of this run can be found <span class=\"pl-c1\">in:</span> <span class=\"pl-k\">/root/.npm/_logs/2024-10-04T09_44_19_632Z-debug-0.log</span>\n<span class=\"pl-s\">#11</span> <span class=\"pl-c1\">ERROR:</span> process <span class=\"pl-s\">\"/bin/sh -c curl -sL https://github.com/nodenv/node-build/archive/master.tar.gz | tar xz -C /tmp/ &amp;&amp;     /tmp/node-build-master/bin/node-build \\\"</span>$<span class=\"pl-s\">{NODE_VERSION}</span>\\<span class=\"pl-s\">\" /usr/local/node &amp;&amp;     npm install -g yarn@$YARN_VERSION &amp;&amp;     rm -rf /tmp/node-build-master\"</span> did <span class=\"pl-c1\">not</span> complete <span class=\"pl-c1\">successfully:</span> <span class=\"pl-k\">exit</span> <span class=\"pl-c1\">code:</span> <span class=\"pl-c1\">1</span>\n------\n <span class=\"pl-k\">&gt;</span> [build  <span class=\"pl-c1\">2</span><span class=\"pl-k\">/10</span>] RUN curl -sL <span class=\"pl-s\">https://github.com/nodenv/node-build/archive/master.tar.gz</span> | tar xz -C <span class=\"pl-k\">/tmp/</span> &amp;&amp;     <span class=\"pl-k\">/tmp/node-build-master/bin/node-build</span> <span class=\"pl-s\">\"22.9.0\"</span> <span class=\"pl-k\">/usr/local/node</span> &amp;&amp;     npm install -g <span class=\"pl-s\">yarn@3.3.1</span> &amp;&amp;     rm -rf <span class=\"pl-k\">/tmp/node-build-master:</span>\n<span class=\"pl-c1\">23.34</span> npm error code ETARGET\n<span class=\"pl-c1\">23.34</span> npm error notarget No matching version found <span class=\"pl-c1\">for</span> <span class=\"pl-s\">yarn@3.3.1.</span>\n<span class=\"pl-c1\">23.34</span> npm error notarget <span class=\"pl-c1\">In</span> most cases you <span class=\"pl-k\">or</span> one of your dependencies are requesting\n<span class=\"pl-c1\">23.34</span> npm error notarget a package version that doesn't exist.\n<span class=\"pl-c1\">23.35</span> npm notice\n<span class=\"pl-c1\">23.35</span> npm notice New minor version of npm <span class=\"pl-c1\">available!</span> 10.8.3 -<span class=\"pl-k\">&gt;</span> 10.9.0\n<span class=\"pl-c1\">23.35</span> npm notice <span class=\"pl-c1\">Changelog:</span> <span class=\"pl-s\">https://github.com/npm/cli/releases/tag/v10.9.0</span>\n<span class=\"pl-c1\">23.35</span> npm notice To <span class=\"pl-c1\">update</span> <span class=\"pl-c1\">run:</span> npm install -g <span class=\"pl-s\">npm@10.9.0</span>\n<span class=\"pl-c1\">23.35</span> npm notice\n<span class=\"pl-c1\">23.35</span> npm error A complete log of this run can be found <span class=\"pl-c1\">in:</span> <span class=\"pl-k\">/root/.npm/_logs/2024-10-04T09_44_19_632Z-debug-0.log</span>\n------\n<span class=\"pl-s\">Dockerfile:40</span>\n--------------------\n  <span class=\"pl-c1\">39</span> |     ENV <span class=\"pl-c1\">PATH=/usr/local/node/bin:</span>$PATH\n  <span class=\"pl-c1\">40</span> | <span class=\"pl-k\">&gt;&gt;&gt;</span> RUN curl -sL <span class=\"pl-s\">https://github.com/nodenv/node-build/archive/master.tar.gz</span> | tar xz -C <span class=\"pl-k\">/tmp/</span> &amp;&amp; \\\n  <span class=\"pl-c1\">41</span> | <span class=\"pl-k\">&gt;&gt;&gt;</span>     <span class=\"pl-k\">/tmp/node-build-master/bin/node-build</span> <span class=\"pl-s\">\"${NODE_VERSION}\"</span> <span class=\"pl-k\">/usr/local/node</span> &amp;&amp; \\\n  <span class=\"pl-c1\">42</span> | <span class=\"pl-k\">&gt;&gt;&gt;</span>     npm install -g <span class=\"pl-s\">yarn@$YARN_VERSION</span> &amp;&amp; \\\n  <span class=\"pl-c1\">43</span> | <span class=\"pl-k\">&gt;&gt;&gt;</span>     rm -rf <span class=\"pl-k\">/tmp/node-build-master</span>\n  <span class=\"pl-c1\">44</span> |     \n--------------------\n<span class=\"pl-c1\">ERROR:</span> failed <span class=\"pl-c1\">to</span> <span class=\"pl-c1\">solve:</span> process <span class=\"pl-s\">\"/bin/sh -c curl -sL https://github.com/nodenv/node-build/archive/master.tar.gz | tar xz -C /tmp/ &amp;&amp;     /tmp/node-build-master/bin/node-build \\\"</span>$<span class=\"pl-s\">{NODE_VERSION}</span>\\<span class=\"pl-s\">\" /usr/local/node &amp;&amp;     npm install -g yarn@$YARN_VERSION &amp;&amp;     rm -rf /tmp/node-build-master\"</span> did <span class=\"pl-c1\">not</span> complete <span class=\"pl-c1\">successfully:</span> <span class=\"pl-k\">exit</span> <span class=\"pl-c1\">code:</span> <span class=\"pl-c1\">1</span></pre></div>\n</details>\nSo, I dig the yarn documentation and found why `npm install -g yarn@3.3.1 &amp;&amp;` fail.\nBecause Yarn &gt; 1.x.x isn't installable through NPM since 2019. \n<p dir=\"auto\">Extract from Yarn documentation :<br>\n<a href=\"https://yarnpkg.com/getting-started/qa#why-is-the-yarn-package-on-npm-still-on-1x\" rel=\"nofollow\">Why is the yarn package on npm still on 1.x?</a></p>\n<blockquote>\n<p dir=\"auto\">Why is the yarn package on npm still on 1.x?</p>\n<p dir=\"auto\">Modern releases of Yarn haven't been distributed on npm since 2019.</p>\n<p dir=\"auto\">The reason is simple: because Yarn wasn't distributed alongside Node.js, many people relied on something like npm install -g yarn as part of their image building. It meant that any breaking change would make their way on everyone using this pattern, and break their deployments.</p>\n<p dir=\"auto\">As a result, we decided to retire the yarn npm package and only use it for the few 1.x maintenance releases needed. Yarn is now installed directly from our website, via either Corepack or yarn set version.\"</p>\n</blockquote>\n<p dir=\"auto\">After this fix, Yarn warns us that <code class=\"notranslate\">--frozen-lockfile</code> is deprecated, so I've replaced it with <code class=\"notranslate\">--immutable</code>.</p>\n\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>This Pull Request changes add a method in the app generator to check if the yarn version need installation through Corepack instead of NPM (&gt;1.x.x).</li>\n<li>The yarn flag <code class=\"notranslate\">--frozen-lockfile</code> is deprecated, so I've replaced it with <code class=\"notranslate\">--immutable</code></li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">As it's my first rails PR, I'm sorry if this fix isn't relevant.</p>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53174",
            "title": "[Dockerfile] Fix yarn installation method for yarn > 1.x.x",
            "date_modified": "2024-10-04T10:06:00.000Z",
            "date_published": "2024-10-04T10:05:56.000Z",
            "author": {
                "name": "BarnabeD",
                "url": "https://github.com/BarnabeD"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Follow up to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2563418980\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/53160\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/53160/hovercard\" href=\"https://github.com/rails/rails/pull/53160\">#53160</a></p>\n<p dir=\"auto\">Technically this is a behavior change so adding a changelog and tests to prevent regressions.</p>\n<p dir=\"auto\">That change was also backported to 7.2, so this can be too.</p>",
            "url": "https://github.com/rails/rails/pull/53169",
            "title": "Add tests and changelog for \"Fix log level of ActiveJob :retry_stopped event\"",
            "date_modified": "2024-10-04T16:25:23.000Z",
            "date_published": "2024-10-04T05:50:34.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/12413247?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request addresses the issue of caching bundler dependencies in a Dev Container setup, which can significantly speed up container startup times by avoiding the need to reinstall gems on every new container creation.</p>\n<p dir=\"auto\">It is a follow-up to an existing PR (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2557605519\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/53123\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/53123/hovercard\" href=\"https://github.com/rails/rails/pull/53123\">#53123</a>) by <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/patriciomacadden/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/patriciomacadden\">@patriciomacadden</a>, which introduced a similar feature using <code class=\"notranslate\">ghcr.io/rails/devcontainer/features/bundler-cache</code>.</p>\n<p dir=\"auto\">However, as discussed in that PR, my approach offers a simpler solution by directly mounting a volume for the <code class=\"notranslate\">.rbenv</code> directory, which includes bundler dependencies. This implementation minimizes additional configuration while still solving the problem effectively.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the <code class=\"notranslate\">devcontainer.json</code> configuration by adding a volume that caches the <code class=\"notranslate\">.rbenv</code> directory.</p>\n<h3 dir=\"auto\">Additional Information</h3>\n<p dir=\"auto\">For more context, please refer to my related PR in an example Rails app repository: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2561168912\" data-permission-text=\"Title is private\" data-url=\"https://github.com/viktorianer/rails8-devcontainer-enhancements/issues/13\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/viktorianer/rails8-devcontainer-enhancements/pull/13/hovercard\" href=\"https://github.com/viktorianer/rails8-devcontainer-enhancements/pull/13\">viktorianer/rails8-devcontainer-enhancements#13</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53161",
            "title": "Add bundler-cache feature in dev container setup",
            "date_modified": "2024-10-04T22:22:09.000Z",
            "date_published": "2024-10-03T10:14:41.000Z",
            "author": {
                "name": "viktorianer",
                "url": "https://github.com/viktorianer"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Prior to this commit, <code class=\"notranslate\">:block</code> options only supported callables. This commit aims to bring browser blocking closer in parity to callbacks declarations like <code class=\"notranslate\">before_action</code> and <code class=\"notranslate\">after_action</code> by supporting instance method names as well.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/53158",
            "title": "AllowBrowser: support method names for `:block`",
            "date_modified": "2024-10-05T00:41:45.000Z",
            "date_published": "2024-10-03T01:37:46.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        }
    ]
}