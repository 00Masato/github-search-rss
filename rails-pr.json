{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5162312?u=e1b3c0f7c6dc600253bf15c99f618b9b2d39c500&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Integration tests use the integration session to access URL helpers. The method_missing in routing assertions is only for controller tests, so let's just move it there.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because this method had a TODO on it that looks out of date to me.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request moves the method_missing on the route assertions module to <code class=\"notranslate\">ActionController::TestCase</code>. Integration tests already delegate to the <code class=\"notranslate\">integration_session</code> route helpers here: </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/421df52bf859120371b82a67529fee20e1f548f8/actionpack/lib/action_dispatch/testing/integration.rb#L436\">rails/actionpack/lib/action_dispatch/testing/integration.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 436\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/421df52bf859120371b82a67529fee20e1f548f8\">421df52</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L436\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"436\"></td>\n          <td id=\"LC436\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">integration_session</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">public_send</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">method</span><span class=\"pl-kos\">,</span> *<span class=\"pl-s1\">args</span><span class=\"pl-kos\">,</span> &amp;<span class=\"pl-s1\">block</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">tap</span> <span class=\"pl-k\">do</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n <div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/421df52bf859120371b82a67529fee20e1f548f8/actionpack/lib/action_dispatch/testing/integration.rb#L358\">rails/actionpack/lib/action_dispatch/testing/integration.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 358\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/421df52bf859120371b82a67529fee20e1f548f8\">421df52</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L358\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"358\"></td>\n          <td id=\"LC358\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">include</span> <span class=\"pl-s1\">app</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">routes</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">url_helpers</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The method_missing I moved might be public API, but I think we only expect it to be used in a controller test context, right? Integration tests include routing assertions to the <a href=\"https://github.com/rails/rails/blob/421df52bf859120371b82a67529fee20e1f548f8/actionpack/lib/action_dispatch/testing/integration.rb#L93\">integration session</a>. Regardless of if we choose to move the method_missing, we can probably better test this behaviour to make sure it doesn't regress.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49821",
            "title": "Move route helper method_missing to ActionController::TestCase",
            "date_modified": "2023-10-28T01:06:10.000Z",
            "date_published": "2023-10-28T01:04:31.000Z",
            "author": {
                "name": "gmcgibbon",
                "url": "https://github.com/gmcgibbon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5162312?u=e1b3c0f7c6dc600253bf15c99f618b9b2d39c500&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Adds support for <code class=\"notranslate\">with_routing</code> test helpers in <code class=\"notranslate\">ActionDispatch::IntegrationTest</code>. Previously, this helper didn't work in an integration context (only for <code class=\"notranslate\">ActionController::TestCase</code>) because the rack app and integration session under test were not mutated. Because controller tests are integration tests by default, we should support test routes for these kinds of test cases as well.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because I needed to use with_routing in an integration test, and <a href=\"https://gist.github.com/gmcgibbon/23648062f6e5a55436b5df0799525996\">it doesn't seem to work</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes routing assertions in integration tests by including <code class=\"notranslate\">ActionDispatch::Assertions::RoutingAssertions::WithIntegrationRouting</code> which overrides the standard <code class=\"notranslate\">with_routing</code> machinery to mutate the app under test and integration session.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I used a shared test module approach for the existing routing assertion tests so that we can test the same way in controller and integration tests.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49819",
            "title": "Make with_routing test helper work for integration tests",
            "date_modified": "2023-10-27T22:01:02.000Z",
            "date_published": "2023-10-27T21:56:05.000Z",
            "author": {
                "name": "gmcgibbon",
                "url": "https://github.com/gmcgibbon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Implementations of the method are exactly the same for trilogy and mysql2 adapters so we will benefit from it being explicitly shared from the abstract mysql adapter</p>\n<p dir=\"auto\">It is close to being a cosmetic change but I think it's an important one to make. We can anticipate many applications to migrate from <code class=\"notranslate\">mysql2</code> to <code class=\"notranslate\">trilogy</code> and in case of any issues developers may potentially be looking into differences between mysql2 and trilogy adapters. Having two exact the same methods in both trilogy and mysql2 doesn't help with debugging and having it in the common class clearly indicates that the behavior is the same</p>\n<h3 dir=\"auto\">PostgreSQL</h3>\n<p dir=\"auto\">To be fair postgresql adapter has exactly the same implementation but I didn't feel confident moving it further to the abstract adapter since I don't think it's an implementation that fits any potential adapter.<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/403447d06165b0e9a13f0942f11b97e2f9d426b8/activerecord/lib/active_record/connection_adapters/postgresql/quoting.rb#L74-L78\">rails/activerecord/lib/active_record/connection_adapters/postgresql/quoting.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 74 to 78\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/403447d06165b0e9a13f0942f11b97e2f9d426b8\">403447d</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L74\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"74\"></td>\n          <td id=\"LC74\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">quote_string</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">s</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\"># :nodoc:</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L75\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"75\"></td>\n          <td id=\"LC75\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">with_raw_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">allow_retry</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">materialize_transactions</span>: <span class=\"pl-c1\">false</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">connection</span>| </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L76\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"76\"></td>\n          <td id=\"LC76\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">escape</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">s</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L77\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"77\"></td>\n          <td id=\"LC77\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">end</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L78\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"78\"></td>\n          <td id=\"LC78\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Also moving it to the abstract adapter would make the <code class=\"notranslate\">Quoting#quote_string</code> method unused, if I'm following it correctly:<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/403447d06165b0e9a13f0942f11b97e2f9d426b8/activerecord/lib/active_record/connection_adapters/abstract/quoting.rb#L88-L90\">rails/activerecord/lib/active_record/connection_adapters/abstract/quoting.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 88 to 90\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/403447d06165b0e9a13f0942f11b97e2f9d426b8\">403447d</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L88\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"88\"></td>\n          <td id=\"LC88\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">quote_string</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">s</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L89\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"89\"></td>\n          <td id=\"LC89\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">s</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-cce\">\\\\</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'\\&amp;\\&amp;'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">gsub</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"'\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"''\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\"># ' (for ruby-mode)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L90\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"90\"></td>\n          <td id=\"LC90\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>",
            "url": "https://github.com/rails/rails/pull/49817",
            "title": "Move `quote_string` from trilogy and mysql2 adapters to abstract mysql adapter",
            "date_modified": "2023-10-27T20:59:17.000Z",
            "date_published": "2023-10-27T20:38:31.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Currently when we <code class=\"notranslate\">_create_record</code> or <code class=\"notranslate\">destroy_row</code> we have to iterate over the list of <code class=\"notranslate\">_reflections</code> and find the ones that are <code class=\"notranslate\">belongs_to</code> type and have a <code class=\"notranslate\">counter_cache_column</code>. This is ineficient as we don't expect the result of this selection to change during runtime. To make it prettier and more efficient we will prebuild a list of associations that have a counter cache column.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I have two reasons to implement this change</p>\n<ol dir=\"auto\">\n<li>It will unblock <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1964409838\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49801\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49801/hovercard\" href=\"https://github.com/rails/rails/pull/49801\">#49801</a> . I'd like to introduce an <code class=\"notranslate\">alias_association</code> feature which will populate <code class=\"notranslate\">_reflections</code> mapping with duplicated reflections under different keys (aliases) and the current approach relies on <code class=\"notranslate\">_reflections</code> to be unique</li>\n<li>Instead of trying to address the \"uniqueness\" problem I'd like to also improve the performance of this particular piece. It seems inefficient to iterate over the same <code class=\"notranslate\">_reflections</code> hash again and again and performing the same checks to get the same result for a given model class. It would be much better to have the list we are interested in prebuilt and ready for use.</li>\n</ol>\n<p dir=\"auto\">Even though performance is not my ultimate goal and the main reason for this change is to unblock <code class=\"notranslate\">alias_association</code> here is the benchmark:</p>\n<details>\n<summary>Benchmark</summary>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"begin\n  require &quot;bundler/inline&quot;\nrescue LoadError =&gt; e\n  $stderr.puts &quot;Bundler version 1.10 or later is required. Please update your Bundler&quot;\n  raise e\nend\n\ngemfile(true) do\n  source &quot;https://rubygems.org&quot;\n  gem &quot;rails&quot;, path: &quot;.&quot;\n  gem &quot;sqlite3&quot;\n  gem &quot;benchmark-ips&quot;\n  gem &quot;debug&quot;\nend\n\nrequire &quot;active_record&quot;\nrequire &quot;benchmark/ips&quot;\n\nmodule ActiveRecord\n  module CounterCache\n    # legacy implementation\n    def each_counter_cached_associations\n      _reflections.each do |name, reflection|\n        yield association(name.to_sym) if reflection.belongs_to? &amp;&amp; reflection.counter_cache_column\n      end\n    end\n  end\nend\n\n\nActiveRecord::Base.establish_connection(adapter: &quot;sqlite3&quot;, database: &quot;:memory:&quot;)\nActiveRecord::Base.logger = Logger.new(STDOUT)\n\nActiveRecord::Schema.define do\n  create_table :users do |t|\n    t.string :first_name\n    t.string :last_name\n    t.integer :comments_count\n  end\n\n  create_table :comments do |t|\n    t.integer :user_id\n    t.text :body\n  end\nend\n\nclass User &lt; ActiveRecord::Base\nend\n\nclass Comment &lt; ActiveRecord::Base\n  belongs_to :user, counter_cache: true\nend\n\nuser = User.create!(first_name: &quot;Nikita&quot;, last_name: &quot;V&quot;)\nputs RUBY_DESCRIPTION\n\nlegacy_associations = []\nuser.send(:each_counter_cached_associations) { |assoc| legacy_associations &lt;&lt; assoc.name }\n\nnew_associations = User.counter_cached_association_names.each { |name| User.association(name) }\nraise if legacy_associations != new_associations\n\n\nBenchmark.ips do |x|\n  x.report(&quot;memoized counter_cache association names&quot;) do\n    User.counter_cached_association_names.each { |name| User.association(name) }\n  end\n\n  x.report(&quot;each_counter_cached_associations&quot;) do\n    user.send(:each_counter_cached_associations) do |assoc|\n      assoc # no need to do anything\n    end\n  end\n\n  x.compare!\nend\n\"><pre class=\"notranslate\"><span class=\"pl-k\">begin</span>\n  <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/inline\"</span>\n<span class=\"pl-k\">rescue</span> <span class=\"pl-v\">LoadError</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">e</span>\n  $stderr<span class=\"pl-kos\">.</span><span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Bundler version 1.10 or later is required. Please update your Bundler\"</span>\n  <span class=\"pl-en\">raise</span> <span class=\"pl-en\">e</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">\"https://rubygems.org\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"rails\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">path</span>: <span class=\"pl-s\">\".\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"sqlite3\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"benchmark-ips\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"debug\"</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_record\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"benchmark/ips\"</span>\n\n<span class=\"pl-k\">module</span> <span class=\"pl-v\">ActiveRecord</span>\n  <span class=\"pl-k\">module</span> <span class=\"pl-v\">CounterCache</span>\n    <span class=\"pl-c\"># legacy implementation</span>\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">each_counter_cached_associations</span>\n      <span class=\"pl-en\">_reflections</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">name</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">reflection</span>|\n        <span class=\"pl-k\">yield</span> <span class=\"pl-en\">association</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">name</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_sym</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">if</span> <span class=\"pl-s1\">reflection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">belongs_to?</span> &amp;&amp; <span class=\"pl-s1\">reflection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">counter_cache_column</span>\n      <span class=\"pl-k\">end</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">establish_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">adapter</span>: <span class=\"pl-s\">\"sqlite3\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">database</span>: <span class=\"pl-s\">\":memory:\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Schema</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">define</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:users</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:first_name</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:last_name</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">integer</span> <span class=\"pl-pds\">:comments_count</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:comments</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">integer</span> <span class=\"pl-pds\">:user_id</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">text</span> <span class=\"pl-pds\">:body</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">User</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Comment</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:user</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">counter_cache</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create!</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">first_name</span>: <span class=\"pl-s\">\"Nikita\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">last_name</span>: <span class=\"pl-s\">\"V\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-en\">puts</span> <span class=\"pl-c1\">RUBY_DESCRIPTION</span>\n\n<span class=\"pl-s1\">legacy_associations</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span>\n<span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">send</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:each_counter_cached_associations</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">assoc</span>| <span class=\"pl-s1\">legacy_associations</span> &lt;&lt; <span class=\"pl-s1\">assoc</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span> <span class=\"pl-kos\">}</span>\n\n<span class=\"pl-s1\">new_associations</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">counter_cached_association_names</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">name</span>| <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">association</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">name</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-en\">raise</span> <span class=\"pl-k\">if</span> <span class=\"pl-s1\">legacy_associations</span> != <span class=\"pl-s1\">new_associations</span>\n\n\n<span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"memoized counter_cache association names\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">counter_cached_association_names</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">name</span>| <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">association</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">name</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"each_counter_cached_associations\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">send</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:each_counter_cached_associations</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">assoc</span>|\n      <span class=\"pl-s1\">assoc</span> <span class=\"pl-c\"># no need to do anything</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">compare!</span>\n<span class=\"pl-k\">end</span></pre></div>\n</details>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Calculating -------------------------------------\nmemoized counter_cache association names\n                          9.143M (± 6.0%) i/s -     46.355M in   5.091984s\neach_counter_cached_associations\n                          3.401M (± 6.1%) i/s -     16.914M in   5.001597s\n\nComparison:\nmemoized counter_cache association names:  9142732.6 i/s\neach_counter_cached_associations:  3401378.9 i/s - 2.69x  slower\"><pre class=\"notranslate\"><code class=\"notranslate\">Calculating -------------------------------------\nmemoized counter_cache association names\n                          9.143M (± 6.0%) i/s -     46.355M in   5.091984s\neach_counter_cached_associations\n                          3.401M (± 6.1%) i/s -     16.914M in   5.001597s\n\nComparison:\nmemoized counter_cache association names:  9142732.6 i/s\neach_counter_cached_associations:  3401378.9 i/s - 2.69x  slower\n</code></pre></div>\n<h3 dir=\"auto\">What reviewers should focus on</h3>\n<p dir=\"auto\">Does it need a changelog entry?</p>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49815",
            "title": "Prebuild list of counter cache associations",
            "date_modified": "2023-10-27T20:18:50.000Z",
            "date_published": "2023-10-27T20:18:13.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/13696143?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1964535188\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49802\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49802/hovercard\" href=\"https://github.com/rails/rails/pull/49802\">#49802</a> (we may want both PRs)</p>\n<p dir=\"auto\">Prior to this commit <code class=\"notranslate\">with_raw_connection</code> would always mark the connection as <code class=\"notranslate\">@verified = true</code> after yielding it. But yielding a connection is not enough to determine that a connection is healthy. Marking a broken connection as verified can prevent further reconnects, leaving us with a broken connection for longer than expected.</p>\n<p dir=\"auto\">For example,</p>\n<ul dir=\"auto\">\n<li>Connection is broken and not verified</li>\n<li>Quote string succeeds, and marks the broken connection as verified</li>\n<li>Because the connection is verified, querying will not trigger a reconnect</li>\n<li>Query fails and the connection is no longer verified</li>\n<li>Repeat ad infinitum (or until we reach a query with <code class=\"notranslate\">allow_retry: true</code>, or one that isn't preceded by a call to quote string)</li>\n</ul>\n<p dir=\"auto\">This commit solves the problem by only marking the connection as verified if we have definitively exercised that connection. This is safer, but it does put more responsibility on each individual adapter. If a call to <code class=\"notranslate\">verified!</code> is missing things should still work OK, but we'll end up pinging the connection more to see if it is active.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a></p>",
            "url": "https://github.com/rails/rails/pull/49811",
            "title": "Prevent marking broken connections as verified",
            "date_modified": "2023-10-27T19:11:29.000Z",
            "date_published": "2023-10-27T15:19:19.000Z",
            "author": {
                "name": "composerinteralia",
                "url": "https://github.com/composerinteralia"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/32258?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The current Rails CSP uses <code class=\"notranslate\">report-uri</code> which is deprecated. There is a newer Reporting API which uses endpoints that can be references from the CSP policy using <code class=\"notranslate\">report-to</code>.</p>\n<p dir=\"auto\">For more info see <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/report-to\" rel=\"nofollow\">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/report-to</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Adds Reporting API endpoint to CSP policy using <code class=\"notranslate\">report-to</code>.</p>\n<p dir=\"auto\">This requires the Report-To HTTP header to be set manually. Example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"response.set_header('Report-To', '{&quot;group&quot;:&quot;csp-endpoint&quot;,&quot;max_age&quot;:31536000,&quot;endpoints&quot;:[{&quot;url&quot;:&quot;https://example.org/csp-endpoint&quot;}],&quot;include_subdomains&quot;:true}')\"><pre class=\"notranslate\"><code class=\"notranslate\">response.set_header('Report-To', '{\"group\":\"csp-endpoint\",\"max_age\":31536000,\"endpoints\":[{\"url\":\"https://example.org/csp-endpoint\"}],\"include_subdomains\":true}')\n</code></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This is my first PR to Rails so let me know if there is any improvement to be made. I wasn't sure whether to include info about the Report-To HTTP header in the docs or code.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49810",
            "title": "CSP Report-to reponse header field for browser Reporting API",
            "date_modified": "2023-10-27T14:20:53.000Z",
            "date_published": "2023-10-27T12:20:19.000Z",
            "author": {
                "name": "espen",
                "url": "https://github.com/espen"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>",
            "url": "https://github.com/rails/rails/pull/49804",
            "title": "[7-1-stable] Quiet deprecated cache_format_version = 6.1 warnings",
            "date_modified": "2023-10-27T05:11:54.000Z",
            "date_published": "2023-10-27T05:02:54.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>",
            "url": "https://github.com/rails/rails/pull/49803",
            "title": "Railties TestHelper remove_from_config should remove all occurrences",
            "date_modified": "2023-10-27T02:04:51.000Z",
            "date_published": "2023-10-27T02:04:47.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/13696143?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49781.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1961443092\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49781\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49781/hovercard\" href=\"https://github.com/rails/rails/issues/49781\">#49781</a></p>\n<p dir=\"auto\">Prior to this commit, the PostgreSQL adapter could end up holding onto a broken connection longer than expected, potentially <strong>into the next request after the executor checkin/checkout</strong>.</p>\n<p dir=\"auto\">The problem is that the PostgreSQL adapter was using <a href=\"https://github.com/rails/rails/blob/e33dbe1b3d423143685154b97ae0992f4ab821b8/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb#L910-L917\">two separate calls</a> to <code class=\"notranslate\">with_raw_connection</code>, one for preparing a statement and another for executing it. That's fine before the statement is added to the statement pool, but once it the statement exists the first call to <code class=\"notranslate\">with_raw_connection</code> <a href=\"https://github.com/rails/rails/blob/490b9fc22faefca30565a970a8727c915de589ff/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb#L964-L966\">does not actually use the connection</a>. But that doesn't stop us from marking the connection as <a href=\"https://github.com/rails/rails/blob/e33dbe1b3d423143685154b97ae0992f4ab821b8/activerecord/lib/active_record/connection_adapters/abstract_adapter.rb#L1032\"><code class=\"notranslate\">@verified</code></a>, thereby preventing the second <code class=\"notranslate\">with_raw_connection</code> from verifying and getting a chance to reconnect.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Post.first\n#=&gt; prepare_statement verifies the connection (if needed) and populates the statement pool\n#=&gt; exec_prepared succeeds\n\n#=&gt; Oops!, we lost the connection for whatever reason\n\nPost.first\n#=&gt; prepare_statement returns the statement from the statement pool, connection still marked as verified\n#=&gt; exec_prepared fails, marks the connection as unverified\n\nPost.first\n#=&gt; prepare_statement returns the statement from the statement pool, marks the connection as verified!!!\n#=&gt; exec_prepared fails, marks the connection as unverified\n\n#=&gt; request finishes, connection gets marked as unverified for the next request\n\nPost.first\n#=&gt; prepare_statement returns the statement from the statement pool, marks the connection as verified!!!\n#=&gt; exec_prepared fails, marks the connection as unverified\"><pre class=\"notranslate\"><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n<span class=\"pl-c\">#=&gt; prepare_statement verifies the connection (if needed) and populates the statement pool</span>\n<span class=\"pl-c\">#=&gt; exec_prepared succeeds</span>\n\n<span class=\"pl-c\">#=&gt; Oops!, we lost the connection for whatever reason</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n<span class=\"pl-c\">#=&gt; prepare_statement returns the statement from the statement pool, connection still marked as verified</span>\n<span class=\"pl-c\">#=&gt; exec_prepared fails, marks the connection as unverified</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n<span class=\"pl-c\">#=&gt; prepare_statement returns the statement from the statement pool, marks the connection as verified!!!</span>\n<span class=\"pl-c\">#=&gt; exec_prepared fails, marks the connection as unverified</span>\n\n<span class=\"pl-c\">#=&gt; request finishes, connection gets marked as unverified for the next request</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n<span class=\"pl-c\">#=&gt; prepare_statement returns the statement from the statement pool, marks the connection as verified!!!</span>\n<span class=\"pl-c\">#=&gt; exec_prepared fails, marks the connection as unverified</span></pre></div>\n<p dir=\"auto\">The only way to recover is to execute a statement that hasn't been prepared yet, one that isn't prepared because it has no binds, or one that has <code class=\"notranslate\">allow_retry: true</code> (which I think is limited to a few internal queries at the moment—we don't pass the value through to <code class=\"notranslate\">with_raw_connection</code> for prepared statements anyway).</p>\n<p dir=\"auto\">This commit fixes the problem by preparing and executing the statement within a single <code class=\"notranslate\">with_raw_connection</code> block. This is what the other adapters with prepared statements already do.</p>\n<p dir=\"auto\">It makes more sense this way—even if we managed to reconnect before executing the statement in the old code, we'd be referencing a prepared statement from a different connection, so it'd fail anyway. Having the prepare and execute in the same <code class=\"notranslate\">with_raw_connection</code> means if we do need to reconnect, we'll start from the beginning and prepare the statement again on the fresh connection.</p>\n<p dir=\"auto\">Note that this change does get rid of connection retries on preparing statements, but I think that's OK. It matches the other adapters, matches the Rails 7.0 behavior, and it's still better than ending up with a broken connection.</p>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49802",
            "title": "Recover from failed connections in PostgreSQL",
            "date_modified": "2023-10-27T15:20:18.000Z",
            "date_published": "2023-10-26T23:51:51.000Z",
            "author": {
                "name": "composerinteralia",
                "url": "https://github.com/composerinteralia"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Implements - <a href=\"https://discuss.rubyonrails.org/t/feature-proposal-alias-association/83439/4\" rel=\"nofollow\">https://discuss.rubyonrails.org/t/feature-proposal-alias-association/83439/4</a></p>\n<p dir=\"auto\">Rails 7.1 deprecated using <code class=\"notranslate\">alias_attribute</code> for anything other than an attribute. Many applications end up using <code class=\"notranslate\">alias_attribute</code> to alias associations and removing such usages would be challenging in many cases. Recognizing this, Rails introduces a new feature to alias associations called <code class=\"notranslate\">alias_association</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Given an alias like <code class=\"notranslate\">BlogPost.alias_association :author, :user</code> where <code class=\"notranslate\">author</code> is an alias and <code class=\"notranslate\">user</code> is the original association name of the <code class=\"notranslate\">belong_to :user</code> association the feature provides the following capabilities:</p>\n<h4 dir=\"auto\">Aliased association methods</h4>\n<p dir=\"auto\">Defines association reader and writer: <code class=\"notranslate\">BlogPost#author</code> and <code class=\"notranslate\">BlogPost#author=</code><br>\n(<code class=\"notranslate\">belongs_to</code> only) Defines <code class=\"notranslate\">build_#{assoc_name}</code> and <code class=\"notranslate\">create_#{assoc_name}</code> constructors: <code class=\"notranslate\">BlogPost#build_author</code>,  <code class=\"notranslate\">BlogPost#create_author</code> and <code class=\"notranslate\">BlogPost#create_author!</code><br>\n(<code class=\"notranslate\">belongs_to</code> only)  Defines change tracking methods: <code class=\"notranslate\">BlogPost#author_changed?</code> and <code class=\"notranslate\">BlogPost#author_previously_changed?</code></p>\n<h4 dir=\"auto\">Aliases support in <code class=\"notranslate\">where()</code> clauses</h4>\n<p dir=\"auto\"><code class=\"notranslate\">BlogPost.where(author: User.find_by(name: \"Nikita\")).to_a</code> #=&gt; searches by <code class=\"notranslate\">user_id</code></p>\n<h4 dir=\"auto\">Aliases support in <code class=\"notranslate\">includes()</code> clauses</h4>\n<p dir=\"auto\"><code class=\"notranslate\">BlogPost.all.includes(:author).to_a</code> # =&gt; preloads <code class=\"notranslate\">user</code> association</p>\n<h3 dir=\"auto\">Implementation details</h3>\n<h4 dir=\"auto\">Aliased association methods</h4>\n<p dir=\"auto\">A new <code class=\"notranslate\">define_association_methods </code> method was defined on <code class=\"notranslate\">ActiveRecord::Associations::Builder::Association</code> builder. Its job to define association-related instance methods. This method is being reused in the original <code class=\"notranslate\">build</code> method.<br>\n<code class=\"notranslate\">define_accessors</code>, <code class=\"notranslate\">define_change_tracking_methods</code> and all downstream methods now accept <code class=\"notranslate\">as:</code> to serve as a publicly facing name of the new methods while the method body itself will point to the original association.</p>\n<p dir=\"auto\">Since <code class=\"notranslate\">alias_association</code> methods needs to know which builder to use for method definition builders now self-register themselves into a registry using <code class=\"notranslate\">register_builder_for</code> method by providing a <code class=\"notranslate\">macro</code> which later can be used to fetch the builder for a given reflection.</p>\n<h4 dir=\"auto\">Aliases support in <code class=\"notranslate\">where()</code> clauses</h4>\n<p dir=\"auto\">To support aliased association names in <code class=\"notranslate\">where()</code> clauses we introduced <code class=\"notranslate\">querying_aliases</code> storage which will serve as a registry of aliases for both associations and attributes. This way we can avoid checking two places (attribute aliases &amp; association aliases) when processing <code class=\"notranslate\">where()</code> arguments.</p>\n<h4 dir=\"auto\">Aliases support in <code class=\"notranslate\">includes()</code> clauses</h4>\n<p dir=\"auto\">To support aliases in <code class=\"notranslate\">includes()</code> (and most likely more capabilities that look into the <code class=\"notranslate\">_reflections</code> hash) we register the same reflection under the new name<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/8917147631838b5c5b85240a61027b39f3adbde2/activerecord/lib/active_record/associations.rb#L1900\">rails/activerecord/lib/active_record/associations.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 1900\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/8917147631838b5c5b85240a61027b39f3adbde2\">8917147</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L1900\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1900\"></td>\n          <td id=\"LC1900\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">Reflection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">add_reflection</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">new_name</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">existing_reflection</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The capabilities this feature provides are pretty standalone and could be extracted or completely descoped from this PR if needed.</p>\n<p dir=\"auto\">Also while the utility of this feature might be concerning the feature comes at no cost for applications that are not interested in utilizing it.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49801",
            "title": "Introduce `alias_association` feature",
            "date_modified": "2023-10-26T22:01:00.000Z",
            "date_published": "2023-10-26T21:41:30.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/11673?u=ef80073b0bb2ee07a241e85af0bb51e892955811&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">I've often had the need to desire a to create a duration type for Ruby classes including <code class=\"notranslate\">ActiveModel::Attributes</code> or for ActiveRecord models backed by non-PostgreSQL database adapters, similar to <a href=\"https://stackoverflow.com/a/45359178/771838\" rel=\"nofollow\">this StackOverflow answer</a>.</p>\n<p dir=\"auto\">The Rails community would benefit from having this type available as an <code class=\"notranslate\">ActiveModel</code> attribute whereas currently only <code class=\"notranslate\">ActiveRecord</code> models with the PostgreSQL adapter support <code class=\"notranslate\">ActiveSupport::Duration</code> through the <code class=\"notranslate\">:interval</code> data type. .</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This changeset adds <code class=\"notranslate\">ActiveModel::Type::Duration</code> to provide representation for <code class=\"notranslate\">ActiveSupport::Duration</code> via the <code class=\"notranslate\">:duration</code> key.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Run\n  include ActiveModel::Attributes\n\n  attribute :lasted, :duration\nend\n\nrun = Run.new\nrun.lasted = 2.hours\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Run</span>\n  <span class=\"pl-en\">include</span> <span class=\"pl-v\">ActiveModel</span>::<span class=\"pl-v\">Attributes</span>\n\n  <span class=\"pl-en\">attribute</span> <span class=\"pl-pds\">:lasted</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:duration</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">run</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">2</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">hours</span></pre></div>\n<p dir=\"auto\">Numeric values are cast to <code class=\"notranslate\">ActiveSupport::Duration</code> as seconds.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"run = Run.new\nrun.lasted = 120 # =&gt; 120 seconds\"><pre class=\"notranslate\"><span class=\"pl-s1\">run</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">120</span> <span class=\"pl-c\"># =&gt; 120 seconds</span></pre></div>\n<p dir=\"auto\">String values are parsed using the ISO 8601 duration format.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"run = Run.new\nrun.lasted = &quot;PT2H&quot;\n\nrun.lasted.class # =&gt; ActiveSupport::Duration\nrun.lasted       # =&gt; 2 hours\"><pre class=\"notranslate\"><span class=\"pl-s1\">run</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"PT2H\"</span>\n\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">class</span> <span class=\"pl-c\"># =&gt; ActiveSupport::Duration</span>\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span>       <span class=\"pl-c\"># =&gt; 2 hours</span></pre></div>\n<p dir=\"auto\">The serialization/deserialization logic is extracted from <code class=\"notranslate\">ActiveRecord::ConnectionAdapters::PostreSQL::OID::Interval</code>, which is here modified to inherit from <code class=\"notranslate\">ActiveModel::Type::Duration</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49799",
            "title": "Add ActiveModel attribute type for duration",
            "date_modified": "2023-10-26T16:24:54.000Z",
            "date_published": "2023-10-26T15:56:47.000Z",
            "author": {
                "name": "rossta",
                "url": "https://github.com/rossta"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/111346?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><code class=\"notranslate\">ActionMailer::InlinePreviewInterceptor</code> is useful not only for previewing the template but also for displaying actual emails loaded from a string/file using <code class=\"notranslate\">Mail.read_from_string</code>. For example, you might want to archive all outgoing emails to the database/filesystem and display these emails in a browser.</p>\n<p dir=\"auto\">The interceptor assumes that attachments are represented as binary data. But if an email is loaded from string, the attachments have already been encoded as base64, so they end up being encoded twice.</p>",
            "url": "https://github.com/rails/rails/pull/49797",
            "title": "Fix double-encoding in `InlinePreviewInterceptor`",
            "date_modified": "2023-10-27T05:29:07.000Z",
            "date_published": "2023-10-26T13:43:42.000Z",
            "author": {
                "name": "c960657",
                "url": "https://github.com/c960657"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5279284?u=40cbc3d0cb818159797fa8856c88c9e87fd8bd49&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">ActionMailer Email Preview - show date header when present or fallback to Time.current.rfc2822</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49788.\">Resolves</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1962469818\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49788\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49788/hovercard\" href=\"https://github.com/rails/rails/issues/49788\">#49788</a></p>\n<p dir=\"auto\">Co-authored-by: <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/allisonphillips/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/allisonphillips\">@allisonphillips</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49790",
            "title": "ActionMailer Email Preview - show date header when present ",
            "date_modified": "2023-10-27T12:55:00.000Z",
            "date_published": "2023-10-26T01:42:47.000Z",
            "author": {
                "name": "sampatbadhe",
                "url": "https://github.com/sampatbadhe"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/18366969?u=e6919af135d360a17f71ab7380f0d57fe08be21a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because there is already <code class=\"notranslate\">destroy_all</code>, but there are cases where you want to raise an exception if it fails. It is useful to have <code class=\"notranslate\">destroy_all!</code>.<br>\nThis change was previously implemented at <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"527539837\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/37782\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/37782/hovercard\" href=\"https://github.com/rails/rails/pull/37782\">#37782</a>, but it was closed. I've re-opened this PR because it was recently mentioned by <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes add <code class=\"notranslate\">#destroy_all!</code> method to <code class=\"notranslate\">ActiveRecord::Relation</code></p>\n<p dir=\"auto\">If the <code class=\"notranslate\">before_destroy</code> callback throws abort the action is cancelled and <code class=\"notranslate\">destroy_all!</code> raises <code class=\"notranslate\">ActiveRecord::RecordNotDestroyed</code>.</p>\n<p dir=\"auto\">If there is more than one target record and you want to ensure that all records are deleted, you should realize this by explicitly using transaction to cause rollback.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class User &lt; ApplicationRecord\n  before_destroy do\n     throw :abort if id == 3\n   end\nend\n\nActiveRecord::Base.transaction do \n  User.where(id: 1..3).destroy_all!  \nend  \n \n=&gt;  TRANSACTION (1.5ms)  BEGIN\n  user Load (1.5ms)  SELECT `users`.* FROM `users` WHERE `users`.`id` BETWEEN 1 AND 3\n  user Destroy (1.2ms)  DELETE FROM `users` WHERE `users`.`id` = 1\n  user Destroy (1.1ms)  DELETE FROM `users` WHERE `users`.`id` = 2\n  TRANSACTION (4.4ms)  ROLLBACK\nActiveRecord::RecordNotDestroyed: Failed to destroy the record\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">User</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">before_destroy</span> <span class=\"pl-k\">do</span>\n     <span class=\"pl-en\">throw</span> <span class=\"pl-pds\">:abort</span> <span class=\"pl-k\">if</span> <span class=\"pl-en\">id</span> == <span class=\"pl-c1\">3</span>\n   <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">transaction</span> <span class=\"pl-k\">do</span> \n  <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">id</span>: <span class=\"pl-c1\">1</span>..<span class=\"pl-c1\">3</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">destroy_all!</span>  \n<span class=\"pl-k\">end</span>  \n \n<span class=\"pl-c1\">=&gt;</span>  <span class=\"pl-c1\">TRANSACTION</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1.5</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  BEGIN\n  <span class=\"pl-en\">user</span> <span class=\"pl-en\">Load</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1.5</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-en\">SELECT</span> <span class=\"pl-s\">`users`</span><span class=\"pl-kos\">.</span>* <span class=\"pl-en\">FROM</span> <span class=\"pl-s\">`users`</span> <span class=\"pl-en\">WHERE</span> <span class=\"pl-s\">`users`</span><span class=\"pl-kos\">.</span>`<span class=\"pl-en\">id</span><span class=\"pl-s\">` BETWEEN 1 AND 3</span>\n<span class=\"pl-s\">  user Destroy (1.2ms)  DELETE FROM `</span><span class=\"pl-en\">users</span><span class=\"pl-s\">` WHERE `</span><span class=\"pl-en\">users</span><span class=\"pl-s\">`.`</span><span class=\"pl-en\">id</span><span class=\"pl-s\">` = 1</span>\n<span class=\"pl-s\">  user Destroy (1.1ms)  DELETE FROM `</span><span class=\"pl-en\">users</span><span class=\"pl-s\">` WHERE `</span><span class=\"pl-en\">users</span><span class=\"pl-s\">`.`</span><span class=\"pl-s1\">id</span>` <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">2</span>\n  <span class=\"pl-en\">TRANSACTION</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">4.4</span><span class=\"pl-en\">ms</span><span class=\"pl-kos\">)</span>  <span class=\"pl-c1\">ROLLBACK</span>\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-en\">RecordNotDestroyed</span>: <span class=\"pl-en\">Failed</span> <span class=\"pl-en\">to</span> <span class=\"pl-en\">destroy</span> <span class=\"pl-en\">the</span> <span class=\"pl-en\">record</span></pre></div>\n<p dir=\"auto\">Also, if the deletion is successful, an Array containing the target object that was successfully deleted is returned.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/rails/rails/pull/37782\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/37782/hovercard\">Previously opened PR</a></li>\n<li><a href=\"https://discuss.rubyonrails.org/t/proposal-add-destroy-all-method-to-activerecord-relation/80959\" rel=\"nofollow\">proposal</a></li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49789",
            "title": "Add `#destroy_all!` method to `ActiveRecord::Relation`",
            "date_modified": "2023-10-28T01:37:06.000Z",
            "date_published": "2023-10-26T01:32:51.000Z",
            "author": {
                "name": "soartec-lab",
                "url": "https://github.com/soartec-lab"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49273.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1896689507\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49273\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49273/hovercard\" href=\"https://github.com/rails/rails/issues/49273\">#49273</a>.</p>\n<p dir=\"auto\">We can remove some code by refactoring <code class=\"notranslate\">db:migrate</code> for multiple dbs to use individual database rake tasks.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/sobrinho/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/sobrinho\">@sobrinho</a></p>",
            "url": "https://github.com/rails/rails/pull/49787",
            "title": "Refactor `db:migrate` task for multiple dbs to use per-database rake tasks",
            "date_modified": "2023-10-27T20:26:55.000Z",
            "date_published": "2023-10-25T22:28:41.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/131752?u=32ddf1119b1d189c9bd241a721b36ea01c29f61e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Previously in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1003663049\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/43282\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/43282/hovercard\" href=\"https://github.com/rails/rails/pull/43282\">#43282</a>, which shipped with Rails 7.0, we added the guarantee that if an exception occurred within an ActiveSupport::Notificaitons subscriber that the remaining subscribers would still be run.</p>\n<p dir=\"auto\">This was broken in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1141875314\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/44469\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/44469/hovercard\" href=\"https://github.com/rails/rails/pull/44469\">#44469</a> (oops 😳), where the different types of subscribers were broken into groups by type for performance. Although we would guard exceptions and always run all (or none) of the same group, that didn't work cross-group with different types of subscriber.</p>",
            "url": "https://github.com/rails/rails/pull/49784",
            "title": "Fix exception guards on multiple subscriber types",
            "date_modified": "2023-10-25T21:01:08.000Z",
            "date_published": "2023-10-25T21:01:04.000Z",
            "author": {
                "name": "jhawthorn",
                "url": "https://github.com/jhawthorn"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Any classes that don't implement #blank? will fall back to Object's implementation, which checks whether #empty? is defined before either using #empty? or implicit truthiness. Since checking whether #empty? is defined is expensive, some core classes (Array/Hash) alias #blank? directly to #empty? to skip the respond_to? check.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit applies the alias optimization to Symbol. #blank? is called on Symbols for many Active Record query methods (select, includes, group, order, joins, etc.) so it seems reasonable to define the #blank? alias on Symbol as well.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49776",
            "title": "Add Symbol#blank? to skip respond_to?(:empty?)",
            "date_modified": "2023-10-25T03:34:05.000Z",
            "date_published": "2023-10-25T03:34:00.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5122678?u=204301f9f9fe8930fd26fe3bfe65b6ffaffd8b59&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because the current <a href=\"https://guides.rubyonrails.org/association_basics.html#single-table-inheritance-sti\" rel=\"nofollow\">STI Guides</a> don't document how to override or disable the <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/ModelSchema.html#method-c-inheritance_column\" rel=\"nofollow\">inheritance_column</a>.</p>\n<p dir=\"auto\"><del>Additionally, it's not clear that you can set <code class=\"notranslate\">inheritance_column = :disabled</code>. Initially, I had tried  <code class=\"notranslate\">inheritance_column = nil</code> which had the same behavior, but is not as clear as the former.</del></p>\n<p dir=\"auto\">Setting <code class=\"notranslate\">inheritance_column = nil</code> disabled STI.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Add new sections to <a href=\"https://guides.rubyonrails.org/association_basics.html#single-table-inheritance-sti\" rel=\"nofollow\">STI Guides</a> demonstrating how to override or disable the <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/ModelSchema.html#method-c-inheritance_column\" rel=\"nofollow\">inheritance_column</a>.</p>\n<p dir=\"auto\">Also improve error message when <code class=\"notranslate\">ActiveRecord::SubclassNotFound</code> is raised.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49774",
            "title": "Improve STI documentation",
            "date_modified": "2023-10-25T17:47:34.000Z",
            "date_published": "2023-10-25T00:49:57.000Z",
            "author": {
                "name": "stevepolitodesign",
                "url": "https://github.com/stevepolitodesign"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49767.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1959594919\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49767\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49767/hovercard\" href=\"https://github.com/rails/rails/issues/49767\">#49767</a>.</p>\n<p dir=\"auto\">All other enum-related methods are already reloading type map.<br>\nI am not sure are tests needed for this?</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/ghiculescu/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ghiculescu\">@ghiculescu</a> (as implementor of the PostgreSQL <code class=\"notranslate\">enum</code>)</p>",
            "url": "https://github.com/rails/rails/pull/49772",
            "title": "Reload type map when creating or dropping PostgreSQL enums",
            "date_modified": "2023-10-27T17:54:48.000Z",
            "date_published": "2023-10-24T20:33:09.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8122246?u=2dbe607a66a7616297b78647eeb4e0dbff657c3a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><ul dir=\"auto\">\n<li>\n<h3 dir=\"auto\">Context</h3>\n<p dir=\"auto\">The Tagged Logging functionality has been a source of a few issues over the years, especially when combined with the broadcasting feature. Initializating a Tagged Logger was also not very intuitive:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"logger = Logger.new(STDOUT)\ntagged_logger = ActiveSupport::TaggedLogging.new(logger)\n# Would expect the `tagged_logger` to be an instance of `AS::TaggedLogging` \n# but it's a clone of the `logger`.\n\ntagged_logger.formatter = -&gt;(_, _, _, message) do\n  { message: message }\nend\n# Modifies the formatter to output JSON formatted logs.\n# This breaks tagged logging.\"><pre class=\"notranslate\"><span class=\"pl-s1\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">tagged_logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">TaggedLogging</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">logger</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\"># Would expect the `tagged_logger` to be an instance of `AS::TaggedLogging` </span>\n<span class=\"pl-c\"># but it's a clone of the `logger`.</span>\n\n<span class=\"pl-s1\">tagged_logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">formatter</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">-&gt;</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">_</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">_</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">_</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">message</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">message</span>: <span class=\"pl-s1\">message</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span>\n<span class=\"pl-c\"># Modifies the formatter to output JSON formatted logs.</span>\n<span class=\"pl-c\"># This breaks tagged logging.</span></pre></div>\n<p dir=\"auto\">I believe the main reason of those issues is because tagged logging is implemented at the wrong level.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">I made a proposal on the Ruby logger upstream in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1790019942\" data-permission-text=\"Title is private\" data-url=\"https://github.com/ruby/logger/issues/90\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/ruby/logger/pull/90/hovercard\" href=\"https://github.com/ruby/logger/pull/90\">ruby/logger#90</a> to help solve this but it hasn't been reviewed yet. So I thought about adding it here for now. The TL;DR is to decouple formatting and adding extra information to logs (which is what tagged logging does).</p>\n<h3 dir=\"auto\">Deprecation</h3>\n<p dir=\"auto\">Since TaggedLogging will no longer access the formatter, there is a few things I'd like to deprecate such as setting a default formatter </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/d68e43922bc11829c52ad9f736ad5549fc97631b/activesupport/lib/active_support/tagged_logging.rb#L124\">rails/activesupport/lib/active_support/tagged_logging.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 124\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/d68e43922bc11829c52ad9f736ad5549fc97631b\">d68e439</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L124\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"124\"></td>\n          <td id=\"LC124\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">formatter</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">Logger</span>::<span class=\"pl-v\">SimpleFormatter</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n but doing so in this PR would increase the size of the diff significantly and would maybe distract for PR reviews.<p></p>\n<p dir=\"auto\">Another thing that I believe should be deprecated is <code class=\"notranslate\">ActiveSupport::TaggedLogging.new</code>. Adding tagging functionality to a logger should be done using a more ruby approach such as <code class=\"notranslate\">logger.extend(AS::TaggedLogging)</code>.</p>\n</li>\n</ul>\n<hr>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49757.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1958722861\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49757\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49757/hovercard\" href=\"https://github.com/rails/rails/issues/49757\">#49757</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49745.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1956771268\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49745\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49745/hovercard\" href=\"https://github.com/rails/rails/issues/49745\">#49745</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #46084.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1379588419\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46084\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/46084/hovercard\" href=\"https://github.com/rails/rails/issues/46084\">#46084</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #44668.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1167130613\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/44668\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/44668/hovercard\" href=\"https://github.com/rails/rails/issues/44668\">#44668</a></p>",
            "url": "https://github.com/rails/rails/pull/49771",
            "title": "Reimplement TaggedLogging:",
            "date_modified": "2023-10-27T12:13:57.000Z",
            "date_published": "2023-10-24T17:24:15.000Z",
            "author": {
                "name": "Edouard-chin",
                "url": "https://github.com/Edouard-chin"
            }
        }
    ]
}