{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/73684?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Managed to reproduce CI failure at <a href=\"https://buildkite.com/rails/rails-nightly/builds/133#018d7bb8-8a32-4978-8e36-d7cb9b067813/1196-1204\" rel=\"nofollow\">https://buildkite.com/rails/rails-nightly/builds/133#018d7bb8-8a32-4978-8e36-d7cb9b067813/1196-1204</a> . It would also reproduce against the released versions of Ruby because this is triggered by minitest v5.22.0 change. <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/minitest/minitest/commit/ebb468c81c0eea069234127bd6a101c84e955872/hovercard\" href=\"https://github.com/minitest/minitest/commit/ebb468c81c0eea069234127bd6a101c84e955872\">minitest/minitest@<tt>ebb468c</tt></a></p>\n<p dir=\"auto\">To avoid all of railties CI failures, pin minitest version to 5.21 tentatively.</p>\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>Steps to reproduce</li>\n</ul>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"git clone https://github.com/rails/rails\ncd rails\nrm Gemfile.lock\nbundle install\ncd railties\nbin/test test/application/test_runner_test.rb -n test_system_tests_are_not_run_with_the_default_test_command\"><pre class=\"notranslate\"><span class=\"pl-en\">git</span> <span class=\"pl-en\">clone</span> <span class=\"pl-pds\">https</span>:<span class=\"pl-sr\">//github</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">com</span>/<span class=\"pl-en\">rails</span>/<span class=\"pl-en\">rails</span>\n<span class=\"pl-en\">cd</span> <span class=\"pl-en\">rails</span>\n<span class=\"pl-en\">rm</span> <span class=\"pl-v\">Gemfile</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lock</span>\n<span class=\"pl-en\">bundle</span> <span class=\"pl-en\">install</span>\n<span class=\"pl-en\">cd</span> <span class=\"pl-en\">railties</span>\n<span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">application</span>/<span class=\"pl-en\">test_runner_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span> -<span class=\"pl-en\">n</span> <span class=\"pl-en\">test_system_tests_are_not_run_with_the_default_test_command</span></pre></div>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">Expected behavior<br>\nIt should pass.</p>\n</li>\n<li>\n<p dir=\"auto\">Actual behavior</p>\n</li>\n</ul>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ bin/test test/application/test_runner_test.rb -n test_system_tests_are_not_run_with_the_default_test_command\nRun options: -n test_system_tests_are_not_run_with_the_default_test_command --seed 14574\n\nF\n\nFailure:\nApplicationTests::TestRunnerTest#test_system_tests_are_not_run_with_the_default_test_command [test/application/test_runner_test.rb:1191]:\nExpected /0\\ runs,\\ 0\\ assertions,\\ 0\\ failures,\\ 0\\ errors,\\ 0\\ skips/ to match &quot;Nothing ran for filter: \\nRunning 0 tests in a single process (parallelization threshold is 50)\\nRun options: --seed 45713\\n\\n# Running:\\n\\n&quot;.\n\nbin/test test/application/test_runner_test.rb:1179\n\nFinished in 9.982314s, 0.1002 runs/s, 0.2004 assertions/s.\n1 runs, 2 assertions, 1 failures, 0 errors, 0 skips\n$\"><pre class=\"notranslate\">$ <span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">application</span>/<span class=\"pl-en\">test_runner_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span> -<span class=\"pl-en\">n</span> <span class=\"pl-en\">test_system_tests_are_not_run_with_the_default_test_command</span>\n<span class=\"pl-en\">Run</span> <span class=\"pl-pds\">options</span>: -<span class=\"pl-en\">n</span> <span class=\"pl-en\">test_system_tests_are_not_run_with_the_default_test_command</span> --<span class=\"pl-en\">seed</span> <span class=\"pl-c1\">14574</span>\n\n<span class=\"pl-c1\">F</span>\n\n<span class=\"pl-v\">Failure</span>:\n<span class=\"pl-v\">ApplicationTests</span>::<span class=\"pl-v\">TestRunnerTest</span><span class=\"pl-c\">#test_system_tests_are_not_run_with_the_default_test_command [test/application/test_runner_test.rb:1191]:</span>\n<span class=\"pl-en\">Expected</span> <span class=\"pl-sr\">/0<span class=\"pl-cce\">\\ </span>runs,<span class=\"pl-cce\">\\ </span>0<span class=\"pl-cce\">\\ </span>assertions,<span class=\"pl-cce\">\\ </span>0<span class=\"pl-cce\">\\ </span>failures,<span class=\"pl-cce\">\\ </span>0<span class=\"pl-cce\">\\ </span>errors,<span class=\"pl-cce\">\\ </span>0<span class=\"pl-cce\">\\ </span>skips/</span> <span class=\"pl-en\">to</span> <span class=\"pl-en\">match</span> <span class=\"pl-s\">\"Nothing ran for filter: <span class=\"pl-cce\">\\n</span>Running 0 tests in a single process (parallelization threshold is 50)<span class=\"pl-cce\">\\n</span>Run options: --seed 45713<span class=\"pl-cce\">\\n</span><span class=\"pl-cce\">\\n</span># Running:<span class=\"pl-cce\">\\n</span><span class=\"pl-cce\">\\n</span>\"</span><span class=\"pl-kos\">.</span>\n\n<span class=\"pl-en\">bin</span>/<span class=\"pl-en\">test</span> <span class=\"pl-en\">test</span>/<span class=\"pl-en\">application</span>/<span class=\"pl-en\">test_runner_test</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rb</span>:<span class=\"pl-c1\">1179</span>\n\n<span class=\"pl-en\">Finished</span> <span class=\"pl-en\">in</span> <span class=\"pl-c1\">9.982314</span><span class=\"pl-en\">s</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0.1002</span> <span class=\"pl-en\">runs</span>/<span class=\"pl-en\">s</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0.2004</span> <span class=\"pl-en\">assertions</span>/<span class=\"pl-en\">s</span><span class=\"pl-kos\">.</span>\n<span class=\"pl-c1\">1</span> <span class=\"pl-en\">runs</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">2</span> <span class=\"pl-en\">assertions</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">1</span> <span class=\"pl-en\">failures</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0</span> <span class=\"pl-en\">errors</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">0</span> <span class=\"pl-en\">skips</span>\n$</pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50978",
            "title": "Pin minitest version to 5.21",
            "date_modified": "2024-02-06T01:18:03.000Z",
            "date_published": "2024-02-06T01:15:48.000Z",
            "author": {
                "name": "yahonda",
                "url": "https://github.com/yahonda"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2786819?u=722b21f1f48dc9a97c9494aba04c4f657d31e941&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The Action Text documentation benefits from some more examples and explanations of some of the concepts that are mentioned, as well as the introduction of some new ones.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request updates the documentation for Action Text. It adds, reorders and in general creates clear instructions for using Action Text.</p>",
            "url": "https://github.com/rails/rails/pull/50977",
            "title": "[RF DOCS] Action Text Documention [ci-skip] ",
            "date_modified": "2024-02-05T22:02:52.000Z",
            "date_published": "2024-02-05T22:02:36.000Z",
            "author": {
                "name": "Ridhwana",
                "url": "https://github.com/Ridhwana"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/12413247?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created to enhance the flexibility and usability of the Rails <code class=\"notranslate\">database.yml</code> configuration for PostgreSQL databases. Currently, Rails applications default to connecting to PostgreSQL through a local Unix socket for development environments. This setup works well for local development but becomes cumbersome when developers use Dockerized PostgreSQL instances or switch between local and Docker environments.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"&gt; rails db:prepare\nbin/rails aborted!\nActiveRecord::ConnectionNotEstablished: connection to server on socket &quot;/tmp/.s.PGSQL.5432&quot; failed: No such file or directory (ActiveRecord::ConnectionNotEstablished)\n\tIs the server running locally and accepting connections on that socket?\n\n\nCaused by:\nPG::ConnectionBad: connection to server on socket &quot;/tmp/.s.PGSQL.5432&quot; failed: No such file or directory (PG::ConnectionBad)\n\tIs the server running locally and accepting connections on that socket?\"><pre class=\"notranslate\"><span class=\"pl-k\">&gt;</span> rails db:prepare\nbin/rails aborted<span class=\"pl-k\">!</span>\nActiveRecord::ConnectionNotEstablished: connection to server on socket <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/tmp/.s.PGSQL.5432<span class=\"pl-pds\">\"</span></span> failed: No such file or directory (ActiveRecord::ConnectionNotEstablished)\n\tIs the server running locally and accepting connections on that socket<span class=\"pl-k\">?</span>\n\n\nCaused by:\nPG::ConnectionBad: connection to server on socket <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/tmp/.s.PGSQL.5432<span class=\"pl-pds\">\"</span></span> failed: No such file or directory (PG::ConnectionBad)\n\tIs the server running locally and accepting connections on that socket<span class=\"pl-k\">?</span></pre></div>\n<p dir=\"auto\">By facilitating easy switching between these environments without the need to manually edit the <code class=\"notranslate\">database.yml</code> file, this PR aims to streamline the development workflow, making it more efficient and less error-prone.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the PostgreSQL database configuration template (<code class=\"notranslate\">postgresql.yml.tt</code>) by introducing dynamic environment variable support for the <code class=\"notranslate\">host</code>, <code class=\"notranslate\">username</code>, and, <code class=\"notranslate\">password</code> settings in the default configuration. Specifically, it allows these settings to be overridden via environment variables, with defaults provided for local development. This approach enables developers to easily switch between a local PostgreSQL server and a Dockerized PostgreSQL instance by simply setting or unsetting environment variables, without the need for manual configuration file edits.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This approach supports the idea in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2106594568\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50914\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50914/hovercard?comment_id=1478343297&amp;comment_type=review_comment\" href=\"https://github.com/rails/rails/pull/50914#discussion_r1478343297\">#50914 (comment)</a>.</p>\n<p dir=\"auto\">I do not like to use `\"&lt;%= app_name.upcase %&gt;_...\" in variable names, but I followed the naming in </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/2c5fe6fa7aba4a10d56ff4ee54d26511e58dda3b/railties/lib/rails/generators/rails/app/templates/config/databases/postgresql.yml.tt#L84\">rails/railties/lib/rails/generators/rails/app/templates/config/databases/postgresql.yml.tt</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 84\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/2c5fe6fa7aba4a10d56ff4ee54d26511e58dda3b\">2c5fe6f</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L84\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"84\"></td>\n          <td id=\"LC84\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> password: &lt;%%= ENV[\"&lt;%= app_name.upcase %&gt;_DATABASE_PASSWORD\"] %&gt; </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n.<p></p>\n<p dir=\"auto\">As suggested in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2106594568\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50914\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50914/hovercard?comment_id=1478855943&amp;comment_type=review_comment\" href=\"https://github.com/rails/rails/pull/50914#discussion_r1478855943\">#50914 (comment)</a>, I would rather use <code class=\"notranslate\">DATABASE_URL</code>, <code class=\"notranslate\">POSTGRES_USER</code>, and <code class=\"notranslate\">POSTGRES_PASSWORD</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">I am not able to run the tests in Dev Container or locally on macOS (it crashes üëéüèº).  Of course, I would love to add or fix tests, need more tome to set up the local environment.</p>\n<p dir=\"auto\">But I could create a new app from local branch, which includes correct generated Postgres database config (<a href=\"https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#running-an-application-against-your-local-branch\" rel=\"nofollow\">https://edgeguides.rubyonrails.org/contributing_to_ruby_on_rails.html#running-an-application-against-your-local-branch</a>).</p>",
            "url": "https://github.com/rails/rails/pull/50975",
            "title": "Enhance PostgreSQL config template for flexible env connections",
            "date_modified": "2024-02-06T00:28:54.000Z",
            "date_published": "2024-02-05T21:38:18.000Z",
            "author": {
                "name": "viktorianer",
                "url": "https://github.com/viktorianer"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1966473?u=fe117732163d3610f051fca80df4e04c1b91335d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h2 dir=\"auto\">Overview</h2>\n<p dir=\"auto\">Action Mailbox is a pretty useful / interesting sub-framework of Rails, that more apps probably could benefit from. It does have a number of moving parts so I focused on explaining the flow of how things work. I did a lot of 'in-app testing' of the docs by implementing its features in a rails app and exploring what's missing in the docs.</p>\n<h2 dir=\"auto\">New sections</h2>\n<p dir=\"auto\">Here are the new things I added, in addition to clarifying the existing text.</p>\n<ul dir=\"auto\">\n<li>Processing Incoming Email - more of a step by step of the flow</li>\n<li>Mail object and it's fields</li>\n<li>List of Inbound Email 'status' values</li>\n<li>ActiveJobs that are part of Action Mailbox - Routing and Incineration</li>\n</ul>\n<h2 dir=\"auto\">Testing</h2>\n<p dir=\"auto\">In addition to testing the Action Mailbox features in-app, I also ran guides:generate and guides:validate locally. I perused the generated html locally as well.</p>\n<p dir=\"auto\">I also tested the instructions for one 'real' ingress Postmark (locally with ngrok).</p>",
            "url": "https://github.com/rails/rails/pull/50973",
            "title": "[RF DOCS] Action Mailbox Documention [ci-skip]",
            "date_modified": "2024-02-05T20:04:40.000Z",
            "date_published": "2024-02-05T20:04:36.000Z",
            "author": {
                "name": "bhumi1102",
                "url": "https://github.com/bhumi1102"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Follow up to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"893709388\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/42240\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/42240/hovercard\" href=\"https://github.com/rails/rails/pull/42240\">#42240</a> (as discussed in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"893709388\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/42240\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/42240/hovercard?comment_id=1926446571&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/pull/42240#issuecomment-1926446571\">#42240 (comment)</a>).</p>\n<p dir=\"auto\">We lost the ability to use the <code class=\"notranslate\">:line</code> option with QueryLogs (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"893709388\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/42240\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/42240/hovercard?comment_id=898668464&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/pull/42240#issuecomment-898668464\">#42240 (comment)</a>), while there is one in the marginalia. It was costly to use it before in the gem, but we made it fast (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2075236301\" data-permission-text=\"Title is private\" data-url=\"https://github.com/basecamp/marginalia/issues/138\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/basecamp/marginalia/pull/138/hovercard\" href=\"https://github.com/basecamp/marginalia/pull/138\">basecamp/marginalia#138</a>), so it is not <em>that</em> costly and people deliberately decide if they want to use it.</p>\n<p dir=\"auto\">I would like to have the <code class=\"notranslate\">:line</code> option (upd: decided to name it as <code class=\"notranslate\">:source_location</code>), it is very much useful. Without it, if we have a slow db query log, for example, it is very hard to know from which part of the codebase the query was generated. Even having an <code class=\"notranslate\">:action</code> component, you need to investigate the unfamiliar codebase to find out where the query was triggered.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a></p>",
            "url": "https://github.com/rails/rails/pull/50969",
            "title": "Support `:source_location` tag option for query log tags",
            "date_modified": "2024-02-05T23:08:23.000Z",
            "date_published": "2024-02-05T14:06:30.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This change is an up-port of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2087434730\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50787\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50787/hovercard\" href=\"https://github.com/rails/rails/pull/50787\">#50787</a> which applied a similar fix to 7-1-stable.</p>\n<p dir=\"auto\">Since these tests weren't running before, we didn't notice when the DirectUploads controller tests were broken. My theory is that it has something to do with changing <code class=\"notranslate\">response.parsed_body</code> to return a HWIA (in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1862118814\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49003\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49003/hovercard\" href=\"https://github.com/rails/rails/pull/49003\">#49003</a>).</p>\n<p dir=\"auto\">This change is different from the 7-1-stable PR in that it removes the need to stringify or symbolize any keys, since we are comparing the metadata with string keys. This is a follow up to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1061833902\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/43705\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/43705/hovercard\" href=\"https://github.com/rails/rails/pull/43705\">#43705</a>.</p>\n<p dir=\"auto\">This PR came out of the work in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2053506521\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50427\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50427/hovercard\" href=\"https://github.com/rails/rails/pull/50427\">#50427</a>, but since I was able to reproduce these failures on main, I wanted to fix them first.</p>",
            "url": "https://github.com/rails/rails/pull/50967",
            "title": "Fix Active Storage test configurations for CI",
            "date_modified": "2024-02-06T01:06:05.000Z",
            "date_published": "2024-02-05T11:47:28.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54629302?u=be8de5137bf940532cddd05aff823129ab8a39db&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">Update some create <code class=\"notranslate\">has_one</code> test descriptions to indicate failure when using the <code class=\"notranslate\">#create_*</code> constructor.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">I ran into these tests when looking into a separate issue and found the failures confusing when running against my changes. The descriptions were change <a href=\"https://github.com/rails/rails/pull/41238\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/41238/hovercard\">in this PR</a>, but I think the reasoning there is incorrect. These are indeed creation failures, and I have added an additional assertion to make that clear.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">None.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50962",
            "title": "Update some create `has_one` failure test descriptions",
            "date_modified": "2024-02-05T01:40:32.000Z",
            "date_published": "2024-02-04T08:46:44.000Z",
            "author": {
                "name": "joshuay03",
                "url": "https://github.com/joshuay03"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1773614?u=ddeb4c8dcd174d1b6cb73cfa9ab91808eaba47a0&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Customers are uploading webp images to our app, and expect them to be rendered just like other images, instead of being converted to the fallback PNG format.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Follows <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"597833295\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/38918\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/38918/hovercard\" href=\"https://github.com/rails/rails/pull/38918\">#38918</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"602809843\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/38988\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/38988/hovercard\" href=\"https://github.com/rails/rails/pull/38988\">#38988</a>. At the time, webp browser support was limited. Now 96% of browsers support webp: <a href=\"https://caniuse.com/?search=webp\" rel=\"nofollow\">https://caniuse.com/?search=webp</a></p>\n<p dir=\"auto\">This PR adds webp as a default image type.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I think this is a sensible default in 2024, but alternatively each Rails app may choose:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Rails.application.configure do\n  config.active_storage.web_image_content_types &lt;&lt; &quot;image/webp&quot;\nend\"><pre class=\"notranslate\"><code class=\"notranslate\">Rails.application.configure do\n  config.active_storage.web_image_content_types &lt;&lt; \"image/webp\"\nend\n</code></pre></div>\n<p dir=\"auto\"><strong>Changelog</strong></p>\n<p dir=\"auto\">I've not added a changelog entry in line with <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"597833295\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/38918\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/38918/hovercard?comment_id=410527726&amp;comment_type=review_comment\" href=\"https://github.com/rails/rails/pull/38918#discussion_r410527726\">#38918 (comment)</a>, but I'd be happy to add one if it's felt useful now.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/jeremy/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jeremy\">@jeremy</a></p>",
            "url": "https://github.com/rails/rails/pull/50953",
            "title": "Add webp as a default to active_storage.web_image_content_types",
            "date_modified": "2024-02-02T17:19:56.000Z",
            "date_published": "2024-02-02T12:51:26.000Z",
            "author": {
                "name": "lewispb",
                "url": "https://github.com/lewispb"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/4509402?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><code class=\"notranslate\">enforce_utf8</code> is false by deault in <code class=\"notranslate\">form_for</code> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"264388907\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/30852\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/30852/hovercard\" href=\"https://github.com/rails/rails/issues/30852\">#30852</a><br>\nWe normally don't need to consider old IE anymore.</p>",
            "url": "https://github.com/rails/rails/pull/50951",
            "title": "set default_enforce_utf8 to false",
            "date_modified": "2024-02-03T08:41:29.000Z",
            "date_published": "2024-02-02T11:11:21.000Z",
            "author": {
                "name": "ironsand",
                "url": "https://github.com/ironsand"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54796266?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">In general validation errors should include more information on where it has happened.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR updates <code class=\"notranslate\">activerecord/lib/active_record/enum.rb</code> validation exception message and just adds class name.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50950",
            "title": "Add class name to enum validation exception message",
            "date_modified": "2024-02-02T11:08:08.000Z",
            "date_published": "2024-02-02T11:07:18.000Z",
            "author": {
                "name": "amkisko",
                "url": "https://github.com/amkisko"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/82408?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This pull request adds a new Rails Guide called \"Tuning Performance for Deployment\".</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">A few weeks ago there was <a href=\"https://github.com/rails/rails/issues/50450\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50450/hovercard\">an issue to change the default thread count for Puma in Rails</a> and <a href=\"https://github.com/rails/rails/pull/50669\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50669/hovercard\">a PR to make that change</a>.</p>\n<p dir=\"auto\">The PR mentioned that a performance tuning guide would be the right way to document some issues, but no such guide exists. I wrote a basic guide and incorporated a lot of feedback from <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a> (Jean Boussier), who wrote the thread count PR.</p>\n<p dir=\"auto\">This pull request adds the suggested Rails Guide.</p>\n<p dir=\"auto\">CC <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/nateberkopec/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/nateberkopec\">@nateberkopec</a> - though I know you're very busy right now :-)</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">It's impossible to have a detailed guide for all possible Rails deployment options. This guide focuses on Puma (the default server) and CRuby, and on giving a good start to people who don't already know deployment well. I've tried to mention core performance issues without explaining every possible configuration change.</p>\n<p dir=\"auto\">Next time there is a deployment configuration change, there will be a place to document the tradeoffs.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50949",
            "title": "Add a Rails Guide for tuning performance for deployment",
            "date_modified": "2024-02-05T17:57:47.000Z",
            "date_published": "2024-02-02T10:55:44.000Z",
            "author": {
                "name": "noahgibbs",
                "url": "https://github.com/noahgibbs"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/3733470?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #50672.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2072396416\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50672\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50672/hovercard\" href=\"https://github.com/rails/rails/issues/50672\">#50672</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">The task <code class=\"notranslate\">db:schema:load:#{name}</code> depends on <code class=\"notranslate\">db:test:purge:#{name}</code> since <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/adb64db43dba5cad1007ce57e25df67f8b3e91f8/hovercard\" href=\"https://github.com/rails/rails/commit/adb64db43dba5cad1007ce57e25df67f8b3e91f8\"><tt>adb64db</tt></a> which requires the DB config to be present, otherwise an error is raised.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ bin/rails db:schema:load:one --trace\n** Invoke db:schema:load:one (first_time)\n** Invoke db:test:purge:one (first_time)\n** Invoke db:load_config (first_time)\n** Invoke environment (first_time)\n** Execute environment\n** Execute db:load_config\n** Invoke db:check_protected_environments (first_time) ** Invoke db:load_config\n** Execute db:check_protected_environments\n** Execute db:test:purge:one\n** Execute db:schema:load:one\"><pre class=\"notranslate\"><code class=\"notranslate\">$ bin/rails db:schema:load:one --trace\n** Invoke db:schema:load:one (first_time)\n** Invoke db:test:purge:one (first_time)\n** Invoke db:load_config (first_time)\n** Invoke environment (first_time)\n** Execute environment\n** Execute db:load_config\n** Invoke db:check_protected_environments (first_time) ** Invoke db:load_config\n** Execute db:check_protected_environments\n** Execute db:test:purge:one\n** Execute db:schema:load:one\n</code></pre></div>\n<p dir=\"auto\">This commit fixes the problem by returning early when the DB config is indeed missing.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The task <code class=\"notranslate\">db:schema:load</code> may need to be updated to depend on <code class=\"notranslate\">db:test:purge</code> too, to keep it consistent with <code class=\"notranslate\">db:schema:load:#{name}</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50946",
            "title": "Fix error raised when running `db:schema:load:#{name}` and test DB config is missing",
            "date_modified": "2024-02-05T17:33:03.000Z",
            "date_published": "2024-02-02T03:17:31.000Z",
            "author": {
                "name": "ricardotk002",
                "url": "https://github.com/ricardotk002"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/547754?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request introduces a convenient helper to check if a date/time is either today or in the future.</p>\n<p dir=\"auto\">Drawing inspiration from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1506331947\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46786\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/46786/hovercard\" href=\"https://github.com/rails/rails/pull/46786\">#46786</a> which introduces <code class=\"notranslate\">.local?</code> helper for environment check.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes:</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">ActiveSupport::TimeWithZone</code></li>\n<li><code class=\"notranslate\">DateAndTime::Calculations</code></li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50945",
            "title": "Introduce today_or_future? method",
            "date_modified": "2024-02-04T23:02:23.000Z",
            "date_published": "2024-02-02T00:44:50.000Z",
            "author": {
                "name": "olimart",
                "url": "https://github.com/olimart"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Previously, neither the PrismRenderParser nor the RipperRenderParser would consider an interpolated string as a dependency. The RubyTracker even included a line to explcitly filter out interpolated paths returned from the RipperRenderParser since they would end in a \"/\". However, the RubyTracker does include the ability to evaluate explicit \"Template Dependency\" comments with wildcard nodes.</p>\n<p dir=\"auto\">This commit extends the RipperRenderParser and PrismRenderParser to convert interpolated strings into wildcard globs. Additionally, it changes the RubyTracker to evaluate wildcards the same for both implicit and explicit dependencies. This enables the RubyTracker to identify potential dependencies for interpolated renders, which it was previously unable to do.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/jhawthorn/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jhawthorn\">@jhawthorn</a> if you think this is a good idea I can try to apply it to ActionView::Precompiler as well</p>",
            "url": "https://github.com/rails/rails/pull/50944",
            "title": "Enable DependencyTracker to evaluate interpolated paths",
            "date_modified": "2024-02-02T19:50:39.000Z",
            "date_published": "2024-02-01T23:46:28.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/39735028?u=91330295c614cf3cec0b64bf242a14fc2ceb358f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because I want to make it easier to retry actionable errors that occur when running tests. Rails already knows how to recover these errors, so lets make it possible for the user to recover from them and run their tests without exiting the process.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Allow Actionable Errors encountered when running tests to be retried. This can be configured by <code class=\"notranslate\">config.actionable_command_line_errors</code> and is <code class=\"notranslate\">true</code> in the test environment unless the <code class=\"notranslate\">\"CI\"</code> env variable is set, and false otherwise.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Migrations are pending. To resolve this issue, run:\n\n        bin/rails db:migrate\n\nYou have 1 pending migration:\n\ndb/migrate/20240201213806_add_a_to_b.rb\nRun pending migrations? [Yn] Y\n== 20240201213806 AddAToB: migrating =========================================\n== 20240201213806 AddAToB: migrated (0.0000s) ================================\n\nRunning 7 tests in a single process (parallelization threshold is 50)\nRun options: --seed 22200\n\n# Running:\n\n.......\n\nFinished in 0.243394s, 28.7600 runs/s, 45.1942 assertions/s.\n7 runs, 11 assertions, 0 failures, 0 errors, 0 skips\"><pre class=\"notranslate\"><code class=\"notranslate\">Migrations are pending. To resolve this issue, run:\n\n        bin/rails db:migrate\n\nYou have 1 pending migration:\n\ndb/migrate/20240201213806_add_a_to_b.rb\nRun pending migrations? [Yn] Y\n== 20240201213806 AddAToB: migrating =========================================\n== 20240201213806 AddAToB: migrated (0.0000s) ================================\n\nRunning 7 tests in a single process (parallelization threshold is 50)\nRun options: --seed 22200\n\n# Running:\n\n.......\n\nFinished in 0.243394s, 28.7600 runs/s, 45.1942 assertions/s.\n7 runs, 11 assertions, 0 failures, 0 errors, 0 skips\n</code></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Right now this is only implemented in the Test Runner, but I'd also like to follow up with a similar implementation for <code class=\"notranslate\">Rails::Command::CorrectableNameError</code>s.</p>\n<p dir=\"auto\">Also we could introduce a new framework default for the configuration if this is the direction in this PR is acceptable.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50941",
            "title": "Retry `ActionableError`s when running tests",
            "date_modified": "2024-02-02T14:23:24.000Z",
            "date_published": "2024-02-01T21:50:43.000Z",
            "author": {
                "name": "andrewn617",
                "url": "https://github.com/andrewn617"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Ref: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2088694143\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50793\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50793/hovercard\" href=\"https://github.com/rails/rails/pull/50793\">#50793</a></p>\n<p dir=\"auto\">If we want to stop caching the checked out connections, then we must persist the cache in the pool, and assign it to the connection when it's checked out.</p>\n<p dir=\"auto\">The pool become responsible for managing the cache lifecycle.</p>\n<p dir=\"auto\">This also open the door to sharing the cache between multiple connections, which is valuable for read replicas, etc.</p>\n<p dir=\"auto\">This change only really make sense if we go through with no longer caching checked out connections. Otherwise it's just extra complexity.</p>",
            "url": "https://github.com/rails/rails/pull/50938",
            "title": "Refactor QueryCache to be owned by the pool",
            "date_modified": "2024-02-01T13:40:44.000Z",
            "date_published": "2024-02-01T13:40:41.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/79303?u=99e3bc7887879138e88a4538ca623b0a3d7538cb&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This fixes race condition in Active Storage when multiple preprocessed variants are defined for a <code class=\"notranslate\">Previewable</code> file is attached.</p>\n<h2 dir=\"auto\">Background</h2>\n<p dir=\"auto\">When a variant is specified for a \"previewable\" file type (e.g. video  or PDF) attachment, a <code class=\"notranslate\">preview_image</code> attachment is first created and attached on the original blob and then any user-specified variants are derived from <em>that</em> preview image. When those variants are named and have <code class=\"notranslate\">preprocessed: true</code>, the jobs to create those variants are queued simultaneously.</p>\n<p dir=\"auto\">Example from my case:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"  has_one_attached :file, dependent: :purge_later do |attachable|\n    attachable.variant :preview, resize_to_fill: [400, 400], preprocessed: true\n    attachable.variant :still, format: &quot;jpg&quot;, saver: {quality: 85}, preprocessed: true\n  end\"><pre class=\"notranslate\">  <span class=\"pl-en\">has_one_attached</span> <span class=\"pl-pds\">:file</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">dependent</span>: <span class=\"pl-pds\">:purge_later</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">attachable</span>|\n    <span class=\"pl-s1\">attachable</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">variant</span> <span class=\"pl-pds\">:preview</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">resize_to_fill</span>: <span class=\"pl-kos\">[</span><span class=\"pl-c1\">400</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">400</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">preprocessed</span>: <span class=\"pl-c1\">true</span>\n    <span class=\"pl-s1\">attachable</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">variant</span> <span class=\"pl-pds\">:still</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">format</span>: <span class=\"pl-s\">\"jpg\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">saver</span>: <span class=\"pl-kos\">{</span><span class=\"pl-pds\">quality</span>: <span class=\"pl-c1\">85</span><span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">preprocessed</span>: <span class=\"pl-c1\">true</span>\n  <span class=\"pl-k\">end</span></pre></div>\n<h2 dir=\"auto\">The issue</h2>\n<p dir=\"auto\">When a <code class=\"notranslate\">Previewable</code> attachment is created (a video, in my case), <code class=\"notranslate\">TransformJob.perform_later</code> is called for each named variant with <code class=\"notranslate\">preprocessed: true</code>. Unless your queue adapter is synchronous (e.g. :inline or :test), this results in a race condition in which every such variant's worker will check <code class=\"notranslate\">processed?</code>, see that no <code class=\"notranslate\">preview_image</code> attachment exists yet on the <code class=\"notranslate\">ActiveStorage::Blob</code>, and:</p>\n<ol dir=\"auto\">\n<li>Redundantly download the file from storage</li>\n<li>Create duplicative ActiveStorage::Attachment and <code class=\"notranslate\">ActiveStorage::Blob</code> records for the <code class=\"notranslate\">preview_image</code> attachment (all but one of which will be orphaned from the original blob's <code class=\"notranslate\">has_one_attached :preview_image</code>)</li>\n<li>Create variant blobs (and associated <code class=\"notranslate\">ActiveStorage::VariantRecord</code>) that are similarly orphaned (by virtue of being a variant of an orphaned <code class=\"notranslate\">preview_image</code> blob)</li>\n</ol>\n<p dir=\"auto\">As a result, if the video is ever purged, <code class=\"notranslate\">PurgeJob</code> will only find the current <code class=\"notranslate\">has_one_attached :preview_image</code> and whatever variant demanded it into existence, then leave the rest as orphaned records in the database and in storage.</p>\n<h2 dir=\"auto\">The fix</h2>\n<p dir=\"auto\">Pretty simple: wrap the first step of the job in <code class=\"notranslate\">blob.with_lock {}</code>. By pessimistically locking on the blob, we can prevent processing the preview image multiple times by multiple <code class=\"notranslate\">TransformJob</code> jobs running concurrently.</p>\n<p dir=\"auto\">Alternate approaches would all be more work:</p>\n<ul dir=\"auto\">\n<li>Queuing a <code class=\"notranslate\">PreviewImage</code> job instead of N <code class=\"notranslate\">TransformJob</code> and have it, only after <code class=\"notranslate\">preview_image</code> is attached, enqueue those <code class=\"notranslate\">TransformJob</code> jobs</li>\n<li>Batching up all the named variant transformations into a single meta-job</li>\n</ul>\n<h2 dir=\"auto\">Testing caveat</h2>\n<p dir=\"auto\">Writing a test for this inside Rails would be difficult because it would require running the resulting TransformJob jobs concurrently. I <a href=\"https://github.com/searls/rails/blob/fix-video-duplicate-preview-variants/activestorage/test/models/variant_with_record_test.rb#L348-L367\">started a test</a> but failed to reproduce, in part because the test queue adapter will perform enqueued jobs inline instead of concurrently. In order to write a test that replicated the issue appropriately, we might first need a new option for <code class=\"notranslate\">perform_enqueued_jobs(async: true) {¬†‚Ä¶ }</code></p>\n<p dir=\"auto\">If you're interested, <a href=\"https://gist.github.com/searls/5b8298abe88b3206f670ea3c6d574aab\">this gist</a> includes a driver script and output before and after the patch showing it working.</p>\n<h2 dir=\"auto\">Evaluating impact on existing Active Storage users</h2>\n<p dir=\"auto\">I only found this because I'm a total cheapskate and was literally counting records in my S3 bucket to ensure <code class=\"notranslate\">PurgeJob</code> worked. Then I wasted the next two days trying to figure out why before landing on this. I strongly suspect that ActiveStorage users who host video and take advantage of <code class=\"notranslate\">preprocessed: true</code> named variants will have a lot of orphaned stuff floating around their buckets.</p>\n<p dir=\"auto\">To see if you have any such \"zombie\" preview_images (and presumably, associated variants) floating around your application that would survive calls to <code class=\"notranslate\">purge</code> on the owning attachment, you could write a query like this:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ActiveStorage::Attachment\n  .joins(&quot;INNER JOIN active_storage_attachments as other_attachments ON\n          active_storage_attachments.record_id = other_attachments.record_id AND\n          active_storage_attachments.id != other_attachments.id&quot;)\n  .where(\n    :name =&gt; &quot;preview_image&quot;,\n    :record_type =&gt; &quot;ActiveStorage::Blob&quot;,\n    &quot;other_attachments.name&quot; =&gt; &quot;preview_image&quot;,\n    &quot;other_attachments.record_type&quot; =&gt; &quot;ActiveStorage::Blob&quot;\n  )\n  .distinct\"><pre class=\"notranslate\"><code class=\"notranslate\">ActiveStorage::Attachment\n  .joins(\"INNER JOIN active_storage_attachments as other_attachments ON\n          active_storage_attachments.record_id = other_attachments.record_id AND\n          active_storage_attachments.id != other_attachments.id\")\n  .where(\n    :name =&gt; \"preview_image\",\n    :record_type =&gt; \"ActiveStorage::Blob\",\n    \"other_attachments.name\" =&gt; \"preview_image\",\n    \"other_attachments.record_type\" =&gt; \"ActiveStorage::Blob\"\n  )\n  .distinct\n</code></pre></div>\n<p dir=\"auto\">Clearing out one's production database and backend storage to get this all right-sized should be a fun exercise for the reader.</p>",
            "url": "https://github.com/rails/rails/pull/50928",
            "title": "Fixes race condition for multiple preprocessed video variants",
            "date_modified": "2024-02-01T02:00:54.000Z",
            "date_published": "2024-01-31T18:49:44.000Z",
            "author": {
                "name": "searls",
                "url": "https://github.com/searls"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1734607?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">ActiveRecord Encryption doesn't prevent you from encrypting binary columns but it doesn't have proper support for it either.</p>\n<p dir=\"auto\">When the data is fed through encrypt/decrypt it is converted to a String. This means that the the encryption layer is not transparent to binary data - which should be passed as Type::Binary::Data.</p>\n<p dir=\"auto\">As a result the data is not properly escaped in the SQL queries or deserialized correctly after decryption.</p>\n<p dir=\"auto\">However it just happens to work fine for MySQL and SQLite because the MessageSerializer doesn't use any characters that need to be encoded. However if you try to use a custom serializer that does then it breaks.</p>\n<p dir=\"auto\">PostgreSQL on the other hand does not work - because the Bytea type is passed a String rather than a Type::Binary::Data to deserialize, it attempts to unescape the data and either mangles it or raises an error if it contains null bytes.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">The commit fixes the issue, by reserializing the data after encryption and decryption. For text data that's a no-op, but for binary data we'll convert it back to a Type::Binary::Data.</p>",
            "url": "https://github.com/rails/rails/pull/50920",
            "title": "Support encrypting binary columns",
            "date_modified": "2024-02-02T14:07:16.000Z",
            "date_published": "2024-01-30T10:53:34.000Z",
            "author": {
                "name": "djmb",
                "url": "https://github.com/djmb"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/12777550?u=415303ec1c626279c440cf729435fc0ee833d1c9&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">In certain situation, we might need to store and query <code class=\"notranslate\">negative</code> values. Having the option to bypass the auto-generated negative scopes can avoid the conflicts.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Add <code class=\"notranslate\">negative_scopes</code> option to <code class=\"notranslate\">ActiveRecord::Enum#enum</code>, this offers the flexibility to optionally skip the creation of negative scopes.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50919",
            "title": "Add negative_scopes option to ActiveRecord's enum method",
            "date_modified": "2024-01-30T09:40:23.000Z",
            "date_published": "2024-01-30T09:11:41.000Z",
            "author": {
                "name": "Jay0921",
                "url": "https://github.com/Jay0921"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/39735028?u=91330295c614cf3cec0b64bf242a14fc2ceb358f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2064753125\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50566\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50566/hovercard\" href=\"https://github.com/rails/rails/issues/50566\">#50566</a></p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created to generate <code class=\"notranslate\">devcontainer</code> files for new Rails apps.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds templates for devcontainer files (<code class=\"notranslate\">devcontainer.json</code>, <code class=\"notranslate\">Dockerfile</code> and <code class=\"notranslate\">docker-compose.yml</code>) to be generated on <code class=\"notranslate\">rails new</code>.</p>\n<p dir=\"auto\">By default the devcontainer contains the following:</p>\n<ul dir=\"auto\">\n<li>A redis container for use with Kredis, Action Cable etc.</li>\n<li>A database (SQLite, Postgres, MySQL or MariaDB)</li>\n<li>A Headless chrome container for system tests</li>\n<li>Active Storage configured to use the local disk and with preview features working</li>\n</ul>\n<p dir=\"auto\">If <code class=\"notranslate\">rails new</code> is called with options to skip any of the above they will be removed from the dev container config.</p>\n<p dir=\"auto\">The dev container can be skipped entirely with the <code class=\"notranslate\">--skip_devcontainer</code> option.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">A few changes are needed to other files generated by rails new to make sure new Rails apps can be developed both in a container and locally.</p>\n<ul dir=\"auto\">\n<li><del>Differentiate <code class=\"notranslate\">CABLE_REDIS_URL</code> and <code class=\"notranslate\">JOBS_REDIS_URL</code> instead of just using <code class=\"notranslate\">REDIS_URL</code> for both (A PR will need to be opened to turbo-rails to make this change as well)</del></li>\n<li><del>For MariaDB and MySQL use the <code class=\"notranslate\">RAILS_DATABASE_HOST</code> if it's set (which it will be in a container) and fallback to <code class=\"notranslate\">localhost</code></del></li>\n<li><del>For Postgres set the host (<code class=\"notranslate\">RAILS_DATABASE_HOST</code>), username and password when in a container`</del></li>\n</ul>\n<p dir=\"auto\">Based on feedback received I reverted the above ^. Instead we will just <code class=\"notranslate\">REDIS_URL</code> and <code class=\"notranslate\">DB_HOST</code>.</p>\n<p dir=\"auto\">For system tests, we need to configure the <code class=\"notranslate\">Capybara</code> host and port to the selenium container. Rather than expose the implementation details of <code class=\"notranslate\">Capybara</code> to the developer, we created a new <code class=\"notranslate\">served_by</code> method on <code class=\"notranslate\">SystemTestCase</code> to configure these.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50914",
            "title": "Generate devcontainer files by default",
            "date_modified": "2024-02-05T22:09:41.000Z",
            "date_published": "2024-01-29T23:03:25.000Z",
            "author": {
                "name": "andrewn617",
                "url": "https://github.com/andrewn617"
            }
        }
    ]
}