{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5122678?u=204301f9f9fe8930fd26fe3bfe65b6ffaffd8b59&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">In an effort to improve the developer experience when debugging generator tests, we add the ability to conditionally print <code class=\"notranslate\">$stdout</code> instead of capturing it.</p>\n<p dir=\"auto\">This allows for calls to <code class=\"notranslate\">binding.irb</code> and <code class=\"notranslate\">puts</code> work as expected.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"PRINT_STDOUT=true ./bin/test test/generators/actions_test.rb\"><pre class=\"notranslate\">PRINT_STDOUT=true ./bin/test test/generators/actions_test.rb</pre></div>\n<p dir=\"auto\">Prior to this commit, it was not possible to use these tools to effectively debug a test or related feature.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">By using an environment variable, we keep the method signature intact, while still allowing for an improved developer experience.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">We make the comparison on \"true\" in an effort to prevent something like following from working.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"PRINT_STDOUT=false ./bin/test test/generators/actions_test.rb\"><pre class=\"notranslate\"><code class=\"notranslate\">PRINT_STDOUT=false ./bin/test test/generators/actions_test.rb\n</code></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49448",
            "title": "Conditionally print `$stdout` when invoking `run_generator`",
            "date_modified": "2023-10-02T10:59:23.000Z",
            "date_published": "2023-10-01T23:48:23.000Z",
            "author": {
                "name": "stevepolitodesign",
                "url": "https://github.com/stevepolitodesign"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Prior to this commit, Blob analysis could only involve a single Analyzer. By default, the metadata typically includes information about dimensions (for image and video).</p>\n<p dir=\"auto\">If applications need to include more involved analysis, they also have to re-implement the dimension analysis on their own (either through composition, inheritance, or copy-pasting).</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit extends analysis to support <em>multiple</em> anaylzer classes by replacing <a href=\"https://ruby-doc.org/core-3.0.2/Enumerable.html#method-i-detect\" rel=\"nofollow\">Enumerable#detect</a> with <a href=\"https://ruby-doc.org/core-3.0.2/Enumerable.html#method-i-select\" rel=\"nofollow\">Enumerable#select</a>, and a <a href=\"https://ruby-doc.org/3.2.2/Hash.html#method-i-hash\" rel=\"nofollow\">Hash#merge</a> with an <a href=\"https://ruby-doc.org/core-3.0.2/Enumerable.html#method-i-reduce\" rel=\"nofollow\">Enumerable#reduce</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49445",
            "title": "Support multiple analyzers during `ActiveStorage::Blob#analyze`",
            "date_modified": "2023-10-01T21:15:46.000Z",
            "date_published": "2023-10-01T15:18:51.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/47848?u=41ccf0d1865a17f47d140f73a3293f1f3559fc0f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">We use <code class=\"notranslate\">klass</code> because <code class=\"notranslate\">class</code> is a reserved word in Ruby.</p>\n<p dir=\"auto\">But, any word ending with the suffix <code class=\"notranslate\">_class</code> isn't reserved, so we don't need to use the suffix <code class=\"notranslate\">_klass</code> anywhere.</p>",
            "url": "https://github.com/rails/rails/pull/49425",
            "title": "No more _klass",
            "date_modified": "2023-09-29T20:21:39.000Z",
            "date_published": "2023-09-29T00:36:08.000Z",
            "author": {
                "name": "rafaelfranca",
                "url": "https://github.com/rafaelfranca"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">The intent is to skip them if you don't have PG running locally but on CI it's supposed to be running.</p>\n<p dir=\"auto\">If we fail to connect, we should fail CI, not skip these tests.</p>",
            "url": "https://github.com/rails/rails/pull/49414",
            "title": "Do not skip Action Cable PG tests on CI",
            "date_modified": "2023-09-28T08:30:52.000Z",
            "date_published": "2023-09-28T08:30:48.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6826778?u=f003e43af6f187f1ff48cfb577150c77a54f4138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">We noticed a couple of spots where transaction tracking events were potentially incorrect.</p>\n<ul dir=\"auto\">\n<li>When the connection reconnects with <code class=\"notranslate\">restore_transactions: true</code>, we were keeping the original start time for the transaction. In this case, it makes more sense to treat these as two separate transactions for tracking purposes.</li>\n<li>If you manually call <code class=\"notranslate\">reconnect!</code> within a transaction opened via <code class=\"notranslate\">being_transaction</code> rather than <code class=\"notranslate\">transaction do</code>, we were never marking the event as finished and thus never broadcasting the event. This isn't public API and likely isn't very common, but we did run into one scenario in a test file that was doing this in a setup block.</li>\n</ul>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">We added a line to the <code class=\"notranslate\">reset_transactions</code> method to mark any open transactions as finished. We went back and forth on the naming for this new method, but eventually settled on <code class=\"notranslate\">suspend_transactions</code> since the transactions may potentially be restarted.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This is a followup to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1886527188\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49192\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49192/hovercard\" href=\"https://github.com/rails/rails/pull/49192\">#49192</a>  and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1895181637\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49262\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49262/hovercard\" href=\"https://github.com/rails/rails/pull/49262\">#49262</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49391",
            "title": "Ensure transaction tracking finishes when reconnecting",
            "date_modified": "2023-09-30T03:43:45.000Z",
            "date_published": "2023-09-26T16:56:05.000Z",
            "author": {
                "name": "ipc103",
                "url": "https://github.com/ipc103"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">ActionView::Helpers::TagHelper::TagBuilder</code> class renders HTML elements based on the methods invoked on it. For example, <code class=\"notranslate\">tag.input</code> will render an <code class=\"notranslate\">&lt;input&gt;</code> element, while <code class=\"notranslate\">tag.turbo_frame</code> will render a <code class=\"notranslate\">&lt;turbo-frame&gt;</code> element.</p>\n<p dir=\"auto\">The magic of the class is rooted in its definition of <code class=\"notranslate\">#method_missing</code>.</p>\n<p dir=\"auto\">The current implementation bakes-in special treatment of void HTML elements (for example: <code class=\"notranslate\">&lt;input&gt;</code>) and self-closing SVG elements (for example: <code class=\"notranslate\">&lt;use /&gt;</code>). Despite its ahead-of-time knowledge of these element names, calls to corresponding methods <code class=\"notranslate\">tag.input</code> and <code class=\"notranslate\">tag.use</code> still rely on <code class=\"notranslate\">#method_missing</code>.</p>\n<p dir=\"auto\">This has performance implications.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit defines a new <code class=\"notranslate\">TagBuilder.define_void_element</code> class method to dynamically define methods for each known element. Then, the class invokes the method for each element name in <code class=\"notranslate\">HTML_VOID_ELEMENTS</code> and <code class=\"notranslate\">SVG_SELF_CLOSING_ELEMENTS</code>.</p>\n<p dir=\"auto\">Calls to <code class=\"notranslate\">.define_void_element</code> and <code class=\"notranslate\">.define_self_closing_element</code> make<br>\n<code class=\"notranslate\">HTML_VOID_ELEMENTS</code> and <code class=\"notranslate\">SVG_SELF_CLOSING_ELEMENTS</code> unnecessary, so<br>\nthis commit removes those constant definitions.</p>\n<p dir=\"auto\">The list of elements was generated from MDN's <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element\" rel=\"nofollow\">HTML elements reference</a> documentation.</p>\n<p dir=\"auto\">By cutting out the reliance on method missing, calls to <code class=\"notranslate\">TagBuilder</code> methods (like <code class=\"notranslate\">tag.input</code>) become comparable to calls to the <code class=\"notranslate\">tag</code> view helper with positional arguments (like <code class=\"notranslate\">tag(:input)</code>).</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"❯ ruby bench.rb\nWarming up --------------------------------------\n                 tag    73.438k i/100ms\n         tag_builder    79.910k i/100ms\nCalculating -------------------------------------\n                 tag    732.467k (± 0.9%) i/s -      3.672M in   5.013504s\n         tag_builder    810.981k (± 0.8%) i/s -      4.075M in   5.025632s\n\nComparison:\n         tag_builder:   810981.5 i/s\n                 tag:   732467.4 i/s - 1.11x  (± 0.00) slower\"><pre class=\"notranslate\"><code class=\"notranslate\">❯ ruby bench.rb\nWarming up --------------------------------------\n                 tag    73.438k i/100ms\n         tag_builder    79.910k i/100ms\nCalculating -------------------------------------\n                 tag    732.467k (± 0.9%) i/s -      3.672M in   5.013504s\n         tag_builder    810.981k (± 0.8%) i/s -      4.075M in   5.025632s\n\nComparison:\n         tag_builder:   810981.5 i/s\n                 tag:   732467.4 i/s - 1.11x  (± 0.00) slower\n</code></pre></div>\n<p dir=\"auto\">The results were from the following benchmark rendering void (<code class=\"notranslate\">&lt;input&gt;</code>) elements:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\" # frozen_string_literal: true\n\nrequire &quot;bundler/setup&quot;\n\nrequire &quot;action_view&quot;\nrequire &quot;minitest/autorun&quot;\nrequire &quot;benchmark/ips&quot;\n\nclass Foo\n  include ActionView::Helpers\nend\n\nhelpers = Foo.new\n\nBenchmark.ips do |x|\n  x.report(&quot;tag&quot;) { helpers.tag(&quot;input&quot;, value: &quot;foo&quot;) }\n  x.report(&quot;tag_builder&quot;) { helpers.tag.input(value: &quot;foo&quot;) }\n  x.compare!\nend\"><pre class=\"notranslate\"> <span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/setup\"</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"action_view\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"minitest/autorun\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"benchmark/ips\"</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Foo</span>\n  <span class=\"pl-en\">include</span> <span class=\"pl-v\">ActionView</span>::<span class=\"pl-v\">Helpers</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">helpers</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Foo</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n\n<span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"tag\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">helpers</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">tag</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"input\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">value</span>: <span class=\"pl-s\">\"foo\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"tag_builder\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">helpers</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">tag</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">input</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">value</span>: <span class=\"pl-s\">\"foo\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">compare!</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Similar to <code class=\"notranslate\">tag.input</code> (a void HTML element), calls to <code class=\"notranslate\">tag.div</code> are somewhat comparable to <code class=\"notranslate\">tag(\"div\")</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"❯ ruby bench.rb\nWarming up --------------------------------------\n         content_tag    59.548k i/100ms\n         tag_builder    51.215k i/100ms\nCalculating -------------------------------------\n         content_tag    595.067k (± 0.5%) i/s -      2.977M in   5.003570s\n         tag_builder    505.553k (± 2.2%) i/s -      2.561M in   5.067704s\n\nComparison:\n         content_tag:   595067.5 i/s\n         tag_builder:   505552.6 i/s - 1.18x  (± 0.00) slower\"><pre class=\"notranslate\"><code class=\"notranslate\">❯ ruby bench.rb\nWarming up --------------------------------------\n         content_tag    59.548k i/100ms\n         tag_builder    51.215k i/100ms\nCalculating -------------------------------------\n         content_tag    595.067k (± 0.5%) i/s -      2.977M in   5.003570s\n         tag_builder    505.553k (± 2.2%) i/s -      2.561M in   5.067704s\n\nComparison:\n         content_tag:   595067.5 i/s\n         tag_builder:   505552.6 i/s - 1.18x  (± 0.00) slower\n</code></pre></div>\n<p dir=\"auto\">The following benchmarks were collected to compare <code class=\"notranslate\">tag(\"turbo-frame\")</code><br>\n(an unknown custom HTML element) and <code class=\"notranslate\">tag.turbo_frame</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"❯ ruby bench.rb\nWarming up --------------------------------------\n         content_tag    56.152k i/100ms\n         tag_builder    49.207k i/100ms\nCalculating -------------------------------------\n         content_tag    561.134k (± 0.5%) i/s -      2.808M in   5.003567s\n         tag_builder    491.178k (± 0.3%) i/s -      2.460M in   5.009140s\n\nComparison:\n         content_tag:   561133.8 i/s\n         tag_builder:   491177.7 i/s - 1.14x  (± 0.00) slower\"><pre class=\"notranslate\"><code class=\"notranslate\">❯ ruby bench.rb\nWarming up --------------------------------------\n         content_tag    56.152k i/100ms\n         tag_builder    49.207k i/100ms\nCalculating -------------------------------------\n         content_tag    561.134k (± 0.5%) i/s -      2.808M in   5.003567s\n         tag_builder    491.178k (± 0.3%) i/s -      2.460M in   5.009140s\n\nComparison:\n         content_tag:   561133.8 i/s\n         tag_builder:   491177.7 i/s - 1.14x  (± 0.00) slower\n</code></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49390",
            "title": "Define `TagBuilder` methods for known HTML Elements",
            "date_modified": "2023-09-29T19:53:03.000Z",
            "date_published": "2023-09-26T16:31:32.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/688886?u=75c4028c534ed5024b1c9bbbe0144e4ea065a847&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This PR resolves pg_stat_statements churn for Postgres databases, as described on the forum: <a href=\"https://discuss.rubyonrails.org/t/83667\" rel=\"nofollow\">https://discuss.rubyonrails.org/t/83667</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Currently, array inclusion queries like <code class=\"notranslate\">where(id: [1,2])</code> generate the SQL <code class=\"notranslate\">id IN (1, 2)</code>. Each distinct array length gets normalized separately, resulting in a high number of duplicates in pg_stat_statements and causing churn as there is a limit on the number of queries tracked.</p>\n<p dir=\"auto\">This PR adds a patch for Postgres that generates <code class=\"notranslate\">id = any('{1,2}')</code>, which pg_stat_statements normalizes as a single query no matter the array length.</p>\n<p dir=\"auto\"><code class=\"notranslate\">NOT IN</code> is implemented using <code class=\"notranslate\">!= all()</code> <a href=\"https://stackoverflow.com/a/11730845\" rel=\"nofollow\">https://stackoverflow.com/a/11730845</a></p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This turns out to be a good deal faster (using Postgres 15.4). Here are the min and max iterations per second from several benchmark runs:</p>\n<ul dir=\"auto\">\n<li>490 - 600 on the main branch</li>\n<li>750 - 950 on this branch with <code class=\"notranslate\">BENCHMARK_PREPARED=1</code></li>\n<li>780 - 1020 on this branch with <code class=\"notranslate\">BENCHMARK_PREPARED=0</code></li>\n</ul>\n<details><summary>Here's the benchmark:</summary>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# Adapted from activerecord/examples/performance.rb\n\nrequire &quot;active_record&quot;\nrequire &quot;benchmark/ips&quot;\n\nTIME    = (ENV[&quot;BENCHMARK_TIME&quot;] || 20).to_i\nRECORDS = (ENV[&quot;BENCHMARK_RECORDS&quot;] || TIME * 1000).to_i\n\nconn = {\n  adapter: &quot;postgresql&quot;,\n  database: &quot;postgres&quot;,\n  prepared_statements: ENV[&quot;BENCHMARK_PREPARED&quot;] == &quot;1&quot;\n}\n\nActiveRecord::Base.establish_connection(conn)\n\nclass User &lt; ActiveRecord::Base\n  connection.create_table :users, force: true do |t|\n    t.string :name, :email\n    t.timestamps\n  end\nend\n\ndef progress_bar(int); print &quot;.&quot; if (int % 100).zero? ; end\n\nputs &quot;Generating data...&quot;\n\nmodule ActiveRecord\n  class Faker\n    LOREM = &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse non aliquet diam. Curabitur vel urna metus, quis malesuada elit.\n     Integer consequat tincidunt felis. Etiam non erat dolor. Vivamus imperdiet nibh sit amet diam eleifend id posuere diam malesuada. Mauris at accumsan sem.\n     Donec id lorem neque. Fusce erat lorem, ornare eu congue vitae, malesuada quis neque. Maecenas vel urna a velit pretium fermentum. Donec tortor enim,\n     tempor venenatis egestas a, tempor sed ipsum. Ut arcu justo, faucibus non imperdiet ac, interdum at diam. Pellentesque ipsum enim, venenatis ut iaculis vitae,\n     varius vitae sem. Sed rutrum quam ac elit euismod bibendum. Donec ultricies ultricies magna, at lacinia libero mollis aliquam. Sed ac arcu in tortor elementum\n     tincidunt vel interdum sem. Curabitur eget erat arcu. Praesent eget eros leo. Nam magna enim, sollicitudin vehicula scelerisque in, vulputate ut libero.\n     Praesent varius tincidunt commodo&quot;.split\n\n    def self.name\n      LOREM.grep(/^\\w*$/).sort_by { rand }.first(2).join &quot; &quot;\n    end\n\n    def self.email\n      LOREM.grep(/^\\w*$/).sort_by { rand }.first(2).join(&quot;@&quot;) + &quot;.com&quot;\n    end\n  end\nend\n\nbegin\n  puts &quot;Inserting #{RECORDS} users...&quot;\n  RECORDS.times do |record|\n    user = User.create(\n      created_at: Date.today,\n      name: ActiveRecord::Faker.name,\n      email: ActiveRecord::Faker.email\n    )\n    progress_bar(record)\n  end\n  puts &quot;Done!\\n&quot;\n\n  Benchmark.ips(TIME) do |x|\n    x.report &quot;Model.where(id: [...])&quot; do\n      User.where(id: (1..100).to_a).count\n    end\n  end\nensure\n  User.connection.drop_table :users\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># Adapted from activerecord/examples/performance.rb</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_record\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"benchmark/ips\"</span>\n\n<span class=\"pl-c1\">TIME</span>    <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"BENCHMARK_TIME\"</span><span class=\"pl-kos\">]</span> || <span class=\"pl-c1\">20</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_i</span>\n<span class=\"pl-c1\">RECORDS</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"BENCHMARK_RECORDS\"</span><span class=\"pl-kos\">]</span> || <span class=\"pl-c1\">TIME</span> * <span class=\"pl-c1\">1000</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_i</span>\n\n<span class=\"pl-s1\">conn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-pds\">adapter</span>: <span class=\"pl-s\">\"postgresql\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">database</span>: <span class=\"pl-s\">\"postgres\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">prepared_statements</span>: <span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"BENCHMARK_PREPARED\"</span><span class=\"pl-kos\">]</span> == <span class=\"pl-s\">\"1\"</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">establish_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">conn</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">User</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:users</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:email</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">timestamps</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">progress_bar</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">int</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span> <span class=\"pl-en\">print</span> <span class=\"pl-s\">\".\"</span> <span class=\"pl-k\">if</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">int</span> % <span class=\"pl-c1\">100</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">zero?</span> <span class=\"pl-kos\">;</span> <span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Generating data...\"</span>\n\n<span class=\"pl-k\">module</span> <span class=\"pl-v\">ActiveRecord</span>\n  <span class=\"pl-k\">class</span> <span class=\"pl-v\">Faker</span>\n    <span class=\"pl-c1\">LOREM</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse non aliquet diam. Curabitur vel urna metus, quis malesuada elit.</span>\n<span class=\"pl-s\">     Integer consequat tincidunt felis. Etiam non erat dolor. Vivamus imperdiet nibh sit amet diam eleifend id posuere diam malesuada. Mauris at accumsan sem.</span>\n<span class=\"pl-s\">     Donec id lorem neque. Fusce erat lorem, ornare eu congue vitae, malesuada quis neque. Maecenas vel urna a velit pretium fermentum. Donec tortor enim,</span>\n<span class=\"pl-s\">     tempor venenatis egestas a, tempor sed ipsum. Ut arcu justo, faucibus non imperdiet ac, interdum at diam. Pellentesque ipsum enim, venenatis ut iaculis vitae,</span>\n<span class=\"pl-s\">     varius vitae sem. Sed rutrum quam ac elit euismod bibendum. Donec ultricies ultricies magna, at lacinia libero mollis aliquam. Sed ac arcu in tortor elementum</span>\n<span class=\"pl-s\">     tincidunt vel interdum sem. Curabitur eget erat arcu. Praesent eget eros leo. Nam magna enim, sollicitudin vehicula scelerisque in, vulputate ut libero.</span>\n<span class=\"pl-s\">     Praesent varius tincidunt commodo\"</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">split</span>\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span>\n      <span class=\"pl-c1\">LOREM</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">grep</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/^<span class=\"pl-cce\">\\w</span>*$/</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">sort_by</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">rand</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">2</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span> <span class=\"pl-s\">\" \"</span>\n    <span class=\"pl-k\">end</span>\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">email</span>\n      <span class=\"pl-c1\">LOREM</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">grep</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/^<span class=\"pl-cce\">\\w</span>*$/</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">sort_by</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">rand</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">2</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"@\"</span><span class=\"pl-kos\">)</span> + <span class=\"pl-s\">\".com\"</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">begin</span>\n  <span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Inserting <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-c1\">RECORDS</span><span class=\"pl-kos\">}</span></span> users...\"</span>\n  <span class=\"pl-c1\">RECORDS</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">times</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">record</span>|\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create</span><span class=\"pl-kos\">(</span>\n      <span class=\"pl-pds\">created_at</span>: <span class=\"pl-v\">Date</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">today</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-pds\">name</span>: <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Faker</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-pds\">email</span>: <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Faker</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">email</span>\n    <span class=\"pl-kos\">)</span>\n    <span class=\"pl-en\">progress_bar</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">record</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Done!<span class=\"pl-cce\">\\n</span>\"</span>\n\n  <span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">TIME</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n    <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span> <span class=\"pl-s\">\"Model.where(id: [...])\"</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">id</span>: <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1</span>..<span class=\"pl-c1\">100</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_a</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">count</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">ensure</span>\n  <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">drop_table</span> <span class=\"pl-pds\">:users</span>\n<span class=\"pl-k\">end</span></pre></div>\n</details>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49388",
            "title": "Reduce pg_stat_statements churn using `= any()` instead of `IN ()`",
            "date_modified": "2023-10-02T00:35:59.000Z",
            "date_published": "2023-09-26T16:23:19.000Z",
            "author": {
                "name": "seanlinsley",
                "url": "https://github.com/seanlinsley"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/47848?u=41ccf0d1865a17f47d140f73a3293f1f3559fc0f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">It is not removing all the shards connections when we call it.</p>\n<p dir=\"auto\">It is because the first time we call it we are resetting the <code class=\"notranslate\">connection_specification_name</code> so the next call doesn't find the right connection pool.</p>",
            "url": "https://github.com/rails/rails/pull/49382",
            "title": "Add failing test for remove_connection",
            "date_modified": "2023-09-28T17:05:37.000Z",
            "date_published": "2023-09-26T00:16:29.000Z",
            "author": {
                "name": "rafaelfranca",
                "url": "https://github.com/rafaelfranca"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Follow-up to <a href=\"https://github.com/rails/rails/pull/49371\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49371/hovercard\">#49371</a></p>\n<p dir=\"auto\">In the wake of the deprecation of <code class=\"notranslate\">tag(:div)</code> in favor of <code class=\"notranslate\">tag.div</code>, this commit replaces all calls made internally with the more modern syntax.</p>\n<p dir=\"auto\">This change is separate from the deprecation cycle, since there are <strong>slight</strong> behavioral changes, since the HTML output changes from self-closing elements like <code class=\"notranslate\">&lt;input /&gt;</code> to open void elements like <code class=\"notranslate\">&lt;input&gt;</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49377",
            "title": "Action View: Remove internal calls to `tag` with positional arguments",
            "date_modified": "2023-09-26T16:33:30.000Z",
            "date_published": "2023-09-25T13:10:59.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5077225?u=e9f968c9eb790ee7734442f6b7998155400ad1d8&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">SQLite is a feature-rich database engine, and production usage is only growing. We need Rails' support to offer developers the range and scope of its features.</p>\n<p dir=\"auto\">The PostgreSQL adapter supports deferred foreign keys, and SQLite itself has support <a href=\"https://www.sqlite.org/foreignkeys.html#fk_deferred\" rel=\"nofollow\">deferred foreign keys</a> <a href=\"https://www.sqlite.org/releaselog/3_7_6.html\" rel=\"nofollow\">since at least 2011</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Implementing the full <code class=\"notranslate\">supports_deferrable_constraints?</code> contract allows foreign keys to be deferred by adding the <code class=\"notranslate\">:deferrable</code> key to the <code class=\"notranslate\">foreign_key</code> options in the <code class=\"notranslate\">add_reference</code> and <code class=\"notranslate\">add_foreign_key</code> methods.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"add_reference :person, :alias, foreign_key: { deferrable: :deferred }\nadd_reference :alias, :person, foreign_key: { deferrable: :deferred }\"><pre class=\"notranslate\"><span class=\"pl-en\">add_reference</span> <span class=\"pl-pds\">:person</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:alias</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">foreign_key</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">deferrable</span>: <span class=\"pl-pds\">:deferred</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-en\">add_reference</span> <span class=\"pl-pds\">:alias</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:person</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">foreign_key</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">deferrable</span>: <span class=\"pl-pds\">:deferred</span> <span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">In this PR, I am adding full support for the SQLite3Adapter by implementing:</p>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaCreation#visit_AddForeignKey</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaCreation#visit_ForeignKeyDefinition</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#supports_deferrable_constraints?</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaStatements#assert_valid_deferrable</code></p>\n<p dir=\"auto\">and altering:</p>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaStatements#add_foreign_key</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#foreign_keys</code></p>\n<h3 dir=\"auto\">Additional Info</h3>\n<p dir=\"auto\">In order to get the <code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#foreign_keys</code> method working properly, I had to add a query to get the <code class=\"notranslate\">CREATE TABLE</code> sql and parse which foreign key constraints are deferrable and which of those are deferred. In order to support this use-case, I extracted a <code class=\"notranslate\">table_structure_sql</code> method which now <code class=\"notranslate\">table_structure_with_collation</code> relies on.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49376",
            "title": "The SQLite3 adapter now implements the `supports_deferrable_constraints?` contract",
            "date_modified": "2023-09-29T20:28:26.000Z",
            "date_published": "2023-09-25T08:41:00.000Z",
            "author": {
                "name": "fractaledmind",
                "url": "https://github.com/fractaledmind"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h2 dir=\"auto\">The bulk of this diff is related to indentation changes, so it's best reviewed <a href=\"https://github.com/rails/rails/pull/49371/files?w=1\">ignoring spacing changes</a></h2>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Modern evolutions of the <code class=\"notranslate\">ActionView::Helpers::TagHelper#tag</code> method are intended to be called <em>on</em> the <code class=\"notranslate\">TagBuilder</code> instance itself instead of with positional arguments.</p>\n<p dir=\"auto\">For example, <code class=\"notranslate\">tag(\"div\")</code> would be called with <code class=\"notranslate\">tag.div</code>.</p>\n<p dir=\"auto\">According to the <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag-label-Legacy+syntax\" rel=\"nofollow\">Legacy Syntax</a> heading of the <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag\" rel=\"nofollow\">ActionView::Helpers::TagHelper#tag</a> guides:</p>\n<blockquote>\n<p dir=\"auto\">The following format is for legacy syntax support. It will be deprecated in future versions of Rails.</p>\n</blockquote>\n<p dir=\"auto\">Since deprecations must occur during releases, this commit proposes that 7.2 be the release to start the deprecation process so that a subsequent release can remove \"Legacy syntax\" support entirely.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit adds a deprecation warning to encourage callers to invoke the helper in the more modern style.</p>\n<p dir=\"auto\">Internally, Rails utilizes the positional argument syntax in several places. Since deprecations must be part of minor version releases, this commit wraps the internal invocations in <code class=\"notranslate\">ActionView.deprecator.silence</code> blocks so that they can remain while the deprecation is made public. This compromise buys the framework time to re-structure those invocations to be compatible with the more modern syntax before the next major release.</p>\n<p dir=\"auto\">There are several calls to <code class=\"notranslate\">tag</code> with positional arguments in the test suite. This commit wraps those as well. In the future, some of those tests will be able to remove those blocks, while other tests will be able to be removed entirely once that style of invocation is no longer supported.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49371",
            "title": "Deprecate `tag` with positional arguments",
            "date_modified": "2023-09-25T20:29:14.000Z",
            "date_published": "2023-09-25T00:50:17.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">TagBuilder</code> instance returned by the<br>\n<a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag\" rel=\"nofollow\">ActionView::Helpers::TagHelper#tag</a> method has the ability to build various HTML elements through its reliance on <code class=\"notranslate\">method_missing</code>. The magic of that instance hinges on the fact that it has a <strong>minimal</strong> public interface, and transforms missing methods names into HTML elements. For example, calling <code class=\"notranslate\">tag.div</code> invokes a missing <code class=\"notranslate\">#div</code> method, which renders a <code class=\"notranslate\">&lt;div&gt;</code> element.</p>\n<p dir=\"auto\">There are two exceptional cases:</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">tag.p</code> is defined, since the existing <a href=\"https://ruby-doc.org/3.2.2/Kernel.html#method-i-p\" rel=\"nofollow\">Kernel#p</a> definition would prevent the underlying <code class=\"notranslate\">#method_missing</code> invocation</li>\n<li><code class=\"notranslate\">tag.attributes</code> is a defined method to transform <code class=\"notranslate\">Hash</code> instances and keyword arguments in HTML attribute strings</li>\n</ul>\n<p dir=\"auto\">In addition to those two <em>intentional</em> exceptions, there are also several methods that are incidentally part of the public interface:</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">#tag_string</code></li>\n<li><code class=\"notranslate\">#content_tag_string</code></li>\n<li><code class=\"notranslate\">#tag_options</code></li>\n<li><code class=\"notranslate\">#boolean_tag_option</code></li>\n<li><code class=\"notranslate\">#tag_option</code></li>\n</ul>\n<p dir=\"auto\">Along with those methods, the class also includes <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/OutputSafetyHelper.html\" rel=\"nofollow\">OutputSafetyHelper</a> and <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/CaptureHelper.html\" rel=\"nofollow\">CaptureHelper</a>, which expand surface area of the class's public interface even further.</p>\n<p dir=\"auto\">While it's unlikely that these methods would collide with method invocations intended to construct HTML elements, they still impact that design of the object.</p>\n<p dir=\"auto\">The \"public\" nature of the <code class=\"notranslate\">TagBuilder</code> interface has some subtle nuances. While it <strong>is</strong> marked with <code class=\"notranslate\">:nodoc:</code>, instances are returned by a public <code class=\"notranslate\">tag</code> method, despite it being considered a private class only meant for internal consumption.</p>\n<p dir=\"auto\">That same is true for the incidentally public methods mentioned above: no consuming applications should be invoking <code class=\"notranslate\">#tag_string</code> or <code class=\"notranslate\">#tag_options</code>. While that's true, those methods <em>are</em> being invoked <strong>directly</strong> by other Action View classes.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit removes those invocations, and instead replaces them with public method calls.</p>\n<p dir=\"auto\">In cases where the tag name is statically know ahead of time, they're replaced with calls to that method (for example, <code class=\"notranslate\">tag(:option)</code> becomes <code class=\"notranslate\">tag.option</code>). When they're dynamic, they're replaced by calls to <a href=\"https://ruby-doc.org/3.2.2/Object.html#method-i-public_send\" rel=\"nofollow\">public_send</a> (for example, <code class=\"notranslate\">tag(name)</code> becomes<br>\n<code class=\"notranslate\">tag.public_send(name)</code>).</p>\n<p dir=\"auto\">The majority of these changes are painless, with one exception. Some calls to the <code class=\"notranslate\">#tag</code> helper also pass an <code class=\"notranslate\">open</code> positional argument that isn't part of the <code class=\"notranslate\">TagBuilder</code> class's public interface. As a result, that becomes slightly more complicated, and requires some String mutation to continue to pass the test suite.</p>\n<p dir=\"auto\">This commit also removes the <code class=\"notranslate\">OutputSafetyHelper</code> and <code class=\"notranslate\">CaptureHelper</code> modules from the class, and delegates to the methods it depended on to j<code class=\"notranslate\">@view_context</code>.</p>\n<p dir=\"auto\">Hopefully, calls to <code class=\"notranslate\">#tag</code> with positional arguments are less and less common, since the documentation describes it as a <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag-label-Legacy+syntax\" rel=\"nofollow\">Legacy Syntax</a> marked for deprecation in future versions of Rails.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49369",
            "title": "Action View: Reduce public API of `tag` helper",
            "date_modified": "2023-09-26T02:32:21.000Z",
            "date_published": "2023-09-24T21:36:45.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Since the <code class=\"notranslate\">ActionView::Helpers::TagBuilder</code> class is marked with <code class=\"notranslate\">:nodoc:</code>, the <code class=\"notranslate\">tag.attributes</code> method isn't directly discoverable by the <a href=\"https://api.rubyonrails.org\" rel=\"nofollow\">API Documentation</a>, despite it being mentioned under the <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag-label-Building+HTML+attributes\" rel=\"nofollow\">Building HTML Attributes</a> subheading of the <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag\" rel=\"nofollow\">tag</a> helper method documentation.</p>\n<p dir=\"auto\">Similarly, methods like <code class=\"notranslate\">tag.div</code> and <code class=\"notranslate\">tag.h1</code> are also not discoverable, since they're dependent on method missing.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit adds RubyDoc comments for <code class=\"notranslate\">tag.attributes</code> and <code class=\"notranslate\">tag.*</code> to provide hooks for the <a href=\"https://api.rubyonrails.org\" rel=\"nofollow\">API Documentation</a> to serve search results.</p>\n<p dir=\"auto\">The contents of the new comments is lifted directly from the longer-form <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag\" rel=\"nofollow\">tag</a> helper method comment block.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49368",
            "title": "Action View: Document `tag.attributes` and `tag.$ELEMENT` [ci skip]",
            "date_modified": "2023-09-26T03:13:01.000Z",
            "date_published": "2023-09-24T21:19:34.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/25947043?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">actioncable-examples</code> repo referenced in the guide is no longer maintained: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1796796167\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/actioncable-examples/issues/46\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/actioncable-examples/pull/46/hovercard?comment_id=1647505744&amp;comment_type=issue_comment\" href=\"https://github.com/rails/actioncable-examples/pull/46#issuecomment-1647505744\">rails/actioncable-examples#46 (comment)</a>. We should remove it from the guide.</p>\n<p dir=\"auto\">I also took the opportunity to update the guide with new sections on importing JavaScript channel files, <code class=\"notranslate\">bin/rails generate channel</code>, and stopping streams.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the following:</p>\n<ul dir=\"auto\">\n<li>Remove unmaintained <code class=\"notranslate\">actioncable-examples</code> reference. For more info: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1796796167\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/actioncable-examples/issues/46\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/actioncable-examples/pull/46/hovercard?comment_id=1647505744&amp;comment_type=issue_comment\" href=\"https://github.com/rails/actioncable-examples/pull/46#issuecomment-1647505744\">rails/actioncable-examples#46 (comment)</a></li>\n<li>Add <code class=\"notranslate\">disconnect</code> and <code class=\"notranslate\">unsubscribed</code> methods to the example connection and channel files.</li>\n<li>Add reference for <code class=\"notranslate\">bin/rails generate channel</code></li>\n<li>Add guide on importing JavaScript channel files with import maps.</li>\n<li>Add section on stopping streams</li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The new sections are easily found in the API documentation. That said, I still think it's valuable to add them to the guide for new developers.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49365",
            "title": "Update Action Cable Overview guide",
            "date_modified": "2023-09-27T08:41:27.000Z",
            "date_published": "2023-09-24T04:07:09.000Z",
            "author": {
                "name": "julianfssen",
                "url": "https://github.com/julianfssen"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Previously, new apps would have a Ruby version set in both the Gemfile and the .ruby-version file. This duplication makes it more difficult to quickly change an application's ruby version as users must remember to update multiple files.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit updates the app generator's Gemfile to read the Ruby version from the .ruby-version file. Since this feature was introduced in the latest version of Bundler, it will only be enabled if a supported version of Bundler is used.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Alternatively, another solution mentioned on the original PR adding .ruby-version was that the .ruby-version file could be removed once rvm/rbenv support reading the Ruby version from the Gemfile. This has a downside that many other tools like chruby do not have plans to support reading a Ruby version from the Gemfile, and so users of those tools would have a worse experience if the .ruby-version file is removed.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49360",
            "title": "Use `ruby file: \".ruby-version\"` for new apps",
            "date_modified": "2023-09-24T07:34:16.000Z",
            "date_published": "2023-09-23T20:06:37.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1558372?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because I'd like to get the label of the fixture that created a record.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">When working with fixtures, it inserts records in the database at the beginning of the test suite. I like to validate those fixtures to avoid inserting invalid data for testing. In case of validation error, I need to find out which fixture created the failing record. For some models it's easy to go from one record  to the fixture that created it, for other models it can be more complicated, for example a join model with an id and foreign_keys.</p>\n<p dir=\"auto\">This PR introduces <code class=\"notranslate\">ActiveRecord::FixtureSet.label_of(record)</code> which will return the fixture label of the record if it was created by a fixture.</p>\n<p dir=\"auto\">I'd like to get feedback regarding this PR and could it be useful in the project ?<br>\nThis is working for records with primary_key.<br>\nComposite primary keys are not supported, should it be supported in this PR ?</p>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49348",
            "title": "Get fixture label from a record",
            "date_modified": "2023-09-21T23:43:41.000Z",
            "date_published": "2023-09-21T21:27:36.000Z",
            "author": {
                "name": "jean-francois-labbe",
                "url": "https://github.com/jean-francois-labbe"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5077225?u=e9f968c9eb790ee7734442f6b7998155400ad1d8&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">SQLite is a feature-rich database engine, and production usage is only growing. We need Rails' support to offer developers the range and scope of its features.</p>\n<p dir=\"auto\">Both the MySQL and PostgreSQL adapters support virtual columns, and SQLite itself has support generated columns <a href=\"https://www.sqlite.org/releaselog/3_31_0.html\" rel=\"nofollow\">since 2020</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"851659992\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/41856\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/41856/hovercard\" href=\"https://github.com/rails/rails/pull/41856\">#41856</a> introduced virtual columns to the PostgreSQLAdapter. This is effectively a clone of that feature, with some necessary tweaks.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"create_table :users do |t|\n  t.string :name\n  t.virtual :name_upper, type: :string, as: 'UPPER(name)'\n  t.virtual :name_lower, type: :string, as: 'LOWER(name)', stored: true\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:users</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:name</span>\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">virtual</span> <span class=\"pl-pds\">:name_upper</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">type</span>: <span class=\"pl-pds\">:string</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">as</span>: <span class=\"pl-s\">'UPPER(name)'</span>\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">virtual</span> <span class=\"pl-pds\">:name_lower</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">type</span>: <span class=\"pl-pds\">:string</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">as</span>: <span class=\"pl-s\">'LOWER(name)'</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">stored</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Firstly, SQLite supported both <code class=\"notranslate\">STORED</code> and <code class=\"notranslate\">VIRTUAL</code> generated columns, while PostgreSQL only supports <code class=\"notranslate\">VIRTUAL</code>. Secondly, SQLite doesn't support <code class=\"notranslate\">ALTER TABLE</code> commands with generated columns.</p>\n<p dir=\"auto\">In this PR, I am adding full support for the SQLite3Adapter by implementing:</p>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::Column#virtual?</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#supports_virtual_columns?</code></p>\n<p dir=\"auto\">and altering:</p>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaCreation#add_column_options</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaDefinitions#new_column_definition</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaDumper#prepare_column_options</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaStatements#new_column_from_field</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#table_structure</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#invalid_alter_table_type?</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#table_structure_with_collation</code></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49346",
            "title": "Add support for generated columns in SQLite3 adapter",
            "date_modified": "2023-09-27T05:41:11.000Z",
            "date_published": "2023-09-21T14:01:38.000Z",
            "author": {
                "name": "fractaledmind",
                "url": "https://github.com/fractaledmind"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/39735028?u=91330295c614cf3cec0b64bf242a14fc2ceb358f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because I want to have the ability to use <code class=\"notranslate\">ActiveSupport::ErrorReport#handle</code> to handle errors in production, but still have these errors be raised when encountered in test or development mode. Sometimes for un-expected / rare issues is better to handle it gracefully in production but I would still prefer to raise it in dev / test.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request introduces a <code class=\"notranslate\">production_only</code> flag to the <code class=\"notranslate\">ActiveSupport::ErrorReporter#handle</code> and <code class=\"notranslate\">#report</code> methods and <code class=\"notranslate\">production</code> attribute to <code class=\"notranslate\">ActiveSupport::ErrorReporter</code>. When this flag is <code class=\"notranslate\">true</code> errors will be raised in non-production environments instead of reported. The flag is <code class=\"notranslate\">false</code> by default to preserve existing behaviour.</p>\n<p dir=\"auto\">I added a <code class=\"notranslate\">production</code> attribute to <code class=\"notranslate\">ActiveSupport::ErrorReporter</code> instances to capture what environment we are in. It is <code class=\"notranslate\">true</code> by default.</p>\n<p dir=\"auto\">In <code class=\"notranslate\">Rails#error</code> I <code class=\"notranslate\">tap</code> the error handler and set the <code class=\"notranslate\">production</code> flag based on the Rails environment.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49339",
            "title": "Introduce :production_only flag for ActiveSupport::ErorrReporter#handle",
            "date_modified": "2023-09-21T19:19:42.000Z",
            "date_published": "2023-09-20T21:04:43.000Z",
            "author": {
                "name": "andrewn617",
                "url": "https://github.com/andrewn617"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49331.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1905093936\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49331\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49331/hovercard\" href=\"https://github.com/rails/rails/issues/49331\">#49331</a>.</p>",
            "url": "https://github.com/rails/rails/pull/49337",
            "title": "Include connection specification name into `ActiveRecord::StatementInvalid` errors",
            "date_modified": "2023-10-01T20:00:26.000Z",
            "date_published": "2023-09-20T20:12:27.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/76983?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because the current behavior is misleading and could cause potential data loss. If you define a scope and you try to call an <code class=\"notranslate\">update</code> or <code class=\"notranslate\">update!</code> on the scope then you would expect that the updates will be executed on the scope and not on every record by ignoring the scope completely.</p>\n<p dir=\"auto\">If I wanted to update every record, then I would call the <code class=\"notranslate\">update</code> or <code class=\"notranslate\">update!</code> on the model directly.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This change updates the behavior of the <code class=\"notranslate\">update</code> and <code class=\"notranslate\">update!</code> methods of the <code class=\"notranslate\">ActiveRecord::Relation</code>. If you pass a set of ids then the update will be executed on those records that match the selected ids but also satisfy the scope.</p>\n<p dir=\"auto\">With this change, we also make the <code class=\"notranslate\">update</code> and <code class=\"notranslate\">update!</code> methods symmetric regardless of whether the first parameter was <code class=\"notranslate\">:all</code> or a set of ids.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This might be considered a breaking change, but I do believe this is an actual bugfix since the behavior was misleading and it was asymmetric depending on the first argument.</p>\n<p dir=\"auto\">Consider the following scenario, if you want to update the <code class=\"notranslate\">Model</code> record and set all of the <code class=\"notranslate\">sent_at</code> attributes to the actual time if the items have been sent, then this would work.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Model.unsent.update!(:all, sent_at: Time.zone.now)\"><pre class=\"notranslate\"><span class=\"pl-v\">Model</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">unsent</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">update!</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:all</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">sent_at</span>: <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">zone</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">But if you want to reduce it to just a subset of ids:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Model.unsent.update!([1, 2], { sent_at: Time.zone.now }, { sent_at: Time.zone.now })\"><pre class=\"notranslate\"><span class=\"pl-v\">Model</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">unsent</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">update!</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">[</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">2</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">sent_at</span>: <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">zone</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">sent_at</span>: <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">zone</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">Then this method call would update all the <code class=\"notranslate\">Model</code> records with the matching ids in the DB and we would lose the previous <code class=\"notranslate\">sent_at</code> values if for example Model with id <code class=\"notranslate\">1</code> was sent already.</p>\n<h4 dir=\"auto\">Undocumented and untested behavior</h4>\n<p dir=\"auto\">I made my change symmetric to <code class=\"notranslate\">ActiveRecord::Persistence</code> so it will also raise an <code class=\"notranslate\">ActiveRecord::RecordNotFound</code> error if a record could not be found, it also raises similar <code class=\"notranslate\">ArgumentError</code> exceptions when invalid arguments are passed.  This behavior was undocumented and untested, now I added tests to cover the cases.</p>\n<p dir=\"auto\">I was using <code class=\"notranslate\">respond_to?</code> to check if we received an <code class=\"notranslate\">Enumerable</code> like argument. This code is almost the exact copy of the <code class=\"notranslate\">ActiveRecord::Persistence#update</code> or <code class=\"notranslate\">ActiveRecord::Persistence#update!</code>, we could merge these three methods into one concern, but I did not want to introduce any bigger changes with this PR.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49332",
            "title": "Handle update and update! on scopes properly",
            "date_modified": "2023-09-23T08:21:42.000Z",
            "date_published": "2023-09-20T14:34:30.000Z",
            "author": {
                "name": "raszi",
                "url": "https://github.com/raszi"
            }
        }
    ]
}