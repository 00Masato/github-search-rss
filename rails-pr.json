{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/496367?u=e3a63a2f7db3bea0507f2a6bcc6650db58a96e6d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This is useful to configure multiple disk services for parallel testing without having to resort to something like <code class=\"notranslate\">ActiveStorage::Blob.services.send(:configurations).keys</code> to get this information.</p>",
            "url": "https://github.com/rails/rails/pull/49181",
            "title": "Expose Active Storage service names",
            "date_modified": "2023-09-06T21:44:15.000Z",
            "date_published": "2023-09-06T21:24:20.000Z",
            "author": {
                "name": "bdewater",
                "url": "https://github.com/bdewater"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1884591726\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49173\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49173/hovercard\" href=\"https://github.com/rails/rails/pull/49173\">#49173</a> deserves a changelog entry</p>",
            "url": "https://github.com/rails/rails/pull/49180",
            "title": "Add `CHANGELOG` entry for `define_attribute_methods` changes",
            "date_modified": "2023-09-06T21:27:12.000Z",
            "date_published": "2023-09-06T21:22:35.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR adds release note for the composite primary keys feature</p>\n<p dir=\"auto\">I tried to keep it as brief as possible and cover the most important fundamentals since detailed examples will be added to Rails guides and documentation</p>\n<p dir=\"auto\">I'm not even sure if having a <code class=\"notranslate\">How to use</code> section is reasonable for a release note since it makes the note kind of large</p>",
            "url": "https://github.com/rails/rails/pull/49179",
            "title": "[ci skip] Add composite primary key release note",
            "date_modified": "2023-09-06T21:03:09.000Z",
            "date_published": "2023-09-06T21:03:06.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/191320?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">The <code class=\"notranslate\">add_check_constraint</code> method now accepts an <code class=\"notranslate\">if_not_exists</code> option. If set to true an error won't be raised if the check constraint already exists. In addition, <code class=\"notranslate\">if_exists</code> and <code class=\"notranslate\">if_not_exists</code> options are transposed if set when reversing <code class=\"notranslate\">remove_check_constraint</code> and <code class=\"notranslate\">add_check_constraint</code>. This enables simple creation of idempotent, non-transactional migrations.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">We often write migrations like this:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class MyMigration &lt; ActiveRecord::Migration[7.0]\n  disable_ddl_transaction!\n\n  def change\n    add_check_constraint(:table, &quot;expression&quot;, name: &quot;mychk&quot;, validate: false)\n    validate_constraint(:table, &quot;mychk&quot;)\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">MyMigration</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Migration</span><span class=\"pl-kos\">[</span><span class=\"pl-c1\">7.0</span><span class=\"pl-kos\">]</span>\n  <span class=\"pl-en\">disable_ddl_transaction!</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">change</span>\n    <span class=\"pl-en\">add_check_constraint</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:table</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"expression\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">name</span>: <span class=\"pl-s\">\"mychk\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">validate</span>: <span class=\"pl-c1\">false</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-en\">validate_constraint</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:table</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"mychk\"</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">But we also want to be able to easily re-run the migration, in case the validation fails. So it needs to be idempotent, because it's non-transactional. So we need an <code class=\"notranslate\">if_not_exists</code> option for <code class=\"notranslate\">add_check_constraint</code>. Also, because it's in a non-transactional migration, in order to properly revert it, the reversion that calls <code class=\"notranslate\">remove_check_constraint</code> should set <code class=\"notranslate\">if_exists: true</code>, in case the reversion was disconnected from the database between the check constraint being removed, and the migration being recorded as complete (this is slightly contrived, but could be far more common if you happen to be adding then removing a check constraint in the same migration).</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49178",
            "title": "Adds support for `if_not_exists` when adding a check constraint.",
            "date_modified": "2023-09-06T20:55:15.000Z",
            "date_published": "2023-09-06T20:01:14.000Z",
            "author": {
                "name": "ccutrer",
                "url": "https://github.com/ccutrer"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/191320?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">It was never finding existing constraints, because <code class=\"notranslate\">CheckConstraintDefinition</code> was validating all options--including <code class=\"notranslate\">if_exists</code>--matched.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49177",
            "title": "Fix `remove_check_constraint` with `if_exists: true` never removing any check constraint",
            "date_modified": "2023-09-06T20:25:10.000Z",
            "date_published": "2023-09-06T19:49:40.000Z",
            "author": {
                "name": "ccutrer",
                "url": "https://github.com/ccutrer"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/22231095?u=fc75f9764434943effe06d6c1dc48d40a5003b0c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Follow up <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1878736618\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49120\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49120/hovercard\" href=\"https://github.com/rails/rails/pull/49120\">#49120</a></p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">As per the discussion in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1878736618\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49120\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49120/hovercard?comment_id=1315644911&amp;comment_type=review_comment\" href=\"https://github.com/rails/rails/pull/49120#discussion_r1315644911\">#49120 (comment)</a>, finally decided to have validation for invalid HTML characters in <code class=\"notranslate\">content_tag</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Added validation for HTML tag names in the <code class=\"notranslate\">content_tag</code> method. The <code class=\"notranslate\">content_tag</code> method now checks that the provided tag name adheres to the HTML specification. If an invalid HTML tag name is provided, the method raises an <code class=\"notranslate\">ArgumentError</code> with an appropriate error message.</p>\n<p dir=\"auto\">Examples:<br>\nBefore:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"content_tag(&quot;12p&quot;) \n#  &quot;&lt;12p&gt;&lt;/12p&gt;&quot;\n\ncontent_tag(&quot;&quot;) \n# &quot;&lt;&gt;&lt;/&gt;&quot;\n\ncontent_tag(&quot;image file&quot;)\n#  &quot;&lt;image_file&gt;&lt;/image_file&gt;&quot;\"><pre class=\"notranslate\"><span class=\"pl-en\">content_tag</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"12p\"</span><span class=\"pl-kos\">)</span> \n<span class=\"pl-c\">#  \"&lt;12p&gt;&lt;/12p&gt;\"</span>\n\n<span class=\"pl-en\">content_tag</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"\"</span><span class=\"pl-kos\">)</span> \n<span class=\"pl-c\"># \"&lt;&gt;&lt;/&gt;\"</span>\n\n<span class=\"pl-en\">content_tag</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"image file\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\">#  \"&lt;image_file&gt;&lt;/image_file&gt;\"</span></pre></div>\n<p dir=\"auto\">After:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# Raises ArgumentError: Invalid HTML tag name: 12p\ncontent_tag(&quot;12p&quot;) # Starting with a number\n\n# Raises ArgumentError: Invalid HTML tag name:  \ncontent_tag(&quot;&quot;) # Empty tag name\n\n# Raises ArgumentError: Invalid HTML tag name: &quot;image file&quot;\ncontent_tag(&quot;image file&quot;) # Contains a space\"><pre class=\"notranslate\"><span class=\"pl-c\"># Raises ArgumentError: Invalid HTML tag name: 12p</span>\n<span class=\"pl-en\">content_tag</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"12p\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\"># Starting with a number</span>\n\n<span class=\"pl-c\"># Raises ArgumentError: Invalid HTML tag name:  </span>\n<span class=\"pl-en\">content_tag</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\"># Empty tag name</span>\n\n<span class=\"pl-c\"># Raises ArgumentError: Invalid HTML tag name: \"image file\"</span>\n<span class=\"pl-en\">content_tag</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"image file\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\"># Contains a space</span></pre></div>\n<p dir=\"auto\">cc\\ <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49175",
            "title": "HTML tag validation added for content_tag",
            "date_modified": "2023-09-06T19:58:17.000Z",
            "date_published": "2023-09-06T19:22:45.000Z",
            "author": {
                "name": "akhilgkrishnan",
                "url": "https://github.com/akhilgkrishnan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/64581?u=d8cec29b4b85089fa2c833d59f2f3c3cb9f9705d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">I believe the guide around the initial setup of Active Record Encryption could be improved by giving an example of explicitly setting the encryption keys. When setting this up myself, it took a minute to understand the <code class=\"notranslate\">bin/rails db:encryption:init</code> just output the keys and then they had to be copy and pasted into the credentials. I also wasn't sure how I could set those values using environment variables instead. Maybe this is an improvement for others!</p>",
            "url": "https://github.com/rails/rails/pull/49170",
            "title": "Improving the setup for the Active Record Encryption Guide",
            "date_modified": "2023-09-06T20:53:30.000Z",
            "date_published": "2023-09-06T15:18:11.000Z",
            "author": {
                "name": "tomrossi7",
                "url": "https://github.com/tomrossi7"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/13851881?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This PR is a fix for this issue described and closed due to inactivity here <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"907682056\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/42336\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/42336/hovercard\" href=\"https://github.com/rails/rails/issues/42336\">#42336</a><br>\nIt still happens in apps with rails 7.0.7.2, ruby 3.2.2 and @rails/actioncable 7.0.4: when large number of events is sent via actioncable (in our case they are turbo broadcast messages) it prevents ping messages from coming in time (currently ping threshold is 6 seconds), so actioncable assumes connection as stale and creates a new one. However, during a downtime between closing/opening connections events could (and are) miss(ed).</p>\n<p dir=\"auto\">In this PR pings are also recorded on every normal message coming to the client.</p>\n<h3 dir=\"auto\">Expected behavior</h3>\n<p dir=\"auto\">Connection does not become stale and does not get reconnected when ping messages are delayed due to large number of normal messages.</p>\n<h3 dir=\"auto\">Actual behavior</h3>\n<p dir=\"auto\">The client is disconnected if it doesn't receive ping events within the staleThreshold even though it's receiving other events.</p>",
            "url": "https://github.com/rails/rails/pull/49168",
            "title": "Record ping on every actioncable message",
            "date_modified": "2023-09-06T13:14:55.000Z",
            "date_published": "2023-09-06T13:14:51.000Z",
            "author": {
                "name": "yauhenininjia",
                "url": "https://github.com/yauhenininjia"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/191128?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">As part of Active Record migrations, there are methods to create and drop PostgreSQL schemas.</p>\n<p dir=\"auto\">However, when you dump the schema for a database that uses the PostgreSQL schemas into the schema.rb file, there are not methods to create the schemas, so when you try to load this schema into a new database, a <code class=\"notranslate\">ActiveRecord::StatementInvalid: PG::InvalidSchemaName</code> can be raised.</p>\n<p dir=\"auto\">This PR adds <code class=\"notranslate\">create_schema</code> statements to the schema.rb file so that is can load schemas that use PostgreSQL schemas.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\">  Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49164",
            "title": "dump PostgreSQL schemas as part of the schema dump",
            "date_modified": "2023-09-06T21:37:30.000Z",
            "date_published": "2023-09-06T09:00:12.000Z",
            "author": {
                "name": "lsylvester",
                "url": "https://github.com/lsylvester"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/188464?u=a22a695eff61e658a728d3274adcc09f4b55c883&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Currently, if we call <code class=\"notranslate\">save</code> or <code class=\"notranslate\">save!</code> in an object that was already destroyed, <code class=\"notranslate\">save</code> returns <code class=\"notranslate\">false</code> and <code class=\"notranslate\">save!</code> raises an exception, but there's no information about why the save failed.</p>\n<p dir=\"auto\">I ran into this issue with a legacy app that, because of a complicated set of callbacks, was destroying an object at some point and then calling <code class=\"notranslate\">save!</code> somewhere else. This produced an exception, but there was no information about the reason.</p>\n<p dir=\"auto\">After a lot of research I realized that the issue was the record was destroyed (so <code class=\"notranslate\">.destroyed?</code> was <code class=\"notranslate\">true</code>), but I think it will help a lot to have an error added to avoid having to find this out.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR updates the <code class=\"notranslate\">create_or_update</code> method to add a <code class=\"notranslate\">:base</code> error message for this specific scenario.</p>\n<p dir=\"auto\">I added a configuration for this to keep the old behavior if needed and during upgrades, since I imagine some apps may rely on the errors hash being empty.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">No additional information.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49160",
            "title": "Add an error when saving a record that was previously destroyed",
            "date_modified": "2023-09-06T03:28:30.000Z",
            "date_published": "2023-09-05T18:40:38.000Z",
            "author": {
                "name": "arielj",
                "url": "https://github.com/arielj"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/509837?u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">ref: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1667397527\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47942\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47942/hovercard\" href=\"https://github.com/rails/rails/pull/47942\">#47942</a></p>\n<p dir=\"auto\">This PR fixes some things that were missed in first PR.</p>\n<ol dir=\"auto\">\n<li><code class=\"notranslate\">Minitest::Spec</code> doesn't extend <code class=\"notranslate\">Rails::LineFiltering</code>, so <code class=\"notranslate\">compose_filter</code> (and thus <code class=\"notranslate\">escape_declarative_test_filter</code>) were not being called in the tests we added. This PR adds a new test case with <code class=\"notranslate\">Rails::LineFiltering</code> included to confirm behaviour is the same either way.</li>\n<li>The filter in <code class=\"notranslate\">escape_declarative_test_filter</code> didn't work on regexes that had passed through <code class=\"notranslate\">Regexp#escape</code>. Now it supports that too.</li>\n</ol>",
            "url": "https://github.com/rails/rails/pull/49141",
            "title": "Fix more bugs in declarative specs filter",
            "date_modified": "2023-09-06T18:44:05.000Z",
            "date_published": "2023-09-05T01:14:13.000Z",
            "author": {
                "name": "ghiculescu",
                "url": "https://github.com/ghiculescu"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1272897?u=19661497b6fe87cb1aa919b1b50163dcd944214c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Currently <code class=\"notranslate\">rack-session</code> commits the session every time it gets loaded, so when concurrent requests are made from the browser to the server, all of them load the session to get the information about the current user, and one of the requests stores some data in the session. Due to racing, there is a chance that a response that reads from the session will overwrite the session value set by a response that writes to the session.</p>\n<p dir=\"auto\">These changes are not going to solve the issue of the overwritten session but are going to make them less frequent. Also will reduce actions done in runtime like cookie encrypting and signing.</p>\n<p dir=\"auto\">The issue was reported:</p>\n<ul dir=\"auto\">\n<li><a href=\"https://stackoverflow.com/questions/42044076/why-is-rails-constantly-sending-back-a-set-cookie-header\" rel=\"nofollow\">https://stackoverflow.com/questions/42044076/why-is-rails-constantly-sending-back-a-set-cookie-header</a></li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Related to:</p>\n<ul dir=\"auto\">\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1879784297\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rack/rack-session/issues/24\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rack/rack-session/pull/24/hovercard\" href=\"https://github.com/rack/rack-session/pull/24\">rack/rack-session#24</a></li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49129",
            "title": "Expose ActionDispatch::Request::Session changed state",
            "date_modified": "2023-09-05T05:56:23.000Z",
            "date_published": "2023-09-04T08:17:59.000Z",
            "author": {
                "name": "ardevelop",
                "url": "https://github.com/ardevelop"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/58332033?u=7aa838b7c0f20fd09510535cb09bf5ec078bd1d0&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because some browsers have a bug and didn't respect the cache max-age and never invalidate the cached URLs even if service_urls_expire_in is set to zero. Hence, I had to override the redirect controller and disable the cache.</p>\n<p dir=\"auto\">This PR makes it easy to toggle caching without override and</p>\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>Active storage by default allows caching service URLs in browsers by adding cache-control max-age = <code class=\"notranslate\">service_urls_expire_in</code> value</li>\n<li>This PR adds the ability to control caching by decoupling it from service_urls_expire_in.</li>\n<li>Adds a new boolean active storage config <code class=\"notranslate\">cache_service_urls</code> equal to true by default</li>\n<li>If it is set to false It will set <code class=\"notranslate\">cache-control</code> to <code class=\"notranslate\">no-store</code></li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49124",
            "title": "Feat: control active storage service urls caching",
            "date_modified": "2023-09-02T17:59:44.000Z",
            "date_published": "2023-09-02T17:54:03.000Z",
            "author": {
                "name": "civilcoder55",
                "url": "https://github.com/civilcoder55"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/50139?u=2dc5ba0e2ccf832493c256b9981ae892980cd9b6&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because it's annoying that HABTM doesn't alert you when you supply the wrong options.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes HABTM so it works like the other associations and raises <code class=\"notranslate\">ArgumentError</code> when you supply options that it doesn't handle.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48939.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1850332701\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48939\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48939/hovercard\" href=\"https://github.com/rails/rails/issues/48939\">#48939</a></p>",
            "url": "https://github.com/rails/rails/pull/49115",
            "title": "Add option validation to HABTM, closes #48939",
            "date_modified": "2023-09-02T05:01:17.000Z",
            "date_published": "2023-09-01T21:17:02.000Z",
            "author": {
                "name": "smathy",
                "url": "https://github.com/smathy"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/646693?u=62e1fec459de18a2ba098b8f90dba89c9d74fa72&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">In case of mail delivery errors, the old ActionMailer::LogSubscriber erroneously logged a \"Delivered mail ...\" line.<br>\nWith this change it checks the passed exception object and logs a \"Failed delivery of mail\" line instead.</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> <del>CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</del></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49083",
            "title": "Log delivery errors in ActionMailer::LogSubscriber",
            "date_modified": "2023-08-31T07:02:57.000Z",
            "date_published": "2023-08-30T11:14:34.000Z",
            "author": {
                "name": "1st8",
                "url": "https://github.com/1st8"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/96156234?u=9ced8d6ac6128a8dea78e7f0d9233669ff0ffecf&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">By transforming the values hash and adding in the type from the table it's being added to it ensures that the correct Type is used for the table.  This enables a user to make sure the specified type is used if one is set in the model.</p>\n<p dir=\"auto\">Fixes #<a href=\"https://github.com/rails/rails/issues/49009\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49009/hovercard\">49009</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul dir=\"auto\">\n<li>[ X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li>[ X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li>[ X] Tests are added or updated if you fix a bug or add a feature.</li>\n<li>[ X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49079",
            "title": "Makes sure values have the correct type in _update_record. Fixes #49009.",
            "date_modified": "2023-09-01T14:58:27.000Z",
            "date_published": "2023-08-29T16:47:38.000Z",
            "author": {
                "name": "paulreece",
                "url": "https://github.com/paulreece"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/509837?u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">If <code class=\"notranslate\">ActiveRecord::Encryption.config.support_unencrypted_data == true</code>, this allows you to do:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class User &lt; ActiveRecord::Base\n  encrypts :name, deterministic: true, support_unencrypted_data: false\n  encrypts :email, deterministic: true\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">User</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">encrypts</span> <span class=\"pl-pds\">:name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">deterministic</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">support_unencrypted_data</span>: <span class=\"pl-c1\">false</span>\n  <span class=\"pl-en\">encrypts</span> <span class=\"pl-pds\">:email</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">deterministic</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Now only the <code class=\"notranslate\">email</code> column will allow unencrypted data (and if <code class=\"notranslate\">extend_queries</code> is true, only <code class=\"notranslate\">email</code> queries will get extended). <a href=\"https://github.com/rails/rails/pull/49072#issuecomment-1697170252\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49072/hovercard\">Here</a> is some back story on why you might want this.</p>",
            "url": "https://github.com/rails/rails/pull/49072",
            "title": "Encryption: support `support_unencrypted_data` at a per-attribute level",
            "date_modified": "2023-09-04T00:01:50.000Z",
            "date_published": "2023-08-29T00:57:39.000Z",
            "author": {
                "name": "ghiculescu",
                "url": "https://github.com/ghiculescu"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/42195321?u=810b1a1449a94590f2ff9e2f189d4c37f90691b3&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This PR addresses the issues <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1766266191\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48535\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48535/hovercard\" href=\"https://github.com/rails/rails/issues/48535\">#48535</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1685480928\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48072\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48072/hovercard\" href=\"https://github.com/rails/rails/issues/48072\">#48072</a>.</p>\n<p dir=\"auto\">With the introduction of PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"782710170\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/41068\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/41068/hovercard\" href=\"https://github.com/rails/rails/pull/41068\">#41068</a>, an unintended behavior surfaced, causing the <code class=\"notranslate\">proc_for_binds</code> to apply casting to attributes that were already casted. Consequently, this led to the malfunctioning of queries, as noted in the referenced issues.</p>\n<p dir=\"auto\">My proposed solution revolves around the incorporation of a new attribute \"type\" named <code class=\"notranslate\">BindAttribute</code>. This type facilitates the desired functionality within the <code class=\"notranslate\">proc_for_binds</code> implementation, while abstaining from unnecessary casting, given that the values are already casted. This correction has obviated the need for changes such as \"Fix deterministic queries that were broken after <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"782710170\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/41068\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/41068/hovercard\" href=\"https://github.com/rails/rails/pull/41068\">#41068</a>,\" as detailed in <a href=\"https://github.com/wbotelhos/rails/commit/37361bfb4222c5d210f11e48ecee46b05ea7d50e\">this commit</a>. These changes had inadvertently caused the tests initially intended for <code class=\"notranslate\">proc_for_binds</code> within <code class=\"notranslate\">HomogeneousIn</code> to erroneously evaluate the <code class=\"notranslate\">proc_for_binds</code> within <code class=\"notranslate\">InWithAdditionalValues</code>. This resulted in false positives whenever adjustments were made to the <code class=\"notranslate\">proc_for_binds</code> within <code class=\"notranslate\">HomogeneousIn</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49050",
            "title": "[Fix #48535]: fix behavior of `proc_for_binds` in `Arel::Nodes::HomogenousIn`",
            "date_modified": "2023-09-02T18:45:33.000Z",
            "date_published": "2023-08-27T14:57:07.000Z",
            "author": {
                "name": "JohnAnon9771",
                "url": "https://github.com/JohnAnon9771"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/39473?u=36a63ee4b4b6c19de5d4ddcb7947b09bb2447fff&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I noticed and confirmed with others that rails console was omitting expected backtrace lines as seen here:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ cat app/models/user.rb\nclass User &lt; ApplicationRecord\n\n  def foo\n    bar\n  end\n\n  def bar\n    baz\n  end\n\n  def baz\n    raise\n  end\nend\n\n$  rc\nLoading development environment (Rails 7.0.7)\n3.1.4 :001 &gt; User.new.foo\n/Users/jsharpe/railsapp/app/models/user.rb:12:in `baz': unhandled exception\n(irb):1:in `&lt;main&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">$ cat app/models/user.rb\nclass User &lt; ApplicationRecord\n\n  def foo\n    bar\n  end\n\n  def bar\n    baz\n  end\n\n  def baz\n    raise\n  end\nend\n\n$  rc\nLoading development environment (Rails 7.0.7)\n3.1.4 :001 &gt; User.new.foo\n/Users/jsharpe/railsapp/app/models/user.rb:12:in `baz': unhandled exception\n(irb):1:in `&lt;main&gt;\n</code></pre></div>\n<p dir=\"auto\">I believe this is caused by irb itself prefixing backtrace lines with the string: <code class=\"notranslate\">\\tfrom </code> as seen here:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"√ (9:21:40 PM) ~ irb\n3.0.4 :001 &gt; class Foo\n3.0.4 :002 &gt; def foo\n3.0.4 :003 &gt; bar\n3.0.4 :004 &gt; end\n3.0.4 :005 &gt; def bar\n3.0.4 :006 &gt; baz\n3.0.4 :007 &gt; end\n3.0.4 :008 &gt; def baz\n3.0.4 :009 &gt; raise\n3.0.4 :010 &gt; end\n3.0.4 :011 &gt; end\n =&gt; :baz\n3.0.4 :012 &gt;\n3.0.4 :013 &gt; Foo.new.foo\n(irb):9:in `baz': unhandled exception\n\tfrom (irb):6:in `bar'\n\tfrom (irb):3:in `foo'\n\tfrom (irb):13:in `&lt;main&gt;'\n\tfrom /Users/jsharpe/.rvm/gems/ruby-3.0.4/gems/irb-1.7.4/exe/irb:9:in `&lt;top (required)&gt;'\n\tfrom /Users/jsharpe/.rvm/gems/ruby-3.0.4/bin/irb:25:in `load'\n\tfrom /Users/jsharpe/.rvm/gems/ruby-3.0.4/bin/irb:25:in `&lt;main&gt;'\n\tfrom /Users/jsharpe/.rvm/gems/ruby-3.0.4/bin/ruby_executable_hooks:22:in `eval'\n\tfrom /Users/jsharpe/.rvm/gems/ruby-3.0.4/bin/ruby_executable_hooks:22:in `&lt;main&gt;'\"><pre class=\"notranslate\"><code class=\"notranslate\">√ (9:21:40 PM) ~ irb\n3.0.4 :001 &gt; class Foo\n3.0.4 :002 &gt; def foo\n3.0.4 :003 &gt; bar\n3.0.4 :004 &gt; end\n3.0.4 :005 &gt; def bar\n3.0.4 :006 &gt; baz\n3.0.4 :007 &gt; end\n3.0.4 :008 &gt; def baz\n3.0.4 :009 &gt; raise\n3.0.4 :010 &gt; end\n3.0.4 :011 &gt; end\n =&gt; :baz\n3.0.4 :012 &gt;\n3.0.4 :013 &gt; Foo.new.foo\n(irb):9:in `baz': unhandled exception\n\tfrom (irb):6:in `bar'\n\tfrom (irb):3:in `foo'\n\tfrom (irb):13:in `&lt;main&gt;'\n\tfrom /Users/jsharpe/.rvm/gems/ruby-3.0.4/gems/irb-1.7.4/exe/irb:9:in `&lt;top (required)&gt;'\n\tfrom /Users/jsharpe/.rvm/gems/ruby-3.0.4/bin/irb:25:in `load'\n\tfrom /Users/jsharpe/.rvm/gems/ruby-3.0.4/bin/irb:25:in `&lt;main&gt;'\n\tfrom /Users/jsharpe/.rvm/gems/ruby-3.0.4/bin/ruby_executable_hooks:22:in `eval'\n\tfrom /Users/jsharpe/.rvm/gems/ruby-3.0.4/bin/ruby_executable_hooks:22:in `&lt;main&gt;'\n</code></pre></div>\n<p dir=\"auto\">This causes rails console to mistakenly filter lines that would otherwise match <code class=\"notranslate\">Rails::BacktraceCleaner::APP_DIRS_PATTERN</code> because that regex hasn't anticipated the prefix.<br>\nThis patch filters <code class=\"notranslate\">\\tfrom </code> if it exists which then allows the filter using <code class=\"notranslate\">APP_DIRS_PATTERN</code> below to work correctly:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ rc\nLoading development environment (Rails 7.0.7)\n3.1.4 :001 &gt; User.new.foo\n/Users/jsharpe/railsapp/app/models/user.rb:12:in `baz': unhandled exception\napp/models/user.rb:8:in `bar'\napp/models/user.rb:4:in `foo'\n(irb):1:in `&lt;main&gt;'\"><pre class=\"notranslate\"><code class=\"notranslate\">$ rc\nLoading development environment (Rails 7.0.7)\n3.1.4 :001 &gt; User.new.foo\n/Users/jsharpe/railsapp/app/models/user.rb:12:in `baz': unhandled exception\napp/models/user.rb:8:in `bar'\napp/models/user.rb:4:in `foo'\n(irb):1:in `&lt;main&gt;'\n</code></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49049",
            "title": "fixes issue where rails console filters lines that match 'APP_DIRS_PATTERN' because they are prefixed with 'from'",
            "date_modified": "2023-09-01T14:47:43.000Z",
            "date_published": "2023-08-27T01:29:32.000Z",
            "author": {
                "name": "josh-m-sharpe",
                "url": "https://github.com/josh-m-sharpe"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/96156234?u=9ced8d6ac6128a8dea78e7f0d9233669ff0ffecf&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Since <code class=\"notranslate\">aliased_table_for</code> is called later on in the stack as to make the <code class=\"notranslate\">missing</code> and <code class=\"notranslate\">associated</code> methods have no awareness of aliasing taking place, I decided to make a similar data structure available within both.  By adding <code class=\"notranslate\">@scope.table_name</code>, and  any <code class=\"notranslate\">joins</code> <code class=\"notranslate\">table_names</code> to an array, I am offering up a similar object that the <code class=\"notranslate\">alias_tracker.aliases</code> hash would contain.  I used an array instead of a hash because in this case we don't need to check the values of the keys like <code class=\"notranslate\">aliased_table_for</code> does.  By building this array it gives these methods an awareness of what aliasing might take place further on in the stack so that it can take the correct course of action when building the where clause.</p>\n<p dir=\"auto\">This adds an <code class=\"notranslate\">alias_prediction</code> method which implements the behavior noted above:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"        def alias_prediction\n          alias_table_names = []\n          alias_table_names.push(@scope.table_name)\n          if @scope.values[:joins]\n            @scope.values[:joins].each do |join|\n              current_join = scope_association_reflection(join)\n              alias_table_names.push(current_join.table_name)\n            end\n          end\n          alias_table_names\n        end\"><pre class=\"notranslate\">        <span class=\"pl-k\">def</span> <span class=\"pl-en\">alias_prediction</span>\n          <span class=\"pl-s1\">alias_table_names</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span>\n          <span class=\"pl-s1\">alias_table_names</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">push</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">@scope</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">table_name</span><span class=\"pl-kos\">)</span>\n          <span class=\"pl-k\">if</span> <span class=\"pl-c1\">@scope</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">values</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:joins</span><span class=\"pl-kos\">]</span>\n            <span class=\"pl-c1\">@scope</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">values</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:joins</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">join</span>|\n              <span class=\"pl-s1\">current_join</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">scope_association_reflection</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">join</span><span class=\"pl-kos\">)</span>\n              <span class=\"pl-s1\">alias_table_names</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">push</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">current_join</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">table_name</span><span class=\"pl-kos\">)</span>\n            <span class=\"pl-k\">end</span>\n          <span class=\"pl-k\">end</span>\n          <span class=\"pl-s1\">alias_table_names</span>\n        <span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Note: The initial <code class=\"notranslate\">reflection.options[:class_name]</code> check is still necessary to avoid false positives.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because a bug report was raised. Fixes #<a href=\"https://github.com/rails/rails/issues/48945\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48945/hovercard\">48945</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49047",
            "title": "This allows Users to merge the actual model to an already aliased/scoped model when using the missing or associated methods. Fixes #48945. ",
            "date_modified": "2023-09-01T14:56:01.000Z",
            "date_published": "2023-08-26T23:23:49.000Z",
            "author": {
                "name": "paulreece",
                "url": "https://github.com/paulreece"
            }
        }
    ]
}