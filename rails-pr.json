{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1398?u=c811c584ad0578eb4902088362067bb4c98cff93&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">While <code class=\"notranslate\">fields_for</code> currently accepts a lambda as an argument for <code class=\"notranslate\">child_index</code>, that lambda is called without any arguments. Being that we are enumerating the association on <code class=\"notranslate\">fields_for</code> as the time the lambda is called, we have an opportunity to pass the child of the association down to the lambda.  This could simplify the case where you may want to use the <code class=\"notranslate\">id</code> of an Active Record object as the index.  So with this change you could do something like this:</p>\n<div class=\"highlight highlight-text-html-erb notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"&lt;%= author_form.fields_for :books, child_index: -&gt;(book) { book.id } do |book_form| %&gt;\n  &lt;%= book_form.text_field :name %&gt;\n&lt;% end %&gt;\"><pre class=\"notranslate\"><span class=\"pl-k\">&lt;%=</span> author_form.fields_for :books, child_index: -&gt;(book) { book.id } do |book_form| <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">  &lt;%=</span> book_form.text_field :name <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">&lt;%</span> end <span class=\"pl-k\">%&gt;</span><span class=\"pl-en\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-kos\"></span><span class=\"pl-pds\"></span><span class=\"pl-c1\"></span><span class=\"pl-kos\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-kos\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-kos\"></span><span class=\"pl-k\"></span><span class=\"pl-s1\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-k\"></span></pre></div>\n<p dir=\"auto\">Prior to this, you would have had to enumerate the association yourself:</p>\n<div class=\"highlight highlight-text-html-erb notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"&lt;% author.books.each do |book| %&gt;\n  &lt;%= author_form.fields_for :books, book, child_index: book.id do |book_form| %&gt;\n    &lt;%= book_form.text_field :name %&gt;\n  &lt;% end %&gt;\n&lt;% end %&gt;\"><pre class=\"notranslate\"><span class=\"pl-k\">&lt;%</span> author.books.each do |book| <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">  &lt;%=</span> author_form.fields_for :books, book, child_index: book.id do |book_form| <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">    &lt;%=</span> book_form.text_field :name <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">  &lt;%</span> end <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">&lt;%</span> end <span class=\"pl-k\">%&gt;</span><span class=\"pl-en\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-k\"></span><span class=\"pl-s1\"></span><span class=\"pl-en\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-kos\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-pds\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-k\"></span><span class=\"pl-s1\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-k\"></span><span class=\"pl-k\"></span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Accepts passing the association's child as an argument in a lambda as the <code class=\"notranslate\">child_index</code> option in <code class=\"notranslate\">fields_for</code>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Used <a href=\"https://github.com/rails/rails/pull/19661\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/19661/hovercard\">PR 19661</a> as a guide when passing a lambda to <code class=\"notranslate\">child_index</code> was originally introduced.</p>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51110",
            "title": "Accept a `child_index` lambda on `fields_for` with an argument",
            "date_modified": "2024-02-16T20:20:01.000Z",
            "date_published": "2024-02-16T20:19:57.000Z",
            "author": {
                "name": "keegnotrub",
                "url": "https://github.com/keegnotrub"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">When using sharding and the <code class=\"notranslate\">test</code> primary config is named differently than <code class=\"notranslate\">development</code> primary config, like</p>\n<div class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"development:\n  primary: # can be any name, not necessary 'primary'\n    adapter: sqlite3\n    database: dev_db\n  secondary:\n    adapter: sqlite3\n    database: secondary_dev_db\n    schema_dump: false\ntest:\n  primary_test: # note the different name\n    adapter: sqlite3\n    database: test_db\n  secondary_test:\n    adapter: sqlite3\n    database: secondary_test_db\n    schema_dump: false\"><pre class=\"notranslate\"><span class=\"pl-ent\">development</span>:\n  <span class=\"pl-ent\">primary</span>: <span class=\"pl-c\"><span class=\"pl-c\">#</span> can be any name, not necessary 'primary'</span>\n    <span class=\"pl-ent\">adapter</span>: <span class=\"pl-s\">sqlite3</span>\n    <span class=\"pl-ent\">database</span>: <span class=\"pl-s\">dev_db</span>\n  <span class=\"pl-ent\">secondary</span>:\n    <span class=\"pl-ent\">adapter</span>: <span class=\"pl-s\">sqlite3</span>\n    <span class=\"pl-ent\">database</span>: <span class=\"pl-s\">secondary_dev_db</span>\n    <span class=\"pl-ent\">schema_dump</span>: <span class=\"pl-c1\">false</span>\n<span class=\"pl-ent\">test</span>:\n  <span class=\"pl-ent\">primary_test</span>: <span class=\"pl-c\"><span class=\"pl-c\">#</span> note the different name</span>\n    <span class=\"pl-ent\">adapter</span>: <span class=\"pl-s\">sqlite3</span>\n    <span class=\"pl-ent\">database</span>: <span class=\"pl-s\">test_db</span>\n  <span class=\"pl-ent\">secondary_test</span>:\n    <span class=\"pl-ent\">adapter</span>: <span class=\"pl-s\">sqlite3</span>\n    <span class=\"pl-ent\">database</span>: <span class=\"pl-s\">secondary_test_db</span>\n    <span class=\"pl-ent\">schema_dump</span>: <span class=\"pl-c1\">false</span></pre></div>\n<p dir=\"auto\">rails is unable to use the default <code class=\"notranslate\">schema.rb</code> file when running <code class=\"notranslate\">rails db:test:prepare</code>. It generates the following error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"app/db/shard_one_test_schema.rb doesn't exist yet. Run `bin/rails db:migrate` to create it, then try again. \nIf you do not intend to use a database, you should instead alter app/config/application.rb to limit the \nframeworks that will be loaded.\"><pre class=\"notranslate\"><code class=\"notranslate\">app/db/shard_one_test_schema.rb doesn't exist yet. Run `bin/rails db:migrate` to create it, then try again. \nIf you do not intend to use a database, you should instead alter app/config/application.rb to limit the \nframeworks that will be loaded.\n</code></pre></div>\n<p dir=\"auto\">When they both are named the same, rails just \"erroneously\" uses the one from the <code class=\"notranslate\">development</code> configuration and it succeeds.</p>",
            "url": "https://github.com/rails/rails/pull/51103",
            "title": "Fix `db:test:prepare` when using sharding and test primary config is named differently than development primary config",
            "date_modified": "2024-02-16T15:55:40.000Z",
            "date_published": "2024-02-16T14:33:04.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/509837?u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1870707368\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49072\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49072/hovercard\" href=\"https://github.com/rails/rails/pull/49072\">#49072</a> allowed you to turn <code class=\"notranslate\">support_unencrypted_data</code> on a global level, then turn it off for specific attributes. But it didn't allow the inverse: you couldn't turn the config off globally, and then turn it on for a specific attribute.</p>\n<p dir=\"auto\">This PR adds support for that, which should make the setting's behaviour less surprising.</p>",
            "url": "https://github.com/rails/rails/pull/51100",
            "title": "Encryption: allow turning on `support_unencrypted_data` at a per-attribute level",
            "date_modified": "2024-02-16T05:59:34.000Z",
            "date_published": "2024-02-16T05:58:33.000Z",
            "author": {
                "name": "ghiculescu",
                "url": "https://github.com/ghiculescu"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/809410?u=d89171dbae587727d4f61de8d128c02f16269174&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I encountered an issue that <code class=\"notranslate\">:race_condition_ttl</code> can still suffer from dog pile effect in the use case of high intense services because during the period of extending expiration time, other process can still access the same entry and try to regenerate the cache at the same time.</p>\n<p dir=\"auto\">While searching for solutions, I realized probabilistic early expiration approach might be a simpler and more efficient solution. It is a technique to avoid the dog pile effect (aka cache stampede) by expiring the cache before the TTL.</p>\n<p dir=\"auto\">I implemented this method based on the paper<sup><a href=\"#user-content-fn-1-580b9543abe03e07ef73cd7f24a8a773\" id=\"user-content-fnref-1-580b9543abe03e07ef73cd7f24a8a773\" data-footnote-ref=\"\" aria-describedby=\"footnote-label\">1</a></sup> which uses probabilistic decision with the exponential function <code class=\"notranslate\">Exp(λ)</code> and demonstrates to be optimal.</p>\n<h3 dir=\"auto\">Detail</h3>\n<ol dir=\"auto\">\n<li>Add new option <code class=\"notranslate\">early_expiration</code> to <code class=\"notranslate\">ActiveSupport::Cache::Store#fetch</code>.</li>\n<li>Add new method <code class=\"notranslate\">ActiveSupport::Cache::Entry#should_expire_early?(beta: 1)</code>.</li>\n<li>Add new instance variable <code class=\"notranslate\">@generation_time</code> to <code class=\"notranslate\">ActiveSupport::Cache::Entry</code>.</li>\n</ol>\n<p dir=\"auto\">Here is a simple implementation to illustrate the approach:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def x_fetch(key, ttl, beta = 1)\n  value, delta, expiry ← read(key)\n  if value.nil? || Time.now − delta * beta * Math.log(rand) ≥ expiry\n    start = Time.now\n    value = yield\n    delta = Time.now – start\n    write(key, value, delta, ttl)\n  end\n  return value\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">def</span> <span class=\"pl-en\">x_fetch</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">ttl</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">beta</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-s1\">value</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">delta</span><span class=\"pl-kos\">,</span> <span class=\"pl-en\">expiry</span> <span class=\"pl-en\">←</span> <span class=\"pl-en\">read</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">key</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">if</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">nil?</span> || <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\"></span> <span class=\"pl-en\">−</span> <span class=\"pl-s1\">delta</span> * <span class=\"pl-s1\">beta</span> * <span class=\"pl-v\">Math</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">rand</span><span class=\"pl-kos\">)</span> <span class=\"pl-en\">≥</span> <span class=\"pl-en\">expiry</span>\n    <span class=\"pl-s1\">start</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span>\n    <span class=\"pl-s1\">value</span> <span class=\"pl-c1\">=</span> <span class=\"pl-k\">yield</span>\n    <span class=\"pl-s1\">delta</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span> <span class=\"pl-en\">–</span> <span class=\"pl-s1\">start</span>\n    <span class=\"pl-en\">write</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">delta</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">ttl</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-en\">return</span> <span class=\"pl-s1\">value</span>\n<span class=\"pl-en\">end</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I created a stacked histogram comparing the stampede sizes between <code class=\"notranslate\">:race_condition_ttl</code> (fetch) and <code class=\"notranslate\">:early_expiration</code> (x_fetch):</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/809410/305307854-01dc5a69-4206-458e-ad76-c52637f9f00b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDgxMTc2MDAsIm5iZiI6MTcwODExNzMwMCwicGF0aCI6Ii84MDk0MTAvMzA1MzA3ODU0LTAxZGM1YTY5LTQyMDYtNDU4ZS1hZDc2LWM1MjYzN2Y5ZjAwYi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwMjE2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDIxNlQyMTAxNDBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0yN2UzNzIzZWU5Zjc2YjA4MDcxYTIzYTUwOGExY2YxOWFkMDNiZjY0YmVjNzMwMjU2ZGEyZTk3ODcyNWVjNWQ2JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.fc-GqMdh90DUwGgxy_FIsoThgvf3iqrvqkD5TNRF5tk\"><img src=\"https://private-user-images.githubusercontent.com/809410/305307854-01dc5a69-4206-458e-ad76-c52637f9f00b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDgxMTc2MDAsIm5iZiI6MTcwODExNzMwMCwicGF0aCI6Ii84MDk0MTAvMzA1MzA3ODU0LTAxZGM1YTY5LTQyMDYtNDU4ZS1hZDc2LWM1MjYzN2Y5ZjAwYi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwMjE2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDIxNlQyMTAxNDBaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0yN2UzNzIzZWU5Zjc2YjA4MDcxYTIzYTUwOGExY2YxOWFkMDNiZjY0YmVjNzMwMjU2ZGEyZTk3ODcyNWVjNWQ2JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.fc-GqMdh90DUwGgxy_FIsoThgvf3iqrvqkD5TNRF5tk\" alt=\"800k_histogram\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">As the histogram shows, <code class=\"notranslate\">:early_expiration</code> has smaller stampede size compared to <code class=\"notranslate\">:race_condition_ttl</code>.</p>\n<p dir=\"auto\">For the definition of \"the stampede sizes\", please refer to <a href=\"https://cseweb.ucsd.edu/~avattani/papers/cache_stampede.pdf\" rel=\"nofollow\">the paper</a>.</p>\n<p dir=\"auto\">Note that the benchmark is generated using 16 threads. The difference could be more significant with higher number of threads.</p>\n<p dir=\"auto\">For more information, please refer to the <a href=\"https://github.com/tonytonyjan/rails_cache_stampede_benchmark\">benchmark repository</a>.</p>\n<p dir=\"auto\">The benchmark repository: <a href=\"https://github.com/tonytonyjan/rails_cache_stampede_benchmark\">https://github.com/tonytonyjan/rails_cache_stampede_benchmark</a><br>\nThe paper: <a href=\"https://cseweb.ucsd.edu/~avattani/papers/cache_stampede.pdf\" rel=\"nofollow\">https://cseweb.ucsd.edu/~avattani/papers/cache_stampede.pdf</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<section data-footnotes=\"\" class=\"footnotes\"><h2 id=\"footnote-label\" class=\"sr-only\" dir=\"auto\">Footnotes</h2>\n<ol dir=\"auto\">\n<li id=\"user-content-fn-1-580b9543abe03e07ef73cd7f24a8a773\">\n<p dir=\"auto\"><a href=\"https://cseweb.ucsd.edu/~avattani/papers/cache_stampede.pdf\">Vattani, A.; Chierichetti, F.; Lowenstein, K. (2015), Optimal Probabilistic Cache Stampede Prevention, Proceedings of the VLDB Endowment, VLDB</a> <a href=\"#user-content-fnref-1-580b9543abe03e07ef73cd7f24a8a773\" data-footnote-backref=\"\" aria-label=\"Back to reference 1\" class=\"data-footnote-backref\">↩</a></p>\n</li>\n</ol>\n</section>",
            "url": "https://github.com/rails/rails/pull/51099",
            "title": "Add a new option `early_expiration` to `ActiveSupport::Cache::Store#fetch` to avoid dog pile effect",
            "date_modified": "2024-02-16T05:20:45.000Z",
            "date_published": "2024-02-16T05:09:34.000Z",
            "author": {
                "name": "tonytonyjan",
                "url": "https://github.com/tonytonyjan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8122246?u=2dbe607a66a7616297b78647eeb4e0dbff657c3a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">ActiveSupport::LocalCache::Middleware</code> clears the local cache after each requests, but when using the <code class=\"notranslate\">with_local_cache</code> method, this could be counter intuitive as this method is supposed to use a local cache for the duration of the block:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Rails.cache.with_local_cache do\n  get &quot;/&quot; \n  # Before this patch: Cache is cleared here\nend\n# After this patch: Cache is cleared here\"><pre class=\"notranslate\"><span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">cache</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">with_local_cache</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">get</span> <span class=\"pl-s\">\"/\"</span> \n  <span class=\"pl-c\"># Before this patch: Cache is cleared here</span>\n<span class=\"pl-k\">end</span>\n<span class=\"pl-c\"># After this patch: Cache is cleared here</span></pre></div>\n<p dir=\"auto\">Asserting on the state of the cache in an integration test isn't possible (by default in test environment the store is a NullStore), unless the cache strategy is temporary changed.<br>\nThis patch makes it easier to check the cache after a request but also allow make subsequent requests to hit the cache.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Rails.cache.with_local_cache\n  get &quot;/&quot;\n  get &quot;/&quot;\n  assert_no_cache_miss\nend\"><pre class=\"notranslate\"><span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">cache</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">with_local_cache</span>\n  <span class=\"pl-en\">get</span> <span class=\"pl-s\">\"/\"</span>\n  <span class=\"pl-en\">get</span> <span class=\"pl-s\">\"/\"</span>\n  <span class=\"pl-en\">assert_no_cache_miss</span>\n<span class=\"pl-en\">end</span></pre></div>\n<p dir=\"auto\">This Pull Request has been created because [REPLACE ME]</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51098",
            "title": "Don't clear the local cache on each requests with `with_local_cache`:",
            "date_modified": "2024-02-15T23:39:06.000Z",
            "date_published": "2024-02-15T23:38:21.000Z",
            "author": {
                "name": "Edouard-chin",
                "url": "https://github.com/Edouard-chin"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54629302?u=be8de5137bf940532cddd05aff823129ab8a39db&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #51095.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2135927044\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51095\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51095/hovercard\" href=\"https://github.com/rails/rails/issues/51095\">#51095</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Updates the error page displayed when a view template is missing to account for nested controller paths in the suggested correct path for the missing template.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">Testing steps: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2135927044\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51095\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51095/hovercard?comment_id=1945603654&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/issues/51095#issuecomment-1945603654\">#51095 (comment)</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51096",
            "title": "[Fix #51095] Missing template error page showing incorrect view path example for nested controller path",
            "date_modified": "2024-02-16T11:23:49.000Z",
            "date_published": "2024-02-15T08:37:46.000Z",
            "author": {
                "name": "joshuay03",
                "url": "https://github.com/joshuay03"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><del>Debugging why a CI job get stuck is particularly painful as the output doesn't contain any information whatsoever.</del></p>\n<p dir=\"auto\"><del>By enabling <code class=\"notranslate\">--verbose</code> we ensure the last line of the CI job is the name of the test that got stuck, helping debug.</del></p>\n<p dir=\"auto\">Similarly, it's hard to figure out why a particular job is slow, so enabling <code class=\"notranslate\">--profile</code> would make it easy to spot some low hanging fruits to improve CI speed.</p>\n<p dir=\"auto\">Edit: <code class=\"notranslate\">--verbose</code> is a bit too much, so leaving it out for now.</p>",
            "url": "https://github.com/rails/rails/pull/51080",
            "title": "Run tests with `--profile` on CI",
            "date_modified": "2024-02-14T21:57:13.000Z",
            "date_published": "2024-02-14T10:30:08.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/60958871?u=6bb040ef46f49caf975a7d884ff0951b56134008&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><strong>Motivation / Background</strong><br>\nCurrently, the <code class=\"notranslate\">where.associated</code> method in Rails allows filtering associated records but only with an inner join. This Pull Request aims to enhance <code class=\"notranslate\">where.associated</code> by supporting additional join types, namely <code class=\"notranslate\">joins, left_joins and left_outer_joins</code></p>\n<p dir=\"auto\"><code class=\"notranslate\">Post.where.associated(join_type: :left_joins, :author)</code></p>\n<p dir=\"auto\">This will provide developers with increased flexibility when querying associated data. It enables scenarios like:</p>\n<p dir=\"auto\">Fetching posts with authors, even if some posts have no author assigned. (left_joins)<br>\nRetrieving comments associated with specific users, including orphaned comments without a user. (using multiple joins with different types).</p>\n<p dir=\"auto\"><strong>Detail</strong><br>\nThis Pull Request proposes modifications to:</p>\n<p dir=\"auto\">Extend <code class=\"notranslate\">where.associated</code> to accept a <code class=\"notranslate\">join_type</code> argument along with the association names.<br>\nImplement logic for handling different join types.</p>\n<p dir=\"auto\"><strong>Additional Information</strong><br>\nThis change aligns with common needs expressed by Rails developers on forums and discussions. Similar functionality exists in some popular ORM extensions, demonstrating its usefulness. The implementation strives to maintain clarity and consistency within the existing codebase.</p>\n<p dir=\"auto\">Note: This is a draft description and should be adapted to your specific implementation details and the project's context.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51078",
            "title": "Add support join types in where.associated method",
            "date_modified": "2024-02-16T08:11:36.000Z",
            "date_published": "2024-02-14T06:16:01.000Z",
            "author": {
                "name": "saleh-alhaddad",
                "url": "https://github.com/saleh-alhaddad"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8813886?u=ee98f4955f20293ff922bdc55d7ee1945e365fcb&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Solving <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2132791988\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51067\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51067/hovercard\" href=\"https://github.com/rails/rails/issues/51067\">#51067</a></p>\n<p dir=\"auto\">I'm only familiar with writing rails tests in rspec, I wrote a test after skimming the other syntax in the file but please let me know if there is a better way. <code class=\"notranslate\">record.reload</code> should raise an exception if the record was deleted by <code class=\"notranslate\">create_table</code> dropping the table.</p>\n<div class=\"markdown-alert markdown-alert-note\" dir=\"auto\"><p class=\"markdown-alert-title\" dir=\"auto\"><svg class=\"octicon octicon-info mr-2\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z\"></path></svg>Note</p><p dir=\"auto\">Currently limited to a web editor so I don't have the ability to squash commits or run the full test suite, will try to grab some time to clean up the branch and validate tests when my personal machine is accessible</p>\n</div>\n\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2132791988\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51067\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51067/hovercard\" href=\"https://github.com/rails/rails/issues/51067\">#51067</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes <code class=\"notranslate\">create_table</code> to ignore the <code class=\"notranslate\">force</code> option (which drops the table) if the <code class=\"notranslate\">if_not_exists</code> option is present</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">If you copy a <code class=\"notranslate\">create_table</code> migration from a schema dump and add the <code class=\"notranslate\">if_not_exists</code> guard but forget to remove <code class=\"notranslate\">force</code>, it will drop your table when you migrate it.</p>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51071",
            "title": "Fix #51067 create_table if_not_exists guard S prevent force drop_table",
            "date_modified": "2024-02-14T16:40:57.000Z",
            "date_published": "2024-02-13T18:20:19.000Z",
            "author": {
                "name": "allisonphillips",
                "url": "https://github.com/allisonphillips"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/7265?u=4e4b392ac516396a83c93a4777886c7690a9b332&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">With a bi-directional has one through association, where the join model belongs to each parent with <code class=\"notranslate\">dependent: :destroy</code>, destroying either parent should destroy the through record and the other parent.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"class Left &lt; ActiveRecord::Base\n  has_one :middle, dependent: :destroy\n  has_one :right, through: :middle\nend\n\nclass Middle &lt; ActiveRecord::Base\n  belongs_to :left, dependent: :destroy\n  belongs_to :right, dependent: :destroy\nend\n\nclass Right &lt; ActiveRecord::Base\n  has_one :middle, dependent: :destroy\n  has_one :left, through: :middle\nend\"><pre class=\"notranslate\"><code class=\"notranslate\">class Left &lt; ActiveRecord::Base\n  has_one :middle, dependent: :destroy\n  has_one :right, through: :middle\nend\n\nclass Middle &lt; ActiveRecord::Base\n  belongs_to :left, dependent: :destroy\n  belongs_to :right, dependent: :destroy\nend\n\nclass Right &lt; ActiveRecord::Base\n  has_one :middle, dependent: :destroy\n  has_one :left, through: :middle\nend\n</code></pre></div>\n<p dir=\"auto\">However this only worked from one end.  When destroying the \"non-working\" end, the join model was correctly destroyed but the other end was not.</p>\n<p dir=\"auto\">In the example above:</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">right.destroy</code> correctly destroys its <code class=\"notranslate\">middle</code> and its <code class=\"notranslate\">left</code>;</li>\n<li><code class=\"notranslate\">left.destroy</code> destroys its <code class=\"notranslate\">middle</code> but not its <code class=\"notranslate\">right</code>.</li>\n</ul>\n<p dir=\"auto\">The end which worked depended on the order of <code class=\"notranslate\">belongs_to</code> statements in the join model.</p>\n<p dir=\"auto\">This commit ensures that the no matter which end you destroy, the far end is destroyed (along with the join record).</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #50948.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2114571381\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50948\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50948/hovercard\" href=\"https://github.com/rails/rails/issues/50948\">#50948</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51066",
            "title": "Fix bi-directional destroying of has_one :through",
            "date_modified": "2024-02-14T19:18:44.000Z",
            "date_published": "2024-02-13T16:52:49.000Z",
            "author": {
                "name": "airblade",
                "url": "https://github.com/airblade"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/108208?u=31587544126ab4506d05644fcccb8621f893ef1b&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #51029.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2127545514\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51029\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51029/hovercard\" href=\"https://github.com/rails/rails/issues/51029\">#51029</a></p>\n\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because the limits for nested attributes didn't reject records marked for destruction.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request ensures records marked for destruction won't interfere on limits.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51054",
            "title": "Do not force limits on nested records marked for destruction.",
            "date_modified": "2024-02-14T00:59:06.000Z",
            "date_published": "2024-02-13T02:02:53.000Z",
            "author": {
                "name": "ruyrocha",
                "url": "https://github.com/ruyrocha"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/7190681?u=2d6f050dc3d66da04d8df3fb62ed1df570bca4ee&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">Expand some documentation and examples for querying across multiple records that implement delegated types.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes documentation in ActiveRecord Delegated Type.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">N/A</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51047",
            "title": "Add query docs for delegated type [ci skip]",
            "date_modified": "2024-02-15T03:55:45.000Z",
            "date_published": "2024-02-12T00:26:49.000Z",
            "author": {
                "name": "johnpitchko",
                "url": "https://github.com/johnpitchko"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54629302?u=be8de5137bf940532cddd05aff823129ab8a39db&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #51044.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2128776609\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51044\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51044/hovercard\" href=\"https://github.com/rails/rails/issues/51044\">#51044</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Updates the documented <code class=\"notranslate\">ActiveRecord::QueryMethods#distinct</code> and undocumented <code class=\"notranslate\">ActiveRecord::QueryMethods#distinct!</code> methods to <del>raise an <code class=\"notranslate\">ArgumentError</code></del> log a deprecation warning if given a non-boolean argument.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">None.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51045",
            "title": "[Fix #51044] Deprecate providing a non-boolean argument to `#distinct`",
            "date_modified": "2024-02-13T10:08:18.000Z",
            "date_published": "2024-02-11T00:50:48.000Z",
            "author": {
                "name": "joshuay03",
                "url": "https://github.com/joshuay03"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1024162?u=7443111f3ec1e524d7cb892e67f2c68dd128f6fc&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR allows you to set <code class=\"notranslate\">code</code> and <code class=\"notranslate\">reason</code> when closing a WebSocket connection.<br>\nIt's very useful when hacking ActionCable.</p>\n<p dir=\"auto\">In addition, I small refactor the file to avoid potential nil error, I can remove this change.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51043",
            "title": "ActionCable: allow to pass websocket.close args",
            "date_modified": "2024-02-16T01:38:55.000Z",
            "date_published": "2024-02-10T18:19:37.000Z",
            "author": {
                "name": "jasl",
                "url": "https://github.com/jasl"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/61513630?u=320e43fe4dc7bc6efc64e9b8f325f8075634fd20&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The current security guide contains outdated information about the CORS initializer.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51042",
            "title": "docs: Outdated CORS initializer [ci-skip]",
            "date_modified": "2024-02-14T00:41:55.000Z",
            "date_published": "2024-02-10T16:36:27.000Z",
            "author": {
                "name": "lsglucas",
                "url": "https://github.com/lsglucas"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Trying to debug <code class=\"notranslate\">reaper_test.rb</code>.</p>",
            "url": "https://github.com/rails/rails/pull/51038",
            "title": "Debug CI flaky test",
            "date_modified": "2024-02-12T12:37:24.000Z",
            "date_published": "2024-02-10T11:11:44.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">As part of removing the dummy apps, in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2053506521\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50427\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50427/hovercard\" href=\"https://github.com/rails/rails/pull/50427\">#50427</a>, it was suggested to look at ways to improve test coverage from the point of view of Railties.</p>\n<p dir=\"auto\">This PR is a first take at that, and always open to feedback/suggestions 🙇</p>",
            "url": "https://github.com/rails/rails/pull/51036",
            "title": "Add a basic railtie integration test for Active Storage",
            "date_modified": "2024-02-10T09:34:06.000Z",
            "date_published": "2024-02-10T09:34:02.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Reverts <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2119751080\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50978\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50978/hovercard\" href=\"https://github.com/rails/rails/pull/50978\">#50978</a></p>\n<p dir=\"auto\">5.22.2 was released to address this, hopefully. 🙏</p>",
            "url": "https://github.com/rails/rails/pull/51011",
            "title": "Revert \"Pin minitest version to 5.21\"",
            "date_modified": "2024-02-08T12:02:42.000Z",
            "date_published": "2024-02-08T11:41:43.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/47484308?u=1d6070e1d8468e41afb88dfcbe3eb982b0a82114&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Currently, there is no (simple) way to ask a model if it connects to a single database or to multiple shards. Furthermore, without looping through a model's connections, I don't believe there's an easy way to return a list of shards a model can connect to.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit adds a <code class=\"notranslate\">@shard_keys</code> ivar that's set whenever <code class=\"notranslate\">.connects_to</code> is called. It sets the ivar to the result of <code class=\"notranslate\">shards.keys</code>. <code class=\"notranslate\">shards</code> in <code class=\"notranslate\">.connects_to</code> defaults to an empty hash and therefore when calling <code class=\"notranslate\">connects_to database: {...}</code> <code class=\"notranslate\">@shard_keys</code> will be set to an empty array.</p>\n<p dir=\"auto\"><code class=\"notranslate\">@shard_keys</code> is set <em>before</em> the following lines:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"if shards.empty?\n  shards[:default] = database\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">if</span> <span class=\"pl-en\">shards</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">empty?</span>\n  <span class=\"pl-en\">shards</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:default</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">database</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">This conditional sets the one and only shard (<code class=\"notranslate\">:default</code>) to the value of <code class=\"notranslate\">database</code> that we pass to <code class=\"notranslate\">.connects_to</code>. This allows for calling <code class=\"notranslate\">connected_to(shard: :default)</code> on models configured to only connect to a database e.g.:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class UnshardedBase &lt; ActiveRecord::Base\n  self.abstract_class = true\n\n  connects_to database: { writing: :primary }\nend\n\nclass UnshardedModel &lt; UnshardedBase\nend\n\nUnshardedBase.connected_to(shard: :default) { UnshardedBase.connection_pool.db_config.name } =&gt; primary\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">UnshardedBase</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">abstract_class</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n\n  <span class=\"pl-en\">connects_to</span> <span class=\"pl-pds\">database</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">writing</span>: <span class=\"pl-pds\">:primary</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">UnshardedModel</span> &lt; <span class=\"pl-v\">UnshardedBase</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">UnshardedBase</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connected_to</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">shard</span>: <span class=\"pl-pds\">:default</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> <span class=\"pl-v\">UnshardedBase</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection_pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">db_config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span> <span class=\"pl-kos\">}</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">primary</span></pre></div>\n<p dir=\"auto\">This is ultimately still an <em>unsharded</em> model which is why <code class=\"notranslate\">@shard_keys</code> gets set before the conditional.</p>\n<p dir=\"auto\">With the new <code class=\"notranslate\">@shard_keys</code> ivar we need a way for descendants of the abstract AR model to return that same value. For that we leverage the existing <code class=\"notranslate\">.connection_class_for_self</code> method. That method returns the ancestor of the model where <code class=\"notranslate\">.connects_to</code> was called, or returns self if it's the connection class:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class UnshardedBase &lt; ActiveRecord::Base\n  self.abstract_class = true\n\n  connects_to database: { writing: :primary }\nend\n\nclass UnshardedModel &lt; UnshardedBase\nend\n\nActiveRecord::Base.connection_class_for_self =&gt; ActiveRecord::Base\n\nUnshardedBase.connection_class_for_self =&gt; UnshardedBase(abstract)\n\nUnshardedModel.connection_class_for_self =&gt; UnshardedBase(abstract)\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">UnshardedBase</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">abstract_class</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n\n  <span class=\"pl-en\">connects_to</span> <span class=\"pl-pds\">database</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">writing</span>: <span class=\"pl-pds\">:primary</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">UnshardedModel</span> &lt; <span class=\"pl-v\">UnshardedBase</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection_class_for_self</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n\n<span class=\"pl-v\">UnshardedBase</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection_class_for_self</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">UnshardedBase</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">abstract</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-v\">UnshardedModel</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection_class_for_self</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">UnshardedBase</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">abstract</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">The new <code class=\"notranslate\">.shard_keys</code> method is a getter which returns the value of <code class=\"notranslate\">@shard_keys</code> from the connection class or it returns an empty array. The empty array is necessary in cases where <code class=\"notranslate\">connects_to</code> was never called.</p>\n<p dir=\"auto\">Finally, I've added an <code class=\"notranslate\">.on_all_shards</code> method which takes all of the arguments for <code class=\"notranslate\">.connected_to</code> except for <code class=\"notranslate\">shard</code>. Instead, it loops through every shard key and then delegates everything else to <code class=\"notranslate\">.connected_to</code>. I've used <code class=\"notranslate\">.map</code> instead of <code class=\"notranslate\">.each</code> so that we can collect the results of each block.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51009",
            "title": "Add `.shard_keys`, `.sharded?`, & `.on_all_shards` methods to AR Models",
            "date_modified": "2024-02-14T16:02:46.000Z",
            "date_published": "2024-02-08T08:50:30.000Z",
            "author": {
                "name": "HeyNonster",
                "url": "https://github.com/HeyNonster"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">For example, if you run <code class=\"notranslate\">rails test test/models/usr_tsst.rb</code> and the file does not exist, Rails will suggest <code class=\"notranslate\">test/models/users_test.rb</code> as a possible file.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Could not load test file: test/models/usr_tsst.rb. Did you mean? test/models/user_test.rb\"><pre class=\"notranslate\"><code class=\"notranslate\">Could not load test file: test/models/usr_tsst.rb. Did you mean? test/models/user_test.rb\n</code></pre></div>\n<p dir=\"auto\">After investigating <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2119751080\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50978\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50978/hovercard\" href=\"https://github.com/rails/rails/pull/50978\">#50978</a>, I was inspired to add this feature to Rails.</p>\n<p dir=\"auto\">Credit to <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/tenderlove/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tenderlove\">@tenderlove</a> for the minitest implementation.</p>",
            "url": "https://github.com/rails/rails/pull/51005",
            "title": "Rails test command suggests similar test files when the given file is not found",
            "date_modified": "2024-02-13T23:09:35.000Z",
            "date_published": "2024-02-08T00:58:58.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        }
    ]
}