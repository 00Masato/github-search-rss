{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/929886?u=20e7647deec019e86c7d64fd94148ede89abb64c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">In <code class=\"notranslate\">config/database.yml</code> specifically, and generally where the default/fallback value of a hash key is a simple value, we should prefer <a href=\"https://ruby-doc.org/3.2.2/Hash.html#method-i-fetch\" rel=\"nofollow\"><code class=\"notranslate\">Hash#fetch(key, default_value)</code></a> to <code class=\"notranslate\">Hash#fetch(key, &amp;blk)</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR updates the <code class=\"notranslate\">config/database.yml</code> template to prefer <code class=\"notranslate\">ENV.fetch(\"RAILS_MAX_THREADS\", 5)</code> over the current block/proc approach. The block/proc approach allows us to defer computing the default value until absolutely necessary—that is, <code class=\"notranslate\">ENV.fetch(\"RAILS_MAX_THREADS\")</code> is <code class=\"notranslate\">nil</code>. This makes sense when the computation can be very expensive. In this case, they're not.</p>\n<p dir=\"auto\">The defaults are simple values (integers), not resource-intensive, and require no expensive computation (method calls, etc) to produce. Therefore, I believe they should be passed directly to the <code class=\"notranslate\">fetch</code> call. I've restricted the changes to the database configuration but there are other low-hanging fruits that could be similarly refactored.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52427",
            "title": "In database config, prefer simple values to blocks/procs",
            "date_modified": "2024-07-26T12:30:50.000Z",
            "date_published": "2024-07-26T12:25:19.000Z",
            "author": {
                "name": "yawboakye",
                "url": "https://github.com/yawboakye"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/99586?u=b4abd791d83e768c72cb832147b4a210caecf47d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">When <code class=\"notranslate\">config.i18n.raise_on_missing_translations = true</code>, controllers and views raise an error on missing translations. However, models won't. This PR changes models to raise an error when <code class=\"notranslate\">raise_on_missing_translations</code> is true.</p>\n<h3 dir=\"auto\">Detail</h3>\n<h3 dir=\"auto\">Additional information</h3>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52426",
            "title": "Add an option to raise an error on missing translations for Active Model human_attribute_name",
            "date_modified": "2024-07-26T11:07:03.000Z",
            "date_published": "2024-07-26T11:06:43.000Z",
            "author": {
                "name": "shouichi",
                "url": "https://github.com/shouichi"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/14981592?u=11406fb0121b15a93b3305388377a57b4d9c96f9&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Rails 8.0 will be Ruby 3.1 or greater only<br>\n<code class=\"notranslate\">except</code> natively got added in Ruby 3.0 so this is dead code now.</p>\n<p dir=\"auto\"><a href=\"https://docs.ruby-lang.org/en/3.1/Hash.html#method-i-except\" rel=\"nofollow\">https://docs.ruby-lang.org/en/3.1/Hash.html#method-i-except</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52424",
            "title": "Drop Hash `except` core extension",
            "date_modified": "2024-07-26T09:38:37.000Z",
            "date_published": "2024-07-26T07:06:12.000Z",
            "author": {
                "name": "Earlopain",
                "url": "https://github.com/Earlopain"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/4289625?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because the current querying guide has no entries for CTE and the link to <code class=\"notranslate\">with</code> method.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds the entry for CTE.</p>\n<p dir=\"auto\">Note that this PR is a retry of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1942777044\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49630\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49630/hovercard\" href=\"https://github.com/rails/rails/pull/49630\">#49630</a>, including the following updates:</p>\n<ul dir=\"auto\">\n<li>Changed the code examples from <code class=\"notranslate\">Post</code> and <code class=\"notranslate\">Comment</code> models to <code class=\"notranslate\">Book</code> and <code class=\"notranslate\">Review</code> to be consistent with <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"623747852\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/39406\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/39406/hovercard\" href=\"https://github.com/rails/rails/pull/39406\">#39406</a></li>\n<li>Added the minimum version of SQLite to work with CTE</li>\n<li>Revised some English sentences with a little help of Claude 3.5 Sonnet</li>\n</ul>\n<p dir=\"auto\">The SQL queries in this PR were actually generated using a local Rails application running Rails 7.1.3.4 and Ruby 3.3.4.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">ref: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"536810238\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/37944\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/37944/hovercard\" href=\"https://github.com/rails/rails/pull/37944\">#37944</a><br>\nref: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1512256975\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46843\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/46843/hovercard\" href=\"https://github.com/rails/rails/pull/46843\">#46843</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52423",
            "title": "[ci-skip][Docs][retry] Add description for CTE to querying guide",
            "date_modified": "2024-07-26T05:34:16.000Z",
            "date_published": "2024-07-26T05:34:11.000Z",
            "author": {
                "name": "hachi8833",
                "url": "https://github.com/hachi8833"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5162312?u=e1b3c0f7c6dc600253bf15c99f618b9b2d39c500&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Followup to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2426595281\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52409\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/52409/hovercard\" href=\"https://github.com/rails/rails/pull/52409\">#52409</a></p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because I'd like to deprecate paths as hash keys in route mappings:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# Before\nget &quot;/users&quot; =&gt; &quot;users#index&quot;\npost &quot;/logout&quot; =&gt; :sessions\n\n# After\nget &quot;/users&quot;, to: &quot;users#index&quot;\npost &quot;/logout&quot;, to: &quot;sessions#logout&quot;\"><pre class=\"notranslate\"><span class=\"pl-c\"># Before</span>\n<span class=\"pl-en\">get</span> <span class=\"pl-s\">\"/users\"</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s\">\"users#index\"</span>\n<span class=\"pl-en\">post</span> <span class=\"pl-s\">\"/logout\"</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-pds\">:sessions</span>\n\n<span class=\"pl-c\"># After</span>\n<span class=\"pl-en\">get</span> <span class=\"pl-s\">\"/users\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">to</span>: <span class=\"pl-s\">\"users#index\"</span>\n<span class=\"pl-en\">post</span> <span class=\"pl-s\">\"/logout\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">to</span>: <span class=\"pl-s\">\"sessions#logout\"</span></pre></div>\n<p dir=\"auto\">This work moves us closer to <a href=\"https://github.com/Shopify/rails/tree/routing_mapper_opt\">using keywords in the routing mapper</a> which gives us a 1.25-1.5x speed boost (see linked PR above for benchmark).</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Drawing routes with has keys complicates route drawing enough to warrant deprecation. Transitioning the routing mapper to use keywords would result in a 1.25-1.5x improvement in speed, and it would be substantially easier to do if we drop this feature.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52422",
            "title": "Deprecate hash key path mapping",
            "date_modified": "2024-07-26T00:18:11.000Z",
            "date_published": "2024-07-26T00:00:52.000Z",
            "author": {
                "name": "gmcgibbon",
                "url": "https://github.com/gmcgibbon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/35061?u=948386299a45ab279b5d657bf028751fc6d3767f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">In my app I'm using Turbo Stream. I need to know the moment that a stream channel is connected and was pleased to find there is a notification for it: <code class=\"notranslate\">transmit_subscription_confirmation.action_cable</code>. However, the only information in the notification event is <code class=\"notranslate\">channel_class: \"Turbo::StreamsChannel\"</code>. For custom ActionCable classes, this might be sufficient, but this is not very helpful for a Turbo Stream channel because you can't disambiguate them. Plus, in my particular case, I want to know the specific model that the <code class=\"notranslate\">turbo_stream_from</code> was initialized for.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds <code class=\"notranslate\">identifier:</code> as an additional payload field for <code class=\"notranslate\">transmit_subscription_confirmation.action_cable</code> and for <code class=\"notranslate\">transmit_subscription_rejection.action_cable</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG — it does not seem worth updating the changelog for this as it's practically a bug fix.</li>\n</ul>\n<h3 dir=\"auto\">Addendum</h3>\n<p dir=\"auto\">The reason that I need to listen for this event is because of a bug, I think, in Turbo Stream. If I can get confirmation of the bug, I'm happy to submit a fix for it, as well. I opened an Issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2431017564\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52420\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/52420/hovercard\" href=\"https://github.com/rails/rails/issues/52420\">#52420</a> to stay organized. But regardless of how we handle this \"bug\", it will be good to have an identifier on these events.</p>",
            "url": "https://github.com/rails/rails/pull/52421",
            "title": "Include identifier in ActionCable channel notifications",
            "date_modified": "2024-07-26T11:09:47.000Z",
            "date_published": "2024-07-25T21:39:58.000Z",
            "author": {
                "name": "krschacht",
                "url": "https://github.com/krschacht"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/131752?u=32ddf1119b1d189c9bd241a721b36ea01c29f61e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This partially reverts commit <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/c9075e3643ecaed3b053b0fe50799895b71474af/hovercard\" href=\"https://github.com/rails/rails/commit/c9075e3643ecaed3b053b0fe50799895b71474af\"><tt>c9075e3</tt></a>, I kept all the tests ❤️ added but adjusted the query counts back to 1.</p>\n<p dir=\"auto\">Per discussion in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2329033571\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51987\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/51987/hovercard\" href=\"https://github.com/rails/rails/pull/51987\">#51987</a>, this changes a behaviour that was <a href=\"https://github.com/rails/rails/blob/55c4adeb36eff229972eecbb53723c1b80393091/activerecord/lib/active_record/associations/collection_proxy.rb#L854-L857\">documented</a> (though not quite well enough IMO, it should probably be mentioned here and not in <code class=\"notranslate\">any?</code>). <code class=\"notranslate\">exists?</code> should be an analogue to <code class=\"notranslate\">count</code> and always make a database query, and users should have the ability to do that. We already have <code class=\"notranslate\">any?</code>/<code class=\"notranslate\">none?</code>/<code class=\"notranslate\">empty?</code> as analogues to <code class=\"notranslate\">size</code>, which intelligently picks whether to use the cached relation or to make a query, though likely all of these could be documented a little better.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/fatkodima/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/fatkodima\">@fatkodima</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a></p>",
            "url": "https://github.com/rails/rails/pull/52418",
            "title": "Revert change to exists? from #51987",
            "date_modified": "2024-07-25T22:15:31.000Z",
            "date_published": "2024-07-25T17:51:00.000Z",
            "author": {
                "name": "jhawthorn",
                "url": "https://github.com/jhawthorn"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Over time, Active Model instances built with data from external sources (like API calls) has the potential to become out of synchronization with older versions of that data. For example, an API might add or remove a field from a JSON response, and applications might be passing that parsed JSON directly to model constructors for mass assignment.</p>\n<p dir=\"auto\">Without operating on the data first (to sanitize or normalize it), model instances don't have an opportunity to gracefully handle those unexpected changes to the underlying data.  In the best cases, they might be able to take corrective or coercive measures. In the worst cases, they might track or log the mismatch.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Introduce the <code class=\"notranslate\">ActiveModel::AttributeAssignment#attribute_writer_missing</code> method to provide instances with an opportunity to gracefully handle assigning to an unknown attribute:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Rectangle\n  include ActiveModel::AttributeAssignment\n\n  attr_accessor :length, :width\n\n  def attribute_writer_missing(name, value)\n    Rails.logger.warn &quot;Tried to assign to unknown attribute #{name}&quot;\n  end\nend\n\nrectangle = Rectangle.new\nrectangle.assign_attributes(volume: 10) # =&gt; Logs &quot;Tried to assign to unknown attribute 'volume'&quot;\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Rectangle</span>\n  <span class=\"pl-en\">include</span> <span class=\"pl-v\">ActiveModel</span>::<span class=\"pl-v\">AttributeAssignment</span>\n\n  <span class=\"pl-en\">attr_accessor</span> <span class=\"pl-pds\">:length</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:width</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">attribute_writer_missing</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">name</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">warn</span> <span class=\"pl-s\">\"Tried to assign to unknown attribute <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">name</span><span class=\"pl-kos\">}</span></span>\"</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">rectangle</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Rectangle</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">rectangle</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">assign_attributes</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">volume</span>: <span class=\"pl-c1\">10</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\"># =&gt; Logs \"Tried to assign to unknown attribute 'volume'\"</span></pre></div>\n<p dir=\"auto\">By default, classes that do not override <code class=\"notranslate\">#attribute_writer_missing</code> will raise an <code class=\"notranslate\">ActiveModel::UnknownAttributeError</code>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">The <code class=\"notranslate\">attribute_writer_missing</code> aims to mimic the naming of <code class=\"notranslate\">BasicObject#method_missing</code>. There is also an<br>\n<a href=\"https://edgeapi.rubyonrails.org/classes/ActiveModel/AttributeMethods.html#method-i-attribute_missing\" rel=\"nofollow\">ActiveModel::AttributeMethods#attribute_missing</a> method, but that pertains to attribute <em>access</em>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52417",
            "title": "Introduce `ActiveModel::AttributeAssignment#attribute_writer_missing`",
            "date_modified": "2024-07-26T10:50:41.000Z",
            "date_published": "2024-07-25T16:54:32.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/393096?u=123de8de12a2f540233c17ff4af0a38a05e8fe41&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">When defining <code class=\"notranslate\">validates_associated</code> with a singular association and when having <code class=\"notranslate\">ActiveRecord.index_nested_attribute_errors</code> enabled, then calling <code class=\"notranslate\">valid?</code> raises the following error</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"NoMethodError: undefined method 'find_index' for an instance of &lt;singular association class name&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">NoMethodError: undefined method 'find_index' for an instance of &lt;singular association class name&gt;\n</code></pre></div>\n<p dir=\"auto\">This bug didn't happen with Rails <code class=\"notranslate\">&lt; 7.2.0.beta1</code> and was likely introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1802075341\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48727\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48727/hovercard\" href=\"https://github.com/rails/rails/pull/48727\">#48727</a></p>\n<p dir=\"auto\">This PR fixes this issue by returning unindexed nested errors when an error occurs on a nested singular association.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Test case to reproduce the error in Ruby on Rails 7.2.0.beta3:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire &quot;bundler/inline&quot;\n\ngemfile(true) do\n  source &quot;https://rubygems.org&quot;\n\n  gem &quot;rails&quot;, &quot;7.2.0.beta3&quot;\n  gem &quot;sqlite3&quot;\nend\n\nrequire &quot;active_record&quot;\nrequire &quot;minitest/autorun&quot;\nrequire &quot;logger&quot;\n\n# This connection will do for database-independent bug reports.\nActiveRecord::Base.establish_connection(adapter: &quot;sqlite3&quot;, database: &quot;:memory:&quot;)\nActiveRecord::Base.logger = Logger.new(STDOUT)\n\nActiveRecord::Schema.define do\n  create_table :users, force: true do |t|\n  end\n\n  create_table :profiles, force: true do |t|\n    t.integer :user_id\n    t.text :handle\n  end\nend\n\nActiveRecord.index_nested_attribute_errors = true\n\nclass User &lt; ActiveRecord::Base\n  has_one :profile\n\n  accepts_nested_attributes_for :profile\n  validates_associated :profile\nend\n\nclass Profile &lt; ActiveRecord::Base\n  belongs_to :user\n\n  validates :handle, presence: true\nend\n\nclass BugTest &lt; Minitest::Test\n  def test_validates_associated\n    user = User.new(profile_attributes: { handle: &quot;spickermann&quot; })\n\n    assert user.valid?\n\n    user = User.new(profile_attributes: { handle: &quot;&quot; })\n\n    refute user.valid?\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/inline\"</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">\"https://rubygems.org\"</span>\n\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"rails\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"7.2.0.beta3\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"sqlite3\"</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_record\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"minitest/autorun\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"logger\"</span>\n\n<span class=\"pl-c\"># This connection will do for database-independent bug reports.</span>\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">establish_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">adapter</span>: <span class=\"pl-s\">\"sqlite3\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">database</span>: <span class=\"pl-s\">\":memory:\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Schema</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">define</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:users</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:profiles</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">integer</span> <span class=\"pl-pds\">:user_id</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">text</span> <span class=\"pl-pds\">:handle</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">ActiveRecord</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">index_nested_attribute_errors</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">User</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">has_one</span> <span class=\"pl-pds\">:profile</span>\n\n  <span class=\"pl-en\">accepts_nested_attributes_for</span> <span class=\"pl-pds\">:profile</span>\n  <span class=\"pl-en\">validates_associated</span> <span class=\"pl-pds\">:profile</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Profile</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:user</span>\n\n  <span class=\"pl-en\">validates</span> <span class=\"pl-pds\">:handle</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">presence</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">BugTest</span> &lt; <span class=\"pl-v\">Minitest</span>::<span class=\"pl-v\">Test</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_validates_associated</span>\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">profile_attributes</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">handle</span>: <span class=\"pl-s\">\"spickermann\"</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-en\">assert</span> <span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">valid?</span>\n\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">profile_attributes</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">handle</span>: <span class=\"pl-s\">\"\"</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-en\">refute</span> <span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">valid?</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">The above test case will raise the following exception in Ruby on Rails 7.2.0.beta3:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  1) Error:\nBugTest#test_validates_associated:\nNoMethodError: undefined method `find_index' for an instance of Profile\n    3.3.4/lib/ruby/gems/3.3.0/gems/activemodel-7.2.0.beta3/lib/active_model/attribute_methods.rb:507:in `method_missing'\n    [...]\n    validate_associated.rb:53:in `test_validates_associated'\"><pre class=\"notranslate\"><code class=\"notranslate\">  1) Error:\nBugTest#test_validates_associated:\nNoMethodError: undefined method `find_index' for an instance of Profile\n    3.3.4/lib/ruby/gems/3.3.0/gems/activemodel-7.2.0.beta3/lib/active_model/attribute_methods.rb:507:in `method_missing'\n    [...]\n    validate_associated.rb:53:in `test_validates_associated'\n</code></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52416",
            "title": "Fix indexed nested error for singular associations",
            "date_modified": "2024-07-25T15:03:18.000Z",
            "date_published": "2024-07-25T13:13:45.000Z",
            "author": {
                "name": "spickermann",
                "url": "https://github.com/spickermann"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19589006?u=4625e661fdb3256af0ed316629196771b9ee0c11&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because I wanted to have a Svelte store compatible way to monitor a channel, and create a clean interface to subscribe callbacks to a channel.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the Action Cable client <code class=\"notranslate\">Subscription</code> to add a <code class=\"notranslate\">.observer(parser = String)</code> accessor to create or find a <code class=\"notranslate\">SubscriptionObserver</code> which allows for subscribing callback functions to new data. The value in the <code class=\"notranslate\">SubscriptionObserver</code> gets replaced with each new packet.</p>\n<p dir=\"auto\">Here's a code example:</p>\n<div class=\"highlight highlight-source-js notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"const observer = consumer.subscriptions.create({ channel: &quot;ExampleChannel&quot; }).observer(JSON.parse)\nconst unsubscribe = observer.subscribe((data) =&gt; console.log(data))\n\nsetTimeout(unsubscribe, 5000)\"><pre class=\"notranslate\"><span class=\"pl-k\">const</span> <span class=\"pl-s1\">observer</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">consumer</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">subscriptions</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">{</span> <span class=\"pl-c1\">channel</span>: <span class=\"pl-s\">\"ExampleChannel\"</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">observer</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">JSON</span><span class=\"pl-kos\">.</span><span class=\"pl-c1\">parse</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">const</span> <span class=\"pl-s1\">unsubscribe</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">observer</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">subscribe</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">data</span><span class=\"pl-kos\">)</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-smi\">console</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">data</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-en\">setTimeout</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">unsubscribe</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">5000</span><span class=\"pl-kos\">)</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">This is fully compatible with <a href=\"https://svelte.dev/docs/svelte-components#script-4-prefix-stores-with-$-to-access-their-values\" rel=\"nofollow\">Svelte Stores</a>.</p>\n<p dir=\"auto\">A lot of inspiration was also taken from the <a href=\"https://rxjs.dev/guide/observable\" rel=\"nofollow\">RxJS Observable</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52411",
            "title": "Action Cable: Create `SubscriptionObserver` to facilitate callbacks for channel data",
            "date_modified": "2024-07-24T14:18:07.000Z",
            "date_published": "2024-07-24T14:17:37.000Z",
            "author": {
                "name": "reesericci",
                "url": "https://github.com/reesericci"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5162312?u=e1b3c0f7c6dc600253bf15c99f618b9b2d39c500&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because I'd like to deprecate using multiple paths on route mappings:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Rails.application.routes.draw do\n  get &quot;/users&quot;, &quot;/other_path/users&quot;, &quot;/another_path/users&quot;, to: &quot;users#index&quot;\nend\"><pre class=\"notranslate\"><span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">routes</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">draw</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">get</span> <span class=\"pl-s\">\"/users\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"/other_path/users\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"/another_path/users\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">to</span>: <span class=\"pl-s\">\"users#index\"</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Instead, we can simply write:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Rails.application.routes.draw do\n  get &quot;/users&quot;, to: &quot;users#index&quot;\n  get &quot;/other_path/users&quot;,  to: &quot;users#index&quot;\n  get &quot;/another_path/users&quot;, to: &quot;users#index&quot;\nend\"><pre class=\"notranslate\"><span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">routes</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">draw</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">get</span> <span class=\"pl-s\">\"/users\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">to</span>: <span class=\"pl-s\">\"users#index\"</span>\n  <span class=\"pl-en\">get</span> <span class=\"pl-s\">\"/other_path/users\"</span><span class=\"pl-kos\">,</span>  <span class=\"pl-pds\">to</span>: <span class=\"pl-s\">\"users#index\"</span>\n  <span class=\"pl-en\">get</span> <span class=\"pl-s\">\"/another_path/users\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">to</span>: <span class=\"pl-s\">\"users#index\"</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">This is a bit easier to read in my opinion (albeit more redundant), and it simplifies the mapper implementation for an upcoming change I'd like to propose. I'd really like to <a href=\"https://github.com/Shopify/rails/tree/routing_mapper_opt\">convert hashes in the mapper to use keywords</a>. Using a benchmark like this:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire &quot;bundler/inline&quot;\n\ngemfile(true) do\n  source &quot;https://rubygems.org&quot;\n\n  gem &quot;rails&quot;, path: &quot;.&quot;\n  gem &quot;benchmark-ips&quot;\n  gem &quot;stringio&quot;\nend\n\nrequire &quot;benchmark/ips&quot;\nrequire &quot;action_controller/railtie&quot;\n\nclass TestApp &lt; Rails::Application\n  config.root = __dir__\n  config.hosts &lt;&lt; &quot;example.org&quot;\n  config.secret_key_base = &quot;secret_key_base&quot;\n\n  config.logger = Logger.new($stdout)\n  Rails.logger  = config.logger\nend\n\nclass TestController &lt; ActionController::Base\n  include Rails.application.routes.url_helpers\n\n  def index\n    render plain: &quot;Home&quot;\n  end\nend\n\nBenchmark.ips do |x|\n  x.report(&quot;draw&quot;) do\n    Rails.application.routes.draw do\n      resources :posts\n      resource :user\n      root to: &quot;home#index&quot;\n      post &quot;login&quot;, to: &quot;sessions#login&quot;\n      delete &quot;logout&quot;, to: &quot;sessions#logout&quot;\n    end\n    Rails.application.instance_variable_set(:@routes, nil)\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/inline\"</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">\"https://rubygems.org\"</span>\n\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"rails\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">path</span>: <span class=\"pl-s\">\".\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"benchmark-ips\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"stringio\"</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"benchmark/ips\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"action_controller/railtie\"</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">TestApp</span> &lt; <span class=\"pl-v\">Rails</span>::<span class=\"pl-v\">Application</span>\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">root</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">__dir__</span>\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">hosts</span> &lt;&lt; <span class=\"pl-s\">\"example.org\"</span>\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">secret_key_base</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"secret_key_base\"</span>\n\n  <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span>$stdout<span class=\"pl-kos\">)</span>\n  <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span>  <span class=\"pl-c1\">=</span> <span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">TestController</span> &lt; <span class=\"pl-v\">ActionController</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">include</span> <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">routes</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">url_helpers</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">index</span>\n    <span class=\"pl-en\">render</span> <span class=\"pl-pds\">plain</span>: <span class=\"pl-s\">\"Home\"</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"draw\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">routes</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">draw</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-en\">resources</span> <span class=\"pl-pds\">:posts</span>\n      <span class=\"pl-en\">resource</span> <span class=\"pl-pds\">:user</span>\n      <span class=\"pl-en\">root</span> <span class=\"pl-pds\">to</span>: <span class=\"pl-s\">\"home#index\"</span>\n      <span class=\"pl-en\">post</span> <span class=\"pl-s\">\"login\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">to</span>: <span class=\"pl-s\">\"sessions#login\"</span>\n      <span class=\"pl-en\">delete</span> <span class=\"pl-s\">\"logout\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">to</span>: <span class=\"pl-s\">\"sessions#logout\"</span>\n    <span class=\"pl-k\">end</span>\n    <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">instance_variable_set</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:@routes</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">nil</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">We get a 1.25-1.5x  speed boost on route draws.</p>\n<p dir=\"auto\">On main:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ruby 3.3.1 (2024-04-23 revision c56cd86388) [arm64-darwin23]\nWarming up --------------------------------------\n                draw   114.000 i/100ms\nCalculating -------------------------------------\n                draw      1.150k (± 1.1%) i/s -      5.814k in   5.055991s\"><pre class=\"notranslate\"><code class=\"notranslate\">ruby 3.3.1 (2024-04-23 revision c56cd86388) [arm64-darwin23]\nWarming up --------------------------------------\n                draw   114.000 i/100ms\nCalculating -------------------------------------\n                draw      1.150k (± 1.1%) i/s -      5.814k in   5.055991s\n</code></pre></div>\n<p dir=\"auto\">On the <a href=\"https://github.com/Shopify/rails/tree/routing_mapper_opt\">feature branch</a> with this feature removed:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ruby 3.3.1 (2024-04-23 revision c56cd86388) [arm64-darwin23]\nWarming up --------------------------------------\n                draw   141.000 i/100ms\nCalculating -------------------------------------\n                draw      1.496k (± 1.4%) i/s -      7.614k in   5.091321s\"><pre class=\"notranslate\"><code class=\"notranslate\">ruby 3.3.1 (2024-04-23 revision c56cd86388) [arm64-darwin23]\nWarming up --------------------------------------\n                draw   141.000 i/100ms\nCalculating -------------------------------------\n                draw      1.496k (± 1.4%) i/s -      7.614k in   5.091321s\n</code></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Drawing routes with multiple paths complicates route drawing enough to warrant deprecation. Transitioning the routing mapper to use keywords would result in a 1.25-1.5x improvement in speed, and it would be substantially easier to do if we drop this feature. Most developers draw one path per route, so this feature is likely seldom used.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I'm planning to deprecate hash key route paths (eg. <code class=\"notranslate\">get \"/users\" =&gt; \"users#index\"</code>) in a followup PR.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52409",
            "title": "Deprecate multiple path route mapping",
            "date_modified": "2024-07-25T22:06:59.000Z",
            "date_published": "2024-07-24T04:57:01.000Z",
            "author": {
                "name": "gmcgibbon",
                "url": "https://github.com/gmcgibbon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/987638?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">We remove files under the public directory for API-only Applications. </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/a17aa6376d7974e38af90a2fe28e548b201baa63/railties/lib/rails/generators/rails/app/app_generator.rb#L500-L509\">rails/railties/lib/rails/generators/rails/app/app_generator.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 500 to 509\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/a17aa6376d7974e38af90a2fe28e548b201baa63\">a17aa63</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L500\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"500\"></td>\n          <td id=\"LC500\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">delete_public_files_if_api_option</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L501\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"501\"></td>\n          <td id=\"LC501\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">if</span> <span class=\"pl-en\">options</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:api</span><span class=\"pl-kos\">]</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L502\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"502\"></td>\n          <td id=\"LC502\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">remove_file</span> <span class=\"pl-s\">\"public/404.html\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L503\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"503\"></td>\n          <td id=\"LC503\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">remove_file</span> <span class=\"pl-s\">\"public/406-unsupported-browser.html\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L504\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"504\"></td>\n          <td id=\"LC504\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">remove_file</span> <span class=\"pl-s\">\"public/422.html\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L505\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"505\"></td>\n          <td id=\"LC505\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">remove_file</span> <span class=\"pl-s\">\"public/500.html\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L506\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"506\"></td>\n          <td id=\"LC506\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">remove_file</span> <span class=\"pl-s\">\"public/icon.png\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L507\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"507\"></td>\n          <td id=\"LC507\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">remove_file</span> <span class=\"pl-s\">\"public/icon.svg\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L508\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"508\"></td>\n          <td id=\"LC508\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">end</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L509\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"509\"></td>\n          <td id=\"LC509\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">We should keep the behavior in <code class=\"notranslate\">app:update</code> command too.</p>\n<p dir=\"auto\">Follow up of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2325982279\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51952\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/51952/hovercard\" href=\"https://github.com/rails/rails/pull/51952\">#51952</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52403",
            "title": "Don't update public directory during `app:update` command for API-only Applications",
            "date_modified": "2024-07-25T16:53:27.000Z",
            "date_published": "2024-07-23T05:51:28.000Z",
            "author": {
                "name": "y-yagi",
                "url": "https://github.com/y-yagi"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/509837?u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Small enhancement to <a href=\"https://github.com/rails/rails/pull/50977\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50977/hovercard\">this awesome PR</a>, cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/Ridhwana/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/Ridhwana\">@Ridhwana</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/carlosantoniodasilva/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/carlosantoniodasilva\">@carlosantoniodasilva</a></p>\n<ul dir=\"auto\">\n<li>Tidied up some of the wording around how Active Storage works with Action Text.</li>\n<li>Added a warning about <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2347254602\" data-permission-text=\"Title is private\" data-url=\"https://github.com/basecamp/trix/issues/1159\" data-hovercard-type=\"issue\" data-hovercard-url=\"/basecamp/trix/issues/1159/hovercard\" href=\"https://github.com/basecamp/trix/issues/1159\">basecamp/trix#1159</a></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52398",
            "title": "Update Action Text :: Active Storage docs",
            "date_modified": "2024-07-23T00:55:00.000Z",
            "date_published": "2024-07-23T00:54:56.000Z",
            "author": {
                "name": "ghiculescu",
                "url": "https://github.com/ghiculescu"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/522155?u=2e71ed2ab56545207a94b885fafc434ee7350cf1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR is an alternative to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2378385100\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52228\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/52228/hovercard\" href=\"https://github.com/rails/rails/pull/52228\">#52228</a>, exploring <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a>'s idea of a separate method from <code class=\"notranslate\">insert_all</code>. That way, the interface of <code class=\"notranslate\">insert_all</code> does not become too crowded.</p>\n<h2 dir=\"auto\">Background</h2>\n<p dir=\"auto\">We have some performance-critical endpoints where we want to allocate least # of objects and use <code class=\"notranslate\">insert_all</code> to write 1000s of rows into the database.</p>\n<p dir=\"auto\">However, we see <code class=\"notranslate\">insert_all</code> being ~2.5x slower compared to manually building <code class=\"notranslate\">INSERT INTO &lt;table&gt; VALUES (...), (...)</code>.</p>\n<p dir=\"auto\">I've been profiling <code class=\"notranslate\">insert_all</code> and that turned out to be largely because it 1) works with arrays of hashes and each hash needs to be traversed 2) it serializes attributes via Attributes API.</p>\n<p dir=\"auto\">That's great default behavior but if we're inserting 2000 tuples of <code class=\"notranslate\">(&lt;foreigh-key&gt;, &lt;foreigh-key&gt;, &lt;foreigh-key&gt;)</code>, we don't want to traverse hashes and run the complexity of casting integers to integers via Attributes API.</p>\n<p dir=\"auto\">I'd like to propose a \"column mode\" for inserting rows that takes arrays of arrays (no need to traverse hashes!) and makes attribute casting is the responsibility of the caller.</p>\n<p dir=\"auto\">With that approach, we're able to make <code class=\"notranslate\">insert_rows</code> as fast as direct string building:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ruby 3.3.1 (2024-04-23 revision c56cd86388) [arm64-darwin23]\nWarming up --------------------------------------\n          insert_all     4.000 i/100ms\ninsert_all with columns\n                        11.000 i/100ms\n             raw sql    13.000 i/100ms\n           with Arel    12.000 i/100ms\nCalculating -------------------------------------\n          insert_all     41.522 (± 7.2%) i/s -    168.000 in   4.066766s\ninsert_all with columns\n                         86.048 (±23.2%) i/s -    341.000 in   4.161382s\n             raw sql    114.595 (±14.0%) i/s -    455.000 in   4.055053s\n           with Arel    100.232 (±23.9%) i/s -    384.000 in   4.084465s\n\nComparison:\n             raw sql:      114.6 i/s\n           with Arel:      100.2 i/s - same-ish: difference falls within error\ninsert_all with columns:       86.0 i/s - same-ish: difference falls within error\n          insert_all:       41.5 i/s - 2.76x  slower\"><pre class=\"notranslate\"><code class=\"notranslate\">ruby 3.3.1 (2024-04-23 revision c56cd86388) [arm64-darwin23]\nWarming up --------------------------------------\n          insert_all     4.000 i/100ms\ninsert_all with columns\n                        11.000 i/100ms\n             raw sql    13.000 i/100ms\n           with Arel    12.000 i/100ms\nCalculating -------------------------------------\n          insert_all     41.522 (± 7.2%) i/s -    168.000 in   4.066766s\ninsert_all with columns\n                         86.048 (±23.2%) i/s -    341.000 in   4.161382s\n             raw sql    114.595 (±14.0%) i/s -    455.000 in   4.055053s\n           with Arel    100.232 (±23.9%) i/s -    384.000 in   4.084465s\n\nComparison:\n             raw sql:      114.6 i/s\n           with Arel:      100.2 i/s - same-ish: difference falls within error\ninsert_all with columns:       86.0 i/s - same-ish: difference falls within error\n          insert_all:       41.5 i/s - 2.76x  slower\n</code></pre></div>\n<details><summary>Benchmark code</summary>\n<p dir=\"auto\">\n</p><div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire 'debug'\nrequire &quot;active_record&quot;\nrequire &quot;benchmark/ips&quot;\n\nGC.disable\n\nROWS_COUNT = 1000\n\nActiveRecord::Base.establish_connection({ adapter: &quot;sqlite3&quot;, database: &quot;:memory:&quot; })\n\nclass Commerce &lt; ActiveRecord::Base\n  connection.create_table :commerces, force: true do |t|\n    t.string :name, :email, :title, :tags\n    t.integer :variant_id, :product_id, :inventory_id, :something_id, :another_id\n    t.boolean :fulfilled\n    t.datetime :fulfilled_at, :deleted_at\n    t.timestamps null: true\n  end\nend\n\ndef db_time(value)\n  value.to_formatted_s(:db).inspect\nend\n\nATTRS = {\n  name: &quot;sam&quot;,\n  email: &quot;kirs@shopify.com&quot;,\n  title: &quot;title&quot;,\n  tags: &quot;tag1,tag2,tag3&quot;,\n  variant_id: 1,\n  product_id: 1,\n  inventory_id: 1,\n  something_id: 1,\n  another_id: 1,\n  fulfilled: true,\n  fulfilled_at: Time.now,\n  deleted_at: Time.now\n}\n\nBenchmark.ips do |x|\n  x.warmup = 2\n  x.time   = 4\n\n  relation = Commerce.all\n\n  x.report(&quot;insert_all&quot;) do\n    conn = Commerce.connection\n\n    relation.insert_all(\n      [ATTRS] * ROWS_COUNT\n    )\n  end\n\n  x.report(&quot;insert_all with columns&quot;) do\n    conn = Commerce.connection\n    attrs = ATTRS.dup\n    attrs[:fulfilled_at] = attrs[:fulfilled_at].to_formatted_s(:db)\n    attrs[:deleted_at] = attrs[:deleted_at].to_formatted_s(:db)\n    attrs[:created_at] = Time.now.to_formatted_s(:db)\n    attrs[:updated_at] = attrs[:created_at]\n\n    values = [\n      attrs[:name], attrs[:email], attrs[:title], attrs[:tags], attrs[:variant_id], attrs[:product_id], attrs[:inventory_id], attrs[:something_id], attrs[:another_id], attrs[:fulfilled], attrs[:fulfilled_at], attrs[:deleted_at], attrs[:created_at], attrs[:updated_at]\n    ]\n\n    relation.insert_all(\n      [values] * ROWS_COUNT,\n      columns: %w[name email title tags variant_id product_id inventory_id something_id another_id fulfilled fulfilled_at deleted_at created_at updated_at],\n    )\n  end\n\n  x.report(&quot;raw sql&quot;) do\n    conn = Commerce.connection\n    values = (1..ROWS_COUNT).map do\n      attrs = ATTRS\n      &quot;(#{conn.quote(attrs[:name])}, #{conn.quote(attrs[:email])}, #{conn.quote(attrs[:title])}, #{conn.quote(attrs[:tags])}, #{attrs[:variant_id]}, #{attrs[:product_id]}, #{attrs[:inventory_id]}, #{attrs[:something_id]}, #{attrs[:another_id]}, #{attrs[:fulfilled]}, #{db_time(attrs[:fulfilled_at])}, #{db_time(attrs[:deleted_at])}, #{db_time(Time.now)}, #{db_time(Time.now)})&quot;\n    end\n\n    conn.execute(\n      &quot;INSERT INTO commerces (name, email, title, tags, variant_id, product_id, inventory_id, something_id, another_id, fulfilled, fulfilled_at, deleted_at, created_at, updated_at) &quot;\\\n      &quot;VALUES #{values.join(',')}&quot;\n    )\n  end\n\n  x.report(&quot;with Arel&quot;) do\n    conn = Commerce.connection\n    columns = %w[name email title tags variant_id product_id inventory_id something_id another_id fulfilled fulfilled_at deleted_at created_at updated_at]\n    attrs = ATTRS.dup\n    attrs[:fulfilled_at] = (attrs[:fulfilled_at]).to_formatted_s(:db)\n    attrs[:deleted_at] = (attrs[:deleted_at]).to_formatted_s(:db)\n    attrs[:created_at] = (Time.now).to_formatted_s(:db)\n    attrs[:updated_at] = (Time.now).to_formatted_s(:db)\n\n    values_list = [attrs.values] * ROWS_COUNT\n\n    sql = &quot;INSERT INTO #{Commerce.quoted_table_name} (#{columns.join(',')}) &quot;\n    sql &lt;&lt; conn.visitor.compile(Arel::Nodes::ValuesList.new(values_list))\n    conn.execute(sql)\n  end\n\n  x.compare!\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">'debug'</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_record\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"benchmark/ips\"</span>\n\n<span class=\"pl-c1\">GC</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">disable</span>\n\n<span class=\"pl-c1\">ROWS_COUNT</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">1000</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">establish_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">{</span> <span class=\"pl-pds\">adapter</span>: <span class=\"pl-s\">\"sqlite3\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">database</span>: <span class=\"pl-s\">\":memory:\"</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Commerce</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:commerces</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:email</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:title</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:tags</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">integer</span> <span class=\"pl-pds\">:variant_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:product_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:inventory_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:something_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:another_id</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">boolean</span> <span class=\"pl-pds\">:fulfilled</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">datetime</span> <span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:deleted_at</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">timestamps</span> <span class=\"pl-pds\">null</span>: <span class=\"pl-c1\">true</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">db_time</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-s1\">value</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">inspect</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-c1\">ATTRS</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-pds\">name</span>: <span class=\"pl-s\">\"sam\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">email</span>: <span class=\"pl-s\">\"kirs@shopify.com\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">title</span>: <span class=\"pl-s\">\"title\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">tags</span>: <span class=\"pl-s\">\"tag1,tag2,tag3\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">variant_id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">product_id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">inventory_id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">something_id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">another_id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">fulfilled</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">fulfilled_at</span>: <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">deleted_at</span>: <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">warmup</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">2</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">time</span>   <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">4</span>\n\n  <span class=\"pl-s1\">relation</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Commerce</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">all</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"insert_all\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">conn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Commerce</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span>\n\n    <span class=\"pl-s1\">relation</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">insert_all</span><span class=\"pl-kos\">(</span>\n      <span class=\"pl-kos\">[</span><span class=\"pl-c1\">ATTRS</span><span class=\"pl-kos\">]</span> * <span class=\"pl-c1\">ROWS_COUNT</span>\n    <span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"insert_all with columns\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">conn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Commerce</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span>\n    <span class=\"pl-s1\">attrs</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">ATTRS</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:deleted_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:deleted_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:created_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:updated_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:created_at</span><span class=\"pl-kos\">]</span>\n\n    <span class=\"pl-s1\">values</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span>\n      <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:name</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:email</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:title</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:tags</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:variant_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:product_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:inventory_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:something_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:another_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:deleted_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:created_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:updated_at</span><span class=\"pl-kos\">]</span>\n    <span class=\"pl-kos\">]</span>\n\n    <span class=\"pl-s1\">relation</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">insert_all</span><span class=\"pl-kos\">(</span>\n      <span class=\"pl-kos\">[</span><span class=\"pl-s1\">values</span><span class=\"pl-kos\">]</span> * <span class=\"pl-c1\">ROWS_COUNT</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-pds\">columns</span>: <span class=\"pl-kos\">%w[</span><span class=\"pl-s\">name</span> <span class=\"pl-s\">email</span> <span class=\"pl-s\">title</span> <span class=\"pl-s\">tags</span> <span class=\"pl-s\">variant_id</span> <span class=\"pl-s\">product_id</span> <span class=\"pl-s\">inventory_id</span> <span class=\"pl-s\">something_id</span> <span class=\"pl-s\">another_id</span> <span class=\"pl-s\">fulfilled</span> <span class=\"pl-s\">fulfilled_at</span> <span class=\"pl-s\">deleted_at</span> <span class=\"pl-s\">created_at</span> <span class=\"pl-s\">updated_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span>\n    <span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"raw sql\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">conn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Commerce</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span>\n    <span class=\"pl-s1\">values</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1</span>..<span class=\"pl-c1\">ROWS_COUNT</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">map</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-s1\">attrs</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">ATTRS</span>\n      <span class=\"pl-s\">\"(<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">quote</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:name</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">quote</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:email</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">quote</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:title</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">quote</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:tags</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:variant_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:product_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:inventory_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:something_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:another_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-en\">db_time</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-en\">db_time</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:deleted_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-en\">db_time</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-en\">db_time</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>)\"</span>\n    <span class=\"pl-k\">end</span>\n\n    <span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">execute</span><span class=\"pl-kos\">(</span>\n      <span class=\"pl-s\">\"INSERT INTO commerces (name, email, title, tags, variant_id, product_id, inventory_id, something_id, another_id, fulfilled, fulfilled_at, deleted_at, created_at, updated_at) \"</span>\\\n      <span class=\"pl-s\">\"VALUES <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">values</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">','</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>\"</span>\n    <span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"with Arel\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">conn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Commerce</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span>\n    <span class=\"pl-s1\">columns</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">%w[</span><span class=\"pl-s\">name</span> <span class=\"pl-s\">email</span> <span class=\"pl-s\">title</span> <span class=\"pl-s\">tags</span> <span class=\"pl-s\">variant_id</span> <span class=\"pl-s\">product_id</span> <span class=\"pl-s\">inventory_id</span> <span class=\"pl-s\">something_id</span> <span class=\"pl-s\">another_id</span> <span class=\"pl-s\">fulfilled</span> <span class=\"pl-s\">fulfilled_at</span> <span class=\"pl-s\">deleted_at</span> <span class=\"pl-s\">created_at</span> <span class=\"pl-s\">updated_at</span><span class=\"pl-kos\">]</span>\n    <span class=\"pl-s1\">attrs</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">ATTRS</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:deleted_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:deleted_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:created_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:updated_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-s1\">values_list</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">values</span><span class=\"pl-kos\">]</span> * <span class=\"pl-c1\">ROWS_COUNT</span>\n\n    <span class=\"pl-s1\">sql</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"INSERT INTO <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-v\">Commerce</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">quoted_table_name</span><span class=\"pl-kos\">}</span></span> (<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">columns</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">','</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>) \"</span>\n    <span class=\"pl-s1\">sql</span> &lt;&lt; <span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">visitor</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">compile</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Arel</span>::<span class=\"pl-v\">Nodes</span>::<span class=\"pl-v\">ValuesList</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">values_list</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">execute</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">sql</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">compare!</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\"></p>\n</details> ",
            "url": "https://github.com/rails/rails/pull/52395",
            "title": "Introduce ActiveRecord::Persistance#insert_rows",
            "date_modified": "2024-07-24T23:52:57.000Z",
            "date_published": "2024-07-22T23:36:45.000Z",
            "author": {
                "name": "kirs",
                "url": "https://github.com/kirs"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/509837?u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">When trying to implement it, I found <a href=\"https://edgeguides.rubyonrails.org/active_storage_overview.html#authenticated-controllers\" rel=\"nofollow\">this guide</a> hard to understand.</p>\n<p dir=\"auto\">This PR expands the example and gives a more options for how to move beyond the default security options in AS.</p>",
            "url": "https://github.com/rails/rails/pull/52388",
            "title": "Improve the Active Storage \"Authenticated Controllers\" guide",
            "date_modified": "2024-07-22T04:48:27.000Z",
            "date_published": "2024-07-22T04:37:43.000Z",
            "author": {
                "name": "ghiculescu",
                "url": "https://github.com/ghiculescu"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/7331511?u=e5c461c2ed59b967e0925a515ab00b9a756715e3&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because the tests under the commands directory are including the Command namespace<br>\nbut this specific test is not and can create confusion for the developers.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the test to include the Command namespace.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52387",
            "title": "Add command namespace to runner test",
            "date_modified": "2024-07-22T04:39:34.000Z",
            "date_published": "2024-07-22T04:36:03.000Z",
            "author": {
                "name": "JuanVqz",
                "url": "https://github.com/JuanVqz"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/191128?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">When resolving the adapter. for a url that is missing the schema (for example <code class=\"notranslate\">//root@localhost:3306/database_name</code>) the adapter resolution currently errors with <code class=\"notranslate\">NoMethodError: undefined method </code>to_sym' for nil<code class=\"notranslate\">when calling</code>ActiveRecord.protocol_adapters[]`.</p>\n<p dir=\"auto\">I am currently using such urls to allow for the adapter to be set by the application in the database.yml instead of the ENV vars which are managed externally to the application.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request prevents this error from being raised when resolving the adapter.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included. (This error is only occurring in beta releases, so I don't think a change log is required).</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52386",
            "title": "handle database urls that are missing schemas",
            "date_modified": "2024-07-25T04:18:26.000Z",
            "date_published": "2024-07-22T02:06:59.000Z",
            "author": {
                "name": "lsylvester",
                "url": "https://github.com/lsylvester"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">When tried to write tests in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2421635675\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52384\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/52384/hovercard\" href=\"https://github.com/rails/rails/pull/52384\">#52384</a>, I noticed that records within individual batches are not sorted, which is a bug imo.</p>",
            "url": "https://github.com/rails/rails/pull/52385",
            "title": "Preserve order within individual batches for batch iteration",
            "date_modified": "2024-07-21T23:43:15.000Z",
            "date_published": "2024-07-21T23:43:11.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Example usage:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Product.in_batches(column: [:shop_id, :id]) do |relation|\n  # do something with relation\nend\"><pre class=\"notranslate\"><span class=\"pl-v\">Product</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">in_batches</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">column</span>: <span class=\"pl-kos\">[</span><span class=\"pl-pds\">:shop_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">relation</span>|\n  <span class=\"pl-c\"># do something with relation</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Currently, we can batch only using primary key columns, which is very limiting. We may want to include some kind of parent (or tenant) column for better use of clustered indexes (or just process all the records from one parent before starting over the other), or iterate using some \"position\" column within parent etc.</p>\n<p dir=\"auto\">I already implemented custom batch iterators a few times in my own gems, because of the lack of ability to iterate using custom columns. For example, <a href=\"https://github.com/fatkodima/online_migrations/blob/master/lib/online_migrations/batch_iterator.rb\">one</a>, <a href=\"https://github.com/fatkodima/sidekiq-iteration/blob/master/lib/sidekiq_iteration/active_record_enumerator.rb\">two</a>, <a href=\"https://github.com/fatkodima/pluck_in_batches/blob/master/lib/pluck_in_batches/iterator.rb\">three</a>, <a href=\"https://github.com/healthie/activerecord_cursor_paginate/blob/master/lib/activerecord_cursor_paginate/paginator.rb\">four</a>. I also currently have a need in the current project to be able to batch over custom columns.</p>\n<p dir=\"auto\">Fortunately, supporting this is very easy, given that we already have support for ordering by multiple columns (via <code class=\"notranslate\">:order</code>) and support for composite primary keys (aka multiple columns).</p>\n<p dir=\"auto\">It is easy for people by mistake to use some non unique columns and get incorrect results (duplicates or missed rows), so this implementation enforces to have some combination of unique columns in the list of provided columns (like a primary key or some columns included in the unique index).</p>",
            "url": "https://github.com/rails/rails/pull/52384",
            "title": "Support batching using custom columns",
            "date_modified": "2024-07-25T13:09:42.000Z",
            "date_published": "2024-07-21T22:57:43.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/13472945?u=ef29693db9743ffa3d8a02d9faa0bdec7fb0892d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2407396802\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52328\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/52328/hovercard\" href=\"https://github.com/rails/rails/pull/52328\">#52328</a> adds sessions (existing user can <strong>sign in</strong>).</p>\n<p dir=\"auto\">This PR adds registrations (new user can <strong>sign up</strong>).</p>\n<p dir=\"auto\">We already have database uniqueness validation for <code class=\"notranslate\">email_address</code>, now we add validations in the <code class=\"notranslate\">User</code> model to display errors during registration.</p>\n<hr>\n<p dir=\"auto\">I think the next step to make this new authentication solution viable for a real app would be adding \"forgot/reset password\" feature.</p>",
            "url": "https://github.com/rails/rails/pull/52383",
            "title": "Sessions generator: add basic registrations",
            "date_modified": "2024-07-23T16:30:42.000Z",
            "date_published": "2024-07-21T21:17:39.000Z",
            "author": {
                "name": "yshmarov",
                "url": "https://github.com/yshmarov"
            }
        }
    ]
}