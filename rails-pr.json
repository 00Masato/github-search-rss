{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1518299?u=d3dda61ebb16317ded64f166b59e35e1e160b9b1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #51269.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2172603548\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51269\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51269/hovercard\" href=\"https://github.com/rails/rails/issues/51269\">#51269</a></p>\n<p dir=\"auto\">Action Text supports saving a RichText model with empty content. Passing <em>almost</em> empty content (such as a space) flushes the embeds, but passing truly empty content does not. This defies expectations.</p>\n<p dir=\"auto\">This change ensures that the embeds are flushed when empty content is passed, but not when <code class=\"notranslate\">nil</code> is passed (for example, when omitted from a form).</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51291",
            "title": "Empty embeds when RichText is set to an empty content",
            "date_modified": "2024-03-11T03:52:14.000Z",
            "date_published": "2024-03-10T22:05:51.000Z",
            "author": {
                "name": "JoeDupuis",
                "url": "https://github.com/JoeDupuis"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5122678?u=204301f9f9fe8930fd26fe3bfe65b6ffaffd8b59&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">It's common to build new apps with <code class=\"notranslate\">--skip-test</code>. When this is done, CI will raise the following error:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Unrecognized command &quot;test&quot; (Rails::Command::UnrecognizedCommandError)\"><pre class=\"notranslate\"><span class=\"pl-en\">Unrecognized</span> <span class=\"pl-en\">command</span> <span class=\"pl-s\">\"test\"</span> <span class=\"pl-kos\">(</span><span class=\"pl-v\">Rails</span>::<span class=\"pl-v\">Command</span>::<span class=\"pl-v\">UnrecognizedCommandError</span><span class=\"pl-kos\">)</span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Skips the <code class=\"notranslate\">test</code> job when a new application is generated with the <code class=\"notranslate\">--skip-test</code> option.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Uses <a href=\"https://github.com/rails/rails/blob/029d31ca31ab72df7bb79372f4ff057231fd0196/railties/lib/rails/generators/rails/plugin/plugin_generator.rb#L270\">prior art</a> to determine if <code class=\"notranslate\">options[:skip_test]</code> was set.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51289",
            "title": "Conditionally skip test job in ci.yml",
            "date_modified": "2024-03-10T23:28:31.000Z",
            "date_published": "2024-03-10T11:04:05.000Z",
            "author": {
                "name": "stevepolitodesign",
                "url": "https://github.com/stevepolitodesign"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1518299?u=d3dda61ebb16317ded64f166b59e35e1e160b9b1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #51284.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2175983514\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51284\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51284/hovercard\" href=\"https://github.com/rails/rails/issues/51284\">#51284</a></p>\n<p dir=\"auto\">Both Proxy controllers in Active Storage set the caching headers early before streaming.</p>\n<p dir=\"auto\">In some instances (see <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2175983514\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51284\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51284/hovercard\" href=\"https://github.com/rails/rails/issues/51284\">#51284</a>), it is possible for the file download (from the service to server) to fail before we send the first byte to the client (response not yet committed).</p>\n<p dir=\"auto\">In those instances, this change would invalidate the cache and return a better response status before closing the stream.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51288",
            "title": "Expire caching when a download fail while proxying in ActiveStorage",
            "date_modified": "2024-03-10T06:55:14.000Z",
            "date_published": "2024-03-10T03:28:10.000Z",
            "author": {
                "name": "JoeDupuis",
                "url": "https://github.com/JoeDupuis"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/122306143?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Currently if the Gemfile does not contain a commented out line for image_processing, or the line uses single, not double quotes, image_processing will not be installed and Trix will not be able to correctly handle image attachments.</p>\n<p dir=\"auto\">This ensures image_processing <em>is</em> installed in those circumstances.</p>\n\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because it is possible for the <code class=\"notranslate\">bin/rails action_text:install</code> command to fail to add <code class=\"notranslate\">image_processing</code> to the Gemfile if the default comment has been removed, or if the double quotes have been changed to single ones (perhaps by a Rubocop auto-fix).</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the ActionText install script to more thoroughly ensure <code class=\"notranslate\">image_processing</code> is installed.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51285",
            "title": "Ensure image_processing is installed with Trix",
            "date_modified": "2024-03-08T13:29:29.000Z",
            "date_published": "2024-03-08T12:59:20.000Z",
            "author": {
                "name": "tsvallender",
                "url": "https://github.com/tsvallender"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">After looking at ways to refactor calls to <code class=\"notranslate\">lease_connection</code>, this tiny PR came up to reduce internal calls in <code class=\"notranslate\">quote_bound_value</code>.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a></p>",
            "url": "https://github.com/rails/rails/pull/51283",
            "title": "Reduce callsites to lease_connection in AR::Sanitization",
            "date_modified": "2024-03-08T12:49:51.000Z",
            "date_published": "2024-03-08T07:24:29.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<h2 dir=\"auto\">The problem</h2>\n<p dir=\"auto\">Loading JSON into an Active Model instance with<br>\n<code class=\"notranslate\">ActiveModel::Serializers:JSON#from_json</code> assumes that the property casings will match the class attribute casings. This works well with snake_casing, since idiomatic Ruby methods are snake_cased.</p>\n<p dir=\"auto\">When <code class=\"notranslate\">#from_json</code> loads JSON properties that are camelCased, it silently ignores them:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Person\n  include ActiveModel::Serializers::JSON\n\n  attr_accessor :name, :born_on\n\n  def attributes=(hash)\n    hash.each { |key, value| send(&quot;#{key}=&quot;, value) }\n  end\nend\n\npayload &lt;&lt;~JSON\n  { &quot;name&quot;: &quot;Alice&quot;, &quot;bornOn&quot;: &quot;2024-03-08&quot; }\nJSON\n\nperson = Person.new.from_json(payload)\nperson.name     # =&gt; &quot;Alice&quot;\nperson.born_on  # =&gt; nil\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Person</span>\n  <span class=\"pl-en\">include</span> <span class=\"pl-v\">ActiveModel</span>::<span class=\"pl-v\">Serializers</span>::<span class=\"pl-c1\">JSON</span>\n\n  <span class=\"pl-en\">attr_accessor</span> <span class=\"pl-pds\">:name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:born_on</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">attributes</span><span class=\"pl-c1\">=</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">hash</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">hash</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">value</span>| <span class=\"pl-en\">send</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">key</span><span class=\"pl-kos\">}</span></span>=\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">payload</span> <span class=\"pl-s\">&lt;&lt;~JSON</span><span class=\"pl-s\"></span>\n<span class=\"pl-s\">  { \"name\": \"Alice\", \"bornOn\": \"2024-03-08\" }</span>\n<span class=\"pl-s\">JSON</span>\n\n<span class=\"pl-s1\">person</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">from_json</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">payload</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span>     <span class=\"pl-c\"># =&gt; \"Alice\"</span>\n<span class=\"pl-s1\">person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">born_on</span>  <span class=\"pl-c\"># =&gt; nil</span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<h2 dir=\"auto\">The proposal</h2>\n<p dir=\"auto\">This commit proposes extending <code class=\"notranslate\">#from_json</code> to accept a block. After the JSON string is decoded (and un-nested from its root, depending on the model's configuration), yield the <code class=\"notranslate\">Hash</code> to a block if one is passed as an argument:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"payload &lt;&lt;~JSON\n  { &quot;name&quot;: &quot;Alice&quot;, &quot;bornOn&quot;: &quot;2024-03-08&quot; }\nJSON\n\nperson = Person.new.from_json(payload) { _1.deep_transform_keys!(&amp;:underscore) }\nperson.name     # =&gt; &quot;Alice&quot;\nperson.born_on  # =&gt; &quot;2024-03-08&quot;\"><pre class=\"notranslate\"><span class=\"pl-en\">payload</span> <span class=\"pl-s\">&lt;&lt;~JSON</span><span class=\"pl-s\"></span>\n<span class=\"pl-s\">  { \"name\": \"Alice\", \"bornOn\": \"2024-03-08\" }</span>\n<span class=\"pl-s\">JSON</span>\n\n<span class=\"pl-s1\">person</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">from_json</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">payload</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">_1</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">deep_transform_keys!</span><span class=\"pl-kos\">(</span>&amp;<span class=\"pl-pds\">:underscore</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-s1\">person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span>     <span class=\"pl-c\"># =&gt; \"Alice\"</span>\n<span class=\"pl-s1\">person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">born_on</span>  <span class=\"pl-c\"># =&gt; \"2024-03-08\"</span></pre></div>\n<p dir=\"auto\">Supporting a block can be useful for context-specific overrides. If a class needs to provide a default transformation, it can override <code class=\"notranslate\">#from_json</code>:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class PersonFromCamelCaseAPI &lt; Person\n  def from_json(*, &amp;block)\n    default_transform = proc { _1.deep_transform_keys!(&amp;:underscore) }\n\n    super(*, &amp;(block || defaul_transform))\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">PersonFromCamelCaseAPI</span> &lt; <span class=\"pl-v\">Person</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">from_json</span><span class=\"pl-kos\">(</span>*<span class=\"pl-kos\">,</span> &amp;<span class=\"pl-s1\">block</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">default_transform</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">proc</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">_1</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">deep_transform_keys!</span><span class=\"pl-kos\">(</span>&amp;<span class=\"pl-pds\">:underscore</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n\n    <span class=\"pl-smi\">super</span><span class=\"pl-kos\">(</span>*<span class=\"pl-en\"></span><span class=\"pl-kos\">,</span> &amp;<span class=\"pl-kos\">(</span><span class=\"pl-s1\">block</span> || <span class=\"pl-en\">defaul_transform</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Without built-in support for transforming camelCased properties into snake_cased attributes, callers are responsible decoding the JSON themselves. In addition to the key transformations, they're also responsible for re-creating both the JSON decoding <em>and</em> the configurable root un-nesting provided by <code class=\"notranslate\">#from_json</code>:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"payload &lt;&lt;~JSON\n  { &quot;name&quot;: &quot;Alice&quot;, &quot;bornOn&quot;: &quot;2024-03-08&quot; }\nJSON\n\nattributes = ActiveSupport::JSON.decode(payload)\nattributes.deep_transform_keys!(&amp;:underscore)\nperson = Person.new(attributes)\nperson.name     # =&gt; &quot;Alice&quot;\nperson.born_on  # =&gt; &quot;2024-03-08&quot;\n\nnested_payload &lt;&lt;~JSON\n  { &quot;person&quot;: { &quot;name&quot;: &quot;Alice&quot;, &quot;bornOn&quot;: &quot;2024-03-08&quot; } }\nJSON\n\nattributes = ActiveSupport::JSON.decode(nested_payload)\nattributes.deep_transform_keys!(&amp;:underscore)\nperson = Person.new(attributes[&quot;person&quot;])\nperson.name     # =&gt; &quot;Alice&quot;\nperson.born_on  # =&gt; &quot;2024-03-08&quot;\"><pre class=\"notranslate\"><span class=\"pl-en\">payload</span> <span class=\"pl-s\">&lt;&lt;~JSON</span><span class=\"pl-s\"></span>\n<span class=\"pl-s\">  { \"name\": \"Alice\", \"bornOn\": \"2024-03-08\" }</span>\n<span class=\"pl-s\">JSON</span>\n\n<span class=\"pl-s1\">attributes</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-c1\">JSON</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">decode</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">payload</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">attributes</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">deep_transform_keys!</span><span class=\"pl-kos\">(</span>&amp;<span class=\"pl-pds\">:underscore</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">person</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attributes</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span>     <span class=\"pl-c\"># =&gt; \"Alice\"</span>\n<span class=\"pl-s1\">person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">born_on</span>  <span class=\"pl-c\"># =&gt; \"2024-03-08\"</span>\n\n<span class=\"pl-en\">nested_payload</span> <span class=\"pl-s\">&lt;&lt;~JSON</span><span class=\"pl-s\"></span>\n<span class=\"pl-s\">  { \"person\": { \"name\": \"Alice\", \"bornOn\": \"2024-03-08\" } }</span>\n<span class=\"pl-s\">JSON</span>\n\n<span class=\"pl-s1\">attributes</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-c1\">JSON</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">decode</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">nested_payload</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">attributes</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">deep_transform_keys!</span><span class=\"pl-kos\">(</span>&amp;<span class=\"pl-pds\">:underscore</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">person</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attributes</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"person\"</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span>     <span class=\"pl-c\"># =&gt; \"Alice\"</span>\n<span class=\"pl-s1\">person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">born_on</span>  <span class=\"pl-c\"># =&gt; \"2024-03-08\"</span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51282",
            "title": "Transform attributes during `ActiveModel::Serialization::JSON#from_json`",
            "date_modified": "2024-03-08T06:20:19.000Z",
            "date_published": "2024-03-08T06:18:38.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/26132902?u=016ee37305f6fa13412eaca5649f8ed41d4e1ee7&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The rails generate scaffold command triggers the resource_route hook twice, although routes are not created twice because Thor only invokes the same task once.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"% bin/rails generate scaffold Post name:string\n      invoke  active_record\n      create    db/migrate/20240303140443_create_posts.rb\n      create    app/models/post.rb\n      invoke    test_unit\n      create      test/models/post_test.rb\n      create      test/fixtures/posts.yml\n      invoke  resource_route\n       route    resources :posts\n      invoke  scaffold_controller\n      create    app/controllers/posts_controller.rb\n      invoke    erb\n      create      app/views/posts\n      create      app/views/posts/index.html.erb\n      create      app/views/posts/edit.html.erb\n      create      app/views/posts/show.html.erb\n      create      app/views/posts/new.html.erb\n      create      app/views/posts/_form.html.erb\n      create      app/views/posts/_post.html.erb\n      invoke    resource_route\n      invoke    test_unit\n      create      test/controllers/posts_controller_test.rb\n      create      test/system/posts_test.rb\n      invoke    helper\n      create      app/helpers/posts_helper.rb\n      invoke      test_unit\n      invoke    jbuilder\n      create      app/views/posts/index.json.jbuilder\n      create      app/views/posts/show.json.jbuilder\n      create      app/views/posts/_post.json.jbuilder\"><pre class=\"notranslate\"><code class=\"notranslate\">% bin/rails generate scaffold Post name:string\n      invoke  active_record\n      create    db/migrate/20240303140443_create_posts.rb\n      create    app/models/post.rb\n      invoke    test_unit\n      create      test/models/post_test.rb\n      create      test/fixtures/posts.yml\n      invoke  resource_route\n       route    resources :posts\n      invoke  scaffold_controller\n      create    app/controllers/posts_controller.rb\n      invoke    erb\n      create      app/views/posts\n      create      app/views/posts/index.html.erb\n      create      app/views/posts/edit.html.erb\n      create      app/views/posts/show.html.erb\n      create      app/views/posts/new.html.erb\n      create      app/views/posts/_form.html.erb\n      create      app/views/posts/_post.html.erb\n      invoke    resource_route\n      invoke    test_unit\n      create      test/controllers/posts_controller_test.rb\n      create      test/system/posts_test.rb\n      invoke    helper\n      create      app/helpers/posts_helper.rb\n      invoke      test_unit\n      invoke    jbuilder\n      create      app/views/posts/index.json.jbuilder\n      create      app/views/posts/show.json.jbuilder\n      create      app/views/posts/_post.json.jbuilder\n</code></pre></div>\n<p dir=\"auto\">Despite setting the --skip-routes option, which is a feature of the ScaffoldControllerGenerator designed to prevent route generation, the command still produces routes.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"% bin/rails g scaffold Post name:string --skip-routes\n      invoke  active_record\n      create    db/migrate/20240306035406_create_posts.rb\n      create    app/models/post.rb\n      invoke    test_unit\n      create      test/models/post_test.rb\n      create      test/fixtures/posts.yml\n      invoke  resource_route\n       route    resources :posts\n      invoke  scaffold_controller\n      create    app/controllers/posts_controller.rb\n      invoke    erb\n      create      app/views/posts\n      create      app/views/posts/index.html.erb\n      create      app/views/posts/edit.html.erb\n      create      app/views/posts/show.html.erb\n      create      app/views/posts/new.html.erb\n      create      app/views/posts/_form.html.erb\n      create      app/views/posts/_post.html.erb\n      invoke    resource_route\n      invoke    test_unit\n      create      test/controllers/posts_controller_test.rb\n      create      test/system/posts_test.rb\n      invoke    helper\n      create      app/helpers/posts_helper.rb\n      invoke      test_unit\n      invoke    jbuilder\n      create      app/views/posts/index.json.jbuilder\n      create      app/views/posts/show.json.jbuilder\n      create      app/views/posts/_post.json.jbuilder\"><pre class=\"notranslate\"><code class=\"notranslate\">% bin/rails g scaffold Post name:string --skip-routes\n      invoke  active_record\n      create    db/migrate/20240306035406_create_posts.rb\n      create    app/models/post.rb\n      invoke    test_unit\n      create      test/models/post_test.rb\n      create      test/fixtures/posts.yml\n      invoke  resource_route\n       route    resources :posts\n      invoke  scaffold_controller\n      create    app/controllers/posts_controller.rb\n      invoke    erb\n      create      app/views/posts\n      create      app/views/posts/index.html.erb\n      create      app/views/posts/edit.html.erb\n      create      app/views/posts/show.html.erb\n      create      app/views/posts/new.html.erb\n      create      app/views/posts/_form.html.erb\n      create      app/views/posts/_post.html.erb\n      invoke    resource_route\n      invoke    test_unit\n      create      test/controllers/posts_controller_test.rb\n      create      test/system/posts_test.rb\n      invoke    helper\n      create      app/helpers/posts_helper.rb\n      invoke      test_unit\n      invoke    jbuilder\n      create      app/views/posts/index.json.jbuilder\n      create      app/views/posts/show.json.jbuilder\n      create      app/views/posts/_post.json.jbuilder\n</code></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Following three parts of the code are related to multiple invocation of resource_route.</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">hook_for :resource_route</code> within the ResourceGenerator, from which the ScaffoldGenerator inherits</li>\n<li><code class=\"notranslate\">class_option :resource_route</code> in ScaffoldGenerator</li>\n<li><code class=\"notranslate\">hook_for :resource_route</code> in ScaffoldControllerGenerator which is invoked by <code class=\"notranslate\">hook_for :scaffold_controller</code> in ScaffoldGenerator</li>\n</ul>\n<p dir=\"auto\">The resource_route hook within ScaffoldGenerator has been removed with remove_hook_for to ensure that the hook is called exclusively within the scaffold_controller hook.<br>\nThe <code class=\"notranslate\">class_option :resource_route, type: :boolean</code> has also been removed. Despite the removal of the resource_route hook in ScaffoldGenerator, invoking <code class=\"notranslate\">class_option :resource_route</code> was still indirectly triggering resource_route.<br>\nThis occurred due to a combination of the following reasons:</p>\n<ul dir=\"auto\">\n<li>generator classes, which inherit from Thor::Group, execute all defined public instance methods upon command execution.</li>\n<li>the hook_for method utilizes invoke_from_option, a method defined in Thor::Group to dynamically defines an invoke_from_option_* method at runtime, which persists even if remove_hook_for is called.\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/rails/thor/blob/a43d92fad7ebd77d359b7b96eb3db8a73ef9057c/lib/thor/group.rb#L124\">https://github.com/rails/thor/blob/a43d92fad7ebd77d359b7b96eb3db8a73ef9057c/lib/thor/group.rb#L124</a></li>\n</ul>\n</li>\n<li>the invoke_from_option_* method returns early when the option isn't available but <code class=\"notranslate\">class_option :resource_route</code> in ScaffoldGeneratore makes the option available and Rails sets the resource_route option as default.\n<ul dir=\"auto\">\n<li><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/f7353283fd771e99b9675bcb9394e398964195f8/railties/lib/rails/generators.rb#L56\">rails/railties/lib/rails/generators.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 56\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/f7353283fd771e99b9675bcb9394e398964195f8\">f735328</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L56\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"56\"></td>\n          <td id=\"LC56\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-pds\">resource_route</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</li>\n</ul>\n</li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51275",
            "title": "Fix redundant resource_route Invocations in scaffold generator",
            "date_modified": "2024-03-07T11:13:44.000Z",
            "date_published": "2024-03-07T11:11:06.000Z",
            "author": {
                "name": "takmar",
                "url": "https://github.com/takmar"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/986290?u=4d733016cf0aff060b84f4084595e5ace35d3b42&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Following up on <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2171811692\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51266\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/51266/hovercard\" href=\"https://github.com/rails/rails/pull/51266\">#51266</a>. Trying to make sure the suggested <code class=\"notranslate\">puma-dev</code> setup introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2134700430\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51088\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/51088/hovercard\" href=\"https://github.com/rails/rails/pull/51088\">#51088</a> works out of the box.</p>\n<p dir=\"auto\">Creating a fresh app with <code class=\"notranslate\">rails new --main AppName</code> (or any multi-word app name) will still give us the error message:</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/986290/310785511-7dd53909-8566-45ac-960c-84b58f3526a9.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTAxODQwMzcsIm5iZiI6MTcxMDE4MzczNywicGF0aCI6Ii85ODYyOTAvMzEwNzg1NTExLTdkZDUzOTA5LTg1NjYtNDVhYy05NjBjLTg0YjU4ZjM1MjZhOS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwMzExJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDMxMVQxOTAyMTdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0wZTFiY2ZiOWRkZGNlNTJlNTc3ZTYyMzc1MDdkMGFjNTYxYmRhYTBjNTk4OGE2MmMxZDk0YTU4NzU3MWFkNWYyJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.IN2_qlwGKia_ZC_xDdeOCHtZ_w3-4Al8IPAZEzpaCKY\"><img src=\"https://private-user-images.githubusercontent.com/986290/310785511-7dd53909-8566-45ac-960c-84b58f3526a9.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTAxODQwMzcsIm5iZiI6MTcxMDE4MzczNywicGF0aCI6Ii85ODYyOTAvMzEwNzg1NTExLTdkZDUzOTA5LTg1NjYtNDVhYy05NjBjLTg0YjU4ZjM1MjZhOS5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwMzExJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDMxMVQxOTAyMTdaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0wZTFiY2ZiOWRkZGNlNTJlNTc3ZTYyMzc1MDdkMGFjNTYxYmRhYTBjNTk4OGE2MmMxZDk0YTU4NzU3MWFkNWYyJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.IN2_qlwGKia_ZC_xDdeOCHtZ_w3-4Al8IPAZEzpaCKY\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">This PR simply kebabcases the <code class=\"notranslate\">puma-dev</code> symlink suggested in <code class=\"notranslate\">bin/setup</code>, making it work without additional configuration.</p>",
            "url": "https://github.com/rails/rails/pull/51273",
            "title": "Kebabcase puma-dev configuration suggestion in bin/seutp",
            "date_modified": "2024-03-07T07:40:11.000Z",
            "date_published": "2024-03-07T07:40:07.000Z",
            "author": {
                "name": "zachasme",
                "url": "https://github.com/zachasme"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2793160?u=93c796d8b2648d3614c150e3fe28e8697af56411&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because I sometimes want to override the global <code class=\"notranslate\">Encoding.escape_html_entities_in_json</code> option for specific call sites.</p>\n<p dir=\"auto\">Where I work, we tend to embed JSON in HTML, so the default html entity escaping is appreciated. But there are some cases where we'd like to turn it off.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes ActiveSupport's JSON encoding code to accept an optional flag for whether or not to escape HTML entities (<code class=\"notranslate\">escape_html_entities</code>). If not supplied, the existing global configuration flag will be used instead.</p>\n<p dir=\"auto\">The idea is to make the following possible:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class MyController &lt; ApplicationController\n  def index\n    render json: { some: '&lt;data&gt;' }, escape_html_entities: false\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">MyController</span> &lt; <span class=\"pl-v\">ApplicationController</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">index</span>\n    <span class=\"pl-en\">render</span> <span class=\"pl-pds\">json</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">some</span>: <span class=\"pl-s\">'&lt;data&gt;'</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">escape_html_entities</span>: <span class=\"pl-c1\">false</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">Sorry to show up with a code change out of the blue. I did a weird monkey patch like this in our codebase at work to solve a problem, and it seemed easy to upstream so I'm submitting this PR just in case. No hard feelings if it doesn't seem reasonable.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul dir=\"auto\">\n<li>[ x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li>[ x] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li>[ x] Tests are added or updated if you fix a bug or add a feature.</li>\n<li>[x ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51272",
            "title": "Add escape_html_entities option to JSON encoder",
            "date_modified": "2024-03-07T03:49:40.000Z",
            "date_published": "2024-03-07T03:49:36.000Z",
            "author": {
                "name": "Resonious",
                "url": "https://github.com/Resonious"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/22004610?u=8b285b31d33b20555541d5dda4c5ed77477eea3b&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Using ActiveSupport::LogSubscriber#color inside a custom log subscriber causes NoMethodError.</p>\n<h3 dir=\"auto\">Detail</h3>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire &quot;bundler/inline&quot;\n\ngemfile(true) do\n  source &quot;https://rubygems.org&quot;\n\n  gem &quot;activesupport&quot;\nend\n\nrequire &quot;active_support&quot;\n\nclass TestLogSubscriber &lt; ActiveSupport::LogSubscriber\n  attach_to :test\n\n  def hi(event)\n    info(color(event.payload[:message], GREEN))\n  end\n\n  private\n    def log_exception(name, e)\n      super\n      raise e\n    end\nend\n\nActiveSupport::LogSubscriber.logger = ActiveSupport::Logger.new(STDOUT)\nActiveSupport::Notifications.instrument(&quot;hi.test&quot;, message: &quot;Hello!&quot;)\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/inline\"</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">\"https://rubygems.org\"</span>\n\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"activesupport\"</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support\"</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">TestLogSubscriber</span> &lt; <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">LogSubscriber</span>\n  <span class=\"pl-en\">attach_to</span> <span class=\"pl-pds\">:test</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">hi</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">event</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-en\">info</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">color</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">event</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">payload</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:message</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">GREEN</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">private</span>\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">log_exception</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">name</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">e</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-smi\">super</span>\n      <span class=\"pl-en\">raise</span> <span class=\"pl-s1\">e</span>\n    <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">LogSubscriber</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">Notifications</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">instrument</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"hi.test\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">message</span>: <span class=\"pl-s\">\"Hello!\"</span><span class=\"pl-kos\">)</span></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/rails/activesupport/lib/active_support/log_subscriber.rb:193:in `mode_from': undefined method `compact_blank' for an instance of Hash (NoMethodError)\n    \n      modes = MODES.values_at(*options.compact_blank.keys)\n                                      ^^^^^^^^^^^^^^\"><pre class=\"notranslate\"><code class=\"notranslate\">/rails/activesupport/lib/active_support/log_subscriber.rb:193:in `mode_from': undefined method `compact_blank' for an instance of Hash (NoMethodError)\n    \n      modes = MODES.values_at(*options.compact_blank.keys)\n                                      ^^^^^^^^^^^^^^\n</code></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I have encountered this while using kredis locally, like;</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ cd kredis\n$ bin/console\nirb(main):001&gt; Kredis.string &quot;mystring&quot;\nCould not log &quot;meta.kredis&quot; event. NoMethodError: undefined method `compact_blank' for an instance of Hash\"><pre class=\"notranslate\"><code class=\"notranslate\">$ cd kredis\n$ bin/console\nirb(main):001&gt; Kredis.string \"mystring\"\nCould not log \"meta.kredis\" event. NoMethodError: undefined method `compact_blank' for an instance of Hash\n</code></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51271",
            "title": "Enable Hash#compact_blank inside ActiveSupport::LogSubscriber",
            "date_modified": "2024-03-07T02:26:35.000Z",
            "date_published": "2024-03-07T01:39:16.000Z",
            "author": {
                "name": "sato11",
                "url": "https://github.com/sato11"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/902714?u=ed4b4581fb3056c3ceba83d22c6452418405c743&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">While Active Storage supports strict loading, it <a href=\"https://github.com/rails/rails/blob/f7353283fd771e99b9675bcb9394e398964195f8/activestorage/lib/active_storage/attached/model.rb#L106\">defaults to false</a>. This can be problematic in applications that enforce strict loading by default. It can be assumed that <code class=\"notranslate\">strict_loading_by_default</code> includes Active Storage attachments, leading to n+1 issues.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the default of the <code class=\"notranslate\">strict_loading</code> keyword parameter for <code class=\"notranslate\">has_one_attached</code> and  <code class=\"notranslate\">has_many_attached</code> to use the model's <code class=\"notranslate\">strict_loading_by_default</code> to create a consistent developer experience.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51261",
            "title": "Default Active Storage strict loading to strict_loading_by_default",
            "date_modified": "2024-03-06T04:39:09.000Z",
            "date_published": "2024-03-06T04:39:05.000Z",
            "author": {
                "name": "HashNotAdam",
                "url": "https://github.com/HashNotAdam"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/4628?u=0e2fd4281d8728b7760bd9e956dce12b6a5484ca&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I have some RESTful endpoints where it makes sense to pattern match params to deal with different shape of incoming payloads, as illustrated in this endpoint:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def create\n  case params\n  in interview_time_availability: { interview_time_id:, person_id: }\n    @interview_time_availabilities.create! interview_time_id:, person_id:\n  in interview_time: { id: }\n    @students.each do |student|\n      student.interview_time_availabilities.create interview_time_id: id\n    end\n  end\n\n  redirect_to students_interview_time_availabilities_path\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">def</span> <span class=\"pl-en\">create</span>\n  <span class=\"pl-k\">case</span> <span class=\"pl-en\">params</span>\n  <span class=\"pl-k\">in</span> <span class=\"pl-pds\">interview_time_availability</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">interview_time_id</span>:<span class=\"pl-kos\">,</span> <span class=\"pl-pds\">person_id</span>: <span class=\"pl-kos\">}</span>\n    <span class=\"pl-c1\">@interview_time_availabilities</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create!</span> <span class=\"pl-pds\">interview_time_id</span>:<span class=\"pl-kos\">,</span> <span class=\"pl-pds\">person_id</span>:\n  <span class=\"pl-k\">in</span> <span class=\"pl-pds\">interview_time</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">id</span>: <span class=\"pl-kos\">}</span>\n    <span class=\"pl-c1\">@students</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">student</span>|\n      <span class=\"pl-s1\">student</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">interview_time_availabilities</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create</span> <span class=\"pl-pds\">interview_time_id</span>: <span class=\"pl-en\">id</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-en\">redirect_to</span> <span class=\"pl-en\">students_interview_time_availabilities_path</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR adds a <code class=\"notranslate\">deconstruct_keys(keys)</code> method on <code class=\"notranslate\">StrongParameters</code> that called <code class=\"notranslate\">to_unsafe_h</code> for pattern matching:</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51260",
            "title": "Add support for pattern matching for parameters",
            "date_modified": "2024-03-11T16:19:18.000Z",
            "date_published": "2024-03-06T03:36:54.000Z",
            "author": {
                "name": "bradgessler",
                "url": "https://github.com/bradgessler"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Prior <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1834208849\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48876\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48876/hovercard\" href=\"https://github.com/rails/rails/pull/48876\">#48876</a> using <code class=\"notranslate\">in_batches</code> on a relation with unpersisted records would work but new records will not be included in the iteration.</p>\n<p dir=\"auto\">Currently using <code class=\"notranslate\">in_batches</code> on a loaded relation with unpersisted records will fail when we try to sort records by <code class=\"notranslate\">id</code> as new records don't have <code class=\"notranslate\">id</code> set and comparison with <code class=\"notranslate\">nil</code> fails.</p>\n<p dir=\"auto\">Since both raising an ambiguous comparison error or implicitly skipping new records seem sub-option we are proposing to raise a clear error to let application explicitly decide whether it needs to iterate on a loaded relation in slices (i.e. <code class=\"notranslate\">each_slice</code>) or explicitly drop / save the un-persisted record and continue using <code class=\"notranslate\">in_batches</code></p>\n<p dir=\"auto\">cc: <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/garyhtou/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/garyhtou\">@garyhtou</a></p>",
            "url": "https://github.com/rails/rails/pull/51251",
            "title": "Raise on `in_batches` used on a relation with unpersisted records",
            "date_modified": "2024-03-11T17:54:06.000Z",
            "date_published": "2024-03-05T01:52:09.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54629302?u=be8de5137bf940532cddd05aff823129ab8a39db&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #50118.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2002750106\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50118\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50118/hovercard\" href=\"https://github.com/rails/rails/issues/50118\">#50118</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Ensures that the <code class=\"notranslate\">:prepend</code> option for after transaction callbacks is respected when <code class=\"notranslate\">config.run_after_transaction_callbacks_in_order_defined = true</code>. This allows prepending certain <code class=\"notranslate\">after_commit</code> and <code class=\"notranslate\">after_rollback</code> callbacks while still running the rest in the order defined on the model.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">In addition to the tests here there is also <a href=\"https://github.com/rails/rails/issues/50118#issuecomment-1975502684\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50118/hovercard\">this script</a> which I tested against.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/ghiculescu/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ghiculescu\">@ghiculescu</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51244",
            "title": "[Fix #50118] `:prepend` option not working with `run_after_transaction_callbacks_in_order_defined` config",
            "date_modified": "2024-03-04T05:20:42.000Z",
            "date_published": "2024-03-04T01:36:20.000Z",
            "author": {
                "name": "joshuay03",
                "url": "https://github.com/joshuay03"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/58582?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Taken from: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2165609779\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51242\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51242/hovercard\" href=\"https://github.com/rails/rails/issues/51242\">#51242</a></p>\n<p dir=\"auto\">In ActiveRecord 7.1, a new option was added to <a href=\"https://api.rubyonrails.org/classes/ActiveRecord/Batches.html#method-i-in_batches\" rel=\"nofollow\">ActiveRecord::Batches#in_batches</a>, <code class=\"notranslate\">use_ranges: true</code>, that enables a more efficient way to generate queries from the provided scope for each batch.</p>\n<p dir=\"auto\">The resulting queries use ranges to select record ids, e.g. <code class=\"notranslate\">WHERE id &gt; 10000 AND id &lt;= 20000</code> instead of passing a possibly very long list of ids in an <code class=\"notranslate\">IN</code> clause, e.g. <code class=\"notranslate\">IN (10000, 10001, [...,] 19999, 20000)</code>.</p>\n<p dir=\"auto\">This option was implemented in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1277547479\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45414\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/45414/hovercard\" href=\"https://github.com/rails/rails/pull/45414\">#45414</a>.</p>\n<p dir=\"auto\">The implementation of <code class=\"notranslate\">use_ranges: true</code> relies on the already implemented strategy to select all ids from the range (needed for <code class=\"notranslate\">use_ranges: false</code>), when generating the scope for each batch.</p>\n<p dir=\"auto\">The typical SQL query to generate a scope for a batch is (example with batches of 10k records):</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"SELECT &quot;users&quot;.&quot;id&quot; FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;id&quot; &gt; ... ORDER BY &quot;users&quot;.&quot;id&quot; ASC LIMIT 10000;\"><pre class=\"notranslate\"><span class=\"pl-k\">SELECT</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">FROM</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">WHERE</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">&gt;</span> ... <span class=\"pl-k\">ORDER BY</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">ASC</span> <span class=\"pl-k\">LIMIT</span> <span class=\"pl-c1\">10000</span>;</pre></div>\n<p dir=\"auto\">But subsequently, all these ids but the last one are discarded:</p>\n<p dir=\"auto\"><a href=\"https://github.com/rails/rails/blob/v7.1.3.2/activerecord/lib/active_record/relation/batches.rb#L379-L380\">https://github.com/rails/rails/blob/v7.1.3.2/activerecord/lib/active_record/relation/batches.rb#L379-L380</a></p>\n<p dir=\"auto\"><strong>This method wastes resources in the database (CPU, I/O), in transit (bandwidth) and in the Ruby process (RAM).</strong></p>\n<p dir=\"auto\">This Pull Request is a proposal to save these resources by implementing <strong>an additional optimisation</strong>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">The description below applies only to the use of <code class=\"notranslate\">in_batches</code> <strong>with</strong> the option <code class=\"notranslate\">use_ranges: true</code>.</p>\n<p dir=\"auto\">Instead of returning all the ids for each batch, we use <code class=\"notranslate\">OFFSET</code> to search for the last id in the next batch and return just one id, e.g.</p>\n<div class=\"highlight highlight-source-diff notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"  -- queries for all batches but the last (before/after)\n- SELECT &quot;users&quot;.&quot;id&quot; FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;id&quot; &gt; ... ORDER BY &quot;users&quot;.&quot;id&quot; ASC LIMIT 10000;\n+ SELECT &quot;users&quot;.&quot;id&quot; FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;id&quot; &gt; ... ORDER BY &quot;users&quot;.&quot;id&quot; ASC LIMIT 1 OFFSET 9999;\"><pre class=\"notranslate\">  -- queries for all batches but the last (before/after)\n<span class=\"pl-md\"><span class=\"pl-md\">-</span> SELECT \"users\".\"id\" FROM \"users\" WHERE \"users\".\"id\" &gt; ... ORDER BY \"users\".\"id\" ASC LIMIT 10000;</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span> SELECT \"users\".\"id\" FROM \"users\" WHERE \"users\".\"id\" &gt; ... ORDER BY \"users\".\"id\" ASC LIMIT 1 OFFSET 9999;</span></pre></div>\n<p dir=\"auto\">There is one downside, however.</p>\n<p dir=\"auto\">Our <code class=\"notranslate\">OFFSET</code>-based query won't be able to return the last id if the next batch is smaller than the limit or if there's no next batch. We always need one additional query to get the size and last id of the very last batch. We use the same query as before the optim for that purpose:</p>\n<div class=\"highlight highlight-source-diff notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"  -- queries for the last batch (before/after)\n- SELECT &quot;users&quot;.&quot;id&quot; FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;id&quot; &gt; ... ORDER BY &quot;users&quot;.&quot;id&quot; ASC LIMIT 10000;\n+ SELECT &quot;users&quot;.&quot;id&quot; FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;id&quot; &gt; ... ORDER BY &quot;users&quot;.&quot;id&quot; ASC LIMIT 1 OFFSET 9999;\n+ SELECT &quot;users&quot;.&quot;id&quot; FROM &quot;users&quot; WHERE &quot;users&quot;.&quot;id&quot; &gt; ... ORDER BY &quot;users&quot;.&quot;id&quot; ASC LIMIT 10000;\"><pre class=\"notranslate\">  -- queries for the last batch (before/after)\n<span class=\"pl-md\"><span class=\"pl-md\">-</span> SELECT \"users\".\"id\" FROM \"users\" WHERE \"users\".\"id\" &gt; ... ORDER BY \"users\".\"id\" ASC LIMIT 10000;</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span> SELECT \"users\".\"id\" FROM \"users\" WHERE \"users\".\"id\" &gt; ... ORDER BY \"users\".\"id\" ASC LIMIT 1 OFFSET 9999;</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span> SELECT \"users\".\"id\" FROM \"users\" WHERE \"users\".\"id\" &gt; ... ORDER BY \"users\".\"id\" ASC LIMIT 10000;</span></pre></div>\n<p dir=\"auto\">Unless we only have a handful of small batches, this strategy is a winner overall, as it reduces the time and network resources spent generating batches, as shown by the benchmark below.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<h4 dir=\"auto\">Benchmark</h4>\n<p dir=\"auto\">Let's reuse the benchmark from the description of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1277547479\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45414\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/45414/hovercard\" href=\"https://github.com/rails/rails/pull/45414\">#45414</a>, i.e. the same <code class=\"notranslate\">users</code> table with <code class=\"notranslate\">10M</code> records, but with two modifications:</p>\n<ul dir=\"auto\">\n<li>Batches of 10k records instead of 1k;</li>\n<li>No call to <code class=\"notranslate\">batch.count</code> on each batch since we are measuring only on the time and resources needed to generate the scopes, not to use them.</li>\n</ul>\n<p dir=\"auto\">Here is the code used:</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"CREATE TABLE users (id bigserial PRIMARY KEY, val integer DEFAULT 0);\nINSERT INTO users SELECT i FROM generate_series(1, 10000000) AS i;\"><pre class=\"notranslate\"><span class=\"pl-k\">CREATE</span> <span class=\"pl-k\">TABLE</span> <span class=\"pl-en\">users</span> (id <span class=\"pl-k\">bigserial</span> <span class=\"pl-k\">PRIMARY KEY</span>, val <span class=\"pl-k\">integer</span> DEFAULT <span class=\"pl-c1\">0</span>);\n<span class=\"pl-k\">INSERT INTO</span> users <span class=\"pl-k\">SELECT</span> i <span class=\"pl-k\">FROM</span> generate_series(<span class=\"pl-c1\">1</span>, <span class=\"pl-c1\">10000000</span>) <span class=\"pl-k\">AS</span> i;</pre></div>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"start = Process.clock_gettime(Process::CLOCK_MONOTONIC)\n\ncount = 0\nUser.in_batches(of: 10_000) do |batch|\n  count += 1  # previously: batch.count, but we don't want to trigger any other queries in this benchmark\nend\n\nputs &quot;Count = #{count}&quot;\nelapsed = Process.clock_gettime(Process::CLOCK_MONOTONIC) - start\nputs &quot;Elapsed: #{elapsed}s&quot;\"><pre class=\"notranslate\"><span class=\"pl-s1\">start</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Process</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">clock_gettime</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Process</span>::<span class=\"pl-c1\">CLOCK_MONOTONIC</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-s1\">count</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">0</span>\n<span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">in_batches</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">of</span>: <span class=\"pl-c1\">10_000</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">batch</span>|\n  <span class=\"pl-s1\">count</span> += <span class=\"pl-c1\">1</span>  <span class=\"pl-c\"># previously: batch.count, but we don't want to trigger any other queries in this benchmark</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Count = <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">count</span><span class=\"pl-kos\">}</span></span>\"</span>\n<span class=\"pl-s1\">elapsed</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Process</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">clock_gettime</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Process</span>::<span class=\"pl-c1\">CLOCK_MONOTONIC</span><span class=\"pl-kos\">)</span> - <span class=\"pl-s1\">start</span>\n<span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Elapsed: <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">elapsed</span><span class=\"pl-kos\">}</span></span>s\"</span></pre></div>\n<p dir=\"auto\">The benchmark is executed on a single machine (a recent macbook), with a round-trip-time &lt; 1ms.</p>\n<p dir=\"auto\">The network (I/O) stats are obtained by comparing the result of this command before/after a benchmark run:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"docker stats --no-stream postgres --format 'table {{.NetIO}}'\"><pre class=\"notranslate\"><code class=\"notranslate\">docker stats --no-stream postgres --format 'table {{.NetIO}}'\n</code></pre></div>\n<p dir=\"auto\"><strong>Here are the results:</strong></p>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Batching method</th>\n<th align=\"right\">Duration</th>\n<th align=\"right\">Network (I/O)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>in_batches(use_ranges: true)</td>\n<td align=\"right\">5.6 s.</td>\n<td align=\"right\">1.2 MB / 180 MB</td>\n</tr>\n<tr>\n<td>in_batches(use_ranges: true) + optim from this PR</td>\n<td align=\"right\">2.3 s.</td>\n<td align=\"right\">&lt; 0.5 MB /  &lt; 0.2 MB</td>\n</tr>\n</tbody>\n</table>\n<p dir=\"auto\">In this benchmark, we managed to <strong>generate scopes for batches <code class=\"notranslate\">x2.4</code> times faster and with <code class=\"notranslate\">x900</code> times less bandwidth</strong>. These results will of course typically vary with the batch size used, and the network speed.</p>\n<p dir=\"auto\">The absolute values may not seem like huge gains, but I'm considering using <code class=\"notranslate\">in_batches(use_ranges: true)</code> on tables with over 3 billion records, where this benchmark would show a saving of at least <code class=\"notranslate\">16+ minutes</code> and <code class=\"notranslate\">52.7 GB</code> of bandwidth (+ the database resources needed to extract/send this traffic).</p>\n<h4 dir=\"auto\">Other strategies considered</h4>\n<p dir=\"auto\">Using <code class=\"notranslate\">OFFSET</code> is not be the only way to achieve the same kind of optimisation.</p>\n<p dir=\"auto\">For example, we could consider using a strategy based on the calculation of the maximum id + batch size for each batch (details folded below).</p>\n<details>\n  <summary>Using a CTE</summary>\n<br>\nWe could use a CTE like this one:\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"WITH &quot;batch_ids&quot; AS (\n    -- same query as today\n    SELECT &quot;users&quot;.&quot;id&quot; FROM &quot;users&quot; WHERE (id &gt; 10000) ORDER BY &quot;users&quot;.&quot;id&quot; ASC LIMIT 10000\n)\nSELECT COUNT(id) AS last_batch_size, MAX(id) AS last_batch_id FROM batch_ids;\"><pre class=\"notranslate\">WITH <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>batch_ids<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">AS</span> (\n    <span class=\"pl-c\"><span class=\"pl-c\">--</span> same query as today</span>\n    <span class=\"pl-k\">SELECT</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">FROM</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">WHERE</span> (id <span class=\"pl-k\">&gt;</span> <span class=\"pl-c1\">10000</span>) <span class=\"pl-k\">ORDER BY</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">ASC</span> <span class=\"pl-k\">LIMIT</span> <span class=\"pl-c1\">10000</span>\n)\n<span class=\"pl-k\">SELECT</span> <span class=\"pl-c1\">COUNT</span>(id) <span class=\"pl-k\">AS</span> last_batch_size, <span class=\"pl-c1\">MAX</span>(id) <span class=\"pl-k\">AS</span> last_batch_id <span class=\"pl-k\">FROM</span> batch_ids;</pre></div>\n<p dir=\"auto\">This would be advantageous, as we would not have to use that \"extra\" query for the last batch as we did above.</p>\n<p dir=\"auto\">Nevertheless, using a CTE would have the following downsides:</p>\n<ol dir=\"auto\">\n<li>CTEs are not supported yet by all RDBMS supported by Active Record (MySQL &lt; 8.0)</li>\n<li>To my knowledge, ActiveRecord does not provide any way to easily generate a query with two distinct calculations such as a count and a maximum. The \"manual\" workarounds for this could be complicated.</li>\n</ol>\n<p dir=\"auto\">For the record, the query above can be generated with:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"User.connection.select_one(\n  User\n    .with(batch_ids: User.select('id').where('id &gt; 10000').order(:id).limit(10000))\n    .from('batch_ids')\n    .select('COUNT(id) AS last_batch_size', 'MAX(id) AS last_batch_id')\n)\"><pre class=\"notranslate\"><span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">select_one</span><span class=\"pl-kos\">(</span>\n  <span class=\"pl-v\">User</span>\n    <span class=\"pl-kos\">.</span><span class=\"pl-en\">with</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">batch_ids</span>: <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">select</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'id'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'id &gt; 10000'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">order</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:id</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">limit</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">10000</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-kos\">.</span><span class=\"pl-en\">from</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'batch_ids'</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-kos\">.</span><span class=\"pl-en\">select</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'COUNT(id) AS last_batch_size'</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'MAX(id) AS last_batch_id'</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-kos\">)</span></pre></div>\n</details>\n<details>\n  <summary>Using a subquery</summary>\n<br>\nWe could use a subquery like this one:\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"SELECT\n    COUNT(id) AS last_batch_size, MAX(id) AS last_batch_id\nFROM (\n    -- same query as today\n    SELECT &quot;users&quot;.&quot;id&quot; FROM &quot;users&quot; WHERE (id &gt; 10000) ORDER BY &quot;users&quot;.&quot;id&quot; ASC LIMIT 10000\n) subquery;\"><pre class=\"notranslate\"><span class=\"pl-k\">SELECT</span>\n    <span class=\"pl-c1\">COUNT</span>(id) <span class=\"pl-k\">AS</span> last_batch_size, <span class=\"pl-c1\">MAX</span>(id) <span class=\"pl-k\">AS</span> last_batch_id\n<span class=\"pl-k\">FROM</span> (\n    <span class=\"pl-c\"><span class=\"pl-c\">--</span> same query as today</span>\n    <span class=\"pl-k\">SELECT</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">FROM</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">WHERE</span> (id <span class=\"pl-k\">&gt;</span> <span class=\"pl-c1\">10000</span>) <span class=\"pl-k\">ORDER BY</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">ASC</span> <span class=\"pl-k\">LIMIT</span> <span class=\"pl-c1\">10000</span>\n) subquery;</pre></div>\n<p dir=\"auto\">Even better than the CTE version because this would be compatible with all RDBMS supported by ActiveRecord.</p>\n<p dir=\"auto\">For the record, the query above can be generated with:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"User.connection.select_one(\n  User.select('COUNT(id) AS last_batch_size', 'MAX(id) AS last_batch_id').from(\n    User.select('id').where('id &gt; 10000').order(:id).limit(10000)\n  )\n)\"><pre class=\"notranslate\"><span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">select_one</span><span class=\"pl-kos\">(</span>\n  <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">select</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'COUNT(id) AS last_batch_size'</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'MAX(id) AS last_batch_id'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">from</span><span class=\"pl-kos\">(</span>\n    <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">select</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'id'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'id &gt; 10000'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">order</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:id</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">limit</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">10000</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-kos\">)</span>\n<span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">But to support all sorts of primary keys (including composite) and multiple calculations in a single query, I suspect some complicated work is required in Active Record. If you think this is feasible at a reasonable cost, please provide some guidance </p>\n</details>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51243",
            "title": "[Fix #51242] Rework in_batches(use_ranges: true) to be more efficient",
            "date_modified": "2024-03-06T09:21:52.000Z",
            "date_published": "2024-03-03T23:02:54.000Z",
            "author": {
                "name": "maximerety",
                "url": "https://github.com/maximerety"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h2 dir=\"auto\">How to review this proposal</h2>\n<p dir=\"auto\">This exploration in expanding support for Action Text editors is motivated by <a href=\"https://github.com/rails/actiontext/issues/41\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/actiontext/issues/41/hovercard\">rails/actiontext#41</a>.</p>\n<p dir=\"auto\">This diff consists of a sequence of commits that could be merged incrementally over time, but are presented here as a unit to form a more cohesive narrative, and to demonstrate a potential end result.</p>\n<p dir=\"auto\">At the moment, the theme of the commits is as follows:</p>\n<ol dir=\"auto\">\n<li>Add Promise support to Client-side JavaScript</li>\n<li>Deprecate Trix-specific Ruby methods</li>\n<li>Consolidate methods to the <code class=\"notranslate\">ActionText::Editor</code> class, including a barebones demonstration of integrating with a third-party editor (<a href=\"https://prosemirror.net\" rel=\"nofollow\">ProseMirror</a>, in this case)</li>\n<li>Remove the barebones demonstration</li>\n</ol>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Related to <a href=\"https://github.com/rails/actiontext/issues/41\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/actiontext/issues/41/hovercard\">rails/actiontext#41</a></p>\n<p dir=\"auto\">The main aim of this changeset is to provide a single, extensible entrypoint for third-party editors (that are not Trix) to integrate with Action Text.</p>\n<p dir=\"auto\">The <code class=\"notranslate\">Editor</code> class (and the <code class=\"notranslate\">TrixEditor</code> implementation to integrate with <a href=\"https://trix-editor.org\" rel=\"nofollow\">Trix</a>) is introduced without a public interface. They are both introduced marked with <code class=\"notranslate\">:nodoc:</code> so that all of their methods are considered <code class=\"notranslate\">:nodoc:</code> as well. They're the only \"public\" part of this PR at the moment. This diff acknowledges their existence, but doesn't commit to any particular interface.</p>\n<p dir=\"auto\">Their surface area is intentionally small, and the scope of what's public is aggressively limited for the sake of deprecating the old methods and merging the changes that introduce the new methods. The idea is for Action Text to declare \"public interface bankruptcy\" for the majority of its inner classes. From that interface bankruptcy, third-party integrates can make ad-hoc extensions as they explore what methods are good candidates to be added and maintained as part of the <code class=\"notranslate\">Editor</code> API (for all Ruby, HTTP, and JavaScript interfaces). Once there's a need to pave the cowpaths, Action Text will have an opportunity to make additions to the interface without much burden of responsibility to maintain historical choices.</p>\n<p dir=\"auto\">Without the existence of the <code class=\"notranslate\">Editor</code> class to consolidate the rich text processing and rendering canonicalized <code class=\"notranslate\">&lt;action-text-attachment&gt;</code> elements, third-party extension would be challenging and potentially more tedious.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This proposes that the entry point should be the <code class=\"notranslate\">ActionText::Editor</code> class. In addition to introducing the new class itself along with its first <code class=\"notranslate\">ActionText::TrixEditor</code> subclass, this changeset also required additional integration points with the existing models and classes.</p>\n<h4 dir=\"auto\">Additions</h4>\n<p dir=\"auto\">The initial responsibilities of the <code class=\"notranslate\">ActionText::Editor</code> have been determined by consolidating a variety of (class- and instance-) methods across a variety of classes to reduce the number of touchpoints for applications and engines that provide third-party editor integrations. The vast majority of its method definitions are direct copy-and-pastes from their original sources. Any method that previously mentioned <code class=\"notranslate\">trix</code> in its name or argument list has replaced and generalized that occurrence with <code class=\"notranslate\">editor</code>.</p>\n<p dir=\"auto\">For example, this proposal draws inspiration from the <code class=\"notranslate\">ActiveStorage::Service</code> class and its related <code class=\"notranslate\">Registry</code> and <code class=\"notranslate\">Configurator</code> infrastructural classes to store per-record information about the editor used to create its constituent data.</p>\n<p dir=\"auto\">To store that metadata, this commit introduces a new migration that adds an <code class=\"notranslate\">action_text_rich_texts.editor_name</code> column to encode the editor. Since the out-of-the-box configuration (and the only historical choice) uses <code class=\"notranslate\">trix</code>, the migration backfills old data with <code class=\"notranslate\">action_text_rich_texts.editor_name = 'trix'</code>.</p>\n<p dir=\"auto\">The editors will be configured through a new <code class=\"notranslate\">config/rich_text.yml</code> file that also draws inspiration from <code class=\"notranslate\">config/storage.yml</code>. Applications (as well as third-party Editor engines) will provide their own <code class=\"notranslate\">config/rich_text.yml</code> files to introduce and configure additional editors.</p>\n<h4 dir=\"auto\">Changes</h4>\n<p dir=\"auto\">With the addition of the <code class=\"notranslate\">ActionText::Editor</code> class and the <code class=\"notranslate\">ActionText::RichText#editor</code> method, there is an opportunity to outsource the details of rendering editor form controls along with filling them out in System Tests to the Editor itself. This commit inverts the responsibility to render the field by introducing the <code class=\"notranslate\">Editor#rich_text_area_tag</code>. The <code class=\"notranslate\">rich_text_area_tag</code> method accepts an instance of <code class=\"notranslate\">ActionView::Base</code> as the <code class=\"notranslate\">view_context</code> argument to access the necessary render helpers. Similarly, the<br>\n<code class=\"notranslate\">Editor#fill_in_rich_text_area</code> method accepts a Capybara session argument.</p>\n<p dir=\"auto\">There is an opportunity to define <code class=\"notranslate\">Editor#rich_text_area_tag</code> in terms of <code class=\"notranslate\">#render_in(view_context, **locals, &amp;block)</code> once the <code class=\"notranslate\">#render_in</code> interface is extended to incorporate call-site keyword arguments and blocks.</p>\n<p dir=\"auto\">On the client-side, this changeset contains some noteworthy JavaScript modifications. For example, it exports the <code class=\"notranslate\">AttachmentUpload</code> class so that third-party editors can utilize it. To do so, it also modifies the constructor arguments to be more generalized. Instead of expecting a <code class=\"notranslate\">Trix.Attachment</code> instance and a browser <code class=\"notranslate\">File</code>, it accepts a \"delegate\" object to provide the <code class=\"notranslate\">File</code> and to respond to upload lifecycle methods.</p>\n<p dir=\"auto\">Additionally, the <code class=\"notranslate\">AttachmentUpload.start</code> function returns a <code class=\"notranslate\">Promise</code> to match asynchronous programming styles that don't utilize callbacks.</p>\n<h4 dir=\"auto\">Deprecations</h4>\n<p dir=\"auto\">The introduction of the <code class=\"notranslate\">Editor</code> class enables the deprecation of a variety of class- and instance-level methods across the <code class=\"notranslate\">ActionText</code> namespace. The main motivation of these deprecations is to seize the opportunity to reset Action Text's public API.</p>\n<p dir=\"auto\">There are two categories of deprecations in this changeset: <code class=\"notranslate\">module</code>/<code class=\"notranslate\">class</code> deprecations and method deprecations.</p>\n<p dir=\"auto\">The <code class=\"notranslate\">module</code> and <code class=\"notranslate\">class</code> deprecations target modules that are internal and \"private\" in intent, but public in Ruby and not marked as <code class=\"notranslate\">:nodoc:</code>. They're either particular to Trix, or their responsibilities have been given to <code class=\"notranslate\">ActionText::Editor</code>.</p>\n<p dir=\"auto\">The method deprecations also target methods that are internal and \"private\" in intent, but <code class=\"notranslate\">public</code> in Ruby and not marked as <code class=\"notranslate\">:nodoc:</code>. In general, determining whether or not to deprecate a method hinged on whether its name or arguments mentioned <code class=\"notranslate\">\"trix\"</code>, <em>or</em> if it lacked method-level documentation or comments of any kind.</p>\n<p dir=\"auto\">When possible, the previous code paths have been deprecated <em>and</em> re-implemented in terms of an <code class=\"notranslate\">ActionText::TrixEditor</code> instance.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">In its current state, this PR includes a test suite that <code class=\"notranslate\">ProsemirrorEditor</code> implementation to integrate with the <a href=\"https://prosemirror.net\" rel=\"nofollow\">ProseMirror</a> package. It contains a Ruby-side implementation as well as an ad hoc JavaScript implementation. The main purpose of this code was to explore what it'd take to replace Trix, and to drive out the necessary extensible methods and points of integration.</p>\n<p dir=\"auto\">It is not my intent to foist the burden of maintaining a third-party editor plugin in the test suite. I am also not proposing that ProseMirror be the first third-party editor to be given built-in support. I'm not sure how to proceed with the code, and have included it here to provide a general sketch of how an application or engine might integrate a WYSIWYG editor. I've left them included in the diff to provide code reviewers from Core with an opportunity to assess the client-side requirements and scan for opportunity to introduce new abstractions that Rails would want to support as part of its \"public\" JavaScript API.</p>\n<p dir=\"auto\">Once the rest of the code is in a mergable state, I'm happy to remove the Prosemirror Ruby / JavaScript / test code.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51238",
            "title": "Extract `ActionText::Editor` to support WYSIWYG Editors",
            "date_modified": "2024-03-08T17:17:03.000Z",
            "date_published": "2024-03-02T13:22:19.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/50948617?u=e0731fc7b612eceeae21f01b0d425cf0aee40da4&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This PR is created because when a <code class=\"notranslate\">form_for</code> has the <code class=\"notranslate\">namespace</code> option, all other fields are prefixed with it except for the <code class=\"notranslate\">label</code> tag which has the <code class=\"notranslate\">for</code> option.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Example:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"form_for(@post, namespace: SecureRandom.urlsafe_base64) do |f|\n  concat f.label(:title, for: &quot;my_custom_post_title&quot;)\n  concat f.text_field(:title, id: &quot;my_custom_post_title&quot;)\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">form_for</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">@post</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">namespace</span>: <span class=\"pl-v\">SecureRandom</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">urlsafe_base64</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">f</span>|\n  <span class=\"pl-en\">concat</span> <span class=\"pl-s1\">f</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">label</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:title</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">for</span>: <span class=\"pl-s\">\"my_custom_post_title\"</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-en\">concat</span> <span class=\"pl-s1\">f</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">text_field</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:title</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">id</span>: <span class=\"pl-s\">\"my_custom_post_title\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">In the above example, the label will not be linked to the text field, which shouldn't be the case just because the <code class=\"notranslate\">namespace</code> option is present.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51237",
            "title": "Fix label with `for` option not getting prefixed by form `namespace` value",
            "date_modified": "2024-03-02T11:37:18.000Z",
            "date_published": "2024-03-02T11:37:13.000Z",
            "author": {
                "name": "abeidahmed",
                "url": "https://github.com/abeidahmed"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1966473?u=fe117732163d3610f051fca80df4e04c1b91335d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created to update and improve the Active Record Basics guide.</p>\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>Add more code examples and update existing examples.</li>\n<li>Make the connection between Active Record and Active Model clear</li>\n<li>Update Intro language to be more friendly, less jargon-y, clearly explain terms like ORM</li>\n</ul>\n<h3 dir=\"auto\">Testing</h3>\n<p dir=\"auto\">Run <code class=\"notranslate\">guides:generate</code> and <code class=\"notranslate\">guides:lint</code> locally and review the generated guide.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51226",
            "title": "[RF DOCS] Active Record Basics Guide [ci-skip]",
            "date_modified": "2024-03-08T03:00:12.000Z",
            "date_published": "2024-02-29T19:06:10.000Z",
            "author": {
                "name": "bhumi1102",
                "url": "https://github.com/bhumi1102"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/605293?u=f09ba4ff4c7ffec1622589eca129d566d785e38e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2022175891\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50247\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50247/hovercard\" href=\"https://github.com/rails/rails/pull/50247\">#50247</a> introduced a regression for engines already defining a <code class=\"notranslate\">table_name_prefix</code> method which would make the default behaviour (ActiveRecord's config + engine's name) take precedence over the user defined method.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes how <code class=\"notranslate\">table_name_prefix</code> is programmatically defined when not already user-defined, removing usage of <code class=\"notranslate\">ActiveSupport.on_load(:active_record)</code> which delay execution of the block until later.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51223",
            "title": "Fix regression in isolated engine's `table_name_prefix` behaviour",
            "date_modified": "2024-02-29T14:47:57.000Z",
            "date_published": "2024-02-29T14:47:52.000Z",
            "author": {
                "name": "hubb",
                "url": "https://github.com/hubb"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/17757590?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49999.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1987597183\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49999\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49999/hovercard\" href=\"https://github.com/rails/rails/issues/49999\">#49999</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">ActiveRecord::Relation#order now properly references Arel::Attribute arguments</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51219",
            "title": "[Fix #49999] properly reference from Arel::Attribute args",
            "date_modified": "2024-02-29T19:21:31.000Z",
            "date_published": "2024-02-28T23:27:21.000Z",
            "author": {
                "name": "mylesboone",
                "url": "https://github.com/mylesboone"
            }
        }
    ]
}