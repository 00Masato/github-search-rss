{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5077225?u=e9f968c9eb790ee7734442f6b7998155400ad1d8&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49373.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1910682345\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49373\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49373/hovercard\" href=\"https://github.com/rails/rails/issues/49373\">#49373</a> fully</p>\n<p dir=\"auto\"><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a>'s commit to address this issue resolved the problem for the one file that the most recent CI had shown was leaking database connections. Further CI runs revealed other such tests, however.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">At present, I have 5 test seeds that reproduce the <code class=\"notranslate\">SQLite3::IOException: disk I/O error</code>:</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">SEED=58510 bundle exec rake db:postgresql:rebuild postgresql:test</code></li>\n<li><code class=\"notranslate\">SEED=31616 bundle exec rake db:postgresql:rebuild postgresql:test</code></li>\n<li><code class=\"notranslate\">SEED=64449 bundle exec rake db:postgresql:rebuild postgresql:test</code></li>\n<li><code class=\"notranslate\">SEED=61510 bundle exec rake db:mysql:rebuild mysql2:test</code></li>\n<li><code class=\"notranslate\">SEED=62616 bundle exec rake db:mysql:rebuild mysql2:test</code></li>\n</ul>\n<p dir=\"auto\">Investigating the various test runs exposed at least 3 tests that leak database connections:</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">ConnectionHandlersShardingDbTest</code></li>\n<li><code class=\"notranslate\">ConnectionHandlersMultiDbTest</code></li>\n<li><code class=\"notranslate\">ConnectionSwappingNestedTest</code></li>\n</ul>\n<p dir=\"auto\">All tests shared a call to <code class=\"notranslate\">clean_up_connection_handler</code> in their <code class=\"notranslate\">teardown</code> hook, so I looked for a tweak to <code class=\"notranslate\">clean_up_connection_handler</code> that would consistently clean up the connection handlers.</p>\n<p dir=\"auto\">After investigation and experimentation, I found that there were only 4 ActiveRecord classes that were expected to have connections independent of a particular test. So, I added a simple additional check to the <code class=\"notranslate\">clean_up_connection_handler</code>.</p>\n<p dir=\"auto\">This removed the need for the previously added <code class=\"notranslate\">remove_connections</code> method.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49403",
            "title": "Fix the problem of database connections leaking between tests",
            "date_modified": "2023-09-27T09:57:14.000Z",
            "date_published": "2023-09-27T09:57:10.000Z",
            "author": {
                "name": "fractaledmind",
                "url": "https://github.com/fractaledmind"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/22231095?u=fc75f9764434943effe06d6c1dc48d40a5003b0c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">In <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1792146155\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48681\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48681/hovercard\" href=\"https://github.com/rails/rails/pull/48681\">#48681</a> The <code class=\"notranslate\">name</code> argument has been deprecated on <code class=\"notranslate\">#remove_connection</code> without any replacement.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">In this PR removes the deprecated <code class=\"notranslate\">name</code> argument from <code class=\"notranslate\">#remove_connection</code></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">cc: <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/eileencodes/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/eileencodes\">@eileencodes</a></p>",
            "url": "https://github.com/rails/rails/pull/49400",
            "title": "Remove deprecated name argument from remove_connection",
            "date_modified": "2023-09-27T09:00:41.000Z",
            "date_published": "2023-09-27T05:50:10.000Z",
            "author": {
                "name": "akhilgkrishnan",
                "url": "https://github.com/akhilgkrishnan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/22231095?u=fc75f9764434943effe06d6c1dc48d40a5003b0c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><code class=\"notranslate\">bin/rails secrets:edit</code> and <code class=\"notranslate\">bin/rails secrets:show</code> has been deprecated since Rails 7.1 in favor of<br>\ncredentials.  <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1645364533\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47801\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47801/hovercard\" href=\"https://github.com/rails/rails/pull/47801\">#47801</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request removes the deprecated <code class=\"notranslate\">secrets:edit</code> and <code class=\"notranslate\">secrets:show</code> methods in Rails 7.2</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49398",
            "title": "Remove deprecated secrets:edit and secrets:show",
            "date_modified": "2023-09-27T05:19:08.000Z",
            "date_published": "2023-09-27T04:48:22.000Z",
            "author": {
                "name": "akhilgkrishnan",
                "url": "https://github.com/akhilgkrishnan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1280550?u=f9b1bc946c4e57f734c0cebf7bf4f51541c8d6fb&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because either the docs are incorrect for the <code class=\"notranslate\">retry_on</code> method or the code is incorrect. Fixing the code is a breaking change and I don't think that's preferrable, so I tried clarifying instead.</p>\n<p dir=\"auto\">See here - <a href=\"https://api.rubyonrails.org/classes/ActiveJob/Exceptions/ClassMethods.html#method-i-retry_on\" rel=\"nofollow\">https://api.rubyonrails.org/classes/ActiveJob/Exceptions/ClassMethods.html#method-i-retry_on</a>.</p>\n<p dir=\"auto\">The <code class=\"notranslate\">attempts</code> actually doesn't represent the number of retries but the number of total tries - the retries start at 1 and goes up to <code class=\"notranslate\">&lt; attempts</code> AFAICT.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">See here - <a href=\"https://api.rubyonrails.org/classes/ActiveJob/Exceptions/ClassMethods.html#method-i-retry_on\" rel=\"nofollow\">https://api.rubyonrails.org/classes/ActiveJob/Exceptions/ClassMethods.html#method-i-retry_on</a>.</p>\n<p dir=\"auto\">The <code class=\"notranslate\">attempts</code> actually doesn't represent the number of retries but the number of total tries - the retries start at 1 and goes up to <code class=\"notranslate\">&lt; attempts</code> AFAICT. So if I execute with <code class=\"notranslate\">attempts: 1</code>, the job will not retry. If I execute with <code class=\"notranslate\">attempts: 2</code>, it will retry once.</p>\n<p dir=\"auto\">I opted for just emphasizing in the method documentation that the <code class=\"notranslate\">attempts</code> include the original job execution attempt.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I don't think it's ideal to change the behaviour even if it's seemingly incorrect. I can do so if that is the preferred way.</p>\n<p dir=\"auto\">If so, we can just update this line to do a a lower-or-equal comparison instead of a lower comparison: </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/c32813ddc6e7e46a924bf98574d1855b494967e8/activejob/lib/active_job/exceptions.rb#L68\">rails/activejob/lib/active_job/exceptions.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 68\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/c32813ddc6e7e46a924bf98574d1855b494967e8\">c32813d</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L68\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"68\"></td>\n          <td id=\"LC68\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> <span class=\"pl-s1\">attempts</span> == <span class=\"pl-pds\">:unlimited</span> || <span class=\"pl-s1\">executions</span> &lt; <span class=\"pl-s1\">attempts</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49394",
            "title": "Adjust method documentation for `ActiveJob::Exceptions::ClassMethods#retry_on`",
            "date_modified": "2023-09-27T06:40:42.000Z",
            "date_published": "2023-09-26T17:46:09.000Z",
            "author": {
                "name": "johanstenberg92",
                "url": "https://github.com/johanstenberg92"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6826778?u=f003e43af6f187f1ff48cfb577150c77a54f4138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">We noticed a couple of spots where transaction tracking events were potentially incorrect.</p>\n<ul dir=\"auto\">\n<li>When the connection reconnects with <code class=\"notranslate\">restore_transactions: true</code>, we were keeping the original start time for the transaction. In this case, it makes more sense to treat these as two separate transactions for tracking purposes.</li>\n<li>If you manually call <code class=\"notranslate\">reconnect!</code> within a transaction opened via <code class=\"notranslate\">being_transaction</code> rather than <code class=\"notranslate\">transaction do</code>, we were never marking the event as finished and thus never broadcasting the event. This isn't public API and likely isn't very common, but we did run into one scenario in a test file that was doing this in a setup block.</li>\n</ul>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">We added a line to the <code class=\"notranslate\">reset_transactions</code> method to mark any open transactions as finished. We went back and forth on the naming for this new method, but eventually settled on <code class=\"notranslate\">suspend_transactions</code> since the transactions may potentially be restarted.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This is a followup to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1886527188\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49192\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49192/hovercard\" href=\"https://github.com/rails/rails/pull/49192\">#49192</a>  and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1895181637\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49262\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49262/hovercard\" href=\"https://github.com/rails/rails/pull/49262\">#49262</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49391",
            "title": "Ensure transaction tracking finishes when reconnecting",
            "date_modified": "2023-09-26T17:09:40.000Z",
            "date_published": "2023-09-26T16:56:05.000Z",
            "author": {
                "name": "ipc103",
                "url": "https://github.com/ipc103"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">ActionView::Helpers::TagHelper::TagBuilder</code> class renders HTML elements based on the methods invoked on it. For example, <code class=\"notranslate\">tag.input</code> will render an <code class=\"notranslate\">&lt;input&gt;</code> element, while <code class=\"notranslate\">tag.turbo_frame</code> will render a <code class=\"notranslate\">&lt;turbo-frame&gt;</code> element.</p>\n<p dir=\"auto\">The magic of the class is rooted in its definition of <code class=\"notranslate\">#method_missing</code>.</p>\n<p dir=\"auto\">The current implementation bakes-in special treatment of void HTML elements (for example: <code class=\"notranslate\">&lt;input&gt;</code>) and self-closing SVG elements (for example: <code class=\"notranslate\">&lt;use /&gt;</code>). Despite its ahead-of-time knowledge of these element names, calls to corresponding methods <code class=\"notranslate\">tag.input</code> and <code class=\"notranslate\">tag.use</code> still rely on <code class=\"notranslate\">#method_missing</code>.</p>\n<p dir=\"auto\">This has performance implications.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit defines a new <code class=\"notranslate\">TagBuilder.define_void_element</code> class method to dynamically define methods for each known element. Then, the class invokes the method for each element name in <code class=\"notranslate\">HTML_VOID_ELEMENTS</code> and <code class=\"notranslate\">SVG_SELF_CLOSING_ELEMENTS</code>.</p>\n<p dir=\"auto\">Calls to <code class=\"notranslate\">.define_void_element</code> and <code class=\"notranslate\">.define_self_closing_element</code> make<br>\n<code class=\"notranslate\">HTML_VOID_ELEMENTS</code> and <code class=\"notranslate\">SVG_SELF_CLOSING_ELEMENTS</code> unnecessary, so<br>\nthis commit removes those constant definitions.</p>\n<p dir=\"auto\">The list of elements was generated from MDN's <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element\" rel=\"nofollow\">HTML elements reference</a> documentation.</p>\n<p dir=\"auto\">By cutting out the reliance on method missing, calls to <code class=\"notranslate\">TagBuilder</code> methods (like <code class=\"notranslate\">tag.input</code>) become comparable to calls to the <code class=\"notranslate\">tag</code> view helper with positional arguments (like <code class=\"notranslate\">tag(:input)</code>).</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"❯ ruby bench.rb\nWarming up --------------------------------------\n                 tag    73.438k i/100ms\n         tag_builder    79.910k i/100ms\nCalculating -------------------------------------\n                 tag    732.467k (± 0.9%) i/s -      3.672M in   5.013504s\n         tag_builder    810.981k (± 0.8%) i/s -      4.075M in   5.025632s\n\nComparison:\n         tag_builder:   810981.5 i/s\n                 tag:   732467.4 i/s - 1.11x  (± 0.00) slower\"><pre class=\"notranslate\"><code class=\"notranslate\">❯ ruby bench.rb\nWarming up --------------------------------------\n                 tag    73.438k i/100ms\n         tag_builder    79.910k i/100ms\nCalculating -------------------------------------\n                 tag    732.467k (± 0.9%) i/s -      3.672M in   5.013504s\n         tag_builder    810.981k (± 0.8%) i/s -      4.075M in   5.025632s\n\nComparison:\n         tag_builder:   810981.5 i/s\n                 tag:   732467.4 i/s - 1.11x  (± 0.00) slower\n</code></pre></div>\n<p dir=\"auto\">The results were from the following benchmark rendering void (<code class=\"notranslate\">&lt;input&gt;</code>) elements:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\" # frozen_string_literal: true\n\nrequire &quot;bundler/setup&quot;\n\nrequire &quot;action_view&quot;\nrequire &quot;minitest/autorun&quot;\nrequire &quot;benchmark/ips&quot;\n\nclass Foo\n  include ActionView::Helpers\nend\n\nhelpers = Foo.new\n\nBenchmark.ips do |x|\n  x.report(&quot;tag&quot;) { helpers.tag(&quot;input&quot;, value: &quot;foo&quot;) }\n  x.report(&quot;tag_builder&quot;) { helpers.tag.input(value: &quot;foo&quot;) }\n  x.compare!\nend\"><pre class=\"notranslate\"> <span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/setup\"</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"action_view\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"minitest/autorun\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"benchmark/ips\"</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Foo</span>\n  <span class=\"pl-en\">include</span> <span class=\"pl-v\">ActionView</span>::<span class=\"pl-v\">Helpers</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">helpers</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Foo</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n\n<span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"tag\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">helpers</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">tag</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"input\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">value</span>: <span class=\"pl-s\">\"foo\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"tag_builder\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">helpers</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">tag</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">input</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">value</span>: <span class=\"pl-s\">\"foo\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">compare!</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Similar to <code class=\"notranslate\">tag.input</code> (a void HTML element), calls to <code class=\"notranslate\">tag.div</code> are somewhat comparable to <code class=\"notranslate\">tag(\"div\")</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"❯ ruby bench.rb\nWarming up --------------------------------------\n         content_tag    59.548k i/100ms\n         tag_builder    51.215k i/100ms\nCalculating -------------------------------------\n         content_tag    595.067k (± 0.5%) i/s -      2.977M in   5.003570s\n         tag_builder    505.553k (± 2.2%) i/s -      2.561M in   5.067704s\n\nComparison:\n         content_tag:   595067.5 i/s\n         tag_builder:   505552.6 i/s - 1.18x  (± 0.00) slower\"><pre class=\"notranslate\"><code class=\"notranslate\">❯ ruby bench.rb\nWarming up --------------------------------------\n         content_tag    59.548k i/100ms\n         tag_builder    51.215k i/100ms\nCalculating -------------------------------------\n         content_tag    595.067k (± 0.5%) i/s -      2.977M in   5.003570s\n         tag_builder    505.553k (± 2.2%) i/s -      2.561M in   5.067704s\n\nComparison:\n         content_tag:   595067.5 i/s\n         tag_builder:   505552.6 i/s - 1.18x  (± 0.00) slower\n</code></pre></div>\n<p dir=\"auto\">The following benchmarks were collected to compare <code class=\"notranslate\">tag(\"turbo-frame\")</code><br>\n(an unknown custom HTML element) and <code class=\"notranslate\">tag.turbo_frame</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"❯ ruby bench.rb\nWarming up --------------------------------------\n         content_tag    56.152k i/100ms\n         tag_builder    49.207k i/100ms\nCalculating -------------------------------------\n         content_tag    561.134k (± 0.5%) i/s -      2.808M in   5.003567s\n         tag_builder    491.178k (± 0.3%) i/s -      2.460M in   5.009140s\n\nComparison:\n         content_tag:   561133.8 i/s\n         tag_builder:   491177.7 i/s - 1.14x  (± 0.00) slower\"><pre class=\"notranslate\"><code class=\"notranslate\">❯ ruby bench.rb\nWarming up --------------------------------------\n         content_tag    56.152k i/100ms\n         tag_builder    49.207k i/100ms\nCalculating -------------------------------------\n         content_tag    561.134k (± 0.5%) i/s -      2.808M in   5.003567s\n         tag_builder    491.178k (± 0.3%) i/s -      2.460M in   5.009140s\n\nComparison:\n         content_tag:   561133.8 i/s\n         tag_builder:   491177.7 i/s - 1.14x  (± 0.00) slower\n</code></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49390",
            "title": "Define `TagBuilder` methods for known HTML Elements",
            "date_modified": "2023-09-26T23:06:24.000Z",
            "date_published": "2023-09-26T16:31:32.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/688886?u=75c4028c534ed5024b1c9bbbe0144e4ea065a847&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This PR resolves pg_stat_statements churn for Postgres databases, as described on the forum: <a href=\"https://discuss.rubyonrails.org/t/83667\" rel=\"nofollow\">https://discuss.rubyonrails.org/t/83667</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Currently, array inclusion queries like <code class=\"notranslate\">where(id: [1,2])</code> generate the SQL <code class=\"notranslate\">id IN (1, 2)</code>. Each distinct array length gets normalized separately, resulting in a high number of duplicates in pg_stat_statements and causing churn as there is a limit on the number of queries tracked.</p>\n<p dir=\"auto\">This PR adds a patch for Postgres that generates <code class=\"notranslate\">id = any('{1,2}')</code>, which pg_stat_statements normalizes as a single query no matter the array length.</p>\n<p dir=\"auto\"><code class=\"notranslate\">NOT IN</code> is implemented using <code class=\"notranslate\">!= all()</code> <a href=\"https://stackoverflow.com/a/11730845\" rel=\"nofollow\">https://stackoverflow.com/a/11730845</a></p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This turns out to be a good deal faster (using Postgres 15.4). Here are the min and max iterations per second from several benchmark runs:</p>\n<ul dir=\"auto\">\n<li>490 - 600 on the main branch</li>\n<li>750 - 950 on this branch with <code class=\"notranslate\">BENCHMARK_PREPARED=1</code></li>\n<li>780 - 1020 on this branch with <code class=\"notranslate\">BENCHMARK_PREPARED=0</code></li>\n</ul>\n<details><summary>Here's the benchmark:</summary>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# Adapted from activerecord/examples/performance.rb\n\nrequire &quot;active_record&quot;\nrequire &quot;benchmark/ips&quot;\n\nTIME    = (ENV[&quot;BENCHMARK_TIME&quot;] || 20).to_i\nRECORDS = (ENV[&quot;BENCHMARK_RECORDS&quot;] || TIME * 1000).to_i\n\nconn = {\n  adapter: &quot;postgresql&quot;,\n  database: &quot;postgres&quot;,\n  prepared_statements: ENV[&quot;BENCHMARK_PREPARED&quot;] == &quot;1&quot;\n}\n\nActiveRecord::Base.establish_connection(conn)\n\nclass User &lt; ActiveRecord::Base\n  connection.create_table :users, force: true do |t|\n    t.string :name, :email\n    t.timestamps\n  end\nend\n\ndef progress_bar(int); print &quot;.&quot; if (int % 100).zero? ; end\n\nputs &quot;Generating data...&quot;\n\nmodule ActiveRecord\n  class Faker\n    LOREM = &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse non aliquet diam. Curabitur vel urna metus, quis malesuada elit.\n     Integer consequat tincidunt felis. Etiam non erat dolor. Vivamus imperdiet nibh sit amet diam eleifend id posuere diam malesuada. Mauris at accumsan sem.\n     Donec id lorem neque. Fusce erat lorem, ornare eu congue vitae, malesuada quis neque. Maecenas vel urna a velit pretium fermentum. Donec tortor enim,\n     tempor venenatis egestas a, tempor sed ipsum. Ut arcu justo, faucibus non imperdiet ac, interdum at diam. Pellentesque ipsum enim, venenatis ut iaculis vitae,\n     varius vitae sem. Sed rutrum quam ac elit euismod bibendum. Donec ultricies ultricies magna, at lacinia libero mollis aliquam. Sed ac arcu in tortor elementum\n     tincidunt vel interdum sem. Curabitur eget erat arcu. Praesent eget eros leo. Nam magna enim, sollicitudin vehicula scelerisque in, vulputate ut libero.\n     Praesent varius tincidunt commodo&quot;.split\n\n    def self.name\n      LOREM.grep(/^\\w*$/).sort_by { rand }.first(2).join &quot; &quot;\n    end\n\n    def self.email\n      LOREM.grep(/^\\w*$/).sort_by { rand }.first(2).join(&quot;@&quot;) + &quot;.com&quot;\n    end\n  end\nend\n\nbegin\n  puts &quot;Inserting #{RECORDS} users...&quot;\n  RECORDS.times do |record|\n    user = User.create(\n      created_at: Date.today,\n      name: ActiveRecord::Faker.name,\n      email: ActiveRecord::Faker.email\n    )\n    progress_bar(record)\n  end\n  puts &quot;Done!\\n&quot;\n\n  Benchmark.ips(TIME) do |x|\n    x.report &quot;Model.where(id: [...])&quot; do\n      User.where(id: (1..100).to_a).count\n    end\n  end\nensure\n  User.connection.drop_table :users\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># Adapted from activerecord/examples/performance.rb</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_record\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"benchmark/ips\"</span>\n\n<span class=\"pl-c1\">TIME</span>    <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"BENCHMARK_TIME\"</span><span class=\"pl-kos\">]</span> || <span class=\"pl-c1\">20</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_i</span>\n<span class=\"pl-c1\">RECORDS</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"BENCHMARK_RECORDS\"</span><span class=\"pl-kos\">]</span> || <span class=\"pl-c1\">TIME</span> * <span class=\"pl-c1\">1000</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_i</span>\n\n<span class=\"pl-s1\">conn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-pds\">adapter</span>: <span class=\"pl-s\">\"postgresql\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">database</span>: <span class=\"pl-s\">\"postgres\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">prepared_statements</span>: <span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"BENCHMARK_PREPARED\"</span><span class=\"pl-kos\">]</span> == <span class=\"pl-s\">\"1\"</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">establish_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">conn</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">User</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:users</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:email</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">timestamps</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">progress_bar</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">int</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span> <span class=\"pl-en\">print</span> <span class=\"pl-s\">\".\"</span> <span class=\"pl-k\">if</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">int</span> % <span class=\"pl-c1\">100</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">zero?</span> <span class=\"pl-kos\">;</span> <span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Generating data...\"</span>\n\n<span class=\"pl-k\">module</span> <span class=\"pl-v\">ActiveRecord</span>\n  <span class=\"pl-k\">class</span> <span class=\"pl-v\">Faker</span>\n    <span class=\"pl-c1\">LOREM</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse non aliquet diam. Curabitur vel urna metus, quis malesuada elit.</span>\n<span class=\"pl-s\">     Integer consequat tincidunt felis. Etiam non erat dolor. Vivamus imperdiet nibh sit amet diam eleifend id posuere diam malesuada. Mauris at accumsan sem.</span>\n<span class=\"pl-s\">     Donec id lorem neque. Fusce erat lorem, ornare eu congue vitae, malesuada quis neque. Maecenas vel urna a velit pretium fermentum. Donec tortor enim,</span>\n<span class=\"pl-s\">     tempor venenatis egestas a, tempor sed ipsum. Ut arcu justo, faucibus non imperdiet ac, interdum at diam. Pellentesque ipsum enim, venenatis ut iaculis vitae,</span>\n<span class=\"pl-s\">     varius vitae sem. Sed rutrum quam ac elit euismod bibendum. Donec ultricies ultricies magna, at lacinia libero mollis aliquam. Sed ac arcu in tortor elementum</span>\n<span class=\"pl-s\">     tincidunt vel interdum sem. Curabitur eget erat arcu. Praesent eget eros leo. Nam magna enim, sollicitudin vehicula scelerisque in, vulputate ut libero.</span>\n<span class=\"pl-s\">     Praesent varius tincidunt commodo\"</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">split</span>\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span>\n      <span class=\"pl-c1\">LOREM</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">grep</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/^<span class=\"pl-cce\">\\w</span>*$/</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">sort_by</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">rand</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">2</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span> <span class=\"pl-s\">\" \"</span>\n    <span class=\"pl-k\">end</span>\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">email</span>\n      <span class=\"pl-c1\">LOREM</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">grep</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/^<span class=\"pl-cce\">\\w</span>*$/</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">sort_by</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">rand</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">2</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"@\"</span><span class=\"pl-kos\">)</span> + <span class=\"pl-s\">\".com\"</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">begin</span>\n  <span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Inserting <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-c1\">RECORDS</span><span class=\"pl-kos\">}</span></span> users...\"</span>\n  <span class=\"pl-c1\">RECORDS</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">times</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">record</span>|\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create</span><span class=\"pl-kos\">(</span>\n      <span class=\"pl-pds\">created_at</span>: <span class=\"pl-v\">Date</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">today</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-pds\">name</span>: <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Faker</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-pds\">email</span>: <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Faker</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">email</span>\n    <span class=\"pl-kos\">)</span>\n    <span class=\"pl-en\">progress_bar</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">record</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Done!<span class=\"pl-cce\">\\n</span>\"</span>\n\n  <span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">TIME</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n    <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span> <span class=\"pl-s\">\"Model.where(id: [...])\"</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">id</span>: <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1</span>..<span class=\"pl-c1\">100</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_a</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">count</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">ensure</span>\n  <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">drop_table</span> <span class=\"pl-pds\">:users</span>\n<span class=\"pl-k\">end</span></pre></div>\n</details>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49388",
            "title": "Reduce pg_stat_statements churn using `= any()` instead of `IN ()`",
            "date_modified": "2023-09-27T04:11:11.000Z",
            "date_published": "2023-09-26T16:23:19.000Z",
            "author": {
                "name": "seanlinsley",
                "url": "https://github.com/seanlinsley"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/47848?u=41ccf0d1865a17f47d140f73a3293f1f3559fc0f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">It is not removing all the shards connections when we call it.</p>\n<p dir=\"auto\">It is because the first time we call it we are resetting the <code class=\"notranslate\">connection_specification_name</code> so the next call doesn't find the right connection pool.</p>",
            "url": "https://github.com/rails/rails/pull/49382",
            "title": "Add failing test for remove_connection",
            "date_modified": "2023-09-26T01:45:29.000Z",
            "date_published": "2023-09-26T00:16:29.000Z",
            "author": {
                "name": "rafaelfranca",
                "url": "https://github.com/rafaelfranca"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Ideally we should be able to checkout an Adapter instance without triggering a connection to the server.</p>\n<p dir=\"auto\">For some adapters like Trilogy that is the case today, but only if you have a schema cache loaded, otherwise <code class=\"notranslate\">check_version</code> will trigger a query.</p>\n<p dir=\"auto\">I think this check can be delayed to when we actually use the connection.</p>",
            "url": "https://github.com/rails/rails/pull/49378",
            "title": "Delay Adapter#check_version to #configure_connection",
            "date_modified": "2023-09-27T10:56:31.000Z",
            "date_published": "2023-09-25T13:47:30.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Follow-up to <a href=\"https://github.com/rails/rails/pull/49371\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49371/hovercard\">#49371</a></p>\n<p dir=\"auto\">In the wake of the deprecation of <code class=\"notranslate\">tag(:div)</code> in favor of <code class=\"notranslate\">tag.div</code>, this commit replaces all calls made internally with the more modern syntax.</p>\n<p dir=\"auto\">This change is separate from the deprecation cycle, since there are <strong>slight</strong> behavioral changes, since the HTML output changes from self-closing elements like <code class=\"notranslate\">&lt;input /&gt;</code> to open void elements like <code class=\"notranslate\">&lt;input&gt;</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49377",
            "title": "Action View: Remove internal calls to `tag` with positional arguments",
            "date_modified": "2023-09-26T16:33:30.000Z",
            "date_published": "2023-09-25T13:10:59.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5077225?u=e9f968c9eb790ee7734442f6b7998155400ad1d8&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">SQLite is a feature-rich database engine, and production usage is only growing. We need Rails' support to offer developers the range and scope of its features.</p>\n<p dir=\"auto\">The PostgreSQL adapter supports deferred foreign keys, and SQLite itself has support <a href=\"https://www.sqlite.org/foreignkeys.html#fk_deferred\" rel=\"nofollow\">deferred foreign keys</a> <a href=\"https://www.sqlite.org/releaselog/3_7_6.html\" rel=\"nofollow\">since at least 2011</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Implementing the full <code class=\"notranslate\">supports_deferrable_constraints?</code> contract allows foreign keys to be deferred by adding the <code class=\"notranslate\">:deferrable</code> key to the <code class=\"notranslate\">foreign_key</code> options in the <code class=\"notranslate\">add_reference</code> and <code class=\"notranslate\">add_foreign_key</code> methods.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"add_reference :person, :alias, foreign_key: { deferrable: :deferred }\nadd_reference :alias, :person, foreign_key: { deferrable: :deferred }\"><pre class=\"notranslate\"><span class=\"pl-en\">add_reference</span> <span class=\"pl-pds\">:person</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:alias</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">foreign_key</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">deferrable</span>: <span class=\"pl-pds\">:deferred</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-en\">add_reference</span> <span class=\"pl-pds\">:alias</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:person</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">foreign_key</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">deferrable</span>: <span class=\"pl-pds\">:deferred</span> <span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">In this PR, I am adding full support for the SQLite3Adapter by implementing:</p>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaCreation#visit_AddForeignKey</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaCreation#visit_ForeignKeyDefinition</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#supports_deferrable_constraints?</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaStatements#assert_valid_deferrable</code></p>\n<p dir=\"auto\">and altering:</p>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaStatements#add_foreign_key</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#foreign_keys</code></p>\n<h3 dir=\"auto\">Additional Info</h3>\n<p dir=\"auto\">In order to get the <code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#foreign_keys</code> method working properly, I had to add a query to get the <code class=\"notranslate\">CREATE TABLE</code> sql and parse which foreign key constraints are deferrable and which of those are deferred. In order to support this use-case, I extracted a <code class=\"notranslate\">table_structure_sql</code> method which now <code class=\"notranslate\">table_structure_with_collation</code> relies on.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49376",
            "title": "The SQLite3 adapter now implements the `supports_deferrable_constraints?` contract",
            "date_modified": "2023-09-27T05:42:18.000Z",
            "date_published": "2023-09-25T08:41:00.000Z",
            "author": {
                "name": "fractaledmind",
                "url": "https://github.com/fractaledmind"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/13130705?u=c91ddc42cdbe8620020f2935052801734da051cf&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Thanks to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"241752753\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/29742\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/29742/hovercard\" href=\"https://github.com/rails/rails/pull/29742\">#29742</a>, newly created Rails apps after Rails 5.2 don't have to deep dive into CSRF problems, and they don't require direct call of <code class=\"notranslate\">protect_from_forgery</code>. However, some projects sill have to consider the case where <code class=\"notranslate\">protect_from_forgery</code> should be called.</p>\n<p dir=\"auto\">Calling <code class=\"notranslate\">protect_from_forgery</code> without <code class=\"notranslate\">:with</code> option treats <code class=\"notranslate\">:with</code> as <code class=\"notranslate\">:null_session</code> by default, not <code class=\"notranslate\">:exception</code>, so I was a bit confused by the inconsistency between <code class=\"notranslate\">default_protect_from_forgery</code> and <code class=\"notranslate\">protect_from_forgery</code>. Maybe, changing the default <code class=\"notranslate\">:with</code> to <code class=\"notranslate\">:exception</code> will bring significant breaking changes, so I want to suggest adding a notice to the method.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li><del>[ ] Tests are added or updated if you fix a bug or add a feature.</del></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49374",
            "title": "Add notice to documentation for protect_from_forgery's :with option",
            "date_modified": "2023-09-25T23:56:00.000Z",
            "date_published": "2023-09-25T06:50:11.000Z",
            "author": {
                "name": "yykamei",
                "url": "https://github.com/yykamei"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h2 dir=\"auto\">The bulk of this diff is related to indentation changes, so it's best reviewed <a href=\"https://github.com/rails/rails/pull/49371/files?w=1\">ignoring spacing changes</a></h2>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Modern evolutions of the <code class=\"notranslate\">ActionView::Helpers::TagHelper#tag</code> method are intended to be called <em>on</em> the <code class=\"notranslate\">TagBuilder</code> instance itself instead of with positional arguments.</p>\n<p dir=\"auto\">For example, <code class=\"notranslate\">tag(\"div\")</code> would be called with <code class=\"notranslate\">tag.div</code>.</p>\n<p dir=\"auto\">According to the <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag-label-Legacy+syntax\" rel=\"nofollow\">Legacy Syntax</a> heading of the <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag\" rel=\"nofollow\">ActionView::Helpers::TagHelper#tag</a> guides:</p>\n<blockquote>\n<p dir=\"auto\">The following format is for legacy syntax support. It will be deprecated in future versions of Rails.</p>\n</blockquote>\n<p dir=\"auto\">Since deprecations must occur during releases, this commit proposes that 7.2 be the release to start the deprecation process so that a subsequent release can remove \"Legacy syntax\" support entirely.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit adds a deprecation warning to encourage callers to invoke the helper in the more modern style.</p>\n<p dir=\"auto\">Internally, Rails utilizes the positional argument syntax in several places. Since deprecations must be part of minor version releases, this commit wraps the internal invocations in <code class=\"notranslate\">ActionView.deprecator.silence</code> blocks so that they can remain while the deprecation is made public. This compromise buys the framework time to re-structure those invocations to be compatible with the more modern syntax before the next major release.</p>\n<p dir=\"auto\">There are several calls to <code class=\"notranslate\">tag</code> with positional arguments in the test suite. This commit wraps those as well. In the future, some of those tests will be able to remove those blocks, while other tests will be able to be removed entirely once that style of invocation is no longer supported.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49371",
            "title": "Deprecate `tag` with positional arguments",
            "date_modified": "2023-09-25T20:29:14.000Z",
            "date_published": "2023-09-25T00:50:17.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">TagBuilder</code> instance returned by the<br>\n<a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag\" rel=\"nofollow\">ActionView::Helpers::TagHelper#tag</a> method has the ability to build various HTML elements through its reliance on <code class=\"notranslate\">method_missing</code>. The magic of that instance hinges on the fact that it has a <strong>minimal</strong> public interface, and transforms missing methods names into HTML elements. For example, calling <code class=\"notranslate\">tag.div</code> invokes a missing <code class=\"notranslate\">#div</code> method, which renders a <code class=\"notranslate\">&lt;div&gt;</code> element.</p>\n<p dir=\"auto\">There are two exceptional cases:</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">tag.p</code> is defined, since the existing <a href=\"https://ruby-doc.org/3.2.2/Kernel.html#method-i-p\" rel=\"nofollow\">Kernel#p</a> definition would prevent the underlying <code class=\"notranslate\">#method_missing</code> invocation</li>\n<li><code class=\"notranslate\">tag.attributes</code> is a defined method to transform <code class=\"notranslate\">Hash</code> instances and keyword arguments in HTML attribute strings</li>\n</ul>\n<p dir=\"auto\">In addition to those two <em>intentional</em> exceptions, there are also several methods that are incidentally part of the public interface:</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">#tag_string</code></li>\n<li><code class=\"notranslate\">#content_tag_string</code></li>\n<li><code class=\"notranslate\">#tag_options</code></li>\n<li><code class=\"notranslate\">#boolean_tag_option</code></li>\n<li><code class=\"notranslate\">#tag_option</code></li>\n</ul>\n<p dir=\"auto\">Along with those methods, the class also includes <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/OutputSafetyHelper.html\" rel=\"nofollow\">OutputSafetyHelper</a> and <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/CaptureHelper.html\" rel=\"nofollow\">CaptureHelper</a>, which expand surface area of the class's public interface even further.</p>\n<p dir=\"auto\">While it's unlikely that these methods would collide with method invocations intended to construct HTML elements, they still impact that design of the object.</p>\n<p dir=\"auto\">The \"public\" nature of the <code class=\"notranslate\">TagBuilder</code> interface has some subtle nuances. While it <strong>is</strong> marked with <code class=\"notranslate\">:nodoc:</code>, instances are returned by a public <code class=\"notranslate\">tag</code> method, despite it being considered a private class only meant for internal consumption.</p>\n<p dir=\"auto\">That same is true for the incidentally public methods mentioned above: no consuming applications should be invoking <code class=\"notranslate\">#tag_string</code> or <code class=\"notranslate\">#tag_options</code>. While that's true, those methods <em>are</em> being invoked <strong>directly</strong> by other Action View classes.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit removes those invocations, and instead replaces them with public method calls.</p>\n<p dir=\"auto\">In cases where the tag name is statically know ahead of time, they're replaced with calls to that method (for example, <code class=\"notranslate\">tag(:option)</code> becomes <code class=\"notranslate\">tag.option</code>). When they're dynamic, they're replaced by calls to <a href=\"https://ruby-doc.org/3.2.2/Object.html#method-i-public_send\" rel=\"nofollow\">public_send</a> (for example, <code class=\"notranslate\">tag(name)</code> becomes<br>\n<code class=\"notranslate\">tag.public_send(name)</code>).</p>\n<p dir=\"auto\">The majority of these changes are painless, with one exception. Some calls to the <code class=\"notranslate\">#tag</code> helper also pass an <code class=\"notranslate\">open</code> positional argument that isn't part of the <code class=\"notranslate\">TagBuilder</code> class's public interface. As a result, that becomes slightly more complicated, and requires some String mutation to continue to pass the test suite.</p>\n<p dir=\"auto\">This commit also removes the <code class=\"notranslate\">OutputSafetyHelper</code> and <code class=\"notranslate\">CaptureHelper</code> modules from the class, and delegates to the methods it depended on to j<code class=\"notranslate\">@view_context</code>.</p>\n<p dir=\"auto\">Hopefully, calls to <code class=\"notranslate\">#tag</code> with positional arguments are less and less common, since the documentation describes it as a <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag-label-Legacy+syntax\" rel=\"nofollow\">Legacy Syntax</a> marked for deprecation in future versions of Rails.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49369",
            "title": "Action View: Reduce public API of `tag` helper",
            "date_modified": "2023-09-26T02:32:21.000Z",
            "date_published": "2023-09-24T21:36:45.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Since the <code class=\"notranslate\">ActionView::Helpers::TagBuilder</code> class is marked with <code class=\"notranslate\">:nodoc:</code>, the <code class=\"notranslate\">tag.attributes</code> method isn't directly discoverable by the <a href=\"https://api.rubyonrails.org\" rel=\"nofollow\">API Documentation</a>, despite it being mentioned under the <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag-label-Building+HTML+attributes\" rel=\"nofollow\">Building HTML Attributes</a> subheading of the <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag\" rel=\"nofollow\">tag</a> helper method documentation.</p>\n<p dir=\"auto\">Similarly, methods like <code class=\"notranslate\">tag.div</code> and <code class=\"notranslate\">tag.h1</code> are also not discoverable, since they're dependent on method missing.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit adds RubyDoc comments for <code class=\"notranslate\">tag.attributes</code> and <code class=\"notranslate\">tag.*</code> to provide hooks for the <a href=\"https://api.rubyonrails.org\" rel=\"nofollow\">API Documentation</a> to serve search results.</p>\n<p dir=\"auto\">The contents of the new comments is lifted directly from the longer-form <a href=\"https://api.rubyonrails.org/classes/ActionView/Helpers/TagHelper.html#method-i-tag\" rel=\"nofollow\">tag</a> helper method comment block.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49368",
            "title": "Action View: Document `tag.attributes` and `tag.$ELEMENT` [ci skip]",
            "date_modified": "2023-09-26T03:13:01.000Z",
            "date_published": "2023-09-24T21:19:34.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/25947043?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">actioncable-examples</code> repo referenced in the guide is no longer maintained: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1796796167\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/actioncable-examples/issues/46\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/actioncable-examples/pull/46/hovercard?comment_id=1647505744&amp;comment_type=issue_comment\" href=\"https://github.com/rails/actioncable-examples/pull/46#issuecomment-1647505744\">rails/actioncable-examples#46 (comment)</a>. We should remove it from the guide.</p>\n<p dir=\"auto\">I also took the opportunity to update the guide with new sections on importing JavaScript channel files, <code class=\"notranslate\">bin/rails generate channel</code>, and stopping streams.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the following:</p>\n<ul dir=\"auto\">\n<li>Remove unmaintained <code class=\"notranslate\">actioncable-examples</code> reference. For more info: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1796796167\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/actioncable-examples/issues/46\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/actioncable-examples/pull/46/hovercard?comment_id=1647505744&amp;comment_type=issue_comment\" href=\"https://github.com/rails/actioncable-examples/pull/46#issuecomment-1647505744\">rails/actioncable-examples#46 (comment)</a></li>\n<li>Add <code class=\"notranslate\">disconnect</code> and <code class=\"notranslate\">unsubscribed</code> methods to the example connection and channel files.</li>\n<li>Add reference for <code class=\"notranslate\">bin/rails generate channel</code></li>\n<li>Add guide on importing JavaScript channel files with import maps.</li>\n<li>Add section on stopping streams</li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The new sections are easily found in the API documentation. That said, I still think it's valuable to add them to the guide for new developers.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49365",
            "title": "Update Action Cable Overview guide",
            "date_modified": "2023-09-27T08:41:27.000Z",
            "date_published": "2023-09-24T04:07:09.000Z",
            "author": {
                "name": "julianfssen",
                "url": "https://github.com/julianfssen"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Previously, new apps would have a Ruby version set in both the Gemfile and the .ruby-version file. This duplication makes it more difficult to quickly change an application's ruby version as users must remember to update multiple files.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit updates the app generator's Gemfile to read the Ruby version from the .ruby-version file. Since this feature was introduced in the latest version of Bundler, it will only be enabled if a supported version of Bundler is used.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Alternatively, another solution mentioned on the original PR adding .ruby-version was that the .ruby-version file could be removed once rvm/rbenv support reading the Ruby version from the Gemfile. This has a downside that many other tools like chruby do not have plans to support reading a Ruby version from the Gemfile, and so users of those tools would have a worse experience if the .ruby-version file is removed.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49360",
            "title": "Use `ruby file: \".ruby-version\"` for new apps",
            "date_modified": "2023-09-24T07:34:16.000Z",
            "date_published": "2023-09-23T20:06:37.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1558372?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because I'd like to get the label of the fixture that created a record.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">When working with fixtures, it inserts records in the database at the beginning of the test suite. I like to validate those fixtures to avoid inserting invalid data for testing. In case of validation error, I need to find out which fixture created the failing record. For some models it's easy to go from one record  to the fixture that created it, for other models it can be more complicated, for example a join model with an id and foreign_keys.</p>\n<p dir=\"auto\">This PR introduces <code class=\"notranslate\">ActiveRecord::FixtureSet.label_of(record)</code> which will return the fixture label of the record if it was created by a fixture.</p>\n<p dir=\"auto\">I'd like to get feedback regarding this PR and could it be useful in the project ?<br>\nThis is working for records with primary_key.<br>\nComposite primary keys are not supported, should it be supported in this PR ?</p>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49348",
            "title": "Get fixture label from a record",
            "date_modified": "2023-09-21T23:43:41.000Z",
            "date_published": "2023-09-21T21:27:36.000Z",
            "author": {
                "name": "jean-francois-labbe",
                "url": "https://github.com/jean-francois-labbe"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5077225?u=e9f968c9eb790ee7734442f6b7998155400ad1d8&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">SQLite is a feature-rich database engine, and production usage is only growing. We need Rails' support to offer developers the range and scope of its features.</p>\n<p dir=\"auto\">Both the MySQL and PostgreSQL adapters support virtual columns, and SQLite itself has support generated columns <a href=\"https://www.sqlite.org/releaselog/3_31_0.html\" rel=\"nofollow\">since 2020</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"851659992\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/41856\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/41856/hovercard\" href=\"https://github.com/rails/rails/pull/41856\">#41856</a> introduced virtual columns to the PostgreSQLAdapter. This is effectively a clone of that feature, with some necessary tweaks.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"create_table :users do |t|\n  t.string :name\n  t.virtual :name_upper, type: :string, as: 'UPPER(name)'\n  t.virtual :name_lower, type: :string, as: 'LOWER(name)', stored: true\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:users</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:name</span>\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">virtual</span> <span class=\"pl-pds\">:name_upper</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">type</span>: <span class=\"pl-pds\">:string</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">as</span>: <span class=\"pl-s\">'UPPER(name)'</span>\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">virtual</span> <span class=\"pl-pds\">:name_lower</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">type</span>: <span class=\"pl-pds\">:string</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">as</span>: <span class=\"pl-s\">'LOWER(name)'</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">stored</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Firstly, SQLite supported both <code class=\"notranslate\">STORED</code> and <code class=\"notranslate\">VIRTUAL</code> generated columns, while PostgreSQL only supports <code class=\"notranslate\">VIRTUAL</code>. Secondly, SQLite doesn't support <code class=\"notranslate\">ALTER TABLE</code> commands with generated columns.</p>\n<p dir=\"auto\">In this PR, I am adding full support for the SQLite3Adapter by implementing:</p>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::Column#virtual?</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#supports_virtual_columns?</code></p>\n<p dir=\"auto\">and altering:</p>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaCreation#add_column_options</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaDefinitions#new_column_definition</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaDumper#prepare_column_options</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaStatements#new_column_from_field</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#table_structure</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#invalid_alter_table_type?</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#table_structure_with_collation</code></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49346",
            "title": "Add support for generated columns in SQLite3 adapter",
            "date_modified": "2023-09-27T05:41:11.000Z",
            "date_published": "2023-09-21T14:01:38.000Z",
            "author": {
                "name": "fractaledmind",
                "url": "https://github.com/fractaledmind"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/39735028?u=91330295c614cf3cec0b64bf242a14fc2ceb358f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because I want to have the ability to use <code class=\"notranslate\">ActiveSupport::ErrorReport#handle</code> to handle errors in production, but still have these errors be raised when encountered in test or development mode. Sometimes for un-expected / rare issues is better to handle it gracefully in production but I would still prefer to raise it in dev / test.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request introduces a <code class=\"notranslate\">production_only</code> flag to the <code class=\"notranslate\">ActiveSupport::ErrorReporter#handle</code> and <code class=\"notranslate\">#report</code> methods and <code class=\"notranslate\">production</code> attribute to <code class=\"notranslate\">ActiveSupport::ErrorReporter</code>. When this flag is <code class=\"notranslate\">true</code> errors will be raised in non-production environments instead of reported. The flag is <code class=\"notranslate\">false</code> by default to preserve existing behaviour.</p>\n<p dir=\"auto\">I added a <code class=\"notranslate\">production</code> attribute to <code class=\"notranslate\">ActiveSupport::ErrorReporter</code> instances to capture what environment we are in. It is <code class=\"notranslate\">true</code> by default.</p>\n<p dir=\"auto\">In <code class=\"notranslate\">Rails#error</code> I <code class=\"notranslate\">tap</code> the error handler and set the <code class=\"notranslate\">production</code> flag based on the Rails environment.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49339",
            "title": "Introduce :production_only flag for ActiveSupport::ErorrReporter#handle",
            "date_modified": "2023-09-21T19:19:42.000Z",
            "date_published": "2023-09-20T21:04:43.000Z",
            "author": {
                "name": "andrewn617",
                "url": "https://github.com/andrewn617"
            }
        }
    ]
}