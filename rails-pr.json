{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Reverts <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2119751080\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50978\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50978/hovercard\" href=\"https://github.com/rails/rails/pull/50978\">#50978</a></p>\n<p dir=\"auto\">5.22.2 was released to address this, hopefully. üôè</p>",
            "url": "https://github.com/rails/rails/pull/51011",
            "title": "Revert \"Pin minitest version to 5.21\"",
            "date_modified": "2024-02-08T12:02:42.000Z",
            "date_published": "2024-02-08T11:41:43.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/47484308?u=1d6070e1d8468e41afb88dfcbe3eb982b0a82114&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Currently, there is no (simple) way to ask a model if it connects to a single database or to multiple shards. Furthermore, without looping through a model's connections, I don't believe there's an easy way to return a list of shards a model can connect to.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit adds a <code class=\"notranslate\">@shard_keys</code> ivar that's set whenever <code class=\"notranslate\">.connects_to</code> is called. It sets the ivar to the result of <code class=\"notranslate\">shards.keys</code>. <code class=\"notranslate\">shards</code> in <code class=\"notranslate\">.connects_to</code> defaults to an empty hash and therefore when calling <code class=\"notranslate\">connects_to database: {...}</code> <code class=\"notranslate\">@shard_keys</code> will be set to an empty array.</p>\n<p dir=\"auto\"><code class=\"notranslate\">@shard_keys</code> is set <em>before</em> the following lines:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"if shards.empty?\n  shards[:default] = database\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">if</span> <span class=\"pl-en\">shards</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">empty?</span>\n  <span class=\"pl-en\">shards</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:default</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">database</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">This conditional sets the one and only shard (<code class=\"notranslate\">:default</code>) to the value of <code class=\"notranslate\">database</code> that we pass to <code class=\"notranslate\">.connects_to</code>. This allows for calling <code class=\"notranslate\">connected_to(shard: :default)</code> on models configured to only connect to a database e.g.:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class UnshardedBase &lt; ActiveRecord::Base\n  self.abstract_class = true\n\n  connects_to database: { writing: :primary }\nend\n\nclass UnshardedModel &lt; UnshardedBase\nend\n\nUnshardedBase.connected_to(shard: :default) { UnshardedBase.connection_pool.db_config.name } =&gt; primary\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">UnshardedBase</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">abstract_class</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n\n  <span class=\"pl-en\">connects_to</span> <span class=\"pl-pds\">database</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">writing</span>: <span class=\"pl-pds\">:primary</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">UnshardedModel</span> &lt; <span class=\"pl-v\">UnshardedBase</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">UnshardedBase</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connected_to</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">shard</span>: <span class=\"pl-pds\">:default</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> <span class=\"pl-v\">UnshardedBase</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection_pool</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">db_config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span> <span class=\"pl-kos\">}</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">primary</span></pre></div>\n<p dir=\"auto\">This is ultimately still an <em>unsharded</em> model which is why <code class=\"notranslate\">@shard_keys</code> gets set before the conditional.</p>\n<p dir=\"auto\">With the new <code class=\"notranslate\">@shard_keys</code> ivar we need a way for descendants of the abstract AR model to return that same value. For that we leverage the existing <code class=\"notranslate\">.connection_class_for_self</code> method. That method returns the ancestor of the model where <code class=\"notranslate\">.connects_to</code> was called, or returns self if it's the connection class:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class UnshardedBase &lt; ActiveRecord::Base\n  self.abstract_class = true\n\n  connects_to database: { writing: :primary }\nend\n\nclass UnshardedModel &lt; UnshardedBase\nend\n\nActiveRecord::Base.connection_class_for_self =&gt; ActiveRecord::Base\n\nUnshardedBase.connection_class_for_self =&gt; UnshardedBase(abstract)\n\nUnshardedModel.connection_class_for_self =&gt; UnshardedBase(abstract)\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">UnshardedBase</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">abstract_class</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n\n  <span class=\"pl-en\">connects_to</span> <span class=\"pl-pds\">database</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">writing</span>: <span class=\"pl-pds\">:primary</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">UnshardedModel</span> &lt; <span class=\"pl-v\">UnshardedBase</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection_class_for_self</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n\n<span class=\"pl-v\">UnshardedBase</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection_class_for_self</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">UnshardedBase</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">abstract</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-v\">UnshardedModel</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection_class_for_self</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">UnshardedBase</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">abstract</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">The new <code class=\"notranslate\">.shard_keys</code> method is a getter which returns the value of <code class=\"notranslate\">@shard_keys</code> from the connection class or it returns an empty array. The empty array is necessary in cases where <code class=\"notranslate\">connects_to</code> was never called.</p>\n<p dir=\"auto\">Finally, I've added an <code class=\"notranslate\">.on_all_shards</code> method which takes all of the arguments for <code class=\"notranslate\">.connected_to</code> except for <code class=\"notranslate\">shard</code>. Instead, it loops through every shard key and then delegates everything else to <code class=\"notranslate\">.connected_to</code>. I've used <code class=\"notranslate\">.map</code> instead of <code class=\"notranslate\">.each</code> so that we can collect the results of each block.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51009",
            "title": "Add `.shard_keys`, `.sharded?`, & `.on_all_shards` methods to AR Models",
            "date_modified": "2024-02-08T09:52:24.000Z",
            "date_published": "2024-02-08T08:50:30.000Z",
            "author": {
                "name": "HeyNonster",
                "url": "https://github.com/HeyNonster"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/91577?u=33435d1886c47d8579ecb440d872811acbe72a2a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Deprecate config.active_record.warn_on_records_fetched_greater_than setting in favor of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2102256404\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50887\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50887/hovercard\" href=\"https://github.com/rails/rails/pull/50887\">#50887</a>.</p>\n<p dir=\"auto\">The same functionality (and more) can now be achieved by subscribing to sql.active_record notifications:</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/91577/303223098-b6501bca-405c-417c-864d-b016b2db0abc.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDc0MjI3OTIsIm5iZiI6MTcwNzQyMjQ5MiwicGF0aCI6Ii85MTU3Ny8zMDMyMjMwOTgtYjY1MDFiY2EtNDA1Yy00MTdjLTg2NGQtYjAxNmIyZGIwYWJjLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAyMDglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMjA4VDIwMDEzMlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTllMmY1ZWNhZjc2YzNmZTZmMjdmNGY2ZTFjODhiNGY5NzQwY2ZhMzIzY2JhM2ZjZGU4NTFiNjkyNTlmNjRiYTkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.YThmBppq2646hvw79G4yi_qWwP3ong6swJpx-E_eU5o\"><img src=\"https://private-user-images.githubusercontent.com/91577/303223098-b6501bca-405c-417c-864d-b016b2db0abc.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDc0MjI3OTIsIm5iZiI6MTcwNzQyMjQ5MiwicGF0aCI6Ii85MTU3Ny8zMDMyMjMwOTgtYjY1MDFiY2EtNDA1Yy00MTdjLTg2NGQtYjAxNmIyZGIwYWJjLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAyMDglMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMjA4VDIwMDEzMlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTllMmY1ZWNhZjc2YzNmZTZmMjdmNGY2ZTFjODhiNGY5NzQwY2ZhMzIzY2JhM2ZjZGU4NTFiNjkyNTlmNjRiYTkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.YThmBppq2646hvw79G4yi_qWwP3ong6swJpx-E_eU5o\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51007",
            "title": "Deprecate config.active_record.warn_on_records_fetched_greater_than",
            "date_modified": "2024-02-08T05:34:29.000Z",
            "date_published": "2024-02-08T05:34:25.000Z",
            "author": {
                "name": "hundredwatt",
                "url": "https://github.com/hundredwatt"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5093358?u=05abbe3a0e4993c2af8ba14b1b1ecb21c8069ee5&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This is a refactor PR to change TestParser to parse using the prism parser if it is available instead of the ripper library.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Prism provides a simpler interface with consistent field names, so it should be easier to maintain going forward. It also has a guaranteed stable API, as opposed to ripper which can change between patch versions of Ruby. It also results in less code.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I benchmarked this change, and it appears to have no visible difference (it's within the margin of error). My benchmark script is below.</p>\n<details>\n<summary>Benchmark</summary>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire &quot;active_support/test_case&quot;\nrequire &quot;prism&quot;\nrequire &quot;ripper&quot;\nrequire &quot;benchmark/ips&quot;\n\nclass PrismParser\n  def self.definition_for(method)\n    filepath, start_line = method.source_location\n    queue = [Prism.parse_file(filepath).value]\n\n    while (node = queue.shift)\n      case node.type\n      when :def_node\n        if node.name.start_with?(&quot;test&quot;) &amp;&amp; node.location.start_line == start_line\n          return [filepath, start_line..node.location.end_line]\n        end\n      when :call_node\n        if node.name == :test &amp;&amp; node.location.start_line == start_line\n          return [filepath, start_line..node.location.end_line]\n        end\n      end\n\n      queue.concat(node.compact_child_nodes)\n    end\n\n    nil\n  end\nend\n\nclass RipperParser &lt; Ripper\n  def self.definition_for(method_obj)\n    path, begin_line = method_obj.source_location\n    begins_to_ends = new(File.read(path), path).parse\n    return unless end_line = begins_to_ends[begin_line]\n    [path, (begin_line..end_line)]\n  end\n\n  def initialize(*)\n    # A hash mapping the 1-indexed line numbers that tests start on to where they end.\n    @begins_to_ends = {}\n    super\n  end\n\n  def parse\n    super\n    @begins_to_ends\n  end\n\n  def on_def(begin_line, *)\n    @begins_to_ends[begin_line] = lineno\n  end\n\n  def on_method_add_block(begin_line, end_line)\n    if begin_line &amp;&amp; end_line\n      @begins_to_ends[begin_line] = end_line\n    end\n  end\n\n  def on_command_call(*, begin_lineno, _args)\n    begin_lineno\n  end\n\n  def first_arg(arg, *)\n    arg\n  end\n\n  def just_lineno(*)\n    lineno\n  end\n\n  alias on_method_add_arg first_arg\n  alias on_command first_arg\n  alias on_stmts_add first_arg\n  alias on_arg_paren first_arg\n  alias on_bodystmt first_arg\n\n  alias on_ident just_lineno\n  alias on_do_block just_lineno\n  alias on_stmts_new just_lineno\n  alias on_brace_block just_lineno\n\n  def on_args_new\n    []\n  end\n\n  def on_args_add(parts, part)\n    parts &lt;&lt; part\n  end\n\n  def on_args_add_block(args, *rest)\n    args.first\n  end\nend\n\nclass ExampleTest &lt; ActiveSupport::TestCase\n  def test_method\n    assert true\n\n\n  end\n\n  def test_oneline; assert true; end\n\n  test &quot;declarative&quot; do\n    assert true\n  end\n\n  test(&quot;declarative w/parens&quot;) do\n    assert true\n\n  end\n\n  self.test &quot;declarative explicit receiver&quot; do\n    assert true\n  end\n\n  test(&quot;declarative oneline&quot;) { assert true }\n\n  test(&quot;declarative oneline do&quot;) do assert true end\n\n  test(&quot;declarative multiline w/ braces&quot;) {\n    assert true\n    refute false\n  }\nend\n\nmethods = ExampleTest.instance_methods.grep(/^test_/).map { |method| ExampleTest.instance_method(method) }\n\nBenchmark.ips do |x|\n  x.report(&quot;Prism&quot;) { methods.each { |method| PrismParser.definition_for(method) } }\n  x.report(&quot;Ripper&quot;) { methods.each { |method| RipperParser.definition_for(method) } }\n  x.compare!\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/test_case\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"prism\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"ripper\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"benchmark/ips\"</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">PrismParser</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">definition_for</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">method</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">filepath</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">start_line</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">method</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">source_location</span>\n    <span class=\"pl-s1\">queue</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-v\">Prism</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">parse_file</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">filepath</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">value</span><span class=\"pl-kos\">]</span>\n\n    <span class=\"pl-k\">while</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">node</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">queue</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">shift</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-k\">case</span> <span class=\"pl-s1\">node</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">type</span>\n      <span class=\"pl-k\">when</span> <span class=\"pl-pds\">:def_node</span>\n        <span class=\"pl-k\">if</span> <span class=\"pl-s1\">node</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">start_with?</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"test\"</span><span class=\"pl-kos\">)</span> &amp;&amp; <span class=\"pl-s1\">node</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">location</span><span class=\"pl-kos\">.</span><span class=\"pl-s1\">start_line</span> == <span class=\"pl-s1\">start_line</span>\n          <span class=\"pl-k\">return</span> <span class=\"pl-kos\">[</span><span class=\"pl-s1\">filepath</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">start_line</span>..<span class=\"pl-s1\">node</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">location</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">end_line</span><span class=\"pl-kos\">]</span>\n        <span class=\"pl-k\">end</span>\n      <span class=\"pl-k\">when</span> <span class=\"pl-pds\">:call_node</span>\n        <span class=\"pl-k\">if</span> <span class=\"pl-s1\">node</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span> == <span class=\"pl-pds\">:test</span> &amp;&amp; <span class=\"pl-s1\">node</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">location</span><span class=\"pl-kos\">.</span><span class=\"pl-s1\">start_line</span> == <span class=\"pl-s1\">start_line</span>\n          <span class=\"pl-k\">return</span> <span class=\"pl-kos\">[</span><span class=\"pl-s1\">filepath</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">start_line</span>..<span class=\"pl-s1\">node</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">location</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">end_line</span><span class=\"pl-kos\">]</span>\n        <span class=\"pl-k\">end</span>\n      <span class=\"pl-k\">end</span>\n\n      <span class=\"pl-s1\">queue</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">concat</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">node</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">compact_child_nodes</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-k\">end</span>\n\n    <span class=\"pl-c1\">nil</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">RipperParser</span> &lt; <span class=\"pl-v\">Ripper</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">definition_for</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">method_obj</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">path</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">begin_line</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">method_obj</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">source_location</span>\n    <span class=\"pl-s1\">begins_to_ends</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">File</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">read</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">path</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">path</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">parse</span>\n    <span class=\"pl-k\">return</span> <span class=\"pl-k\">unless</span> <span class=\"pl-s1\">end_line</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">begins_to_ends</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">begin_line</span><span class=\"pl-kos\">]</span>\n    <span class=\"pl-kos\">[</span><span class=\"pl-s1\">path</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">begin_line</span>..<span class=\"pl-s1\">end_line</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">]</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">initialize</span><span class=\"pl-kos\">(</span>*<span class=\"pl-kos\">)</span>\n    <span class=\"pl-c\"># A hash mapping the 1-indexed line numbers that tests start on to where they end.</span>\n    <span class=\"pl-c1\">@begins_to_ends</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">{</span><span class=\"pl-kos\">}</span>\n    <span class=\"pl-smi\">super</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">parse</span>\n    <span class=\"pl-smi\">super</span>\n    <span class=\"pl-c1\">@begins_to_ends</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">on_def</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">begin_line</span><span class=\"pl-kos\">,</span> *<span class=\"pl-kos\">)</span>\n    <span class=\"pl-c1\">@begins_to_ends</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">begin_line</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">lineno</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">on_method_add_block</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">begin_line</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">end_line</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-k\">if</span> <span class=\"pl-s1\">begin_line</span> &amp;&amp; <span class=\"pl-s1\">end_line</span>\n      <span class=\"pl-c1\">@begins_to_ends</span><span class=\"pl-kos\">[</span><span class=\"pl-s1\">begin_line</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">end_line</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">on_command_call</span><span class=\"pl-kos\">(</span>*<span class=\"pl-kos\">,</span> <span class=\"pl-s1\">begin_lineno</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">_args</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">begin_lineno</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">first_arg</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">arg</span><span class=\"pl-kos\">,</span> *<span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">arg</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">just_lineno</span><span class=\"pl-kos\">(</span>*<span class=\"pl-kos\">)</span>\n    <span class=\"pl-en\">lineno</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">alias</span> <span class=\"pl-en\">on_method_add_arg</span> <span class=\"pl-en\">first_arg</span>\n  <span class=\"pl-k\">alias</span> <span class=\"pl-en\">on_command</span> <span class=\"pl-en\">first_arg</span>\n  <span class=\"pl-k\">alias</span> <span class=\"pl-en\">on_stmts_add</span> <span class=\"pl-en\">first_arg</span>\n  <span class=\"pl-k\">alias</span> <span class=\"pl-en\">on_arg_paren</span> <span class=\"pl-en\">first_arg</span>\n  <span class=\"pl-k\">alias</span> <span class=\"pl-en\">on_bodystmt</span> <span class=\"pl-en\">first_arg</span>\n\n  <span class=\"pl-k\">alias</span> <span class=\"pl-en\">on_ident</span> <span class=\"pl-en\">just_lineno</span>\n  <span class=\"pl-k\">alias</span> <span class=\"pl-en\">on_do_block</span> <span class=\"pl-en\">just_lineno</span>\n  <span class=\"pl-k\">alias</span> <span class=\"pl-en\">on_stmts_new</span> <span class=\"pl-en\">just_lineno</span>\n  <span class=\"pl-k\">alias</span> <span class=\"pl-en\">on_brace_block</span> <span class=\"pl-en\">just_lineno</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">on_args_new</span>\n    <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">on_args_add</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">parts</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">part</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">parts</span> &lt;&lt; <span class=\"pl-s1\">part</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">on_args_add_block</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">args</span><span class=\"pl-kos\">,</span> *<span class=\"pl-s1\">rest</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">args</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">ExampleTest</span> &lt; <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">TestCase</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_method</span>\n    <span class=\"pl-en\">assert</span> <span class=\"pl-c1\">true</span>\n\n\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_oneline</span><span class=\"pl-kos\">;</span> <span class=\"pl-en\">assert</span> <span class=\"pl-c1\">true</span><span class=\"pl-kos\">;</span> <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-en\">test</span> <span class=\"pl-s\">\"declarative\"</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-en\">assert</span> <span class=\"pl-c1\">true</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-en\">test</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"declarative w/parens\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-en\">assert</span> <span class=\"pl-c1\">true</span>\n\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">test</span> <span class=\"pl-s\">\"declarative explicit receiver\"</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-en\">assert</span> <span class=\"pl-c1\">true</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-en\">test</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"declarative oneline\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">assert</span> <span class=\"pl-c1\">true</span> <span class=\"pl-kos\">}</span>\n\n  <span class=\"pl-en\">test</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"declarative oneline do\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span> <span class=\"pl-en\">assert</span> <span class=\"pl-c1\">true</span> <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-en\">test</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"declarative multiline w/ braces\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span>\n    <span class=\"pl-en\">assert</span> <span class=\"pl-c1\">true</span>\n    <span class=\"pl-en\">refute</span> <span class=\"pl-c1\">false</span>\n  <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">methods</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ExampleTest</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">instance_methods</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">grep</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/^test_/</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">map</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">method</span>| <span class=\"pl-v\">ExampleTest</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">instance_method</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">method</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n\n<span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"Prism\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">methods</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">method</span>| <span class=\"pl-v\">PrismParser</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">definition_for</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">method</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"Ripper\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">methods</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">method</span>| <span class=\"pl-v\">RipperParser</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">definition_for</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">method</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">compare!</span>\n<span class=\"pl-k\">end</span></pre></div>\n</details>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51006",
            "title": "Parse tests with prism",
            "date_modified": "2024-02-08T14:09:35.000Z",
            "date_published": "2024-02-08T04:50:36.000Z",
            "author": {
                "name": "kddnewton",
                "url": "https://github.com/kddnewton"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">For example, if you run <code class=\"notranslate\">rails test test/models/usr_tsst.rb</code> and the file does not exist, Rails will suggest <code class=\"notranslate\">test/models/users_test.rb</code> as a possible file.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Could not load test file: test/models/usr_tsst.rb. Did you mean? test/models/user_test.rb\"><pre class=\"notranslate\"><code class=\"notranslate\">Could not load test file: test/models/usr_tsst.rb. Did you mean? test/models/user_test.rb\n</code></pre></div>\n<p dir=\"auto\">After investigating <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2119751080\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50978\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50978/hovercard\" href=\"https://github.com/rails/rails/pull/50978\">#50978</a>, I was inspired to add this feature to Rails.</p>\n<p dir=\"auto\">Credit to <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/tenderlove/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tenderlove\">@tenderlove</a> for the minitest implementation.</p>",
            "url": "https://github.com/rails/rails/pull/51005",
            "title": "Rails test command suggests similar test files when the given file is not found",
            "date_modified": "2024-02-08T00:59:02.000Z",
            "date_published": "2024-02-08T00:58:58.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1966473?u=fe117732163d3610f051fca80df4e04c1b91335d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h2 dir=\"auto\">Overview</h2>\n<p dir=\"auto\">Add documentation related to <code class=\"notranslate\">perform_all_later</code> for bulk enqueuing jobs.</p>\n<h2 dir=\"auto\">Testing</h2>\n<p dir=\"auto\">Tested the new method in-app using sidekiq locally. Also tested documentation by running <code class=\"notranslate\">guides:generate</code>, <code class=\"notranslate\">guides:validate</code> and <code class=\"notranslate\">guides:lint</code> locally.</p>",
            "url": "https://github.com/rails/rails/pull/51004",
            "title": "[RF DOCS] Add documentation for `perform_all_later` to Active Job Basics guide [ci-skip]",
            "date_modified": "2024-02-08T16:48:18.000Z",
            "date_published": "2024-02-07T19:27:15.000Z",
            "author": {
                "name": "bhumi1102",
                "url": "https://github.com/bhumi1102"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Ref: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2088694143\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50793\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50793/hovercard\" href=\"https://github.com/rails/rails/pull/50793\">#50793</a></p>\n<p dir=\"auto\">Transactional fixtures are currently tightly coupled with the pool active connection. It assumes calling <code class=\"notranslate\">pool.connection</code> will memoize the checked out connection and leverage that to start a transaction on it and ensure all subsequent accesses will get the same connection.</p>\n<p dir=\"auto\">To allow to remove checkout caching (or make it optional), we first must decouple transactional fixtures to not rely on it.</p>\n<p dir=\"auto\">The idea is to behave similarly, but store the connection in the pool as a special \"pinned\" connection, and not as the regular active connection.</p>\n<p dir=\"auto\">This allows to always return the same pinned connection, but without necessarily assigning it as the active connection.</p>\n<p dir=\"auto\">FYI <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a></p>",
            "url": "https://github.com/rails/rails/pull/50999",
            "title": "Decouple transactional fixtures and active connections",
            "date_modified": "2024-02-08T16:24:54.000Z",
            "date_published": "2024-02-07T11:51:30.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Apply <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2118334223\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50967\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50967/hovercard\" href=\"https://github.com/rails/rails/pull/50967\">#50967</a> to 7-1-stable, to simplify the tests for metadata and corrects the test configuration path with improvements to the readability.</p>\n<p dir=\"auto\">This change improves upon <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2087434730\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50787\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50787/hovercard\" href=\"https://github.com/rails/rails/pull/50787\">#50787</a> in that it removes the need to stringify or symbolize any keys, since we are comparing the metadata with string keys. This is a follow up to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1061833902\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/43705\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/43705/hovercard\" href=\"https://github.com/rails/rails/pull/43705\">#43705</a>.</p>\n<p dir=\"auto\">Sorry this took me 2 PRs! üôá</p>",
            "url": "https://github.com/rails/rails/pull/50995",
            "title": "[7-1-stable] Fix Active Storage test configurations for CI",
            "date_modified": "2024-02-07T11:18:44.000Z",
            "date_published": "2024-02-07T11:18:40.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1418177?u=dc49ad1adab8df31f34121febc5fc8808beda02f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">At the moment, Rails::Rack::Logger tags the logger (if it's <code class=\"notranslate\">ActiveSupport::TaggedLogging</code>) for the duration of the <code class=\"notranslate\">@app.call</code>, but only fires the request.action_dispatch event later, on body close. That means anything logged in <code class=\"notranslate\">request.action_dispatch</code> handlers won't have the same tags as the rest of the request.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Fix this by deferring the popping of tags into <code class=\"notranslate\">finish_request_instrumentation</code>, in the same way that finishing the instrumentation handle is deferred.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">There didn't seem to be any test case related to request log taggers, so I added one. Also, I don't know if this is important enough for a changelog entry, but it seemed harmless enough to add a one-liner in there.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50992",
            "title": "Don't pop logger tags in Rails::Rack::Logger until request is finished",
            "date_modified": "2024-02-07T03:21:14.000Z",
            "date_published": "2024-02-07T03:12:30.000Z",
            "author": {
                "name": "KJTsanaktsidis",
                "url": "https://github.com/KJTsanaktsidis"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54458?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This PR implements the minimum connection pool size idea described in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2121725445\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50989\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50989/hovercard\" href=\"https://github.com/rails/rails/issues/50989\">#50989</a>.</p>\n<p dir=\"auto\">The primary motivation with this is to ensure that we always have at least <em>N</em> connections established to the DB so that we don't need to spend time connecting to the DB during the handling of a request.</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #50989.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2121725445\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50989\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50989/hovercard\" href=\"https://github.com/rails/rails/issues/50989\">#50989</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">In <code class=\"notranslate\">ConnectionPool</code>, rename <code class=\"notranslate\">:size</code> to <code class=\"notranslate\">:max_size</code>, and add <code class=\"notranslate\">:min_size</code> as a configuration option. <code class=\"notranslate\">:min_size</code> is initialized from <code class=\"notranslate\">db_config.min_size</code>, where I've also added a new configuration option.</p>\n<p dir=\"auto\"><code class=\"notranslate\">ConnectionPool#initialize</code> calls a new method, <code class=\"notranslate\">ensure_minimum_connections</code> when <code class=\"notranslate\">min_size</code> is &gt; 0.</p>\n<p dir=\"auto\">In <code class=\"notranslate\">ConnectionPool#flush</code>, we need to pay attention to the minimum pool size, and make sure that we don't close too many connections.</p>\n<p dir=\"auto\">Finally, <code class=\"notranslate\">ConnectionPool::Reaper</code> also calls into <code class=\"notranslate\">ensure_minimum_connections</code> after reaping/flushing to ensure that we always have the desired number of established connections active.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50990",
            "title": "Add minimum size to connection pool",
            "date_modified": "2024-02-06T22:13:46.000Z",
            "date_published": "2024-02-06T22:01:44.000Z",
            "author": {
                "name": "catlee",
                "url": "https://github.com/catlee"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Enums have historically been defined using keyword arguments:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Function &gt; ApplicationRecord\n  enum color: [:red, :blue],\n       type: [:instance, :class],\n       _scopes: false\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Function</span> &gt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">enum</span> <span class=\"pl-pds\">color</span>: <span class=\"pl-kos\">[</span><span class=\"pl-pds\">:red</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:blue</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span>\n       <span class=\"pl-pds\">type</span>: <span class=\"pl-kos\">[</span><span class=\"pl-pds\">:instance</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:class</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span>\n       <span class=\"pl-pds\">_scopes</span>: <span class=\"pl-c1\">false</span></pre></div>\n<p dir=\"auto\">This has the advantage of being able to define multiple enums at once with the same options. However, it also has a downside that enum options must be prefixed with an underscore to separate them from the enum definitions (to enable models to have enums with the same name as an option).</p>\n<p dir=\"auto\">In Rails 7, a new syntax was <a href=\"https://github.com/rails/rails/commit/0618d2d84a501aea93c898aec504ff9a0e09d6f2\">introduced</a> to instead define enums with positional arguments:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Function &gt; ApplicationRecord\n  enum :color, [:red, :blue], scopes: false\n  enum :type, [:instance, :class], scopes: false\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Function</span> &gt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">enum</span> <span class=\"pl-pds\">:color</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">[</span><span class=\"pl-pds\">:red</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:blue</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">scopes</span>: <span class=\"pl-c1\">false</span>\n  <span class=\"pl-en\">enum</span> <span class=\"pl-pds\">:type</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">[</span><span class=\"pl-pds\">:instance</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:class</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">scopes</span>: <span class=\"pl-c1\">false</span></pre></div>\n<p dir=\"auto\">This new syntax eliminates the need to prefix options with an underscore, and the docs were updated to recommend this new syntax.</p>\n<p dir=\"auto\">However, both versions of the API have been supported since, and it has started to cause some problems:</p>\n<p dir=\"auto\">The first issue is that the available options have drifted. In Rails 7.1, an option was added to make assigning an invalid enum value use validation errors instead of runtime errors. However, the equivalent underscored prefix option was not added for the original enum syntax</p>\n<p dir=\"auto\">Articles have been created that describe the new option in Rails 7.1, but the examples in the articles use un-prefixed options with the old syntax. This confusion has also lead to issues opened asking why that incorrect syntax is not working.</p>\n<p dir=\"auto\">Additionally, the presence of underscored options is just generally confusing because it tends to imply an option is for internal use.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit aims to fix all of these issues by deprecating the old enum syntax. With only one way to define enums, options cannot drift and there will be less confusion around how enums should be defined.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #50333.\">Closes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2036946693\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50333\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50333/hovercard\" href=\"https://github.com/rails/rails/pull/50333\">#50333</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50987",
            "title": "Deprecate defining enums with keywords args",
            "date_modified": "2024-02-06T19:55:09.000Z",
            "date_published": "2024-02-06T17:52:31.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #50968.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2118566194\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50968\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50968/hovercard\" href=\"https://github.com/rails/rails/issues/50968\">#50968</a>.</p>",
            "url": "https://github.com/rails/rails/pull/50983",
            "title": "Fix counter caches to work for models with composite primary keys",
            "date_modified": "2024-02-08T17:39:30.000Z",
            "date_published": "2024-02-06T13:35:09.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1516722?u=58b7d69a8f28602ae667ee377a3cbed251cebd3a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This PR aims to make Action Cable more flexible and extensible as a library/framework by separating low-level, implementation specific details (e.g., handling WebSockets, dealing with concurrency) from abstractions (Connection, Channel classes). That would make it possible to use user-level Action Cable code with alternative web servers or execution models (e.g., Fibers) without rewriting it or monkey-patching internals.</p>\n<div class=\"markdown-alert markdown-alert-tip\" dir=\"auto\"><p class=\"markdown-alert-title\" dir=\"auto\"><svg class=\"octicon octicon-light-bulb mr-2\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"M8 1.5c-2.363 0-4 1.69-4 3.75 0 .984.424 1.625.984 2.304l.214.253c.223.264.47.556.673.848.284.411.537.896.621 1.49a.75.75 0 0 1-1.484.211c-.04-.282-.163-.547-.37-.847a8.456 8.456 0 0 0-.542-.68c-.084-.1-.173-.205-.268-.32C3.201 7.75 2.5 6.766 2.5 5.25 2.5 2.31 4.863 0 8 0s5.5 2.31 5.5 5.25c0 1.516-.701 2.5-1.328 3.259-.095.115-.184.22-.268.319-.207.245-.383.453-.541.681-.208.3-.33.565-.37.847a.751.751 0 0 1-1.485-.212c.084-.593.337-1.078.621-1.489.203-.292.45-.584.673-.848.075-.088.147-.173.213-.253.561-.679.985-1.32.985-2.304 0-2.06-1.637-3.75-4-3.75ZM5.75 12h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM6 15.25a.75.75 0 0 1 .75-.75h2.5a.75.75 0 0 1 0 1.5h-2.5a.75.75 0 0 1-.75-.75Z\"></path></svg>Tip</p><p dir=\"auto\">You can find a more detailed description of the problem, motivation and potential benefits of such refactoring in <a href=\"https://docs.google.com/document/d/1oGf86NAzQL9sDw6rTfUNSe3mzzg7wX64sc34D-_3EDI/edit#heading=h.d3db1fd03ano\" rel=\"nofollow\">this document</a>.</p>\n</div>\n<div class=\"markdown-alert markdown-alert-note\" dir=\"auto\"><p class=\"markdown-alert-title\" dir=\"auto\"><svg class=\"octicon octicon-info mr-2\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z\"></path></svg>Note</p><p dir=\"auto\">This PR does not introduce any new features or public API breaking changes. It doesn't affect the existing functionality of built-in Action Cable server.</p>\n</div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">The changes are grouped into commits to reflect the following major changes.</p>\n<ol dir=\"auto\">\n<li><strong>Reorganizing threaded executors</strong>.</li>\n</ol>\n<p dir=\"auto\">Action Cable relies on two threaded executors right now: one to perform user-space code (Worker) and another one to perform internal async operations around pub/sub. The latter was for some (historical?) reason hidden within the <code class=\"notranslate\">StreamEventLoop</code> class that implements and IO loop to perform read/write operations on sockets. I've extracted the executor and promoted it into a server attribute independent of IO event loop. The main motivation of this extraction is not only in enforcing SoC but to separate WebSocket-specific code from more generic async executor used throughout the codebase.</p>\n<p dir=\"auto\">I've also wrapped the Concurrent Ruby threaded executor into a custom class with a minimal interface (<code class=\"notranslate\">#post</code>, <code class=\"notranslate\">#timer</code> and <code class=\"notranslate\">#shutdown</code> methods), so it will be possible to configure a custom executor for a server in the future (one use-case we have in mind is using a Fiber-based executor instead of a Thread-based one).</p>\n<p dir=\"auto\">Note that this PR doesn't include any configuration-related code (e.g., to support smth like <code class=\"notranslate\">config.action_cable.async_executor = :fiber</code>) but I'm considering adding something like that in the follow-up PRs.</p>\n<ol start=\"2\" dir=\"auto\">\n<li><strong>Limiting the scope of async operations</strong>.</li>\n</ol>\n<p dir=\"auto\">This step is the follow-up to the async executor extraction. We have a few places in the Channel internals which directly refer to the <code class=\"notranslate\">event_loop</code> but they're all related to pub/sub operations. So, to avoid unnecessary async operations at the abstraction level, I moved all it to the pub/sub layer by and standardized it across adapters by using a <code class=\"notranslate\">SubscriberMap::Async</code> subclass.</p>\n<p dir=\"auto\">Previously, we might have double async calls when performing <code class=\"notranslate\">#stream_from</code> (one from the channel and one from the pub/sub adapter); now it's up to the adapter whether to create subscriptions asynchronously or not. We shouldn't duplicate this logic.</p>\n<ol start=\"3\" dir=\"auto\">\n<li><strong>Splitting ActionCable::Connection::Base into ActionCable::Connection::Base and ActionCable::Server::Connection</strong></li>\n</ol>\n<p dir=\"auto\">Today, the Connection class knows about everything from performing user code to setting up WebSocket event listeners to dealing with Rails executor wrapping. That prevents from reusing this class in environments when we don't need to deal with all of these (non-WebSocket servers or unit tests, more about them below).</p>\n<p dir=\"auto\">This change is mostly code reorganization and minor tests updates (e.g., we no longer need to always use <code class=\"notranslate\">run_in_eventmachine</code>, because now we deal with pure Ruby classes).</p>\n<p dir=\"auto\">So, now we have two types of connections: low-level Server::Connection and application-level Connection::Base. The <em>communicate</em> with each other via the following interfaces:</p>\n<section class=\"js-render-needs-enrichment render-needs-enrichment position-relative\" data-identity=\"db37ee6f-ae78-401d-b508-9a57b859f948\" data-host=\"https://viewscreen.githubusercontent.com\" data-src=\"https://viewscreen.githubusercontent.com/markdown/mermaid?docs_host=https%3A%2F%2Fdocs.github.com\" data-type=\"mermaid\" aria-label=\"mermaid rendered output container\">\n  <div class=\"js-render-enrichment-target\" data-json=\"{&quot;data&quot;:&quot;classDiagram\\n  class _PubSub {\\n    subscribe: (channel, handler, callback) -&amp;gt; void\\n    unsubscribe: (channel, handler) -&amp;gt; void\\n  }\\n  \\n  class _Executor {\\n    post: (&amp;amp;block) -&amp;gt; void\\n    timer: (interval, &amp;amp;block) -&amp;gt; handle\\n  }\\n  \\n  class _Server {\\n    pubsub: _PubSub\\n    executor: _Executor\\n    config: Configuration \\n  }\\n  \\n  class _ServerConn {\\n    logger: Logger\\n    env: Hash[String, untyped]\\n    request: Request\\n    protocol: String\\n    initialize: (_Server, env) -&amp;gt; void\\n    transmit: (untyped) -&amp;gt; void\\n    close: () -&amp;gt; void\\n    perform_work: (untyped receiver, method_name Symbol, *untyped args) -&amp;gt; void\\n  }\\n  \\n  class _Connection {\\n    initialize: (_Server, _ServerConn) -&amp;gt; void\\n    handle_open: () -&amp;gt; void\\n    handle_incoming: (payload) -&amp;gt; void\\n    handle_close: () -&amp;gt; void\\n    beat: () -&amp;gt; void\\n    statistics: () -&amp;gt; Hash[Symbol, untyped]\\n  }\\n  \\n  _Server --&amp;gt; _PubSub\\n  _Server --&amp;gt; _Executor\\n  _Connection --&amp;gt; _ServerConn\\n  _Connection --&amp;gt; _Server\\n&quot;}\" data-plain=\"classDiagram\n  class _PubSub {\n    subscribe: (channel, handler, callback) -&gt; void\n    unsubscribe: (channel, handler) -&gt; void\n  }\n  \n  class _Executor {\n    post: (&amp;block) -&gt; void\n    timer: (interval, &amp;block) -&gt; handle\n  }\n  \n  class _Server {\n    pubsub: _PubSub\n    executor: _Executor\n    config: Configuration \n  }\n  \n  class _ServerConn {\n    logger: Logger\n    env: Hash[String, untyped]\n    request: Request\n    protocol: String\n    initialize: (_Server, env) -&gt; void\n    transmit: (untyped) -&gt; void\n    close: () -&gt; void\n    perform_work: (untyped receiver, method_name Symbol, *untyped args) -&gt; void\n  }\n  \n  class _Connection {\n    initialize: (_Server, _ServerConn) -&gt; void\n    handle_open: () -&gt; void\n    handle_incoming: (payload) -&gt; void\n    handle_close: () -&gt; void\n    beat: () -&gt; void\n    statistics: () -&gt; Hash[Symbol, untyped]\n  }\n  \n  _Server --&gt; _PubSub\n  _Server --&gt; _Executor\n  _Connection --&gt; _ServerConn\n  _Connection --&gt; _Server\n\" dir=\"auto\">\n    <div class=\"render-plaintext-hidden\" dir=\"auto\">\n      <pre lang=\"mermaid\" aria-label=\"Raw mermaid code\" class=\"notranslate\">classDiagram\n  class _PubSub {\n    subscribe: (channel, handler, callback) -&gt; void\n    unsubscribe: (channel, handler) -&gt; void\n  }\n  \n  class _Executor {\n    post: (&amp;block) -&gt; void\n    timer: (interval, &amp;block) -&gt; handle\n  }\n  \n  class _Server {\n    pubsub: _PubSub\n    executor: _Executor\n    config: Configuration \n  }\n  \n  class _ServerConn {\n    logger: Logger\n    env: Hash[String, untyped]\n    request: Request\n    protocol: String\n    initialize: (_Server, env) -&gt; void\n    transmit: (untyped) -&gt; void\n    close: () -&gt; void\n    perform_work: (untyped receiver, method_name Symbol, *untyped args) -&gt; void\n  }\n  \n  class _Connection {\n    initialize: (_Server, _ServerConn) -&gt; void\n    handle_open: () -&gt; void\n    handle_incoming: (payload) -&gt; void\n    handle_close: () -&gt; void\n    beat: () -&gt; void\n    statistics: () -&gt; Hash[Symbol, untyped]\n  }\n  \n  _Server --&gt; _PubSub\n  _Server --&gt; _Executor\n  _Connection --&gt; _ServerConn\n  _Connection --&gt; _Server\n</pre>\n    </div>\n  </div>\n  <span class=\"js-render-enrichment-loader d-flex flex-justify-center flex-items-center width-full\" style=\"min-height:100px\" role=\"presentation\">\n    <svg style=\"box-sizing: content-box; color: var(--color-icon-primary);\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\" fill=\"none\" data-view-component=\"true\" class=\"octospinner mx-auto anim-rotate\">\n  <circle cx=\"8\" cy=\"8\" r=\"7\" stroke=\"currentColor\" stroke-opacity=\"0.25\" stroke-width=\"2\" vector-effect=\"non-scaling-stroke\" fill=\"none\"></circle>\n  <path d=\"M15 8a7.002 7.002 0 00-7-7\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" vector-effect=\"non-scaling-stroke\"></path>\n</svg>\n  </span>\n</section>\n\n<h3 dir=\"auto\">Examples / follow-ups</h3>\n<h4 dir=\"auto\">Action Cable testing</h4>\n<p dir=\"auto\">Here is an example commit (one of the future PRs) demonstrating how this refactoring simplifies Action Cable testing and make it more robust (no patches, real connection and channel classes, etc.): <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/palkan/rails/commit/3ba6d35c788134faeb062b12f371aab5da1886b8/hovercard\" href=\"https://github.com/palkan/rails/commit/3ba6d35c788134faeb062b12f371aab5da1886b8\">palkan@<tt>3ba6d35</tt></a></p>\n<h4 dir=\"auto\">Action Cable over SSE</h4>\n<p dir=\"auto\">Here is a sketch of how SSE transport for Action Cable can be implemented (based on the changes from this PR): <a href=\"https://gist.github.com/palkan/270a192e79b05d5601fe497ad3ec83b5\">https://gist.github.com/palkan/270a192e79b05d5601fe497ad3ec83b5</a></p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Here is a <a href=\"https://discord.com/channels/849034466856665118/1168026423001366609\" rel=\"nofollow\">Discord thread</a> where we discuss the project.</p>\n<p dir=\"auto\">There is an old PR attempting to achieve the same goal: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"200138002\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/27648\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/27648/hovercard\" href=\"https://github.com/rails/rails/pull/27648\">#27648</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">/cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/ioquatix/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ioquatix\">@ioquatix</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a></p>",
            "url": "https://github.com/rails/rails/pull/50979",
            "title": "Action Cable server adapterization",
            "date_modified": "2024-02-07T03:22:28.000Z",
            "date_published": "2024-02-06T02:13:01.000Z",
            "author": {
                "name": "palkan",
                "url": "https://github.com/palkan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2786819?u=722b21f1f48dc9a97c9494aba04c4f657d31e941&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The Action Text documentation benefits from some more examples and explanations of some of the concepts that are mentioned, as well as the introduction of some new ones.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request updates the documentation for Action Text. It adds, reorders and in general creates clear instructions for using Action Text.</p>",
            "url": "https://github.com/rails/rails/pull/50977",
            "title": "[RF DOCS] Action Text Documention [ci-skip] ",
            "date_modified": "2024-02-06T13:10:35.000Z",
            "date_published": "2024-02-05T22:02:36.000Z",
            "author": {
                "name": "Ridhwana",
                "url": "https://github.com/Ridhwana"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1966473?u=fe117732163d3610f051fca80df4e04c1b91335d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h2 dir=\"auto\">Overview</h2>\n<p dir=\"auto\">Action Mailbox is a pretty useful / interesting sub-framework of Rails, that more apps probably could benefit from. It does have a number of moving parts so I focused on explaining the flow of how things work. I did a lot of 'in-app testing' of the docs by implementing its features in a rails app and exploring what's missing in the docs.</p>\n<h2 dir=\"auto\">New sections</h2>\n<p dir=\"auto\">Here are the new things I added, in addition to clarifying the existing text.</p>\n<ul dir=\"auto\">\n<li>Processing Incoming Email - more of a step by step of the flow</li>\n<li>Mail object and it's fields</li>\n<li>List of Inbound Email 'status' values</li>\n<li>ActiveJobs that are part of Action Mailbox - Routing and Incineration</li>\n</ul>\n<h2 dir=\"auto\">Testing</h2>\n<p dir=\"auto\">In addition to testing the Action Mailbox features in-app, I also ran <code class=\"notranslate\">guides:generate</code> and <code class=\"notranslate\">guides:validate</code> locally. I perused the generated html locally as well.</p>\n<p dir=\"auto\">I also tested the instructions for one 'real' ingress Postmark (locally with ngrok).</p>",
            "url": "https://github.com/rails/rails/pull/50973",
            "title": "[RF DOCS] Action Mailbox Documention [ci-skip]",
            "date_modified": "2024-02-07T19:53:21.000Z",
            "date_published": "2024-02-05T20:04:36.000Z",
            "author": {
                "name": "bhumi1102",
                "url": "https://github.com/bhumi1102"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54629302?u=be8de5137bf940532cddd05aff823129ab8a39db&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">Update some create <code class=\"notranslate\">has_one</code> test descriptions to indicate failure when using the <code class=\"notranslate\">#create_*</code> constructor.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">I ran into these tests when looking into a separate issue and found the failures confusing when running against my changes. The descriptions were change <a href=\"https://github.com/rails/rails/pull/41238\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/41238/hovercard\">in this PR</a>, but I think the reasoning there is incorrect. These are indeed creation failures, and I have added an additional assertion to make that clear.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">None.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50962",
            "title": "Update some create `has_one` failure test descriptions",
            "date_modified": "2024-02-07T13:59:59.000Z",
            "date_published": "2024-02-04T08:46:44.000Z",
            "author": {
                "name": "joshuay03",
                "url": "https://github.com/joshuay03"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1773614?u=ddeb4c8dcd174d1b6cb73cfa9ab91808eaba47a0&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Customers are uploading webp images to our app, and expect them to be rendered just like other images, instead of being converted to the fallback PNG format.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Follows <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"597833295\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/38918\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/38918/hovercard\" href=\"https://github.com/rails/rails/pull/38918\">#38918</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"602809843\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/38988\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/38988/hovercard\" href=\"https://github.com/rails/rails/pull/38988\">#38988</a>. At the time, webp browser support was limited. Now 96% of browsers support webp: <a href=\"https://caniuse.com/?search=webp\" rel=\"nofollow\">https://caniuse.com/?search=webp</a></p>\n<p dir=\"auto\">This PR adds webp as a default image type.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I think this is a sensible default in 2024, but alternatively each Rails app may choose:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Rails.application.configure do\n  config.active_storage.web_image_content_types &lt;&lt; &quot;image/webp&quot;\nend\"><pre class=\"notranslate\"><code class=\"notranslate\">Rails.application.configure do\n  config.active_storage.web_image_content_types &lt;&lt; \"image/webp\"\nend\n</code></pre></div>\n<p dir=\"auto\"><strong>Changelog</strong></p>\n<p dir=\"auto\">I've not added a changelog entry in line with <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"597833295\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/38918\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/38918/hovercard?comment_id=410527726&amp;comment_type=review_comment\" href=\"https://github.com/rails/rails/pull/38918#discussion_r410527726\">#38918 (comment)</a>, but I'd be happy to add one if it's felt useful now.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/jeremy/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jeremy\">@jeremy</a></p>",
            "url": "https://github.com/rails/rails/pull/50953",
            "title": "Add webp as a default to active_storage.web_image_content_types",
            "date_modified": "2024-02-07T09:50:18.000Z",
            "date_published": "2024-02-02T12:51:26.000Z",
            "author": {
                "name": "lewispb",
                "url": "https://github.com/lewispb"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54796266?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">In general validation errors should include more information on where it has happened.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR updates <code class=\"notranslate\">activerecord/lib/active_record/enum.rb</code> validation exception message and just adds class name.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50950",
            "title": "Add class name to enum validation exception message",
            "date_modified": "2024-02-02T11:08:08.000Z",
            "date_published": "2024-02-02T11:07:18.000Z",
            "author": {
                "name": "amkisko",
                "url": "https://github.com/amkisko"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/82408?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This pull request adds a new Rails Guide called \"Tuning Performance for Deployment\".</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">A few weeks ago there was <a href=\"https://github.com/rails/rails/issues/50450\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50450/hovercard\">an issue to change the default thread count for Puma in Rails</a> and <a href=\"https://github.com/rails/rails/pull/50669\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50669/hovercard\">a PR to make that change</a>.</p>\n<p dir=\"auto\">The PR mentioned that a performance tuning guide would be the right way to document some issues, but no such guide exists. I wrote a basic guide and incorporated a lot of feedback from <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a> (Jean Boussier), who wrote the thread count PR.</p>\n<p dir=\"auto\">This pull request adds the suggested Rails Guide.</p>\n<p dir=\"auto\">CC <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/nateberkopec/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/nateberkopec\">@nateberkopec</a> - though I know you're very busy right now :-)</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">It's impossible to have a detailed guide for all possible Rails deployment options. This guide focuses on Puma (the default server) and CRuby, and on giving a good start to people who don't already know deployment well. I've tried to mention core performance issues without explaining every possible configuration change.</p>\n<p dir=\"auto\">Next time there is a deployment configuration change, there will be a place to document the tradeoffs.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50949",
            "title": "Add a Rails Guide for tuning performance for deployment",
            "date_modified": "2024-02-07T17:38:56.000Z",
            "date_published": "2024-02-02T10:55:44.000Z",
            "author": {
                "name": "noahgibbs",
                "url": "https://github.com/noahgibbs"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/3733470?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #50672.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2072396416\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50672\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50672/hovercard\" href=\"https://github.com/rails/rails/issues/50672\">#50672</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">The task <code class=\"notranslate\">db:schema:load:#{name}</code> depends on <code class=\"notranslate\">db:test:purge:#{name}</code> since <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/adb64db43dba5cad1007ce57e25df67f8b3e91f8/hovercard\" href=\"https://github.com/rails/rails/commit/adb64db43dba5cad1007ce57e25df67f8b3e91f8\"><tt>adb64db</tt></a> which requires the DB config to be present, otherwise an error is raised.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ bin/rails db:schema:load:one --trace\n** Invoke db:schema:load:one (first_time)\n** Invoke db:test:purge:one (first_time)\n** Invoke db:load_config (first_time)\n** Invoke environment (first_time)\n** Execute environment\n** Execute db:load_config\n** Invoke db:check_protected_environments (first_time) ** Invoke db:load_config\n** Execute db:check_protected_environments\n** Execute db:test:purge:one\n** Execute db:schema:load:one\"><pre class=\"notranslate\"><code class=\"notranslate\">$ bin/rails db:schema:load:one --trace\n** Invoke db:schema:load:one (first_time)\n** Invoke db:test:purge:one (first_time)\n** Invoke db:load_config (first_time)\n** Invoke environment (first_time)\n** Execute environment\n** Execute db:load_config\n** Invoke db:check_protected_environments (first_time) ** Invoke db:load_config\n** Execute db:check_protected_environments\n** Execute db:test:purge:one\n** Execute db:schema:load:one\n</code></pre></div>\n<p dir=\"auto\">This commit fixes the problem by returning early when the DB config is indeed missing.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The task <code class=\"notranslate\">db:schema:load</code> may need to be updated to depend on <code class=\"notranslate\">db:test:purge</code> too, to keep it consistent with <code class=\"notranslate\">db:schema:load:#{name}</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50946",
            "title": "Fix error raised when running `db:schema:load:#{name}` and test DB config is missing",
            "date_modified": "2024-02-05T17:33:03.000Z",
            "date_published": "2024-02-02T03:17:31.000Z",
            "author": {
                "name": "ricardotk002",
                "url": "https://github.com/ricardotk002"
            }
        }
    ]
}