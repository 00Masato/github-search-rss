{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Generate the text-only label contents for a field:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"  # Helper method\n  field_label :article, :title    # =&gt; &quot;Title&quot;\n\n  # FormBuilder method\n  fields model: @article do |form|\n    form.label :title             # =&gt; &quot;&lt;label for=\\&quot;article_title\\&quot;&gt;Title&lt;/label&gt;&quot;\n    form.field_label :title       # =&gt; &quot;Title&quot;\n  end\"><pre class=\"notranslate\">  <span class=\"pl-c\"># Helper method</span>\n  <span class=\"pl-en\">field_label</span> <span class=\"pl-pds\">:article</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:title</span>    <span class=\"pl-c\"># =&gt; \"Title\"</span>\n\n  <span class=\"pl-c\"># FormBuilder method</span>\n  <span class=\"pl-en\">fields</span> <span class=\"pl-pds\">model</span>: <span class=\"pl-c1\">@article</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">form</span>|\n    <span class=\"pl-s1\">form</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">label</span> <span class=\"pl-pds\">:title</span>             <span class=\"pl-c\"># =&gt; \"&lt;label for=\\\"article_title\\\"&gt;Title&lt;/label&gt;\"</span>\n    <span class=\"pl-s1\">form</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">field_label</span> <span class=\"pl-pds\">:title</span>       <span class=\"pl-c\"># =&gt; \"Title\"</span>\n  <span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">This can be useful when utilizing <code class=\"notranslate\">[aria-label]</code> in rare circumstances where rendering a <code class=\"notranslate\">&lt;label&gt;</code> element for a form control isn't feasible.</p>\n<p dir=\"auto\">Prior to this commit, invoking <code class=\"notranslate\">label_tag</code> or <code class=\"notranslate\">form.label</code> was the only way to automatically determine a form control's (internationalized!) label text without providing call-site specific content (via a String argument or a block). Even with that automatic determination, the text content is nested within a <code class=\"notranslate\">&lt;label&gt;</code> element.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">With this change, views can separate the content text from the element for circumstances where they need to craft their own <code class=\"notranslate\">[aria-label]</code> text based on the out-of-the-box translated label text:</p>\n<div class=\"highlight highlight-text-html-erb notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"&lt;%= form_with model: @post do |form| %&gt;\n  &lt;%# a typical &lt;label&gt; + &lt;input&gt; combination %&gt;\n  &lt;%= form.label :title %&gt;\n  &lt;%= form.text_field :title %&gt;\n\n  &lt;%# an &lt;input&gt; with [aria-label] text %&gt;\n  &lt;%= form.text_field :title, aria: { label: form.field_label(:title) } %&gt;\n\n  &lt;%# a typical &lt;label&gt; + &lt;input&gt; combination with additional [aria-label] text %&gt;\n  &lt;%= form.label :title %&gt;\n  &lt;%= form.text_field :title, aria: {\n        label: &quot;#{form.field_label(:title)}, and then some additional text to be announced&quot;\n      } %&gt;\n&lt;% end %&gt;\"><pre class=\"notranslate\"><span class=\"pl-k\">&lt;%=</span> form_with model: @post do |form| <span class=\"pl-k\">%&gt;</span><span class=\"pl-c\"><span class=\"pl-k\"></span></span>\n<span class=\"pl-c\"><span class=\"pl-k\">  &lt;%#</span> a typical &lt;label&gt; + &lt;input&gt; combination <span class=\"pl-k\">%&gt;</span></span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">  &lt;%=</span> form.label :title <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">  &lt;%=</span> form.text_field :title <span class=\"pl-k\">%&gt;</span><span class=\"pl-c\"><span class=\"pl-k\"></span></span>\n<span class=\"pl-c\"><span class=\"pl-k\"></span></span>\n<span class=\"pl-c\"><span class=\"pl-k\">  &lt;%#</span> an &lt;input&gt; with [aria-label] text <span class=\"pl-k\">%&gt;</span></span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">  &lt;%=</span> form.text_field :title, aria: { label: form.field_label(:title) } <span class=\"pl-k\">%&gt;</span><span class=\"pl-c\"><span class=\"pl-k\"></span></span>\n<span class=\"pl-c\"><span class=\"pl-k\"></span></span>\n<span class=\"pl-c\"><span class=\"pl-k\">  &lt;%#</span> a typical &lt;label&gt; + &lt;input&gt; combination with additional [aria-label] text <span class=\"pl-k\">%&gt;</span></span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">  &lt;%=</span> form.label :title <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">  &lt;%=</span> form.text_field :title, aria: {\n        label: \"#{form.field_label(:title)}, and then some additional text to be announced\"\n      } <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">&lt;%</span> end <span class=\"pl-k\">%&gt;</span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-c1\"></span><span class=\"pl-k\"></span><span class=\"pl-s1\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-kos\"></span><span class=\"pl-pds\"></span><span class=\"pl-kos\"></span><span class=\"pl-pds\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-kos\"></span><span class=\"pl-pds\"></span><span class=\"pl-kos\"></span><span class=\"pl-kos\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-kos\"></span><span class=\"pl-pds\"></span><span class=\"pl-kos\"></span><span class=\"pl-pds\"></span><span class=\"pl-s\"><span class=\"pl-s1\"><span class=\"pl-kos\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-kos\"></span><span class=\"pl-pds\"></span><span class=\"pl-kos\"></span><span class=\"pl-kos\"></span></span></span><span class=\"pl-kos\"></span><span class=\"pl-k\"></span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50124",
            "title": "Introduce `field_label` form helper",
            "date_modified": "2023-11-21T04:10:03.000Z",
            "date_published": "2023-11-21T03:58:55.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/42748004?u=a2f943e4a20b708d6e082b99f8ee277189dce7cf&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">From <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1692891902\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48111\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48111/hovercard?comment_id=1531952728&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/pull/48111#issuecomment-1531952728\">#48111 (comment)</a>, it was found that there is currently no test coverage for the types of errors when connecting to the db.</p>\n\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This was done by modifying the database configs with invalid host/user/database. As a result, this PR also fixes the error code of <code class=\"notranslate\">ER_DBACCESS_DENIED_ERROR</code> to return a no database error instead of a username error.</p>\n<p dir=\"auto\">**Looking into the CI error ðŸ‘€</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50123",
            "title": "Add error connection tests for various db adapters",
            "date_modified": "2023-11-21T03:43:02.000Z",
            "date_published": "2023-11-21T01:16:33.000Z",
            "author": {
                "name": "jenshenny",
                "url": "https://github.com/jenshenny"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/38864576?u=6bbb80e5c3a3a5bd70f1be00a243893056738e3e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">Using the current <code class=\"notranslate\">Interceptor</code> and <code class=\"notranslate\">Observer</code> registering examples trigger deprecation warnings. The ones I proposed instead are similar to what is recommended in the <code class=\"notranslate\">ActionMailer</code> <a href=\"https://guides.rubyonrails.org/configuring.html#config-action-mailer-observers\" rel=\"nofollow\">configuration guide</a>.</p>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50115",
            "title": "Update interceptors and observers registering examples",
            "date_modified": "2023-11-20T16:03:17.000Z",
            "date_published": "2023-11-20T16:03:13.000Z",
            "author": {
                "name": "bear-in-mind",
                "url": "https://github.com/bear-in-mind"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/10277857?u=62b279cd191760111ca30d53d3be2c688014c1f7&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><a href=\"https://www.ietf.org/rfc/rfc7396.txt\" rel=\"nofollow\">RFC 7396 JSON Merge Patch</a> defines the JSON merge patch format and processing rules and registers <code class=\"notranslate\">application/merge-patch+json</code> as additional MIME media type. It expects the same encoding of <code class=\"notranslate\">application/json</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR proposes adding <code class=\"notranslate\">application/merge-patch+json</code> as an additional recognized MIME subtype for <code class=\"notranslate\">application/json</code>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50114",
            "title": "Add `application/merge-patch+json` as subtype for `application/json`",
            "date_modified": "2023-11-20T15:07:57.000Z",
            "date_published": "2023-11-20T15:07:53.000Z",
            "author": {
                "name": "kemuridama",
                "url": "https://github.com/kemuridama"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/84159?u=611f8cb6bdccc221b89e645b60cb8471d9269ada&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Continuation of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1994508902\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50064\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50064/hovercard\" href=\"https://github.com/rails/rails/pull/50064\">#50064</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2000421714\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50093\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50093/hovercard\" href=\"https://github.com/rails/rails/pull/50093\">#50093</a> with <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a></p>\n<p dir=\"auto\">This adds the <code class=\"notranslate\">mysql://</code> or <code class=\"notranslate\">adapter: mysql</code> alias to be put in DB config or deploy ENV, and then allows the application to be configured to either use <code class=\"notranslate\">mysql2</code> or <code class=\"notranslate\">trilogy</code> as the concrete adapter. This separates environment config (ie. \"this app uses MySQL and here are the credentials\") from adapter choice and implementation (ie. \"connect to the database from the app using trilogy or mysql2\"). It also provides an easy test/upgrade path without changing the env.</p>\n<p dir=\"auto\">It makes <code class=\"notranslate\">mysql</code> the default adapter generated for new rails apps that use MySQL, but it keeps <code class=\"notranslate\">mysql2</code> as the default adapter used. It's a different approach than <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2001754105\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50110\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50110/hovercard\" href=\"https://github.com/rails/rails/pull/50110\">#50110</a> but here it's easily swappable as to which generates by default.</p>\n<h3 dir=\"auto\">Is <code class=\"notranslate\">alias</code> really necessary?</h3>\n<p dir=\"auto\">I proposed adding this once before and discussed it with Matthew and we decided to remove it. <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2000421714\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50093\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50093/hovercard?comment_id=1817531767&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/pull/50093#issuecomment-1817531767\">#50093 (comment)</a></p>\n<p dir=\"auto\">I've added it back here for a couple reasons.</p>\n<p dir=\"auto\">The <code class=\"notranslate\">ActiveRecord::ConnectionAdapters</code> does not expose what the class name and path are for registered adapters. Since you cannot query that you cannot retrieve those two values to add an alias, so you'd need to be repeating those configuration strings in wherever you add the alias through <code class=\"notranslate\">register()</code>.</p>\n<p dir=\"auto\">It would also mean we would need to somewhere (like in an initializer) define a switch statement like:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"case ActiveRecord.mysql_adapter\nwhen :trilogy, &quot;trilogy&quot;\n  ActiveRecord::ConnectionAdapters.register(&quot;mysql&quot;, &quot;ActiveRecord::ConnectionAdapters::TrilogyAdapter&quot;, &quot;active_record/connection_adapters/trilogy_adapter&quot;)\nwhen :mysql2, &quot;mysql2&quot;\n  ActiveRecord::ConnectionAdapters.register(&quot;mysql2&quot;, &quot;ActiveRecord::ConnectionAdapters::Mysql2Adapter&quot;, &quot;active_record/connection_adapters/mysql2_adapter&quot;)\nwhen nil\n  # noop\nelse\n  raise &quot;uknown adapter etc.&quot;\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">case</span> <span class=\"pl-v\">ActiveRecord</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">mysql_adapter</span>\n<span class=\"pl-k\">when</span> <span class=\"pl-pds\">:trilogy</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"trilogy\"</span>\n  <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">ConnectionAdapters</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">register</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"mysql\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"ActiveRecord::ConnectionAdapters::TrilogyAdapter\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"active_record/connection_adapters/trilogy_adapter\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">when</span> <span class=\"pl-pds\">:mysql2</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"mysql2\"</span>\n  <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">ConnectionAdapters</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">register</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"mysql2\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"ActiveRecord::ConnectionAdapters::Mysql2Adapter\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"active_record/connection_adapters/mysql2_adapter\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">when</span> <span class=\"pl-c1\">nil</span>\n  <span class=\"pl-c\"># noop</span>\n<span class=\"pl-k\">else</span>\n  <span class=\"pl-en\">raise</span> <span class=\"pl-s\">\"uknown adapter etc.\"</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">This reimplements some of the connection lookup validation and the location/class names of the adapters. It is very much not <strong>DRY</strong>.  It is also not <strong>open/closed</strong> as this is extremely not open for extension as we cannot easily add to the list. I could not write code that I was happy with without this.</p>\n<h3 dir=\"auto\">Why is the default <code class=\"notranslate\">mysql_adapter</code> config <code class=\"notranslate\">nil</code>?</h3>\n<p dir=\"auto\">I'm a little unsure on what the best behaviour is here. If we set <code class=\"notranslate\">ActiveRecord.mysql_adapter = :trilogy</code> or whatever as default, the initializer attempts to alias to it no matter what. So if the app is using Postgres or SQLite it will reference the MySQL adapter(s) that are not loaded and raise.</p>\n<p dir=\"auto\">But because the aliasing must be done before the adapters are loaded, <em>we do not know if we are using MySQL in the app or not</em>. So, the default is <code class=\"notranslate\">nil</code> and it does nothing, but the <em>default generated app adds the config</em>. That makes it easy to update later.</p>\n<h3 dir=\"auto\">Should the default be <code class=\"notranslate\">:trilogy</code>?</h3>\n<p dir=\"auto\">I don't know! That's a Rails vision/direction question. Easy to change that here (or soon after).</p>",
            "url": "https://github.com/rails/rails/pull/50112",
            "title": "Allow the MySQL adapter implementation to be configured in an Active Record config",
            "date_modified": "2023-11-21T05:08:40.000Z",
            "date_published": "2023-11-20T12:29:19.000Z",
            "author": {
                "name": "kmcphillips",
                "url": "https://github.com/kmcphillips"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/530941?u=8a110e767c1f487f7c7979170a6ffb85fbef3be5&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request addresses a regression introduced in PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1630083113\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47708\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47708/hovercard\" href=\"https://github.com/rails/rails/pull/47708\">#47708</a>, where the error message for an excessively long password was changed to a less informative \"is too long\". Previously, the error message included a dynamic count of the maximum allowed characters (e.g., \"is too long (maximum is %{count} characters)\"). This regression affects the user experience by providing less guidance on how to correct the input. Restoring the informative error message helps developers and users understand the validation constraints.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request makes the following changes:</p>\n<ul dir=\"auto\">\n<li>It restores the <code class=\"notranslate\">count</code> parameter in the error message for a password exceeding the maximum length, ensuring users receive a detailed response (\"is too long (maximum is %{count} characters)\").</li>\n<li>It reverts the validation error symbol from <code class=\"notranslate\">:password_too_long</code> back to <code class=\"notranslate\">:too_long</code> within <code class=\"notranslate\">activemodel/lib/active_model/secure_password.rb</code>.</li>\n<li>It removes the <code class=\"notranslate\">:password_too_long</code> key from <code class=\"notranslate\">activemodel/lib/active_model/locale/en.yml</code> to align with the use of the <code class=\"notranslate\">:too_long</code> symbol.</li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The change is straightforward and restores functionality to its previous state as of v7.1.0.beta1, ensuring that the error message for password length validation is both informative and accurate.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<hr>\n<p dir=\"auto\">This PR was co-authored by ChatGPT.</p>",
            "url": "https://github.com/rails/rails/pull/50109",
            "title": "Restore detailed error message for excessive password length",
            "date_modified": "2023-11-21T08:24:05.000Z",
            "date_published": "2023-11-20T00:33:04.000Z",
            "author": {
                "name": "cabgfx",
                "url": "https://github.com/cabgfx"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #50099.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2000622165\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50099\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50099/hovercard\" href=\"https://github.com/rails/rails/issues/50099\">#50099</a> (see there for the description).</p>\n<p dir=\"auto\">Tested locally - works as expected, but I am struggling to write a test for this.</p>",
            "url": "https://github.com/rails/rails/pull/50105",
            "title": "Fix `run_generator` to work for generators calling other generators",
            "date_modified": "2023-11-19T17:59:42.000Z",
            "date_published": "2023-11-19T16:46:25.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1371733?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">When a blob is a representable of kind <code class=\"notranslate\">previewable</code>, the preview<br>\nimage that's being proxied is always the original preview image,<br>\ndiscarding completely the <code class=\"notranslate\">variation_key</code> param passed in the request.</p>\n<p dir=\"auto\">As all 3 classes are now 100% interchangeable, we can deprecate the use<br>\nof <code class=\"notranslate\">Representable#image</code>. Users of this class won't need to call this<br>\nmethod as it's become obsolete. and in case of <code class=\"notranslate\">Preview#image</code><br>\nerroneous.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR fixes this by editing <code class=\"notranslate\">Preview</code> and <code class=\"notranslate\">VariantWithRecord</code> to<br>\nhave full synchronized API with <code class=\"notranslate\">Variant</code>. this will then allow the<br>\nProxyController to not call <code class=\"notranslate\">representable#image</code> but <code class=\"notranslate\">representable</code><br>\ninstead.</p>\n<p dir=\"auto\">As all 3 classes are now 100% interchangeable, we can deprecate the use<br>\nof <code class=\"notranslate\">Representable#image</code>. Users of this class won't need to call this<br>\nmethod as it's become obsolete. and in case of <code class=\"notranslate\">Preview#image</code><br>\nerroneous.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I've added missing failing tests that would have caught this issue.</p>\n<p dir=\"auto\">It wasn't straightforward to fix. Because of some mismatches between <code class=\"notranslate\">AS::Variant</code> / <code class=\"notranslate\">AS::VariantWithRecord</code> / <code class=\"notranslate\">AS::Preview</code><br>\nFor example <code class=\"notranslate\">AS::Variant</code> adds a lot of redundant methods like <code class=\"notranslate\">#filename</code>simply because <code class=\"notranslate\">AS::Variant#image</code> returns <code class=\"notranslate\">self</code> ( and <strong>not</strong> a AS blob). and any methods that are used with <code class=\"notranslate\">send_blob_stream</code></p>\n<p dir=\"auto\">Here are the the lines that call <code class=\"notranslate\">@representation.image</code><br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/438cad462638b02210fc48b700c29dcd0428a8b7/activestorage/app/controllers/active_storage/representations/proxy_controller.rb#L14-L16\">rails/activestorage/app/controllers/active_storage/representations/proxy_controller.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 14 to 16\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/438cad462638b02210fc48b700c29dcd0428a8b7\">438cad4</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L14\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"14\"></td>\n          <td id=\"LC14\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">http_cache_forever</span> <span class=\"pl-pds\">public</span>: <span class=\"pl-c1\">true</span> <span class=\"pl-k\">do</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L15\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"15\"></td>\n          <td id=\"LC15\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">send_blob_stream</span> <span class=\"pl-c1\">@representation</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">image</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">disposition</span>: <span class=\"pl-en\">params</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:disposition</span><span class=\"pl-kos\">]</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L16\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"16\"></td>\n          <td id=\"LC16\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">which I changed to call <code class=\"notranslate\">send_blob_stream @representation</code> getting rid of <code class=\"notranslate\">#image</code> and we can deprecate it in a future PR</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50098",
            "title": "[ActiveStorage] Fix `ActiveStorage:Representations::ProxyController` returning the wrong preview",
            "date_modified": "2023-11-21T10:04:35.000Z",
            "date_published": "2023-11-18T22:02:31.000Z",
            "author": {
                "name": "chaadow",
                "url": "https://github.com/chaadow"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/12038583?u=ac2f7ffc061e858f2281a4c11cc06dcb0e77e690&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">On platforms without a high-resolution (nanosecond) clock, it is likely that the processing of an event will take less time than one complete clock resolution cycle, which means that the start and end times will be equal and the duration zero, failing these tests.  Usually these issues are fixed by adding a sleep of equal to one clock resolution cycle, but that is not applicable here since the duration measurement occurs in the actual library code rather than the test code, so just skip these tests on such platforms.  Also tested and confirmed that the tests are not skipped under normal platforms with a highres clock.</p>",
            "url": "https://github.com/rails/rails/pull/50097",
            "title": "Skip activesupport event processing tests on platforms w/o highres clock",
            "date_modified": "2023-11-18T17:53:01.000Z",
            "date_published": "2023-11-18T17:52:57.000Z",
            "author": {
                "name": "matoro",
                "url": "https://github.com/matoro"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/118707?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I work on a rather large, robust Rails application that has some custom multi-database code. The default behavior of <code class=\"notranslate\">ActiveRecord::Base.clear_query_caches_for_current_thread</code> for cache clearing can result in a substantial number of cache misses between unrelated shards, (noted in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"743149311\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/40622\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/40622/hovercard\" href=\"https://github.com/rails/rails/pull/40622\">#40622</a>) - similarly as the methods passed to <code class=\"notranslate\">dirties_query_cache</code> in <code class=\"notranslate\">ActiveRecord::ConnectionAdapters::QueryCache</code> has changed (such as in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1682868612\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48061\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48061/hovercard\" href=\"https://github.com/rails/rails/pull/48061\">#48061</a>) this again changes the number of query cache hits, which can result in performance regressions. In both cases, the default behavior absolutely makes sense, however it is difficult to carve out an exception. In order to do so this requires making <code class=\"notranslate\">clear_query_caches_for_current_thread</code> a noop and then overwriting the target methods on the adapter classes.</p>\n<p dir=\"auto\">Rather than being prescriptive, this pull request maintains the current behavior and gives a more straightforward way for applications to modify the existing cache clearing behavior instead of monkey patching core Active Record classes.</p>\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>Add <code class=\"notranslate\">ActiveRecord#query_cache_clearing_strategy</code> as a singleton accessor that defaults to a <code class=\"notranslate\">Proc</code> that just calls <code class=\"notranslate\">ActiveRecord::Base.clear_query_caches_for_current_thread</code></li>\n<li>Replace the call to <code class=\"notranslate\">ActiveRecord::Base.clear_query_caches_for_current_thread</code> in the inline method definition in <code class=\"notranslate\">ActiveRecord::ConnectionAdapters::QueryCache</code> to call the new <code class=\"notranslate\">Proc</code> with the arguments of <code class=\"notranslate\">self</code>, the <code class=\"notranslate\">method_name</code> and args.</li>\n<li>Update the configuration guide to document this.</li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Since there is no change to the behavior as is, I have no additional tests added.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50091",
            "title": "Add `query_cache_clearing_strategy` to customize how the query cache clears",
            "date_modified": "2023-11-20T17:13:55.000Z",
            "date_published": "2023-11-18T00:18:15.000Z",
            "author": {
                "name": "jcalvert",
                "url": "https://github.com/jcalvert"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/26704491?u=db54a0798fb800751ceea6bd73cf3d2794ebb1ac&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR update the actiontext dependency to match with the latest dependent active storage version</p>",
            "url": "https://github.com/rails/rails/pull/50084",
            "title": "Fixed the dependencies of actiontext according to current actionstoraâ€¦",
            "date_modified": "2023-11-18T21:19:38.000Z",
            "date_published": "2023-11-17T17:32:37.000Z",
            "author": {
                "name": "adityapandit17",
                "url": "https://github.com/adityapandit17"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/96426677?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #50078.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1997760191\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50078\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50078/hovercard\" href=\"https://github.com/rails/rails/issues/50078\">#50078</a></p>\n<p dir=\"auto\">This Pull Request has been created because I needed to sort a column ASC with nulls last with a MySQL database and wanted to avoid using an SQL fragment to achieve this. I discovered that Arel supports this for all databases apart from MySQL. When investigating the MySQL implementation, I noticed inconsistencies with how it is implemented.</p>\n<p dir=\"auto\">Originally, I was just aiming to make the functionality consistent, but then had a go at implementing the missing functionality.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the implementation of <code class=\"notranslate\">.nulls_first()</code> and <code class=\"notranslate\">.nulls_last()</code> for MySQL databases. These methods now work as designed.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50079",
            "title": "Arel nulls first/last implementation Mysql ",
            "date_modified": "2023-11-17T21:02:28.000Z",
            "date_published": "2023-11-16T21:13:53.000Z",
            "author": {
                "name": "tttffff",
                "url": "https://github.com/tttffff"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1530604?u=ce3bcded6b07f96722f7b3a0201a41002a314dff&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Add base62 method to SecureRandom</p>",
            "url": "https://github.com/rails/rails/pull/50073",
            "title": "Add base62 method to SecureRandom",
            "date_modified": "2023-11-18T12:26:22.000Z",
            "date_published": "2023-11-16T16:00:20.000Z",
            "author": {
                "name": "valenciaj",
                "url": "https://github.com/valenciaj"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/159?u=36438d464451d200a47a38f51180656aeb9a44d5&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This was added in back in bootsnap 1.15.0 (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1463505600\" data-permission-text=\"Title is private\" data-url=\"https://github.com/Shopify/bootsnap/issues/428\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/Shopify/bootsnap/pull/428/hovercard\" href=\"https://github.com/Shopify/bootsnap/pull/428\">Shopify/bootsnap#428</a>). This can save extra work and IO when the cache won't be changed, like is the case for docker containers</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the Dockerfile template used when creating a new application to add <code class=\"notranslate\">BOOTSNAP_READONLY=1</code></p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50065",
            "title": "Add BOOTSNAP_READONLY to Dockerfile template for production",
            "date_modified": "2023-11-16T17:27:05.000Z",
            "date_published": "2023-11-15T19:19:44.000Z",
            "author": {
                "name": "technicalpickles",
                "url": "https://github.com/technicalpickles"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Some of these were specifically mentioned earlier in the Metal docs (response_body=, content_type=, status=) but were not linked because the methods were not documented (due to being part of a delegation).</p>\n<p dir=\"auto\">This commit separates all of the delegated methods so that they can be documented, adds links for the mentioned methods, and additionally documents two methods on Response that are mentioned in the new Metal documentation, but were not previously documented.</p>",
            "url": "https://github.com/rails/rails/pull/50063",
            "title": "Add documentation for delegated methods on Metal",
            "date_modified": "2023-11-15T04:42:26.000Z",
            "date_published": "2023-11-15T04:36:15.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #50051.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1991817449\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50051\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50051/hovercard\" href=\"https://github.com/rails/rails/issues/50051\">#50051</a>.</p>\n<p dir=\"auto\">The test case is a preceding test case, adapted for this change.</p>",
            "url": "https://github.com/rails/rails/pull/50060",
            "title": "Fix permitting arrays in numbered parameters for `StrongParameters`",
            "date_modified": "2023-11-14T19:19:34.000Z",
            "date_published": "2023-11-14T18:00:21.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/28561?u=095779352a57f75e734987829f3f67a10e5780ed&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">As Active Record relations respond to <code class=\"notranslate\">include?</code>, calling <code class=\"notranslate\">in?</code> will perform a query if the relation hasn't been loaded yet:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"mary = Person.create(name: &quot;Mary&quot;)\n# =&gt; #&lt;Person id: 654, name: &quot;Mary&quot;&gt;\nmary.in?(Person.where(name: &quot;Alice&quot;))\n# SELECT 1 AS one FROM &quot;people&quot; WHERE &quot;people&quot;.&quot;name&quot; =&quot;Alice&quot; ...\"><pre class=\"notranslate\"><span class=\"pl-s1\">mary</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">name</span>: <span class=\"pl-s\">\"Mary\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\"># =&gt; #&lt;Person id: 654, name: \"Mary\"&gt;</span>\n<span class=\"pl-s1\">mary</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">in?</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">name</span>: <span class=\"pl-s\">\"Alice\"</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\"># SELECT 1 AS one FROM \"people\" WHERE \"people\".\"name\" =\"Alice\" ...</span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50059",
            "title": "Document `#in?` can perform queries for Active Record relations",
            "date_modified": "2023-11-15T20:03:43.000Z",
            "date_published": "2023-11-14T17:27:09.000Z",
            "author": {
                "name": "p8",
                "url": "https://github.com/p8"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The flexibility provided by <code class=\"notranslate\">config.x</code> supports arbitrarily defining new configuration objects on-the-fly. Each new intermediate configuration object is constructed during chaining from its ancestor through a method invocation made without arguments.</p>\n<p dir=\"auto\">Conversely, writing to leaf configuration values occurs when the invoked method's name ends with <code class=\"notranslate\">=</code>, and the new configuration value is assigned to whatever that method's arguments are.</p>\n<p dir=\"auto\">There are no cases when reading from a <code class=\"notranslate\">config.x</code> value or building the intermediate values<br>\ninvolves arguments.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Prior to this commit, a read invoked with a method arguments would ignore those arguments. While this is robust and error-free, it's possible to obscure misuse.</p>\n<p dir=\"auto\">For example, consider a line like:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"config.x.my_config.enabled = true\nconfig.x.my_config.enabled #=&gt; true\"><pre class=\"notranslate\"><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">my_config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">enabled</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n<span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">my_config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">enabled</span> <span class=\"pl-c\">#=&gt; true</span></pre></div>\n<p dir=\"auto\">Now consider that first line with a typo that omits the <code class=\"notranslate\">=</code>:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"config.x.my_config.enabled true\nconfig.x.my_config.enabled #=&gt; nil\"><pre class=\"notranslate\"><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">my_config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">enabled</span> <span class=\"pl-c1\">true</span>\n<span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">my_config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">enabled</span> <span class=\"pl-c\">#=&gt; nil</span></pre></div>\n<p dir=\"auto\">This commit aims to provide more direct feedback for scenarios like the one above. There aren't legitimate use cases for invoking <code class=\"notranslate\">#enabled</code> with arguments, so raise a <code class=\"notranslate\">ArgumentError</code> when encountering a read with arguments.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50050",
            "title": "Raise `ArgumentError` when reading from `config.x` with arguments",
            "date_modified": "2023-11-14T20:11:05.000Z",
            "date_published": "2023-11-14T00:27:01.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/84159?u=611f8cb6bdccc221b89e645b60cb8471d9269ada&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h2 dir=\"auto\">Problem</h2>\n<p dir=\"auto\">When <a href=\"https://github.com/rails/rails/blob/757f4896417f86b58303e416f4040a2b434abdd6/activerecord/lib/active_record.rb#L208-L213\"><code class=\"notranslate\">ActiveRecord.db_warnings_action</code></a> is set to anything other than <code class=\"notranslate\">:ignore</code>, I would expect that it would <em>always be called</em> when there are warnings.</p>\n<p dir=\"auto\">In MySQL this is not necessarily the case though. In the <code class=\"notranslate\">AbstractMysqlAdapter</code> the warnings are handled in two statements:<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/757f4896417f86b58303e416f4040a2b434abdd6/activerecord/lib/active_record/connection_adapters/abstract_mysql_adapter.rb#L750-L754\">rails/activerecord/lib/active_record/connection_adapters/abstract_mysql_adapter.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 750 to 754\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/757f4896417f86b58303e416f4040a2b434abdd6\">757f489</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L750\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"750\"></td>\n          <td id=\"LC750\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">return</span> <span class=\"pl-k\">if</span> <span class=\"pl-v\">ActiveRecord</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">db_warnings_action</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">nil?</span> || <span class=\"pl-c1\">@raw_connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">warning_count</span> == <span class=\"pl-c1\">0</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L751\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"751\"></td>\n          <td id=\"LC751\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L752\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"752\"></td>\n          <td id=\"LC752\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">@affected_rows_before_warnings</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">@raw_connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">affected_rows</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L753\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"753\"></td>\n          <td id=\"LC753\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">result</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">@raw_connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">query</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"SHOW WARNINGS\"</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L754\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"754\"></td>\n          <td id=\"LC754\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">result</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">level</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">code</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">message</span>| </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Simplified, but the logic is:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"query_result = raw_connection.query(sql)\nif raw_connection.warning_count != 0\n  warning_result = raw_connection.query(&quot;SHOW WARNINGS&quot;)\n  warning_result.each do |warning|\n    ActiveRecord.db_warnings_action(warning)\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-s1\">query_result</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">raw_connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">query</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">sql</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">if</span> <span class=\"pl-en\">raw_connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">warning_count</span> != <span class=\"pl-c1\">0</span>\n  <span class=\"pl-s1\">warning_result</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">raw_connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">query</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"SHOW WARNINGS\"</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-s1\">warning_result</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">warning</span>|\n    <span class=\"pl-v\">ActiveRecord</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">db_warnings_action</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">warning</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">So the query returns <code class=\"notranslate\">warning_count</code> as metadata from the result. A second <code class=\"notranslate\">\"SHOW WARNINGS\"</code> query is executed to get the warnings, and is assumed to always be correct. I know of two instances where this will return <code class=\"notranslate\">[]</code> despite <code class=\"notranslate\">warning_count</code> being greater than 0:</p>\n<ul dir=\"auto\">\n<li>If MySQL <code class=\"notranslate\">max_error_count</code> is set to 0, warnings are counted but never persisted, so <code class=\"notranslate\">SHOW WARNINGS</code> is always empty. <a href=\"https://dev.mysql.com/doc/refman/8.0/en/show-warnings.html\" rel=\"nofollow\">(source)</a></li>\n<li>If you are using ProxySQL it does not appear to propagate warnings at all. (see <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"372920090\" data-permission-text=\"Title is private\" data-url=\"https://github.com/sysown/proxysql/issues/1751\" data-hovercard-type=\"issue\" data-hovercard-url=\"/sysown/proxysql/issues/1751/hovercard\" href=\"https://github.com/sysown/proxysql/issues/1751\">sysown/proxysql#1751</a>)</li>\n</ul>\n<p dir=\"auto\">There may be others.</p>\n<p dir=\"auto\">So the behaviour to the user is that even when <code class=\"notranslate\">db_warnings_action</code> is set to something like <code class=\"notranslate\">:raise</code> or a proc, <strong>it is never executed and no warning is ever surfaced</strong>.</p>\n<h2 dir=\"auto\">Solution</h2>\n<p dir=\"auto\">In the case where <code class=\"notranslate\">warning_count</code> is non-zero, but <code class=\"notranslate\">SHOW WARNINGS</code> returns <code class=\"notranslate\">[]</code>, add a single warning with an error message. This isn't a super helpful message, but it is better than silently hiding that any warnings were encountered. This allows the user to update their DB config, or add a custom proc to report on or track warnings as is appropriate for their use case.</p>\n<p dir=\"auto\">I also found that <code class=\"notranslate\">trilogy</code> did not test the warning behaviour at all, so I first added tests for warnings that are essentially copies of what is done in the <code class=\"notranslate\">mysql2</code> tests.</p>\n<h3 dir=\"auto\">Questions</h3>\n<ul dir=\"auto\">\n<li>How is the voice and tone of the error message? I'm not tied to it, but it's the best I could come up with.</li>\n<li>Should I include documentation around <code class=\"notranslate\">db_warnings_action</code> with hints on how to tune the DB to prevent this state from occurring? I don't feel like it's the right place and I'm not sure if we give hints on infra in other places in the docs. Seems too specific and like it would get out of date.</li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/adrianna-chang-shopify/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/adrianna-chang-shopify\">@adrianna-chang-shopify</a></p>",
            "url": "https://github.com/rails/rails/pull/50049",
            "title": "Handle case in MySQL where the `ActiveRecord.db_warnings_action` is not called even when a DB query has warnings",
            "date_modified": "2023-11-20T17:40:19.000Z",
            "date_published": "2023-11-13T21:31:47.000Z",
            "author": {
                "name": "kmcphillips",
                "url": "https://github.com/kmcphillips"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1655218?u=e159b7a9f5a2172e4e7e2aed6a9c69ee107b9144&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I have IoT devices connecting to my Rails app via ActionCable, and I want to log when a device connects or disconnects.</p>\n<p dir=\"auto\">This is already doable via <code class=\"notranslate\">Cahnnel#subscribed</code> and <code class=\"notranslate\">Channel#unsubscribed</code>; and it works pretty well when a device properly connects, subscribes, and disconnects.</p>\n<p dir=\"auto\">But when a device improperly disconnects - e.g. if it gets unplugged from the network - its ActionCable connection doesn't close and can linger in the system for up to half an hour.</p>\n<p dir=\"auto\">This means that the server is using up resources to manage this connection, and send messages to it, when there isn't a client to receive them (since a client will reconnect if it misses 2 heartbeats which is about 6 sec). Some of these issues have been commented on in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1237667974\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45112\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/45112/hovercard\" href=\"https://github.com/rails/rails/issues/45112\">#45112</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"153616312\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24908\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24908/hovercard\" href=\"https://github.com/rails/rails/issues/24908\">#24908</a></p>\n<p dir=\"auto\">Currently, ActionCable doesn't have a mechanism to detect if it's connection is half-open (if a there is a client listening on the other end).</p>\n<p dir=\"auto\">This PR changes the protocol so that a client has to respond to a PING message with a PONG message. If it doesn't do so within 2 heartbeats (6 sec) the connection is assumed to be half-open and is closed.</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #45112.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1237667974\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45112\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/45112/hovercard\" href=\"https://github.com/rails/rails/issues/45112\">#45112</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #24908.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"153616312\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24908\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24908/hovercard\" href=\"https://github.com/rails/rails/issues/24908\">#24908</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #29307.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"232767165\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/29307\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/29307/hovercard\" href=\"https://github.com/rails/rails/issues/29307\">#29307</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #32828.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"320577446\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/32828\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/32828/hovercard\" href=\"https://github.com/rails/rails/pull/32828\">#32828</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<h4 dir=\"auto\">Why not client-initiated heartbeats?</h4>\n<p dir=\"auto\">I've considered implementing client-initiated heartbeats (<a href=\"https://github.com/monorkin/actioncable-presence-detection-demo/commit/82a851f0de0f8db414e3c8055fa28be4031ffd90\">and did a proof of concept for it</a>) as was suggested in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1237667974\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45112\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/45112/hovercard\" href=\"https://github.com/rails/rails/issues/45112\">#45112</a> and in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"153616312\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24908\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24908/hovercard\" href=\"https://github.com/rails/rails/issues/24908\">#24908</a>, but opted for PONG responses because <a href=\"https://developer.chrome.com/blog/timer-throttling-in-chrome-88/\" rel=\"nofollow\">Chrome recently added a feature that throttles setTimeout and setInterval to run at most once a minute if a tab isn't in focus</a>.</p>\n<p dir=\"auto\">This throttling would cause clients to reconnect loop if the half-open threshold is set to below 1 min. And heartbeats with intervals greater than 1 min aren't always desirable, like in my case where I want to know that a device went offline withing seconds. Chrome's throttling also <a href=\"https://github.com/socketio/socket.io/issues/2769#issuecomment-639300952\" data-hovercard-type=\"issue\" data-hovercard-url=\"/socketio/socket.io/issues/2769/hovercard\">prompted socket.io to change it's heartbeat to be server-initated</a>.</p>\n<h4 dir=\"auto\">Backwards and forwards compatibility</h4>\n<p dir=\"auto\">To ensure that clients that <em>don't</em> know about PONG messages can still work with servers that <em>do</em>, and for clients that <em>do</em> know about PONG messages to work with servers that <em>don't</em>; I've created a minor revision of the protocol - <code class=\"notranslate\">actioncable-v1.1-json</code>.</p>\n<p dir=\"auto\">If a client sends that in a <code class=\"notranslate\">Sec-WebSocket-Protocol</code> header to the server and the server responds with <code class=\"notranslate\">actioncable-v1.1-json</code> both the client and server know that they should send and expect PONG messages.</p>\n<p dir=\"auto\">If the client doesn't send <code class=\"notranslate\">Sec-WebSocket-Protocol: actioncable-v1.1-json</code> or the server doesn't respond with <code class=\"notranslate\">Sec-WebSocket-Protocol: actioncable-v1.1-json</code> then the behavior from <code class=\"notranslate\">actioncable-v1-json</code> is used.</p>\n<h4 dir=\"auto\">Why is this logic on the connection object instead of the stream object?</h4>\n<p dir=\"auto\">In <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1237667974\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45112\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/45112/hovercard\" href=\"https://github.com/rails/rails/issues/45112\">#45112</a> there was a suggestion to implement this as a timeout in the event-loop / select-loop.<br>\nFrom my understanding implementing it that way wouldn't be that much different from the implementation in this PR.<br>\nThere would be some kind of last_message_read_at timestamp that's checked in each iteration, and if a threshold is exceeded the socket would be closed.</p>\n<p dir=\"auto\">I implemented everything on the connection object because doimainwise it makes sense to me that a connection keeps the heartbeat and responds to it.</p>\n<p dir=\"auto\">Though I can see the benefits of having everything in the event loop. I have no strong opinion on this.</p>\n<h4 dir=\"auto\">What about dropped message detection from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"153616312\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24908\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24908/hovercard\" href=\"https://github.com/rails/rails/issues/24908\">#24908</a>?</h4>\n<p dir=\"auto\">I've opted not to tackle that in this PR as that seems to be a mini-framework within ActionCable.</p>\n<h4 dir=\"auto\">What about client-side latency measurements from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"153616312\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24908\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24908/hovercard\" href=\"https://github.com/rails/rails/issues/24908\">#24908</a>?</h4>\n<p dir=\"auto\">I've opted not to include that in this PR. But this could probably be done by adding an <code class=\"notranslate\">echo</code> type message, or repurposing <code class=\"notranslate\">ping</code>, that just echos back what the client sends to the server.</p>\n<h4 dir=\"auto\">What about client-set heartbeat frequency from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"153616312\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24908\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24908/hovercard\" href=\"https://github.com/rails/rails/issues/24908\">#24908</a>?</h4>\n<p dir=\"auto\">I've opted not to include that in this PR as it's an unrelated feature to this one.</p>\n<h4 dir=\"auto\">Why not native WebSocket PING and PONG messages like <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"320577446\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/32828\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/32828/hovercard\" href=\"https://github.com/rails/rails/pull/32828\">#32828</a>?</h4>\n<p dir=\"auto\">It currently isn't possible to process native PING and PONG messages in browsers, so an additional sub-protocol level heartbeat would be needed for clients to be able to detect that they have been disconnected. Therefore it makes more sense to have just the one sub-protocol level heartbeat for everything.</p>\n<h4 dir=\"auto\">What about the changelog?</h4>\n<p dir=\"auto\">The CHANGELOG file contains a link to the changes in Rails 7.1. I'm not sure what to do.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50039",
            "title": "Add ability to detect a half-open connection",
            "date_modified": "2023-11-15T11:08:41.000Z",
            "date_published": "2023-11-13T14:54:58.000Z",
            "author": {
                "name": "monorkin",
                "url": "https://github.com/monorkin"
            }
        }
    ]
}