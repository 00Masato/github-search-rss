{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1371733?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">When a blob is a representable of kind <code class=\"notranslate\">previewable</code>, the preview image that is being proxied is always the original preview image, discarding completely the <code class=\"notranslate\">variation_key</code> param passed in the request.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR fixes this by editing <code class=\"notranslate\">AS::Preview#image</code> to return the proper preview image variant, taking into account the <code class=\"notranslate\">variation_key</code> param. and returns the original preview image if <code class=\"notranslate\">variation_key</code> is blank?<br>\nThis is done while maintaining compatibility with the other representable types : <code class=\"notranslate\">AS::Variant</code> and <code class=\"notranslate\">AS::VariantWithRecord</code></p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I've added missing failing tests that would have caught this issue.</p>\n<p dir=\"auto\">It wasn't straightforward to fix. Because of some mismatches between <code class=\"notranslate\">AS::Variant</code> / <code class=\"notranslate\">AS::VariantWithRecord</code> / <code class=\"notranslate\">AS::Preview</code><br>\nFor example <code class=\"notranslate\">AS::Variant</code> adds a lot of redundant methods like <code class=\"notranslate\">#filename</code> ( which i believe has a wrong implementation btw but I didn't want to change a lot in this PR ) simply because <code class=\"notranslate\">AS::Variant#image</code> returns <code class=\"notranslate\">self</code> ( instance of a plain old ruby object). and any methods that are used with <code class=\"notranslate\">send_blob_stream</code></p>\n<p dir=\"auto\">(One test that is missing is when <code class=\"notranslate\">AS.track_variants</code> is false whill would return an <code class=\"notranslate\">AS::Variant</code>, I will update the PR )</p>\n<p dir=\"auto\">Here are the the lines that call <code class=\"notranslate\">@representation.image</code><br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/438cad462638b02210fc48b700c29dcd0428a8b7/activestorage/app/controllers/active_storage/representations/proxy_controller.rb#L14-L16\">rails/activestorage/app/controllers/active_storage/representations/proxy_controller.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 14 to 16\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/438cad462638b02210fc48b700c29dcd0428a8b7\">438cad4</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L14\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"14\"></td>\n          <td id=\"LC14\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">http_cache_forever</span> <span class=\"pl-pds\">public</span>: <span class=\"pl-c1\">true</span> <span class=\"pl-k\">do</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L15\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"15\"></td>\n          <td id=\"LC15\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">send_blob_stream</span> <span class=\"pl-c1\">@representation</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">image</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">disposition</span>: <span class=\"pl-en\">params</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:disposition</span><span class=\"pl-kos\">]</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L16\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"16\"></td>\n          <td id=\"LC16\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">If you have a better way to fix this please let me know <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/jonathanhefner/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jonathanhefner\">@jonathanhefner</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50098",
            "title": "[ActiveStorage] Fix AS:Representations::ProxyController returning the wrong preview",
            "date_modified": "2023-11-18T22:36:09.000Z",
            "date_published": "2023-11-18T22:02:31.000Z",
            "author": {
                "name": "chaadow",
                "url": "https://github.com/chaadow"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/12038583?u=ac2f7ffc061e858f2281a4c11cc06dcb0e77e690&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">On platforms without a high-resolution (nanosecond) clock, it is likely that the processing of an event will take less time than one complete clock resolution cycle, which means that the start and end times will be equal and the duration zero, failing these tests.  Usually these issues are fixed by adding a sleep of equal to one clock resolution cycle, but that is not applicable here since the duration measurement occurs in the actual library code rather than the test code, so just skip these tests on such platforms.  Also tested and confirmed that the tests are not skipped under normal platforms with a highres clock.</p>",
            "url": "https://github.com/rails/rails/pull/50097",
            "title": "Skip activesupport event processing tests on platforms w/o highres clock",
            "date_modified": "2023-11-18T17:53:01.000Z",
            "date_published": "2023-11-18T17:52:57.000Z",
            "author": {
                "name": "matoro",
                "url": "https://github.com/matoro"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/38360603?u=c869ef32043211dbb2793e3c8cf4faeb0d81fbb4&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The newly introduced <code class=\"notranslate\">ActiveRecord::Normalization</code> module allows to normalize attributes, it can receive any callable object that responds to <code class=\"notranslate\">call</code>. While we were using it, we found that we were calling a method that already <em>exists</em> on the normalized object, and hence can simply be \"forwarded\" to the object.</p>\n<p dir=\"auto\">To our surprise, it threw errors when we tried to supply the normalization to do as a symbol to be forwarded to the normalized object using <code class=\"notranslate\">Object#send</code>.</p>\n<p dir=\"auto\">I found it not Rails-y to do something like the following,</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Post\n  normalizes :body, with: -&gt; body { body.squish }\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span>\n  <span class=\"pl-en\">normalizes</span> <span class=\"pl-pds\">:body</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">with</span>: <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-s1\">body</span> <span class=\"pl-kos\">{</span> <span class=\"pl-s1\">body</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">squish</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">When you can simply supply the <code class=\"notranslate\">squish</code> as a symbol that then gets send to the object. With this proposed change, we can slim the code above into a more Ruby-ish and subsequently, Rails-ish way.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Post\n  normalizes :body, with: :squish\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span>\n  <span class=\"pl-en\">normalizes</span> <span class=\"pl-pds\">:body</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">with</span>: <span class=\"pl-pds\">:squish</span>\n<span class=\"pl-k\">end</span></pre></div>\n\n<p dir=\"auto\">This Pull Request has been created because the current implementation of the <code class=\"notranslate\">normalizes</code> method does not support a Symbol as an argument that gets forwarded to the object to normalize.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the <code class=\"notranslate\">ActiveRecord::Normalization::NormalizedValueType</code>'s <code class=\"notranslate\">normalizer:</code> argument to accept a Symbol that sends to the normalized object via <code class=\"notranslate\">Object#public_send</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50094",
            "title": "normalizer accepts symbols that the normalized object responds to",
            "date_modified": "2023-11-18T17:20:09.000Z",
            "date_published": "2023-11-18T14:34:53.000Z",
            "author": {
                "name": "rockwellll",
                "url": "https://github.com/rockwellll"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/84159?u=611f8cb6bdccc221b89e645b60cb8471d9269ada&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Next step in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1994508902\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50064\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50064/hovercard\" href=\"https://github.com/rails/rails/pull/50064\">#50064</a> by <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a>.</p>\n<h2 dir=\"auto\">Problem</h2>\n<p dir=\"auto\">We want to allow aliasing of DB adapters by name. The end state here is to allow <code class=\"notranslate\">mysql</code> to be mapped to either <code class=\"notranslate\">trilogy</code> or <code class=\"notranslate\">mysql2</code> at an application level. And allow others to do the same.</p>\n<p dir=\"auto\">The main refactor here is moving the adapter validation out of <code class=\"notranslate\">DatabaseConfig.new</code> and into a <code class=\"notranslate\">#validate</code> method that is called later.</p>\n<p dir=\"auto\">The reason for this refactor is that currently database configs are loaded by the framework so early that there isn't really a way to hook into registering/aliasing adapters before the configs are loaded and validated with <code class=\"notranslate\">.new</code>:</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/438cad462638b02210fc48b700c29dcd0428a8b7/activerecord/lib/active_record/railtie.rb#L305-L307\">rails/activerecord/lib/active_record/railtie.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 305 to 307\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/438cad462638b02210fc48b700c29dcd0428a8b7\">438cad4</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L305\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"305\"></td>\n          <td id=\"LC305\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">initializer</span> <span class=\"pl-s\">\"active_record.initialize_database\"</span> <span class=\"pl-k\">do</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L306\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"306\"></td>\n          <td id=\"LC306\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-v\">ActiveSupport</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">on_load</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:active_record</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L307\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"307\"></td>\n          <td id=\"LC307\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">configurations</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">application</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">database_configuration</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">The adapter needs to be registered with Active Record after it is loaded, but before configs are loaded, and because <code class=\"notranslate\">on_load(:active_record)</code> hooks are executed in order the above one is always executed before anything in the rails app, including the initializers. I even tried adding a <code class=\"notranslate\">:active_record_register_adapters</code> hook, but again the app initializers aren't run before this fires.</p>\n<h2 dir=\"auto\">Solution</h2>\n<p dir=\"auto\">As <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a> suggested, extract validation into a method on <code class=\"notranslate\">DatabaseConfig</code>. This has the added bonus of allowing the config subclasses further specialize validation.</p>\n<p dir=\"auto\">Also adds a method which I will use in the next step to <code class=\"notranslate\">alias(\"trilogy\", as: \"mysql\")</code>.</p>\n<h3 dir=\"auto\">Reproduction steps</h3>\n<p dir=\"auto\">I have validated this in a new rails app, by naming the \"sqlite3\" adapter \"potato\", and the app will run with the following steps:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ ../rails/railties/exe/rails new example --dev --skip-asset-pipeline --skip-javascript --skip-hotwire --skip-test\"><pre class=\"notranslate\"><code class=\"notranslate\">$ ../rails/railties/exe/rails new example --dev --skip-asset-pipeline --skip-javascript --skip-hotwire --skip-test\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ sed -i 's/adapter: sqlite3/adapter: potato/' config/database.yml\"><pre class=\"notranslate\"><code class=\"notranslate\">$ sed -i 's/adapter: sqlite3/adapter: potato/' config/database.yml\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ bin/rails environment\nbin/rails aborted!\nActiveRecord::AdapterNotFound: database configuration specifies nonexistent 'potato' adapter. Ensure that the adapter is spelled correctly in config/database.yml and that you've added the necessary adapter gem to your Gemfile. (ActiveRecord::AdapterNotFound)\"><pre class=\"notranslate\"><code class=\"notranslate\">$ bin/rails environment\nbin/rails aborted!\nActiveRecord::AdapterNotFound: database configuration specifies nonexistent 'potato' adapter. Ensure that the adapter is spelled correctly in config/database.yml and that you've added the necessary adapter gem to your Gemfile. (ActiveRecord::AdapterNotFound)\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ echo 'ActiveSupport.on_load(:active_record) { ActiveRecord::ConnectionAdapters.register(&quot;potato&quot;, &quot;ActiveRecord::ConnectionAdapters::SQLite3Adapter&quot;, &quot;active_record/connection_adapters/sqlite3_adapter&quot;) }' &gt; config/initializers/active_record_adapters.rb\"><pre class=\"notranslate\"><code class=\"notranslate\">$ echo 'ActiveSupport.on_load(:active_record) { ActiveRecord::ConnectionAdapters.register(\"potato\", \"ActiveRecord::ConnectionAdapters::SQLite3Adapter\", \"active_record/connection_adapters/sqlite3_adapter\") }' &gt; config/initializers/active_record_adapters.rb\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ bin/rails environment\n$ bin/rails runner 'puts &quot;#{ ActiveRecord::Base.connection.pool.db_config.adapter } / #{ ActiveRecord::Base.connection.adapter_name }&quot;'\npotato / SQLite\"><pre class=\"notranslate\"><code class=\"notranslate\">$ bin/rails environment\n$ bin/rails runner 'puts \"#{ ActiveRecord::Base.connection.pool.db_config.adapter } / #{ ActiveRecord::Base.connection.adapter_name }\"'\npotato / SQLite\n</code></pre></div>",
            "url": "https://github.com/rails/rails/pull/50093",
            "title": "Delay validation of registered Active Record adapters and allow aliasing of adapters",
            "date_modified": "2023-11-18T18:59:17.000Z",
            "date_published": "2023-11-18T13:32:01.000Z",
            "author": {
                "name": "kmcphillips",
                "url": "https://github.com/kmcphillips"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/118707?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I work on a rather large, robust Rails application that has some custom multi-database code. The default behavior of <code class=\"notranslate\">ActiveRecord::Base.clear_query_caches_for_current_thread</code> for cache clearing can result in a substantial number of cache misses between unrelated shards, (noted in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"743149311\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/40622\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/40622/hovercard\" href=\"https://github.com/rails/rails/pull/40622\">#40622</a>) - similarly as the methods passed to <code class=\"notranslate\">dirties_query_cache</code> in <code class=\"notranslate\">ActiveRecord::ConnectionAdapters::QueryCache</code> has changed (such as in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1682868612\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48061\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48061/hovercard\" href=\"https://github.com/rails/rails/pull/48061\">#48061</a>) this again changes the number of query cache hits, which can result in performance regressions. In both cases, the default behavior absolutely makes sense it is difficult to carve out an exception. In order to do so this requires making <code class=\"notranslate\">clear_query_caches_for_current_thread</code> a noop and then overwriting the target methods on the adapter classes.</p>\n<p dir=\"auto\">Rather than being prescriptive, this pull request maintains the current behavior and gives a more straightforward way for applications to modify the existing cache clearing behavior instead of monkey patching core Active Record classes.</p>\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>Add <code class=\"notranslate\">ActiveRecord#query_cache_clearing_strategy</code> as a singleton accessor that defaults to a <code class=\"notranslate\">Proc</code> that just calls <code class=\"notranslate\">ActiveRecord::Base.clear_query_caches_for_current_thread</code></li>\n<li>Replace the call to <code class=\"notranslate\">ActiveRecord::Base.clear_query_caches_for_current_thread</code> in the inline method definition in <code class=\"notranslate\">ActiveRecord::ConnectionAdapters::QueryCache</code> to call the new <code class=\"notranslate\">Proc</code> with the arguments of <code class=\"notranslate\">self</code>, the <code class=\"notranslate\">method_name</code> and args.</li>\n<li>Update the configuration guide to document this.</li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Since there is no change to the behavior as is, I have no additional tests added.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50091",
            "title": "Add `query_cache_clearing_strategy` to customize how the query cache clears",
            "date_modified": "2023-11-18T00:18:20.000Z",
            "date_published": "2023-11-18T00:18:15.000Z",
            "author": {
                "name": "jcalvert",
                "url": "https://github.com/jcalvert"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/26704491?u=db54a0798fb800751ceea6bd73cf3d2794ebb1ac&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR update the actiontext dependency to match with the latest dependent active storage version</p>",
            "url": "https://github.com/rails/rails/pull/50084",
            "title": "Fixed the dependencies of actiontext according to current actionstora…",
            "date_modified": "2023-11-18T21:19:38.000Z",
            "date_published": "2023-11-17T17:32:37.000Z",
            "author": {
                "name": "adityapandit17",
                "url": "https://github.com/adityapandit17"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/96426677?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #50078.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1997760191\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50078\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50078/hovercard\" href=\"https://github.com/rails/rails/issues/50078\">#50078</a></p>\n<p dir=\"auto\">This Pull Request has been created because I needed to sort a column ASC with nulls last with a MySQL database and wanted to avoid using an SQL fragment to achieve this. I discovered that Arel supports this for all databases apart from MySQL. When investigating the MySQL implementation, I noticed inconsistencies with how it is implemented.</p>\n<p dir=\"auto\">Originally, I was just aiming to make the functionality consistent, but then had a go at implementing the missing functionality.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the implementation of <code class=\"notranslate\">.nulls_first()</code> and <code class=\"notranslate\">.nulls_last()</code> for MySQL databases. These methods now work as designed.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50079",
            "title": "Arel nulls first/last implementation Mysql ",
            "date_modified": "2023-11-17T21:02:28.000Z",
            "date_published": "2023-11-16T21:13:53.000Z",
            "author": {
                "name": "tttffff",
                "url": "https://github.com/tttffff"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1530604?u=ce3bcded6b07f96722f7b3a0201a41002a314dff&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Add base62 method to SecureRandom</p>",
            "url": "https://github.com/rails/rails/pull/50073",
            "title": "Add base62 method to SecureRandom",
            "date_modified": "2023-11-18T12:26:22.000Z",
            "date_published": "2023-11-16T16:00:20.000Z",
            "author": {
                "name": "valenciaj",
                "url": "https://github.com/valenciaj"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/159?u=36438d464451d200a47a38f51180656aeb9a44d5&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This was added in back in bootsnap 1.15.0 (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1463505600\" data-permission-text=\"Title is private\" data-url=\"https://github.com/Shopify/bootsnap/issues/428\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/Shopify/bootsnap/pull/428/hovercard\" href=\"https://github.com/Shopify/bootsnap/pull/428\">Shopify/bootsnap#428</a>). This can save extra work and IO when the cache won't be changed, like is the case for docker containers</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the Dockerfile template used when creating a new application to add <code class=\"notranslate\">BOOTSNAP_READONLY=1</code></p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50065",
            "title": "Add BOOTSNAP_READONLY to Dockerfile template for production",
            "date_modified": "2023-11-16T17:27:05.000Z",
            "date_published": "2023-11-15T19:19:44.000Z",
            "author": {
                "name": "technicalpickles",
                "url": "https://github.com/technicalpickles"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Some of these were specifically mentioned earlier in the Metal docs (response_body=, content_type=, status=) but were not linked because the methods were not documented (due to being part of a delegation).</p>\n<p dir=\"auto\">This commit separates all of the delegated methods so that they can be documented, adds links for the mentioned methods, and additionally documents two methods on Response that are mentioned in the new Metal documentation, but were not previously documented.</p>",
            "url": "https://github.com/rails/rails/pull/50063",
            "title": "Add documentation for delegated methods on Metal",
            "date_modified": "2023-11-15T04:42:26.000Z",
            "date_published": "2023-11-15T04:36:15.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #50051.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1991817449\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50051\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50051/hovercard\" href=\"https://github.com/rails/rails/issues/50051\">#50051</a>.</p>\n<p dir=\"auto\">The test case is a preceding test case, adapted for this change.</p>",
            "url": "https://github.com/rails/rails/pull/50060",
            "title": "Fix permitting arrays in numbered parameters for `StrongParameters`",
            "date_modified": "2023-11-14T19:19:34.000Z",
            "date_published": "2023-11-14T18:00:21.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/28561?u=095779352a57f75e734987829f3f67a10e5780ed&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">As Active Record relations respond to <code class=\"notranslate\">include?</code>, calling <code class=\"notranslate\">in?</code> will perform a query if the relation hasn't been loaded yet:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"mary = Person.create(name: &quot;Mary&quot;)\n# =&gt; #&lt;Person id: 654, name: &quot;Mary&quot;&gt;\nmary.in?(Person.where(name: &quot;Alice&quot;))\n# SELECT 1 AS one FROM &quot;people&quot; WHERE &quot;people&quot;.&quot;name&quot; =&quot;Alice&quot; ...\"><pre class=\"notranslate\"><span class=\"pl-s1\">mary</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">name</span>: <span class=\"pl-s\">\"Mary\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\"># =&gt; #&lt;Person id: 654, name: \"Mary\"&gt;</span>\n<span class=\"pl-s1\">mary</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">in?</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Person</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">name</span>: <span class=\"pl-s\">\"Alice\"</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\"># SELECT 1 AS one FROM \"people\" WHERE \"people\".\"name\" =\"Alice\" ...</span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50059",
            "title": "Document `#in?` can perform queries for Active Record relations",
            "date_modified": "2023-11-15T20:03:43.000Z",
            "date_published": "2023-11-14T17:27:09.000Z",
            "author": {
                "name": "p8",
                "url": "https://github.com/p8"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The flexibility provided by <code class=\"notranslate\">config.x</code> supports arbitrarily defining new configuration objects on-the-fly. Each new intermediate configuration object is constructed during chaining from its ancestor through a method invocation made without arguments.</p>\n<p dir=\"auto\">Conversely, writing to leaf configuration values occurs when the invoked method's name ends with <code class=\"notranslate\">=</code>, and the new configuration value is assigned to whatever that method's arguments are.</p>\n<p dir=\"auto\">There are no cases when reading from a <code class=\"notranslate\">config.x</code> value or building the intermediate values<br>\ninvolves arguments.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Prior to this commit, a read invoked with a method arguments would ignore those arguments. While this is robust and error-free, it's possible to obscure misuse.</p>\n<p dir=\"auto\">For example, consider a line like:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"config.x.my_config.enabled = true\nconfig.x.my_config.enabled #=&gt; true\"><pre class=\"notranslate\"><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">my_config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">enabled</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">true</span>\n<span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">my_config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">enabled</span> <span class=\"pl-c\">#=&gt; true</span></pre></div>\n<p dir=\"auto\">Now consider that first line with a typo that omits the <code class=\"notranslate\">=</code>:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"config.x.my_config.enabled true\nconfig.x.my_config.enabled #=&gt; nil\"><pre class=\"notranslate\"><span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">my_config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">enabled</span> <span class=\"pl-c1\">true</span>\n<span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">my_config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">enabled</span> <span class=\"pl-c\">#=&gt; nil</span></pre></div>\n<p dir=\"auto\">This commit aims to provide more direct feedback for scenarios like the one above. There aren't legitimate use cases for invoking <code class=\"notranslate\">#enabled</code> with arguments, so raise a <code class=\"notranslate\">ArgumentError</code> when encountering a read with arguments.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50050",
            "title": "Raise `ArgumentError` when reading from `config.x` with arguments",
            "date_modified": "2023-11-14T20:11:05.000Z",
            "date_published": "2023-11-14T00:27:01.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/84159?u=611f8cb6bdccc221b89e645b60cb8471d9269ada&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h2 dir=\"auto\">Problem</h2>\n<p dir=\"auto\">When <a href=\"https://github.com/rails/rails/blob/757f4896417f86b58303e416f4040a2b434abdd6/activerecord/lib/active_record.rb#L208-L213\"><code class=\"notranslate\">ActiveRecord.db_warnings_action</code></a> is set to anything other than <code class=\"notranslate\">:ignore</code>, I would expect that it would <em>always be called</em> when there are warnings.</p>\n<p dir=\"auto\">In MySQL this is not necessarily the case though. In the <code class=\"notranslate\">AbstractMysqlAdapter</code> the warnings are handled in two statements:<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/757f4896417f86b58303e416f4040a2b434abdd6/activerecord/lib/active_record/connection_adapters/abstract_mysql_adapter.rb#L750-L754\">rails/activerecord/lib/active_record/connection_adapters/abstract_mysql_adapter.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 750 to 754\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/757f4896417f86b58303e416f4040a2b434abdd6\">757f489</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L750\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"750\"></td>\n          <td id=\"LC750\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">return</span> <span class=\"pl-k\">if</span> <span class=\"pl-v\">ActiveRecord</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">db_warnings_action</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">nil?</span> || <span class=\"pl-c1\">@raw_connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">warning_count</span> == <span class=\"pl-c1\">0</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L751\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"751\"></td>\n          <td id=\"LC751\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L752\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"752\"></td>\n          <td id=\"LC752\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">@affected_rows_before_warnings</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">@raw_connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">affected_rows</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L753\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"753\"></td>\n          <td id=\"LC753\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">result</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">@raw_connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">query</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"SHOW WARNINGS\"</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L754\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"754\"></td>\n          <td id=\"LC754\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">result</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">level</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">code</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">message</span>| </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Simplified, but the logic is:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"query_result = raw_connection.query(sql)\nif raw_connection.warning_count != 0\n  warning_result = raw_connection.query(&quot;SHOW WARNINGS&quot;)\n  warning_result.each do |warning|\n    ActiveRecord.db_warnings_action(warning)\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-s1\">query_result</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">raw_connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">query</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">sql</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">if</span> <span class=\"pl-en\">raw_connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">warning_count</span> != <span class=\"pl-c1\">0</span>\n  <span class=\"pl-s1\">warning_result</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">raw_connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">query</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"SHOW WARNINGS\"</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-s1\">warning_result</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">warning</span>|\n    <span class=\"pl-v\">ActiveRecord</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">db_warnings_action</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">warning</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">So the query returns <code class=\"notranslate\">warning_count</code> as metadata from the result. A second <code class=\"notranslate\">\"SHOW WARNINGS\"</code> query is executed to get the warnings, and is assumed to always be correct. I know of two instances where this will return <code class=\"notranslate\">[]</code> despite <code class=\"notranslate\">warning_count</code> being greater than 0:</p>\n<ul dir=\"auto\">\n<li>If MySQL <code class=\"notranslate\">max_error_count</code> is set to 0, warnings are counted but never persisted, so <code class=\"notranslate\">SHOW WARNINGS</code> is always empty. <a href=\"https://dev.mysql.com/doc/refman/8.0/en/show-warnings.html\" rel=\"nofollow\">(source)</a></li>\n<li>If you are using ProxySQL it does not appear to propagate warnings at all. (see <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"372920090\" data-permission-text=\"Title is private\" data-url=\"https://github.com/sysown/proxysql/issues/1751\" data-hovercard-type=\"issue\" data-hovercard-url=\"/sysown/proxysql/issues/1751/hovercard\" href=\"https://github.com/sysown/proxysql/issues/1751\">sysown/proxysql#1751</a>)</li>\n</ul>\n<p dir=\"auto\">There may be others.</p>\n<p dir=\"auto\">So the behaviour to the user is that even when <code class=\"notranslate\">db_warnings_action</code> is set to something like <code class=\"notranslate\">:raise</code> or a proc, <strong>it is never executed and no warning is ever surfaced</strong>.</p>\n<h2 dir=\"auto\">Solution</h2>\n<p dir=\"auto\">In the case where <code class=\"notranslate\">warning_count</code> is non-zero, but <code class=\"notranslate\">SHOW WARNINGS</code> returns <code class=\"notranslate\">[]</code>, add a single warning with an error message. This isn't a super helpful message, but it is better than silently hiding that any warnings were encountered. This allows the user to update their DB config, or add a custom proc to report on or track warnings as is appropriate for their use case.</p>\n<p dir=\"auto\">I also found that <code class=\"notranslate\">trilogy</code> did not test the warning behaviour at all, so I first added tests for warnings that are essentially copies of what is done in the <code class=\"notranslate\">mysql2</code> tests.</p>\n<h3 dir=\"auto\">Questions</h3>\n<ul dir=\"auto\">\n<li>How is the voice and tone of the error message? I'm not tied to it, but it's the best I could come up with.</li>\n<li>Should I include documentation around <code class=\"notranslate\">db_warnings_action</code> with hints on how to tune the DB to prevent this state from occurring? I don't feel like it's the right place and I'm not sure if we give hints on infra in other places in the docs. Seems too specific and like it would get out of date.</li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/adrianna-chang-shopify/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/adrianna-chang-shopify\">@adrianna-chang-shopify</a></p>",
            "url": "https://github.com/rails/rails/pull/50049",
            "title": "Handle case in MySQL where the `ActiveRecord.db_warnings_action` is not called even when a DB query has warnings",
            "date_modified": "2023-11-14T15:52:20.000Z",
            "date_published": "2023-11-13T21:31:47.000Z",
            "author": {
                "name": "kmcphillips",
                "url": "https://github.com/kmcphillips"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1655218?u=e159b7a9f5a2172e4e7e2aed6a9c69ee107b9144&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I have IoT devices connecting to my Rails app via ActionCable, and I want to log when a device connects or disconnects.</p>\n<p dir=\"auto\">This is already doable via <code class=\"notranslate\">Cahnnel#subscribed</code> and <code class=\"notranslate\">Channel#unsubscribed</code>; and it works pretty well when a device properly connects, subscribes, and disconnects.</p>\n<p dir=\"auto\">But when a device improperly disconnects - e.g. if it gets unplugged from the network - its ActionCable connection doesn't close and can linger in the system for up to half an hour.</p>\n<p dir=\"auto\">This means that the server is using up resources to manage this connection, and send messages to it, when there isn't a client to receive them (since a client will reconnect if it misses 2 heartbeats which is about 6 sec). Some of these issues have been commented on in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1237667974\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45112\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/45112/hovercard\" href=\"https://github.com/rails/rails/issues/45112\">#45112</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"153616312\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24908\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24908/hovercard\" href=\"https://github.com/rails/rails/issues/24908\">#24908</a></p>\n<p dir=\"auto\">Currently, ActionCable doesn't have a mechanism to detect if it's connection is half-open (if a there is a client listening on the other end).</p>\n<p dir=\"auto\">This PR changes the protocol so that a client has to respond to a PING message with a PONG message. If it doesn't do so within 2 heartbeats (6 sec) the connection is assumed to be half-open and is closed.</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #45112.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1237667974\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45112\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/45112/hovercard\" href=\"https://github.com/rails/rails/issues/45112\">#45112</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #24908.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"153616312\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24908\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24908/hovercard\" href=\"https://github.com/rails/rails/issues/24908\">#24908</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #29307.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"232767165\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/29307\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/29307/hovercard\" href=\"https://github.com/rails/rails/issues/29307\">#29307</a><br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #32828.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"320577446\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/32828\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/32828/hovercard\" href=\"https://github.com/rails/rails/pull/32828\">#32828</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<h4 dir=\"auto\">Why not client-initiated heartbeats?</h4>\n<p dir=\"auto\">I've considered implementing client-initiated heartbeats (<a href=\"https://github.com/monorkin/actioncable-presence-detection-demo/commit/82a851f0de0f8db414e3c8055fa28be4031ffd90\">and did a proof of concept for it</a>) as was suggested in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1237667974\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45112\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/45112/hovercard\" href=\"https://github.com/rails/rails/issues/45112\">#45112</a> and in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"153616312\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24908\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24908/hovercard\" href=\"https://github.com/rails/rails/issues/24908\">#24908</a>, but opted for PONG responses because <a href=\"https://developer.chrome.com/blog/timer-throttling-in-chrome-88/\" rel=\"nofollow\">Chrome recently added a feature that throttles setTimeout and setInterval to run at most once a minute if a tab isn't in focus</a>.</p>\n<p dir=\"auto\">This throttling would cause clients to reconnect loop if the half-open threshold is set to below 1 min. And heartbeats with intervals greater than 1 min aren't always desirable, like in my case where I want to know that a device went offline withing seconds. Chrome's throttling also <a href=\"https://github.com/socketio/socket.io/issues/2769#issuecomment-639300952\" data-hovercard-type=\"issue\" data-hovercard-url=\"/socketio/socket.io/issues/2769/hovercard\">prompted socket.io to change it's heartbeat to be server-initated</a>.</p>\n<h4 dir=\"auto\">Backwards and forwards compatibility</h4>\n<p dir=\"auto\">To ensure that clients that <em>don't</em> know about PONG messages can still work with servers that <em>do</em>, and for clients that <em>do</em> know about PONG messages to work with servers that <em>don't</em>; I've created a minor revision of the protocol - <code class=\"notranslate\">actioncable-v1.1-json</code>.</p>\n<p dir=\"auto\">If a client sends that in a <code class=\"notranslate\">Sec-WebSocket-Protocol</code> header to the server and the server responds with <code class=\"notranslate\">actioncable-v1.1-json</code> both the client and server know that they should send and expect PONG messages.</p>\n<p dir=\"auto\">If the client doesn't send <code class=\"notranslate\">Sec-WebSocket-Protocol: actioncable-v1.1-json</code> or the server doesn't respond with <code class=\"notranslate\">Sec-WebSocket-Protocol: actioncable-v1.1-json</code> then the behavior from <code class=\"notranslate\">actioncable-v1-json</code> is used.</p>\n<h4 dir=\"auto\">Why is this logic on the connection object instead of the stream object?</h4>\n<p dir=\"auto\">In <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1237667974\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45112\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/45112/hovercard\" href=\"https://github.com/rails/rails/issues/45112\">#45112</a> there was a suggestion to implement this as a timeout in the event-loop / select-loop.<br>\nFrom my understanding implementing it that way wouldn't be that much different from the implementation in this PR.<br>\nThere would be some kind of last_message_read_at timestamp that's checked in each iteration, and if a threshold is exceeded the socket would be closed.</p>\n<p dir=\"auto\">I implemented everything on the connection object because doimainwise it makes sense to me that a connection keeps the heartbeat and responds to it.</p>\n<p dir=\"auto\">Though I can see the benefits of having everything in the event loop. I have no strong opinion on this.</p>\n<h4 dir=\"auto\">What about dropped message detection from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"153616312\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24908\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24908/hovercard\" href=\"https://github.com/rails/rails/issues/24908\">#24908</a>?</h4>\n<p dir=\"auto\">I've opted not to tackle that in this PR as that seems to be a mini-framework within ActionCable.</p>\n<h4 dir=\"auto\">What about client-side latency measurements from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"153616312\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24908\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24908/hovercard\" href=\"https://github.com/rails/rails/issues/24908\">#24908</a>?</h4>\n<p dir=\"auto\">I've opted not to include that in this PR. But this could probably be done by adding an <code class=\"notranslate\">echo</code> type message, or repurposing <code class=\"notranslate\">ping</code>, that just echos back what the client sends to the server.</p>\n<h4 dir=\"auto\">What about client-set heartbeat frequency from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"153616312\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24908\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24908/hovercard\" href=\"https://github.com/rails/rails/issues/24908\">#24908</a>?</h4>\n<p dir=\"auto\">I've opted not to include that in this PR as it's an unrelated feature to this one.</p>\n<h4 dir=\"auto\">Why not native WebSocket PING and PONG messages like <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"320577446\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/32828\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/32828/hovercard\" href=\"https://github.com/rails/rails/pull/32828\">#32828</a>?</h4>\n<p dir=\"auto\">It currently isn't possible to process native PING and PONG messages in browsers, so an additional sub-protocol level heartbeat would be needed for clients to be able to detect that they have been disconnected. Therefore it makes more sense to have just the one sub-protocol level heartbeat for everything.</p>\n<h4 dir=\"auto\">What about the changelog?</h4>\n<p dir=\"auto\">The CHANGELOG file contains a link to the changes in Rails 7.1. I'm not sure what to do.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50039",
            "title": "Add ability to detect a half-open connection",
            "date_modified": "2023-11-15T11:08:41.000Z",
            "date_published": "2023-11-13T14:54:58.000Z",
            "author": {
                "name": "monorkin",
                "url": "https://github.com/monorkin"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Trying to debug <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1967223028\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49841\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49841/hovercard\" href=\"https://github.com/rails/rails/issues/49841\">#49841</a>.</p>",
            "url": "https://github.com/rails/rails/pull/50037",
            "title": "Debug CI flaky test",
            "date_modified": "2023-11-15T11:11:26.000Z",
            "date_published": "2023-11-13T00:22:44.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/22231095?u=fc75f9764434943effe06d6c1dc48d40a5003b0c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><code class=\"notranslate\">uglifier</code> is an outdated and not used in modernjs application instead of that it recommends to use <code class=\"notranslate\">terser</code>.<br>\nref: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1049157852\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/43623\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/43623/hovercard\" href=\"https://github.com/rails/rails/pull/43623\">#43623</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request removes <code class=\"notranslate\">uglifier</code> from the guide and test.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50023",
            "title": "Remove uglifier from guide and test",
            "date_modified": "2023-11-18T16:38:32.000Z",
            "date_published": "2023-11-12T07:12:22.000Z",
            "author": {
                "name": "akhilgkrishnan",
                "url": "https://github.com/akhilgkrishnan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49926.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1977782020\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49926\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49926/hovercard\" href=\"https://github.com/rails/rails/issues/49926\">#49926</a>.</p>\n<p dir=\"auto\">Currently, <code class=\"notranslate\">ActiveRecord.dump_schemas</code> (introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"61916304\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/19347\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/19347/hovercard\" href=\"https://github.com/rails/rails/pull/19347\">#19347</a>) is only considered when dumping schema in a <code class=\"notranslate\">:sql</code> format. This PR fixes that by considering it also when dumping in a <code class=\"notranslate\">:ruby</code> format.</p>",
            "url": "https://github.com/rails/rails/pull/50020",
            "title": "Fix schema dumper to account for `ActiveRecord.dump_schemas` when dumping in `:ruby` format",
            "date_modified": "2023-11-13T21:39:15.000Z",
            "date_published": "2023-11-11T19:51:48.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/10229505?u=2871863a7667f0f4103aebc38dc1cb1835b9a632&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><a href=\"https://www.npmjs.com/package/karma\" rel=\"nofollow\">karma</a> npm package, used in actioncable and actionview, has been stale.</p>\n<p dir=\"auto\">karma 3.x was stable in 2018, but 6.x is now the latest.</p>\n<p dir=\"auto\">This Pull Request has been created because Rails developers are to use the latest karma and latest Node.js (20 LTS or 21).</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request updates karma package from 3.1.4 to 6.4.2, which prevents from using <code class=\"notranslate\">chokidar@2</code> (or <code class=\"notranslate\">fsevents@1</code>).</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The package was introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"380461495\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/34440\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/34440/hovercard\" href=\"https://github.com/rails/rails/pull/34440\">#34440</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1400973915\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46206\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/46206/hovercard\" href=\"https://github.com/rails/rails/pull/46206\">#46206</a>. Also this change follows up <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1975819154\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49901\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49901/hovercard\" href=\"https://github.com/rails/rails/pull/49901\">#49901</a> (Node.js 20).</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li>[n/a] Tests are added or updated if you fix a bug or add a feature.</li>\n<li>[n/a] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50018",
            "title": "test: update karma npm from 3.1.4 to 6.4.2",
            "date_modified": "2023-11-18T21:28:25.000Z",
            "date_published": "2023-11-11T14:53:27.000Z",
            "author": {
                "name": "tnir",
                "url": "https://github.com/tnir"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6979737?u=e5fc89c5f1b12b1fb83f942c742af204df2d1ca1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #26295.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"173580677\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/26295\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/26295/hovercard\" href=\"https://github.com/rails/rails/issues/26295\">#26295</a>. It was closed due to the issue becoming stale, not because it was fixed. It never had a satisfactory fix.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request modifies the order of attribute assignments for associations, e.g. <code class=\"notranslate\">collection.build</code> and <code class=\"notranslate\">build_foo</code>. Previously, if you were to build a record from an association, the attributes derived from the scope would be applied last. This is problematic when a setter on the model expects those scope values to be present, since they were technically defined first. This has bitten me a few times in a multi-tenant application, requiring a workaround where you supply the scope attributes again in <code class=\"notranslate\">#build</code>.</p>\n<p dir=\"auto\">I've tried to make this backwards compatible, by first applying the attributes from the scope via <code class=\"notranslate\">#scope_for_create</code>, then applying the provided attributes to <code class=\"notranslate\">#build</code> minus foreign keys from <code class=\"notranslate\">#scope_for_create</code>, and then finally initializing the record normally.</p>\n<p dir=\"auto\">Here's a small reproduction script of the problem: <a href=\"https://gist.github.com/ezekg/5722f5af2b79061a4f945d49f3ce734b\">https://gist.github.com/ezekg/5722f5af2b79061a4f945d49f3ce734b</a> (modified from <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/heaven/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/heaven\">@heaven</a>'s original reproduction script: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"173580677\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/26295\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/26295/hovercard?comment_id=246189123&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/issues/26295#issuecomment-246189123\">#26295 (comment)</a>)</p>\n<p dir=\"auto\">I've written tests that fail without the changes to the <code class=\"notranslate\">#build_record</code> method.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/50014",
            "title": "Fix order of scope- vs user-derived attribute assignments",
            "date_modified": "2023-11-15T16:44:22.000Z",
            "date_published": "2023-11-10T23:09:28.000Z",
            "author": {
                "name": "ezekg",
                "url": "https://github.com/ezekg"
            }
        }
    ]
}