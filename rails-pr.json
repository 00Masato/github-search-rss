{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This warning occurs three times before this:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\".W, [2023-10-17T19:15:46.723620 9821]  WARN -- : You are running SQLite in production, this is generally not recommended. You can disable this warning by setting &quot;config.active_record.sqlite3_production_warning=false&quot;.\n........W, [2023-10-17T19:15:47.315464 9832]  WARN -- : You are running SQLite in production, this is generally not recommended. You can disable this warning by setting &quot;config.active_record.sqlite3_production_warning=false&quot;.\n....W, [2023-10-17T19:16:03.776050 10140]  WARN -- : You are running SQLite in production, this is generally not recommended. You can disable this warning by setting &quot;config.active_record.sqlite3_production_warning=false&quot;.\"><pre class=\"notranslate\"><code class=\"notranslate\">.W, [2023-10-17T19:15:46.723620 9821]  WARN -- : You are running SQLite in production, this is generally not recommended. You can disable this warning by setting \"config.active_record.sqlite3_production_warning=false\".\n........W, [2023-10-17T19:15:47.315464 9832]  WARN -- : You are running SQLite in production, this is generally not recommended. You can disable this warning by setting \"config.active_record.sqlite3_production_warning=false\".\n....W, [2023-10-17T19:16:03.776050 10140]  WARN -- : You are running SQLite in production, this is generally not recommended. You can disable this warning by setting \"config.active_record.sqlite3_production_warning=false\".\n</code></pre></div>\n<p dir=\"auto\">This PR is blocked by <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1966939284\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49835\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49835/hovercard\" href=\"https://github.com/rails/rails/pull/49835\">#49835</a> since there are now multiple settings for config.active_record, which results in the following errors:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error:\nApplicationTests::ConfigurationTest#test_the_application_root_can_be_set:\nNoMethodError: undefined method `active_record' for #&lt;Rails::Application::Configuration:0x00000001063d7320&gt;\n    /Users/zzak/code/rails/railties/lib/rails/railtie/configuration.rb:96:in `method_missing'\n    /Users/zzak/code/rails/tmp/d20231030-68543-vf3ndb/app/config/application.rb:28:in `&lt;class:Application&gt;'\n    /Users/zzak/code/rails/tmp/d20231030-68543-vf3ndb/app/config/application.rb:10:in `&lt;module:AppTemplate&gt;'\n    /Users/zzak/code/rails/tmp/d20231030-68543-vf3ndb/app/config/application.rb:9:in `&lt;top (required)&gt;'\n    /Users/zzak/code/rails/tmp/d20231030-68543-vf3ndb/app/config/environment.rb:2:in `require_relative'\n    /Users/zzak/code/rails/tmp/d20231030-68543-vf3ndb/app/config/environment.rb:2:in `&lt;top (required)&gt;'\n    &lt;internal:/Users/zzak/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require'\n    &lt;internal:/Users/zzak/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require'\n    /Users/zzak/code/rails/railties/test/application/configuration_test.rb:55:in `app'\n    /Users/zzak/code/rails/railties/test/application/configuration_test.rb:260:in `block in &lt;class:ConfigurationTest&gt;'\"><pre class=\"notranslate\"><code class=\"notranslate\">Error:\nApplicationTests::ConfigurationTest#test_the_application_root_can_be_set:\nNoMethodError: undefined method `active_record' for #&lt;Rails::Application::Configuration:0x00000001063d7320&gt;\n    /Users/zzak/code/rails/railties/lib/rails/railtie/configuration.rb:96:in `method_missing'\n    /Users/zzak/code/rails/tmp/d20231030-68543-vf3ndb/app/config/application.rb:28:in `&lt;class:Application&gt;'\n    /Users/zzak/code/rails/tmp/d20231030-68543-vf3ndb/app/config/application.rb:10:in `&lt;module:AppTemplate&gt;'\n    /Users/zzak/code/rails/tmp/d20231030-68543-vf3ndb/app/config/application.rb:9:in `&lt;top (required)&gt;'\n    /Users/zzak/code/rails/tmp/d20231030-68543-vf3ndb/app/config/environment.rb:2:in `require_relative'\n    /Users/zzak/code/rails/tmp/d20231030-68543-vf3ndb/app/config/environment.rb:2:in `&lt;top (required)&gt;'\n    &lt;internal:/Users/zzak/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require'\n    &lt;internal:/Users/zzak/.rbenv/versions/3.2.2/lib/ruby/3.2.0/rubygems/core_ext/kernel_require.rb&gt;:37:in `require'\n    /Users/zzak/code/rails/railties/test/application/configuration_test.rb:55:in `app'\n    /Users/zzak/code/rails/railties/test/application/configuration_test.rb:260:in `block in &lt;class:ConfigurationTest&gt;'\n</code></pre></div>",
            "url": "https://github.com/rails/rails/pull/49844",
            "title": "[7-0-stable] Quiet sqlite3_production_warning on railties/configuration_test",
            "date_modified": "2023-10-30T02:50:49.000Z",
            "date_published": "2023-10-30T02:50:45.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This warning occurs three times before this:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\".W, [2023-10-17T19:15:46.723620 #9821]  WARN -- : You are running SQLite in production, this is generally not recommended. You can disable this warning by setting &quot;config.active_record.sqlite3_production_warning=false&quot;.\n........W, [2023-10-17T19:15:47.315464 #9832]  WARN -- : You are running SQLite in production, this is generally not recommended. You can disable this warning by setting &quot;config.active_record.sqlite3_production_warning=false&quot;.\n....W, [2023-10-17T19:16:03.776050 #10140]  WARN -- : You are running SQLite in production, this is generally not recommended. You can disable this warning by setting &quot;config.active_record.sqlite3_production_warning=false&quot;.\"><pre class=\"notranslate\"><code class=\"notranslate\">.W, [2023-10-17T19:15:46.723620 #9821]  WARN -- : You are running SQLite in production, this is generally not recommended. You can disable this warning by setting \"config.active_record.sqlite3_production_warning=false\".\n........W, [2023-10-17T19:15:47.315464 #9832]  WARN -- : You are running SQLite in production, this is generally not recommended. You can disable this warning by setting \"config.active_record.sqlite3_production_warning=false\".\n....W, [2023-10-17T19:16:03.776050 #10140]  WARN -- : You are running SQLite in production, this is generally not recommended. You can disable this warning by setting \"config.active_record.sqlite3_production_warning=false\".\n</code></pre></div>\n<p dir=\"auto\">This PR is blocked by <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1966938274\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49834\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49834/hovercard\" href=\"https://github.com/rails/rails/pull/49834\">#49834</a> since there are now multiple settings for <code class=\"notranslate\">config.active_record</code>, which results in the following errors:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error:\nApplicationTests::ConfigurationTest#test_the_application_root_can_be_set:\nNoMethodError: undefined method `active_record' for #&lt;Rails::Application::Configuration:0x000000000032c8&gt;\n    /Users/zzak/code/rails/railties/lib/rails/railtie/configuration.rb:109:in `method_missing'\n    /Users/zzak/code/rails/tmp/d20231030-66254-n6lfzq/app/config/application.rb:34:in `&lt;class:Application&gt;'\n    /Users/zzak/code/rails/tmp/d20231030-66254-n6lfzq/app/config/application.rb:10:in `&lt;module:AppTemplate&gt;'\n    /Users/zzak/code/rails/tmp/d20231030-66254-n6lfzq/app/config/application.rb:9:in `&lt;top (required)&gt;'\n    /Users/zzak/code/rails/tmp/d20231030-66254-n6lfzq/app/config/environment.rb:2:in `require_relative'\n    /Users/zzak/code/rails/tmp/d20231030-66254-n6lfzq/app/config/environment.rb:2:in `&lt;top (required)&gt;'\n    /Users/zzak/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/zeitwerk-2.6.12/lib/zeitwerk/kernel.rb:38:in `require'\n    /Users/zzak/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/zeitwerk-2.6.12/lib/zeitwerk/kernel.rb:38:in `require'\n    /Users/zzak/code/rails/railties/test/application/configuration_test.rb:63:in `app'\n    /Users/zzak/code/rails/railties/test/application/configuration_test.rb:270:in `block in &lt;class:ConfigurationTest&gt;'\"><pre class=\"notranslate\"><code class=\"notranslate\">Error:\nApplicationTests::ConfigurationTest#test_the_application_root_can_be_set:\nNoMethodError: undefined method `active_record' for #&lt;Rails::Application::Configuration:0x000000000032c8&gt;\n    /Users/zzak/code/rails/railties/lib/rails/railtie/configuration.rb:109:in `method_missing'\n    /Users/zzak/code/rails/tmp/d20231030-66254-n6lfzq/app/config/application.rb:34:in `&lt;class:Application&gt;'\n    /Users/zzak/code/rails/tmp/d20231030-66254-n6lfzq/app/config/application.rb:10:in `&lt;module:AppTemplate&gt;'\n    /Users/zzak/code/rails/tmp/d20231030-66254-n6lfzq/app/config/application.rb:9:in `&lt;top (required)&gt;'\n    /Users/zzak/code/rails/tmp/d20231030-66254-n6lfzq/app/config/environment.rb:2:in `require_relative'\n    /Users/zzak/code/rails/tmp/d20231030-66254-n6lfzq/app/config/environment.rb:2:in `&lt;top (required)&gt;'\n    /Users/zzak/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/zeitwerk-2.6.12/lib/zeitwerk/kernel.rb:38:in `require'\n    /Users/zzak/.rbenv/versions/3.2.2/lib/ruby/gems/3.2.0/gems/zeitwerk-2.6.12/lib/zeitwerk/kernel.rb:38:in `require'\n    /Users/zzak/code/rails/railties/test/application/configuration_test.rb:63:in `app'\n    /Users/zzak/code/rails/railties/test/application/configuration_test.rb:270:in `block in &lt;class:ConfigurationTest&gt;'\n</code></pre></div>",
            "url": "https://github.com/rails/rails/pull/49843",
            "title": "[7-1-stable] Quiet sqlite3_production_warning on railties/configuration_test",
            "date_modified": "2023-10-30T02:56:54.000Z",
            "date_published": "2023-10-30T02:12:36.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49752.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1958096764\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49752\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49752/hovercard\" href=\"https://github.com/rails/rails/issues/49752\">#49752</a>.</p>\n<p dir=\"auto\">MariaDB since version 10.7 natively supports <a href=\"https://mariadb.com/kb/en/uuid-data-type/\" rel=\"nofollow\"><code class=\"notranslate\">uuid</code> data type</a>. Also, since 10.5 supports <a href=\"https://mariadb.com/kb/en/insertreturning/\" rel=\"nofollow\"><code class=\"notranslate\">INSERT ... RETURNING</code></a>.</p>\n<p dir=\"auto\">This PR adds support for <code class=\"notranslate\">uuid</code> type for MariaDB only.</p>\n<p dir=\"auto\">MySQL, unfortunately, as usual does not support anything. There are some hacks on how people manually implement \"uuid\" data type. For example, using a <code class=\"notranslate\">BINARY(16)</code> column with a <code class=\"notranslate\">UUID_TO_BIN(UUID())</code> as a default or a <code class=\"notranslate\">VARCHAR(36)</code> with <code class=\"notranslate\">UUID()</code> as a default. See <a href=\"https://blogs.oracle.com/mysql/post/mysql-uuids\" rel=\"nofollow\">https://blogs.oracle.com/mysql/post/mysql-uuids</a> or <a href=\"https://dev.mysql.com/blog-archive/mysql-8-0-uuid-support/\" rel=\"nofollow\">https://dev.mysql.com/blog-archive/mysql-8-0-uuid-support/</a> for detailed examples. But since MySQL does not support <code class=\"notranslate\">RETURNING</code>, there is no way we can retrieve these values during the <code class=\"notranslate\">INSERT</code> without the <code class=\"notranslate\">record.reload</code>. Or, differently, we must manually set the uuid before creating a record.</p>\n<p dir=\"auto\">So, the question is: Should we add also support for MySQL, expecting that people will manually set the default?<br>\nSomething like:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"attribute :guid, :uuid, default: -&gt; { SomeUuidGenerator.generate }\"><pre class=\"notranslate\"><span class=\"pl-en\">attribute</span> <span class=\"pl-pds\">:guid</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:uuid</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">default</span>: <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-v\">SomeUuidGenerator</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">generate</span> <span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">The added test cases are basically adopted tests for PostgreSQL uuid (<a href=\"https://github.com/rails/rails/blob/main/activerecord/test/cases/adapters/postgresql/uuid_test.rb\">https://github.com/rails/rails/blob/main/activerecord/test/cases/adapters/postgresql/uuid_test.rb</a>).</p>\n<p dir=\"auto\">Before merging this PR, <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1967219246\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49840\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49840/hovercard\" href=\"https://github.com/rails/rails/pull/49840\">#49840</a> should be merged, because these have overlapping code regarding <code class=\"notranslate\">RETURNING</code> for MariaDB.</p>",
            "url": "https://github.com/rails/rails/pull/49842",
            "title": "Support `uuid` type for MariaDB 10.7.0+",
            "date_modified": "2023-10-30T01:10:06.000Z",
            "date_published": "2023-10-30T01:10:01.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This is a rebased <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1902605602\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49315\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49315/hovercard\" href=\"https://github.com/rails/rails/pull/49315\">#49315</a> PR with addressed feedback.<br>\nI will need these changes for <a href=\"https://github.com/rails/rails/issues/49752#issuecomment-1783439384\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49752/hovercard\">my effort</a> of supporting <code class=\"notranslate\">uuid</code> data type for MySQL/MariaDB.</p>\n<p dir=\"auto\">I added a test case which tests that dynamic database defaults are populated after the <code class=\"notranslate\">INSERT</code>. <code class=\"notranslate\">insert_all</code>-like methods also support <code class=\"notranslate\">:returning</code>, but these are already tested </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/820fbd9102a5488f3bfcc91ec35324b7076cc83e/activerecord/test/cases/insert_all_test.rb#L90\">rails/activerecord/test/cases/insert_all_test.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 90\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/820fbd9102a5488f3bfcc91ec35324b7076cc83e\">820fbd9</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L90\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"90\"></td>\n          <td id=\"LC90\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">skip</span> <span class=\"pl-k\">unless</span> <span class=\"pl-en\">supports_insert_returning?</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #49315.\">Closes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1902605602\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49315\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49315/hovercard\" href=\"https://github.com/rails/rails/pull/49315\">#49315</a>.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/nvasilevski/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/nvasilevski\">@nvasilevski</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/adrianna-chang-shopify/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/adrianna-chang-shopify\">@adrianna-chang-shopify</a></p>",
            "url": "https://github.com/rails/rails/pull/49840",
            "title": "Support `RETURNING` clause for MariaDB",
            "date_modified": "2023-10-30T00:27:35.000Z",
            "date_published": "2023-10-29T23:35:47.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Using <code class=\"notranslate\">config.secret_key_base</code> currently raises a deprecation warning when used in production because <code class=\"notranslate\">config.secret_key_base</code> gets merged into the <code class=\"notranslate\">secrets</code> hash instead of being looked up specifically in the <code class=\"notranslate\">secret_key_base</code> method.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit addresses this by not raising a deprecation warning if <code class=\"notranslate\">secrets.secret_key_base</code> and <code class=\"notranslate\">config.secret_key_base</code> are the same object (meaning <code class=\"notranslate\">config.secret_key_base</code> was merged into `secrets).</p>\n<p dir=\"auto\">Additionally, an improved deprecation warning is added for apps that continue to set <code class=\"notranslate\">secret_key_base</code> in their secrets. The current warning is not great because it isn't directly actionable for users. Currently they will see the warning, not see <code class=\"notranslate\">secrets</code> being referenced in their app, and potentially end up confused. The new warning helps users understand the actual change they need to make: not removing a reference to <code class=\"notranslate\">secrets</code> but moving <code class=\"notranslate\">secret_key_base</code> out of <code class=\"notranslate\">secrets</code>.</p>\n<h3 dir=\"auto\">Additional Information</h3>\n<p dir=\"auto\">I based this on <code class=\"notranslate\">main</code> because the deprecation hasn't been removed yet, but I can change the base to <code class=\"notranslate\">7-1-stable</code> since that's really where this change should be made.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49839",
            "title": "Fix config.secret_key_base warning about secrets",
            "date_modified": "2023-10-30T09:28:13.000Z",
            "date_published": "2023-10-29T23:17:41.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/96156234?u=9ced8d6ac6128a8dea78e7f0d9233669ff0ffecf&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This fix allows the <code class=\"notranslate\">polymorphic_method</code> in the <code class=\"notranslate\">HelperMethodBuilder</code> class in <code class=\"notranslate\">polymorphic_routes.rb</code> discern whether or not a singular resource is being passed into it.  If it finds a singular resource it will pass in <code class=\"notranslate\">format: nil</code> to the options so that we can have an edited object using the patch method get sent to the proper URL instead of appending a period and number to the end. I believe this is a better implementation than my first try.</p>\n<p dir=\"auto\">The current bug behavior in 7.1:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Started PATCH &quot;/author.1&quot; for ::1 at 2023-10-12 15:03:31 -0400\"><pre class=\"notranslate\"><span class=\"pl-en\">Started</span> <span class=\"pl-c1\">PATCH</span> <span class=\"pl-s\">\"/author.1\"</span> <span class=\"pl-k\">for</span> ::<span class=\"pl-c1\">1</span> <span class=\"pl-en\">at</span> <span class=\"pl-c1\">2023</span>-<span class=\"pl-c1\">10</span>-<span class=\"pl-c1\">12</span> <span class=\"pl-c1\">15</span><span class=\"pl-pds\">:03</span><span class=\"pl-pds\">:31</span> -<span class=\"pl-c1\">0400</span></pre></div>\n<p dir=\"auto\">This fix corrects this to:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Started PATCH &quot;/author&quot; for ::1 at 2023-10-12 15:03:31 -0400\"><pre class=\"notranslate\"><span class=\"pl-en\">Started</span> <span class=\"pl-c1\">PATCH</span> <span class=\"pl-s\">\"/author\"</span> <span class=\"pl-k\">for</span> ::<span class=\"pl-c1\">1</span> <span class=\"pl-en\">at</span> <span class=\"pl-c1\">2023</span>-<span class=\"pl-c1\">10</span>-<span class=\"pl-c1\">12</span> <span class=\"pl-c1\">15</span><span class=\"pl-pds\">:03</span><span class=\"pl-pds\">:31</span> -<span class=\"pl-c1\">0400</span></pre></div>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49604.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1940028753\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49604\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49604/hovercard\" href=\"https://github.com/rails/rails/issues/49604\">#49604</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49838",
            "title": "Render URLs without numbers for singular resource routes",
            "date_modified": "2023-10-29T22:05:38.000Z",
            "date_published": "2023-10-29T21:08:35.000Z",
            "author": {
                "name": "paulreece",
                "url": "https://github.com/paulreece"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Backports <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1964634708\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49803\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49803/hovercard\" href=\"https://github.com/rails/rails/pull/49803\">#49803</a> to <code class=\"notranslate\">7-0-stable</code> from <code class=\"notranslate\">zzak/railties/remove_from_file-gsub</code></p>",
            "url": "https://github.com/rails/rails/pull/49835",
            "title": "[7-0-stable] Railties TestHelper remove_from_config should remove all occurrences",
            "date_modified": "2023-10-29T10:53:12.000Z",
            "date_published": "2023-10-29T10:53:08.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Backports <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1964634708\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49803\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49803/hovercard\" href=\"https://github.com/rails/rails/pull/49803\">#49803</a> to <code class=\"notranslate\">7-1-stable</code> from <code class=\"notranslate\">zzak/railties/remove_from_file-gsub</code></p>",
            "url": "https://github.com/rails/rails/pull/49834",
            "title": "[7-1-stable] Railties TestHelper remove_from_config should remove all occurrences",
            "date_modified": "2023-10-29T10:49:52.000Z",
            "date_published": "2023-10-29T10:49:48.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/16350274?u=1a4e57ba26ff3044cc2150e1fe28453a03a5b8b7&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because touch is used in a lot of places but it's interaction is not documented anywhere wrt transactions. Bot how the queries are coalesced and the order in which callbacks are fired can be very confusing if not mentioned.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the Rdoc of touch.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"54832242\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/18606\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/18606/hovercard\" href=\"https://github.com/rails/rails/issues/18606\">#18606</a> coalesce PR<br>\n<a href=\"https://gist.github.com/dhavalsingh/0b353121345b1b74f6d16a41afb1bc5e\">https://gist.github.com/dhavalsingh/0b353121345b1b74f6d16a41afb1bc5e</a> Github gist for how callbacks are executed with touch and transaction blocks.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul dir=\"auto\">\n<li>[ x] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li>[x ] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li>[x ] Tests are added or updated if you fix a bug or add a feature.</li>\n<li>[x ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49833",
            "title": "Clarify behavior of touch in transactions with callbacks in RDoc [ci skip]",
            "date_modified": "2023-10-30T09:20:33.000Z",
            "date_published": "2023-10-28T21:28:31.000Z",
            "author": {
                "name": "dhavalsingh",
                "url": "https://github.com/dhavalsingh"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/16350274?u=1a4e57ba26ff3044cc2150e1fe28453a03a5b8b7&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">… multiple instances of the same model</p>\n\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because this is a pretty nuanced case that can come up in complex applications. We had a bug due to this and I couldn't find any other source specifying this behavior. The rails guides should be clear on this case so folks can avoid this and be mindful of this behavior when designing or maintaining systems.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the AR Callback Docs.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"623545878\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/39400\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/39400/hovercard\" href=\"https://github.com/rails/rails/issues/39400\">#39400</a> This is the only place that references this.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49831",
            "title": "Update Callbacks Documentation: Specify 'after_commit' and 'after_rollback' Behavior for Multiple Objects of the Same Record [ci skip]",
            "date_modified": "2023-10-29T16:26:57.000Z",
            "date_published": "2023-10-28T17:45:53.000Z",
            "author": {
                "name": "dhavalsingh",
                "url": "https://github.com/dhavalsingh"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/567626?u=21feddf6c972d874e08c32536e09d0812a7df59c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">I can understand why this was avoided in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1562090099\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47186\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47186/hovercard\" href=\"https://github.com/rails/rails/pull/47186\">#47186</a>, currently docs and guides don't use this consistently. As well as this is a big change.</p>\n<p dir=\"auto\">At the same time we also have <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1966522354\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49824\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49824/hovercard\" href=\"https://github.com/rails/rails/pull/49824\">#49824</a></p>\n<p dir=\"auto\">Longer run, the codebase will prefer double quotes now that we use it at most places. We might as well enforce them, instead of repeat PRs fixing at different places.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a>  / <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/zzak/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zzak\">@zzak</a> / <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rafaelfranca/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rafaelfranca\">@rafaelfranca</a></p>\n<p dir=\"auto\">PS: This might affect diffs in upgrades guides comparison, but not sure the gains of not doing it 🤔</p>",
            "url": "https://github.com/rails/rails/pull/49829",
            "title": "Enable String Literal rule styles in guides to be more consistent with codebase styles",
            "date_modified": "2023-10-28T15:31:34.000Z",
            "date_published": "2023-10-28T15:29:44.000Z",
            "author": {
                "name": "vipulnsward",
                "url": "https://github.com/vipulnsward"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/111346?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR fixes two issues with the mailer preview:</p>\n<ul dir=\"auto\">\n<li>Do not list inline attachments in the attachment list. This is similar to what most email clients do.</li>\n<li>Show attached emails in the attachment list. TIL that <code class=\"notranslate\">mail.attachments</code> includes any files attached inside the attached email, but it does not include the message/rfc822 part itself.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49828",
            "title": "Ignore inline attachments and show attached emails in attachment list",
            "date_modified": "2023-10-28T15:02:33.000Z",
            "date_published": "2023-10-28T14:24:23.000Z",
            "author": {
                "name": "c960657",
                "url": "https://github.com/c960657"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5162312?u=e1b3c0f7c6dc600253bf15c99f618b9b2d39c500&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Integration tests use the integration session to access URL helpers. The method_missing in routing assertions is only for controller tests, so let's just move it there.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because this method had a TODO on it that looks out of date to me.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request moves the method_missing on the route assertions module to <code class=\"notranslate\">ActionController::TestCase</code>. Integration tests already delegate to the <code class=\"notranslate\">integration_session</code> route helpers here: </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/421df52bf859120371b82a67529fee20e1f548f8/actionpack/lib/action_dispatch/testing/integration.rb#L436\">rails/actionpack/lib/action_dispatch/testing/integration.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 436\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/421df52bf859120371b82a67529fee20e1f548f8\">421df52</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L436\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"436\"></td>\n          <td id=\"LC436\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">integration_session</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">public_send</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">method</span><span class=\"pl-kos\">,</span> *<span class=\"pl-s1\">args</span><span class=\"pl-kos\">,</span> &amp;<span class=\"pl-s1\">block</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">tap</span> <span class=\"pl-k\">do</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n <div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/421df52bf859120371b82a67529fee20e1f548f8/actionpack/lib/action_dispatch/testing/integration.rb#L358\">rails/actionpack/lib/action_dispatch/testing/integration.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 358\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/421df52bf859120371b82a67529fee20e1f548f8\">421df52</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L358\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"358\"></td>\n          <td id=\"LC358\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">include</span> <span class=\"pl-s1\">app</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">routes</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">url_helpers</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The method_missing I moved might be public API, but I think we only expect it to be used in a controller test context, right? Integration tests include routing assertions to the <a href=\"https://github.com/rails/rails/blob/421df52bf859120371b82a67529fee20e1f548f8/actionpack/lib/action_dispatch/testing/integration.rb#L93\">integration session</a>. Regardless of if we choose to move the method_missing, we can probably better test this behaviour to make sure it doesn't regress.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49821",
            "title": "Move route helper method_missing to ActionController::TestCase",
            "date_modified": "2023-10-28T01:06:10.000Z",
            "date_published": "2023-10-28T01:04:31.000Z",
            "author": {
                "name": "gmcgibbon",
                "url": "https://github.com/gmcgibbon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5162312?u=e1b3c0f7c6dc600253bf15c99f618b9b2d39c500&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Adds support for <code class=\"notranslate\">with_routing</code> test helpers in <code class=\"notranslate\">ActionDispatch::IntegrationTest</code>. Previously, this helper didn't work in an integration context (only for <code class=\"notranslate\">ActionController::TestCase</code>) because the rack app and integration session under test were not mutated. Because controller tests are integration tests by default, we should support test routes for these kinds of test cases as well.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because I needed to use with_routing in an integration test, and <a href=\"https://gist.github.com/gmcgibbon/23648062f6e5a55436b5df0799525996\">it doesn't seem to work</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes routing assertions in integration tests by including <code class=\"notranslate\">ActionDispatch::Assertions::RoutingAssertions::WithIntegrationRouting</code> which overrides the standard <code class=\"notranslate\">with_routing</code> machinery to mutate the app under test and integration session.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I used a shared test module approach for the existing routing assertion tests so that we can test the same way in controller and integration tests.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49819",
            "title": "Make with_routing test helper work for integration tests",
            "date_modified": "2023-10-27T22:01:02.000Z",
            "date_published": "2023-10-27T21:56:05.000Z",
            "author": {
                "name": "gmcgibbon",
                "url": "https://github.com/gmcgibbon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Currently when we <code class=\"notranslate\">_create_record</code> or <code class=\"notranslate\">destroy_row</code> we have to iterate over the list of <code class=\"notranslate\">_reflections</code> and find the ones that are <code class=\"notranslate\">belongs_to</code> type and have a <code class=\"notranslate\">counter_cache_column</code>. This is ineficient as we don't expect the result of this selection to change during runtime. To make it prettier and more efficient we will prebuild a list of associations that have a counter cache column.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I have two reasons to implement this change</p>\n<ol dir=\"auto\">\n<li>It will unblock <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1964409838\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49801\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49801/hovercard\" href=\"https://github.com/rails/rails/pull/49801\">#49801</a> . I'd like to introduce an <code class=\"notranslate\">alias_association</code> feature which will populate <code class=\"notranslate\">_reflections</code> mapping with duplicated reflections under different keys (aliases) and the current approach relies on <code class=\"notranslate\">_reflections</code> to be unique</li>\n<li>Instead of trying to address the \"uniqueness\" problem I'd like to also improve the performance of this particular piece. It seems inefficient to iterate over the same <code class=\"notranslate\">_reflections</code> hash again and again and performing the same checks to get the same result for a given model class. It would be much better to have the list we are interested in prebuilt and ready for use.</li>\n</ol>\n<p dir=\"auto\">Even though performance is not my ultimate goal and the main reason for this change is to unblock <code class=\"notranslate\">alias_association</code> here is the benchmark:</p>\n<details>\n<summary>Benchmark</summary>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"begin\n  require &quot;bundler/inline&quot;\nrescue LoadError =&gt; e\n  $stderr.puts &quot;Bundler version 1.10 or later is required. Please update your Bundler&quot;\n  raise e\nend\n\ngemfile(true) do\n  source &quot;https://rubygems.org&quot;\n  gem &quot;rails&quot;, path: &quot;.&quot;\n  gem &quot;sqlite3&quot;\n  gem &quot;benchmark-ips&quot;\n  gem &quot;debug&quot;\nend\n\nrequire &quot;active_record&quot;\nrequire &quot;benchmark/ips&quot;\n\nmodule ActiveRecord\n  module CounterCache\n    # legacy implementation\n    def each_counter_cached_associations\n      _reflections.each do |name, reflection|\n        yield association(name.to_sym) if reflection.belongs_to? &amp;&amp; reflection.counter_cache_column\n      end\n    end\n  end\nend\n\n\nActiveRecord::Base.establish_connection(adapter: &quot;sqlite3&quot;, database: &quot;:memory:&quot;)\nActiveRecord::Base.logger = Logger.new(STDOUT)\n\nActiveRecord::Schema.define do\n  create_table :users do |t|\n    t.string :first_name\n    t.string :last_name\n    t.integer :comments_count\n  end\n\n  create_table :comments do |t|\n    t.integer :user_id\n    t.text :body\n  end\nend\n\nclass User &lt; ActiveRecord::Base\nend\n\nclass Comment &lt; ActiveRecord::Base\n  belongs_to :user, counter_cache: true\nend\n\nuser = User.create!(first_name: &quot;Nikita&quot;, last_name: &quot;V&quot;)\nputs RUBY_DESCRIPTION\n\nlegacy_associations = []\nuser.send(:each_counter_cached_associations) { |assoc| legacy_associations &lt;&lt; assoc.name }\n\nnew_associations = User.counter_cached_association_names.each { |name| User.association(name) }\nraise if legacy_associations != new_associations\n\n\nBenchmark.ips do |x|\n  x.report(&quot;memoized counter_cache association names&quot;) do\n    User.counter_cached_association_names.each { |name| User.association(name) }\n  end\n\n  x.report(&quot;each_counter_cached_associations&quot;) do\n    user.send(:each_counter_cached_associations) do |assoc|\n      assoc # no need to do anything\n    end\n  end\n\n  x.compare!\nend\n\"><pre class=\"notranslate\"><span class=\"pl-k\">begin</span>\n  <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/inline\"</span>\n<span class=\"pl-k\">rescue</span> <span class=\"pl-v\">LoadError</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">e</span>\n  $stderr<span class=\"pl-kos\">.</span><span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Bundler version 1.10 or later is required. Please update your Bundler\"</span>\n  <span class=\"pl-en\">raise</span> <span class=\"pl-en\">e</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">\"https://rubygems.org\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"rails\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">path</span>: <span class=\"pl-s\">\".\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"sqlite3\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"benchmark-ips\"</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"debug\"</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_record\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"benchmark/ips\"</span>\n\n<span class=\"pl-k\">module</span> <span class=\"pl-v\">ActiveRecord</span>\n  <span class=\"pl-k\">module</span> <span class=\"pl-v\">CounterCache</span>\n    <span class=\"pl-c\"># legacy implementation</span>\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">each_counter_cached_associations</span>\n      <span class=\"pl-en\">_reflections</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">name</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">reflection</span>|\n        <span class=\"pl-k\">yield</span> <span class=\"pl-en\">association</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">name</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_sym</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">if</span> <span class=\"pl-s1\">reflection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">belongs_to?</span> &amp;&amp; <span class=\"pl-s1\">reflection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">counter_cache_column</span>\n      <span class=\"pl-k\">end</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">establish_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">adapter</span>: <span class=\"pl-s\">\"sqlite3\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">database</span>: <span class=\"pl-s\">\":memory:\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Schema</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">define</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:users</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:first_name</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:last_name</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">integer</span> <span class=\"pl-pds\">:comments_count</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:comments</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">integer</span> <span class=\"pl-pds\">:user_id</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">text</span> <span class=\"pl-pds\">:body</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">User</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Comment</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:user</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">counter_cache</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create!</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">first_name</span>: <span class=\"pl-s\">\"Nikita\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">last_name</span>: <span class=\"pl-s\">\"V\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-en\">puts</span> <span class=\"pl-c1\">RUBY_DESCRIPTION</span>\n\n<span class=\"pl-s1\">legacy_associations</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">]</span>\n<span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">send</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:each_counter_cached_associations</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">assoc</span>| <span class=\"pl-s1\">legacy_associations</span> &lt;&lt; <span class=\"pl-s1\">assoc</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span> <span class=\"pl-kos\">}</span>\n\n<span class=\"pl-s1\">new_associations</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">counter_cached_association_names</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">name</span>| <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">association</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">name</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-en\">raise</span> <span class=\"pl-k\">if</span> <span class=\"pl-s1\">legacy_associations</span> != <span class=\"pl-s1\">new_associations</span>\n\n\n<span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"memoized counter_cache association names\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">counter_cached_association_names</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">name</span>| <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">association</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">name</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"each_counter_cached_associations\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">send</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:each_counter_cached_associations</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">assoc</span>|\n      <span class=\"pl-s1\">assoc</span> <span class=\"pl-c\"># no need to do anything</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">compare!</span>\n<span class=\"pl-k\">end</span></pre></div>\n</details>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Calculating -------------------------------------\nmemoized counter_cache association names\n                          9.143M (± 6.0%) i/s -     46.355M in   5.091984s\neach_counter_cached_associations\n                          3.401M (± 6.1%) i/s -     16.914M in   5.001597s\n\nComparison:\nmemoized counter_cache association names:  9142732.6 i/s\neach_counter_cached_associations:  3401378.9 i/s - 2.69x  slower\"><pre class=\"notranslate\"><code class=\"notranslate\">Calculating -------------------------------------\nmemoized counter_cache association names\n                          9.143M (± 6.0%) i/s -     46.355M in   5.091984s\neach_counter_cached_associations\n                          3.401M (± 6.1%) i/s -     16.914M in   5.001597s\n\nComparison:\nmemoized counter_cache association names:  9142732.6 i/s\neach_counter_cached_associations:  3401378.9 i/s - 2.69x  slower\n</code></pre></div>\n<h3 dir=\"auto\">What reviewers should focus on</h3>\n<p dir=\"auto\">Does it need a changelog entry?</p>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49815",
            "title": "Prebuild list of counter cache associations",
            "date_modified": "2023-10-29T19:23:44.000Z",
            "date_published": "2023-10-27T20:18:13.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/13696143?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1964535188\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49802\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49802/hovercard\" href=\"https://github.com/rails/rails/pull/49802\">#49802</a> (we may want both PRs)</p>\n<p dir=\"auto\">Prior to this commit <code class=\"notranslate\">with_raw_connection</code> would always mark the connection as <code class=\"notranslate\">@verified = true</code> after yielding it. But yielding a connection is not enough to determine that a connection is healthy. Marking a broken connection as verified can prevent further reconnects, leaving us with a broken connection for longer than expected.</p>\n<p dir=\"auto\">For example,</p>\n<ul dir=\"auto\">\n<li>Connection is broken and not verified</li>\n<li>Quote string succeeds, and marks the broken connection as verified</li>\n<li>Because the connection is verified, querying will not trigger a reconnect</li>\n<li>Query fails and the connection is no longer verified</li>\n<li>Repeat ad infinitum (or until we reach a query with <code class=\"notranslate\">allow_retry: true</code>, or one that isn't preceded by a call to quote string)</li>\n</ul>\n<p dir=\"auto\">This commit solves the problem by only marking the connection as verified if we have definitively exercised that connection. This is safer, but it does put more responsibility on each individual adapter. If a call to <code class=\"notranslate\">verified!</code> is missing things should still work OK, but we'll end up pinging the connection more to see if it is active.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a></p>",
            "url": "https://github.com/rails/rails/pull/49811",
            "title": "Prevent marking broken connections as verified",
            "date_modified": "2023-10-30T08:50:46.000Z",
            "date_published": "2023-10-27T15:19:19.000Z",
            "author": {
                "name": "composerinteralia",
                "url": "https://github.com/composerinteralia"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/32258?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The current Rails CSP uses <code class=\"notranslate\">report-uri</code> which is deprecated. There is a newer Reporting API which uses endpoints that can be references from the CSP policy using <code class=\"notranslate\">report-to</code>.</p>\n<p dir=\"auto\">For more info see <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/report-to\" rel=\"nofollow\">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/report-to</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Adds Reporting API endpoint to CSP policy using <code class=\"notranslate\">report-to</code>.</p>\n<p dir=\"auto\">This requires the Report-To HTTP header to be set manually. Example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"response.set_header('Report-To', '{&quot;group&quot;:&quot;csp-endpoint&quot;,&quot;max_age&quot;:31536000,&quot;endpoints&quot;:[{&quot;url&quot;:&quot;https://example.org/csp-endpoint&quot;}],&quot;include_subdomains&quot;:true}')\"><pre class=\"notranslate\"><code class=\"notranslate\">response.set_header('Report-To', '{\"group\":\"csp-endpoint\",\"max_age\":31536000,\"endpoints\":[{\"url\":\"https://example.org/csp-endpoint\"}],\"include_subdomains\":true}')\n</code></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This is my first PR to Rails so let me know if there is any improvement to be made. I wasn't sure whether to include info about the Report-To HTTP header in the docs or code.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49810",
            "title": "CSP Report-to reponse header field for browser Reporting API",
            "date_modified": "2023-10-27T14:20:53.000Z",
            "date_published": "2023-10-27T12:20:19.000Z",
            "author": {
                "name": "espen",
                "url": "https://github.com/espen"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/13696143?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49781.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1961443092\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49781\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49781/hovercard\" href=\"https://github.com/rails/rails/issues/49781\">#49781</a></p>\n<p dir=\"auto\">Prior to this commit, the PostgreSQL adapter could end up holding onto a broken connection longer than expected, potentially <strong>into the next request after the executor checkin/checkout</strong>.</p>\n<p dir=\"auto\">The problem is that the PostgreSQL adapter was using <a href=\"https://github.com/rails/rails/blob/e33dbe1b3d423143685154b97ae0992f4ab821b8/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb#L910-L917\">two separate calls</a> to <code class=\"notranslate\">with_raw_connection</code>, one for preparing a statement and another for executing it. That's fine before the statement is added to the statement pool, but once it the statement exists the first call to <code class=\"notranslate\">with_raw_connection</code> <a href=\"https://github.com/rails/rails/blob/490b9fc22faefca30565a970a8727c915de589ff/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb#L964-L966\">does not actually use the connection</a>. But that doesn't stop us from marking the connection as <a href=\"https://github.com/rails/rails/blob/e33dbe1b3d423143685154b97ae0992f4ab821b8/activerecord/lib/active_record/connection_adapters/abstract_adapter.rb#L1032\"><code class=\"notranslate\">@verified</code></a>, thereby preventing the second <code class=\"notranslate\">with_raw_connection</code> from verifying and getting a chance to reconnect.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Post.first\n#=&gt; prepare_statement verifies the connection (if needed) and populates the statement pool\n#=&gt; exec_prepared succeeds\n\n#=&gt; Oops!, we lost the connection for whatever reason\n\nPost.first\n#=&gt; prepare_statement returns the statement from the statement pool, connection still marked as verified\n#=&gt; exec_prepared fails, marks the connection as unverified\n\nPost.first\n#=&gt; prepare_statement returns the statement from the statement pool, marks the connection as verified!!!\n#=&gt; exec_prepared fails, marks the connection as unverified\n\n#=&gt; request finishes, connection gets marked as unverified for the next request\n\nPost.first\n#=&gt; prepare_statement returns the statement from the statement pool, marks the connection as verified!!!\n#=&gt; exec_prepared fails, marks the connection as unverified\"><pre class=\"notranslate\"><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n<span class=\"pl-c\">#=&gt; prepare_statement verifies the connection (if needed) and populates the statement pool</span>\n<span class=\"pl-c\">#=&gt; exec_prepared succeeds</span>\n\n<span class=\"pl-c\">#=&gt; Oops!, we lost the connection for whatever reason</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n<span class=\"pl-c\">#=&gt; prepare_statement returns the statement from the statement pool, connection still marked as verified</span>\n<span class=\"pl-c\">#=&gt; exec_prepared fails, marks the connection as unverified</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n<span class=\"pl-c\">#=&gt; prepare_statement returns the statement from the statement pool, marks the connection as verified!!!</span>\n<span class=\"pl-c\">#=&gt; exec_prepared fails, marks the connection as unverified</span>\n\n<span class=\"pl-c\">#=&gt; request finishes, connection gets marked as unverified for the next request</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span>\n<span class=\"pl-c\">#=&gt; prepare_statement returns the statement from the statement pool, marks the connection as verified!!!</span>\n<span class=\"pl-c\">#=&gt; exec_prepared fails, marks the connection as unverified</span></pre></div>\n<p dir=\"auto\">The only way to recover is to execute a statement that hasn't been prepared yet, one that isn't prepared because it has no binds, or one that has <code class=\"notranslate\">allow_retry: true</code> (which I think is limited to a few internal queries at the moment—we don't pass the value through to <code class=\"notranslate\">with_raw_connection</code> for prepared statements anyway).</p>\n<p dir=\"auto\">This commit fixes the problem by preparing and executing the statement within a single <code class=\"notranslate\">with_raw_connection</code> block. This is what the other adapters with prepared statements already do.</p>\n<p dir=\"auto\">It makes more sense this way—even if we managed to reconnect before executing the statement in the old code, we'd be referencing a prepared statement from a different connection, so it'd fail anyway. Having the prepare and execute in the same <code class=\"notranslate\">with_raw_connection</code> means if we do need to reconnect, we'll start from the beginning and prepare the statement again on the fresh connection.</p>\n<p dir=\"auto\">Note that this change does get rid of connection retries on preparing statements, but I think that's OK. It matches the other adapters, matches the Rails 7.0 behavior, and it's still better than ending up with a broken connection.</p>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49802",
            "title": "Recover from failed connections in PostgreSQL",
            "date_modified": "2023-10-27T15:20:18.000Z",
            "date_published": "2023-10-26T23:51:51.000Z",
            "author": {
                "name": "composerinteralia",
                "url": "https://github.com/composerinteralia"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Implements - <a href=\"https://discuss.rubyonrails.org/t/feature-proposal-alias-association/83439/4\" rel=\"nofollow\">https://discuss.rubyonrails.org/t/feature-proposal-alias-association/83439/4</a></p>\n<p dir=\"auto\">Rails 7.1 deprecated using <code class=\"notranslate\">alias_attribute</code> for anything other than an attribute. Many applications end up using <code class=\"notranslate\">alias_attribute</code> to alias associations and removing such usages would be challenging in many cases. Recognizing this, Rails introduces a new feature to alias associations called <code class=\"notranslate\">alias_association</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Given an alias like <code class=\"notranslate\">BlogPost.alias_association :author, :user</code> where <code class=\"notranslate\">author</code> is an alias and <code class=\"notranslate\">user</code> is the original association name of the <code class=\"notranslate\">belong_to :user</code> association the feature provides the following capabilities:</p>\n<h4 dir=\"auto\">Aliased association methods</h4>\n<p dir=\"auto\">Defines association reader and writer: <code class=\"notranslate\">BlogPost#author</code> and <code class=\"notranslate\">BlogPost#author=</code><br>\n(<code class=\"notranslate\">belongs_to</code> only) Defines <code class=\"notranslate\">build_#{assoc_name}</code> and <code class=\"notranslate\">create_#{assoc_name}</code> constructors: <code class=\"notranslate\">BlogPost#build_author</code>,  <code class=\"notranslate\">BlogPost#create_author</code> and <code class=\"notranslate\">BlogPost#create_author!</code><br>\n(<code class=\"notranslate\">belongs_to</code> only)  Defines change tracking methods: <code class=\"notranslate\">BlogPost#author_changed?</code> and <code class=\"notranslate\">BlogPost#author_previously_changed?</code></p>\n<h4 dir=\"auto\">Aliases support in <code class=\"notranslate\">where()</code> clauses</h4>\n<p dir=\"auto\"><code class=\"notranslate\">BlogPost.where(author: User.find_by(name: \"Nikita\")).to_a</code> #=&gt; searches by <code class=\"notranslate\">user_id</code></p>\n<h4 dir=\"auto\">Aliases support in <code class=\"notranslate\">includes()</code> clauses</h4>\n<p dir=\"auto\"><code class=\"notranslate\">BlogPost.all.includes(:author).to_a</code> # =&gt; preloads <code class=\"notranslate\">user</code> association</p>\n<h3 dir=\"auto\">Implementation details</h3>\n<h4 dir=\"auto\">Aliased association methods</h4>\n<p dir=\"auto\">A new <code class=\"notranslate\">define_association_methods </code> method was defined on <code class=\"notranslate\">ActiveRecord::Associations::Builder::Association</code> builder. Its job to define association-related instance methods. This method is being reused in the original <code class=\"notranslate\">build</code> method.<br>\n<code class=\"notranslate\">define_accessors</code>, <code class=\"notranslate\">define_change_tracking_methods</code> and all downstream methods now accept <code class=\"notranslate\">as:</code> to serve as a publicly facing name of the new methods while the method body itself will point to the original association.</p>\n<p dir=\"auto\">Since <code class=\"notranslate\">alias_association</code> methods needs to know which builder to use for method definition builders now self-register themselves into a registry using <code class=\"notranslate\">register_builder_for</code> method by providing a <code class=\"notranslate\">macro</code> which later can be used to fetch the builder for a given reflection.</p>\n<h4 dir=\"auto\">Aliases support in <code class=\"notranslate\">where()</code> clauses</h4>\n<p dir=\"auto\">To support aliased association names in <code class=\"notranslate\">where()</code> clauses we introduced <code class=\"notranslate\">querying_aliases</code> storage which will serve as a registry of aliases for both associations and attributes. This way we can avoid checking two places (attribute aliases &amp; association aliases) when processing <code class=\"notranslate\">where()</code> arguments.</p>\n<h4 dir=\"auto\">Aliases support in <code class=\"notranslate\">includes()</code> clauses</h4>\n<p dir=\"auto\">To support aliases in <code class=\"notranslate\">includes()</code> (and most likely more capabilities that look into the <code class=\"notranslate\">_reflections</code> hash) we register the same reflection under the new name<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/8917147631838b5c5b85240a61027b39f3adbde2/activerecord/lib/active_record/associations.rb#L1900\">rails/activerecord/lib/active_record/associations.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 1900\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/8917147631838b5c5b85240a61027b39f3adbde2\">8917147</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L1900\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1900\"></td>\n          <td id=\"LC1900\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-v\">Reflection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">add_reflection</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">new_name</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">existing_reflection</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">The capabilities this feature provides are pretty standalone and could be extracted or completely descoped from this PR if needed.</p>\n<p dir=\"auto\">Also while the utility of this feature might be concerning the feature comes at no cost for applications that are not interested in utilizing it.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49801",
            "title": "Introduce `alias_association` feature",
            "date_modified": "2023-10-26T22:01:00.000Z",
            "date_published": "2023-10-26T21:41:30.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/11673?u=ef80073b0bb2ee07a241e85af0bb51e892955811&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">I've often had the need to desire a to create a duration type for Ruby classes including <code class=\"notranslate\">ActiveModel::Attributes</code> or for ActiveRecord models backed by non-PostgreSQL database adapters, similar to <a href=\"https://stackoverflow.com/a/45359178/771838\" rel=\"nofollow\">this StackOverflow answer</a>.</p>\n<p dir=\"auto\">The Rails community would benefit from having this type available as an <code class=\"notranslate\">ActiveModel</code> attribute whereas currently only <code class=\"notranslate\">ActiveRecord</code> models with the PostgreSQL adapter support <code class=\"notranslate\">ActiveSupport::Duration</code> through the <code class=\"notranslate\">:interval</code> data type. .</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This changeset adds <code class=\"notranslate\">ActiveModel::Type::Duration</code> to provide representation for <code class=\"notranslate\">ActiveSupport::Duration</code> via the <code class=\"notranslate\">:duration</code> key.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Run\n  include ActiveModel::Attributes\n\n  attribute :lasted, :duration\nend\n\nrun = Run.new\nrun.lasted = 2.hours\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Run</span>\n  <span class=\"pl-en\">include</span> <span class=\"pl-v\">ActiveModel</span>::<span class=\"pl-v\">Attributes</span>\n\n  <span class=\"pl-en\">attribute</span> <span class=\"pl-pds\">:lasted</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:duration</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">run</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">2</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">hours</span></pre></div>\n<p dir=\"auto\">Numeric values are cast to <code class=\"notranslate\">ActiveSupport::Duration</code> as seconds.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"run = Run.new\nrun.lasted = 120 # =&gt; 120 seconds\"><pre class=\"notranslate\"><span class=\"pl-s1\">run</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">120</span> <span class=\"pl-c\"># =&gt; 120 seconds</span></pre></div>\n<p dir=\"auto\">String values are parsed using the ISO 8601 duration format.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"run = Run.new\nrun.lasted = &quot;PT2H&quot;\n\nrun.lasted.class # =&gt; ActiveSupport::Duration\nrun.lasted       # =&gt; 2 hours\"><pre class=\"notranslate\"><span class=\"pl-s1\">run</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"PT2H\"</span>\n\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">class</span> <span class=\"pl-c\"># =&gt; ActiveSupport::Duration</span>\n<span class=\"pl-s1\">run</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">lasted</span>       <span class=\"pl-c\"># =&gt; 2 hours</span></pre></div>\n<p dir=\"auto\">The serialization/deserialization logic is extracted from <code class=\"notranslate\">ActiveRecord::ConnectionAdapters::PostreSQL::OID::Interval</code>, which is here modified to inherit from <code class=\"notranslate\">ActiveModel::Type::Duration</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49799",
            "title": "Add ActiveModel attribute type for duration",
            "date_modified": "2023-10-26T16:24:54.000Z",
            "date_published": "2023-10-26T15:56:47.000Z",
            "author": {
                "name": "rossta",
                "url": "https://github.com/rossta"
            }
        }
    ]
}