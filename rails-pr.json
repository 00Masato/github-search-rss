{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48156.\">Fix</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1698872866\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48156\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48156/hovercard\" href=\"https://github.com/rails/rails/issues/48156\">#48156</a></p>\n<p dir=\"auto\">The assumption here is that in the overwhelming majority of cases, all formats are valid.</p>\n<p dir=\"auto\">So we first check if any of the formats is invalid before duping the details hash and filtering them.</p>\n<p dir=\"auto\">Additionally, by exposing a (non-public) <code class=\"notranslate\">valid_symbols?</code> method, we can check symbols are valid without resporting to <code class=\"notranslate\">Array#%</code> which would needlessly duplicate the <code class=\"notranslate\">formats</code> array.</p>\n<p dir=\"auto\">This optimization is based on a prior refactor of ActionView::Template::Types to avoid delegation.</p>\n<p dir=\"auto\">The <code class=\"notranslate\">Type</code> class was introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"127043824\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/23085\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/23085/hovercard\" href=\"https://github.com/rails/rails/pull/23085\">#23085</a> for the sole purpose of breaking the dependency of Action View on Action Dispatch.</p>\n<p dir=\"auto\">Unless you are somehow running Action View standalone, this is actually never used.</p>\n<p dir=\"auto\">So instead of delegating, we can use constant swapping, this saves us a useless layer.</p>\n<p dir=\"auto\">Ultimately we could consider moving <code class=\"notranslate\">Mime::Types</code> into Active Support but it requires some more thoughts.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/headius/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/headius\">@headius</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/ghiculescu/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/ghiculescu\">@ghiculescu</a></p>\n<p dir=\"auto\">Also cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/jhawthorn/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jhawthorn\">@jhawthorn</a> as I see you've optimized the <code class=\"notranslate\">Template::Types</code> delegation in the past.</p>\n<p dir=\"auto\">I still need to benchmark to see how much we gain here, and if another approach may be faster, but I'd like to first check CI is green.</p>",
            "url": "https://github.com/rails/rails/pull/48163",
            "title": "Optimize mime types validation in ActionView::LookupContext",
            "date_modified": "2023-05-08T01:52:19.000Z",
            "date_published": "2023-05-08T01:41:50.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/771968?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This adds test coverage for <code class=\"notranslate\">String#blank?</code> with every non-dummy encoding that is bundled with Ruby.</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48149.\">Closes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1698518966\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48149\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48149/hovercard\" href=\"https://github.com/rails/rails/issues/48149\">#48149</a>.</p>",
            "url": "https://github.com/rails/rails/pull/48160",
            "title": "Test `String#blank?` with every non-dummy encoding",
            "date_modified": "2023-05-08T00:20:05.000Z",
            "date_published": "2023-05-07T20:55:06.000Z",
            "author": {
                "name": "jonathanhefner",
                "url": "https://github.com/jonathanhefner"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1518299?u=a2dd8dd1835679cfd6b1924ef63a6e61ea62fa2a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><a href=\"https://github.com/rack/rack/blob/main/CHANGELOG.md?plain=1#L98\">Rack 3.0 doesn't guarantee rewindable request body streams. </a></p>\n<p dir=\"auto\">Therefore Rack doesn't <a href=\"https://github.com/rack/rack/commit/42aff22f708123839ba706cbe659d108b47c40c7#diff-7404531728e9194974263579fc1b939066d457000ec901206b49ced795df9babL48\">rewind the body after parsing the POST params like it use to</a>.<br>\nSince this is a test request, <a href=\"https://github.com/rails/rails/blob/main/actionpack/lib/action_controller/test_case.rb#L122\">we can garantee the stream is rewindable</a> and rewind in the test instead.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">While this is only a soft failure, all buildkite builds <a href=\"https://buildkite.com/rails/rails/builds/96229#0187f3ef-462a-4bfc-8de8-9612c20e0e73\" rel=\"nofollow\">are currently failing</a> on <code class=\"notranslate\">action_pack [rack-3]</code>. This should bring it back to green.</p>\n<p dir=\"auto\">We could wait for <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1465595207\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46594\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/46594/hovercard\" href=\"https://github.com/rails/rails/pull/46594\">#46594</a>  to land, but this has been in the pipes for a while. Fixing CI for the other branches seems like a good idea.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Maybe the right solution is to remove the test entirely? The test doesn't seem to test much at this point. Only that the request is a stream.</p>\n<p dir=\"auto\">If we do keep the test, <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1465595207\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46594\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/46594/hovercard\" href=\"https://github.com/rails/rails/pull/46594\">#46594</a> also <a href=\"https://github.com/rails/rails/pull/46594/files#diff-b0e9e928ad4f52e85feaa663c8b5c33b3ff5e46646b67945bceb444a0ccbd394R264-R269\">fixes it</a>, but I think it invalidates the test.<br>\n<a href=\"https://github.com/rails/rails/blob/main/actionpack/lib/action_dispatch/http/request.rb#L356-L362\">It bypass the body_stream branch</a> in <code class=\"notranslate\">ActionDispatch::Request#body</code> by setting <code class=\"notranslate\">RAW_POST_DATA</code> <a href=\"https://github.com/rails/rails/blob/main/actionpack/lib/action_controller/test_case.rb#L503-L505\">when doing the request</a>.</p>\n<p dir=\"auto\"><a href=\"https://github.com/rails/rails/blob/main/actionpack/test/controller/test_case_test.rb#L277-L280\">We already have tests</a> on the <code class=\"notranslate\">RAW_POST_DATA</code> branch of <code class=\"notranslate\">ActionDispatch::Request#body</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG -- N/A</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48158",
            "title": "Fix failing buildkite build - action_pack [rack-3]",
            "date_modified": "2023-05-08T00:24:31.000Z",
            "date_published": "2023-05-07T06:11:40.000Z",
            "author": {
                "name": "JoeDupuis",
                "url": "https://github.com/JoeDupuis"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/16636757?u=27830160a8177896eb66623c0a9b730015a2aae0&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">In this test case we only check if the third child's queue adapter is nil or not. We should instead check if the queue adapter is the same as base adapter to ensure that it did not change when we changed adapters for other jobs.</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/50f0c0f064997186707613889fbccf19416176e2/activejob/test/cases/queue_adapter_test.rb#L44-L52\">rails/activejob/test/cases/queue_adapter_test.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 44 to 52\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/50f0c0f064997186707613889fbccf19416176e2\">50f0c0f</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L44\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"44\"></td>\n          <td id=\"LC44\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">assert_kind_of</span> <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">QueueAdapters</span>::<span class=\"pl-v\">StubTwoAdapter</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">child_job_two</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L45\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"45\"></td>\n          <td id=\"LC45\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">assert_kind_of</span> <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">QueueAdapters</span>::<span class=\"pl-v\">StubTwoAdapter</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">child_job_two</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L46\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"46\"></td>\n          <td id=\"LC46\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">assert_kind_of</span> <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">QueueAdapters</span>::<span class=\"pl-v\">StubOneAdapter</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">child_job_one</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"child_job_one's queue adapter should remain unchanged\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L47\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"47\"></td>\n          <td id=\"LC47\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">assert_equal</span> <span class=\"pl-s1\">base_queue_adapter</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"ActiveJob::Base's queue adapter should remain unchanged\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L48\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"48\"></td>\n          <td id=\"LC48\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L49\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"49\"></td>\n          <td id=\"LC49\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">child_job_three</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Class</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">ActiveJob</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L50\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"50\"></td>\n          <td id=\"LC50\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L51\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"51\"></td>\n          <td id=\"LC51\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">assert_not_nil</span> <span class=\"pl-s1\">child_job_three</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">queue_adapter</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L52\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"52\"></td>\n          <td id=\"LC52\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\"><del>This Pull Request changes [REPLACE ME]</del></p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.<br>\n<del>* [ ] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</del></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48157",
            "title": "Improve AJ queue adapter test case",
            "date_modified": "2023-05-07T07:17:31.000Z",
            "date_published": "2023-05-07T05:51:18.000Z",
            "author": {
                "name": "shivamsinghchahar",
                "url": "https://github.com/shivamsinghchahar"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/771968?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This commit addresses a few problems:</p>\n<ol dir=\"auto\">\n<li>\n<p dir=\"auto\"><code class=\"notranslate\">read_multi</code> (and <code class=\"notranslate\">fetch_multi</code> and <code class=\"notranslate\">delete_multi</code>) logs multiple keys as if they were a single composite key.  For example, <code class=\"notranslate\">read_multi(\"posts/1\", \"posts/2\")</code> will log \"Cache read_multi: posts/1/posts/2\".  This can make the log confusing or indecipherable when keys contain more slashes, such as with view fragments.</p>\n</li>\n<li>\n<p dir=\"auto\"><code class=\"notranslate\">write_multi</code> logs its entire argument as a single composite key.  For example, <code class=\"notranslate\">write_multi(\"p1\" =&gt; post1, \"p2\" =&gt; post2)</code> will log \"Cache write_multi: p1=#Post:0x.../p2=#Post:0x...\".</p>\n</li>\n<li>\n<p dir=\"auto\"><code class=\"notranslate\">MemoryStore#cleanup</code> logs its instrumentation payload instead of setting it on the event.  For example, when 10 entries are in the cache, <code class=\"notranslate\">cleanup</code> will log \"Cache cleanup: size=10\" instead of merging <code class=\"notranslate\">{ size: 10 }</code> into the event payload.</p>\n</li>\n</ol>\n<p dir=\"auto\">Multi-key logging was first added in <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/ca6aba7f30ad9910f17e4c5b39667889d9518794/hovercard\" href=\"https://github.com/rails/rails/commit/ca6aba7f30ad9910f17e4c5b39667889d9518794\"><tt>ca6aba7</tt></a>, then reverted in <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/c4a46fa781d39f1b4607cb1613a1c67fa044ce54/hovercard\" href=\"https://github.com/rails/rails/commit/c4a46fa781d39f1b4607cb1613a1c67fa044ce54\"><tt>c4a46fa</tt></a> due to being unwieldy, and then re-added in <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/2b96d5822bfe407be7589e293f3265c0c7a6726c/hovercard\" href=\"https://github.com/rails/rails/commit/2b96d5822bfe407be7589e293f3265c0c7a6726c\"><tt>2b96d58</tt></a> (for <code class=\"notranslate\">write_multi</code>) and <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/62023884f76c108127c8966f4d67bb717338dd66/hovercard\" href=\"https://github.com/rails/rails/commit/62023884f76c108127c8966f4d67bb717338dd66\"><tt>6202388</tt></a> (for <code class=\"notranslate\">read_multi</code>) but without any handling or formatting.</p>\n<p dir=\"auto\">This commit changes the way multi-key operations are logged in order to prevent these problems.  For example, <code class=\"notranslate\">read_multi(\"posts/1\", \"posts/2\")</code> will now log \"Cache read_multi: 2 key(s) specified\", and <code class=\"notranslate\">write_multi(\"p1\" =&gt; post1, \"p2\" =&gt; post2)</code> will now log \"Cache write_multi: 2 key(s) specified\".</p>",
            "url": "https://github.com/rails/rails/pull/48150",
            "title": "Log key summary for `*_multi` cache operations",
            "date_modified": "2023-05-08T00:03:54.000Z",
            "date_published": "2023-05-06T21:26:08.000Z",
            "author": {
                "name": "jonathanhefner",
                "url": "https://github.com/jonathanhefner"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/325748?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #38698.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"579257105\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/38698\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/38698/hovercard\" href=\"https://github.com/rails/rails/issues/38698\">#38698</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #38698.\">fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"579257105\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/38698\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/38698/hovercard\" href=\"https://github.com/rails/rails/issues/38698\">#38698</a> by allowing nested Arrays to pass through unchanged when permitting arbitrary hashes.  (i.e. <code class=\"notranslate\">permit(data: {})</code>)</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48148",
            "title": "[Fix #38698] Fix nested Arrays when permitting arbitrary Hashes",
            "date_modified": "2023-05-06T20:09:57.000Z",
            "date_published": "2023-05-06T05:34:56.000Z",
            "author": {
                "name": "tindron",
                "url": "https://github.com/tindron"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2145?u=852c36277afc8bff6cfd2565a665294841184ecc&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because writing <code class=\"notranslate\">Rails.application.credentials</code> can be a tad cumbersome.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes <code class=\"notranslate\">Rails</code> to have a convenient <code class=\"notranslate\">credentials</code> method for one less hop to get to credentials. (Similar to <code class=\"notranslate\">Rails.configuration</code>)</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48147",
            "title": "Add credentials convenience method on Rails",
            "date_modified": "2023-05-07T23:44:53.000Z",
            "date_published": "2023-05-06T04:07:39.000Z",
            "author": {
                "name": "mattpolito",
                "url": "https://github.com/mattpolito"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR allows aliasing the <code class=\"notranslate\">id</code> column in cases where it is not<br>\nbeing used as a primary key.</p>\n<p dir=\"auto\">Currently there is no convenient way of reading the <code class=\"notranslate\">id</code> column value<br>\nwhich is not being used as a primary key as <code class=\"notranslate\">id</code> in Rails is a reserved<br>\nterm which means \"an identifier\" or the value stored in the primary key<br>\ncolumn.</p>\n<p dir=\"auto\">Given a <code class=\"notranslate\">posts</code> table with both <code class=\"notranslate\">id</code> and <code class=\"notranslate\">title</code> columns where <code class=\"notranslate\">title</code><br>\nis being used as a primary key it is possible to alias <code class=\"notranslate\">id</code> attribute<br>\nto a new name so we can fetch the column value.</p>\n<p dir=\"auto\">For example:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Post &lt; ActiveRecord::Base\n  self.primary_key = :title\n  alias_attribute :post_id, :id\nend\n\npost = Post.create(title: &quot;Hello world&quot;)\npost.post_id # =&gt; 1\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">primary_key</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">:title</span>\n  <span class=\"pl-en\">alias_attribute</span> <span class=\"pl-pds\">:post_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:id</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">title</span>: <span class=\"pl-s\">\"Hello world\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">post_id</span> <span class=\"pl-c\"># =&gt; 1</span></pre></div>\n<h3 dir=\"auto\">Technical details</h3>\n<p dir=\"auto\">Currently aliasing an attribute like <code class=\"notranslate\">alias_attribute :subject, :title</code> will define <code class=\"notranslate\">&lt;prefix_subject_suffix&gt;</code> methods that directly delegate to the <code class=\"notranslate\">*title*</code> methods. For example the <code class=\"notranslate\">subject</code> reader would look like:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def subject\n  title\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">def</span> <span class=\"pl-en\">subject</span>\n  <span class=\"pl-en\">title</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">This works fine but doesn't work when aliasing the <code class=\"notranslate\">id</code> attribute as <code class=\"notranslate\">id</code> method is reserved to return the primary key value so in current implementation an alias like <code class=\"notranslate\">alias_attribute :subject, :id</code> ends up generating</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def subject\n  id\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">def</span> <span class=\"pl-en\">subject</span>\n  <span class=\"pl-en\">id</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">which will return the value behind the <code class=\"notranslate\">primary_key</code> column and not the <code class=\"notranslate\">id</code> column value.</p>\n<p dir=\"auto\">With the change we are proposing aliasing <code class=\"notranslate\">id</code> attribute will generate methods that call into so-called \"proxy\" methods that read directly from the attributes. So aliasing <code class=\"notranslate\">id</code> attribute will generate:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def subject\n  attribute(&quot;id&quot;)\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">def</span> <span class=\"pl-en\">subject</span>\n  <span class=\"pl-en\">attribute</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"id\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/d503e893056650524caaf9ffe0364417224c051a/activemodel/lib/active_model/attributes.rb#L148-L149\">rails/activemodel/lib/active_model/attributes.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 148 to 149\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/d503e893056650524caaf9ffe0364417224c051a\">d503e89</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L148\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"148\"></td>\n          <td id=\"LC148\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">attribute</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attr_name</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L149\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"149\"></td>\n          <td id=\"LC149\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-c1\">@attributes</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">fetch_value</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attr_name</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">along with <code class=\"notranslate\">attribute_was?</code> <code class=\"notranslate\">attribute_changed?</code>, etc and allow to access the <code class=\"notranslate\">id</code> value directly.</p>\n<p dir=\"auto\">We achieve this by abstracting the way how we build the method body in <code class=\"notranslate\">compilable_alias_attribute_method_body_for</code> and <code class=\"notranslate\">dynamic_alias_attribute_method_body_for</code> methods and override it from the <code class=\"notranslate\">PrimaryKey</code> module to build a different body for <code class=\"notranslate\">id</code> attribute.</p>\n<p dir=\"auto\">Since now we have versions of the alias attribute methods we had to make sure we are using two different namespaces to avoid one of the bodies being cached. This is to prevent issues when a non Active Record model, like an Active Model model aliases <code class=\"notranslate\">id</code> and pollutes the <code class=\"notranslate\">:alias_attribute</code> namespace cache with a non-primary key implementation.</p>\n<h3 dir=\"auto\">Long-term plans</h3>\n<p dir=\"auto\">What we initially planned and what we could do is to extend <code class=\"notranslate\">alias_attribute</code> to allow for aliasing of any of the Active Record reserved terms. For example if the application ends up in a situation where it needs to work with a schema that contains columns named with reserved terms it could alias these columns like:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"alias_attribute :delete_value, :delete\nalias_attribute :save_value, :save\nalias_attribute :update_value, :update\n...\"><pre class=\"notranslate\"><span class=\"pl-en\">alias_attribute</span> <span class=\"pl-pds\">:delete_value</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:delete</span>\n<span class=\"pl-en\">alias_attribute</span> <span class=\"pl-pds\">:save_value</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:save</span>\n<span class=\"pl-en\">alias_attribute</span> <span class=\"pl-pds\">:update_value</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:update</span>\n...</pre></div>\n<p dir=\"auto\">However, we decided to limit it to <code class=\"notranslate\">id</code> only as at this moment it is not possible to boot a Rails app with a column name that conflicts with an Active Record reserved terms as it raises based on the <code class=\"notranslate\">dangerous_attribute_method?</code><br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/d503e893056650524caaf9ffe0364417224c051a/activerecord/lib/active_record/attribute_methods.rb#L87-L89\">rails/activerecord/lib/active_record/attribute_methods.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 87 to 89\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/d503e893056650524caaf9ffe0364417224c051a\">d503e89</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L87\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"87\"></td>\n          <td id=\"LC87\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">instance_method_already_implemented?</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">method_name</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L88\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"88\"></td>\n          <td id=\"LC88\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">if</span> <span class=\"pl-en\">dangerous_attribute_method?</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">method_name</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L89\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"89\"></td>\n          <td id=\"LC89\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">raise</span> <span class=\"pl-v\">DangerousAttributeError</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">method_name</span><span class=\"pl-kos\">}</span></span> is defined by Active Record. Check to make sure that you don't have an attribute or method with the same name.\"</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">So before extending the <code class=\"notranslate\">alias_attribute</code> capabilities we would need to change Rails to avoid raising the exception and allow application to boot with a conflicting column name so it can be aliased to a different attribute name. Which in our opinion deserves a separate PR.</p>\n<h3 dir=\"auto\">Side note</h3>\n<p dir=\"auto\">Overall it looks like the <code class=\"notranslate\">alias_attribute</code> generation could be simplified and we could at least get rid of one of the regexes<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/d503e893056650524caaf9ffe0364417224c051a/activemodel/lib/active_model/attribute_methods.rb#L67-L68\">rails/activemodel/lib/active_model/attribute_methods.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 67 to 68\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/d503e893056650524caaf9ffe0364417224c051a\">d503e89</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L67\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"67\"></td>\n          <td id=\"LC67\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">NAME_COMPILABLE_REGEXP</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">/<span class=\"pl-cce\">\\A</span>[a-zA-Z_]<span class=\"pl-cce\">\\w</span>*[!?=]?<span class=\"pl-cce\">\\z</span>/</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L68\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"68\"></td>\n          <td id=\"LC68\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">CALL_COMPILABLE_REGEXP</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">/<span class=\"pl-cce\">\\A</span>[a-zA-Z_]<span class=\"pl-cce\">\\w</span>*[!?]?<span class=\"pl-cce\">\\z</span>/</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Also <code class=\"notranslate\">COMPILABLE</code> term doesn't seem to be the best fit for the logic anymore. As far as I can tell it used to differentiate between methods built inline like a string (compiled) and methods that were defined using <code class=\"notranslate\">define_method</code><br>\nWe are not using <code class=\"notranslate\">define_method</code> anymore which means both of the branches are \"complied\" in the legacy terms.<br>\nSo it looks like we can refactor the logic to only do the <code class=\"notranslate\">.match</code> once to determine whether we want a <code class=\"notranslate\">send</code> body or <code class=\"notranslate\">self.method</code> body. It may not result in any performance gains but overall the logic is complex and it would be nice to simplify it a bit.</p>",
            "url": "https://github.com/rails/rails/pull/48144",
            "title": "Call proxy attribute methods for `id` alias attribute",
            "date_modified": "2023-05-05T21:00:17.000Z",
            "date_published": "2023-05-05T21:00:13.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/28561?u=095779352a57f75e734987829f3f67a10e5780ed&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Document the <code class=\"notranslate\">*_partial_path</code>, <code class=\"notranslate\">attachable_sgid</code> and <code class=\"notranslate\">as_json</code> methods.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48143",
            "title": "Document more methods for ActionText::Attachable [ci-skip]",
            "date_modified": "2023-05-05T20:06:41.000Z",
            "date_published": "2023-05-05T20:04:27.000Z",
            "author": {
                "name": "p8",
                "url": "https://github.com/p8"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48135.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1697145934\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48135\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48135/hovercard\" href=\"https://github.com/rails/rails/issues/48135\">#48135</a></p>\n<p dir=\"auto\">Encrypted keys were updated <a href=\"https://github.com/rails/rails/commit/4c6c3575c66ce10043c9ea04023788890a228de8\">previously</a> to restrict other users from reading the file by default. However, there is a brief period of time between an encrypted key being created and its permissions being set to 0600. This means that it is possible for another user to read that file during that time.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit fixes that issue by setting the desired permissions when the file is created.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I've pointed this at my branch of Thor to show that <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1698030150\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/thor/issues/820\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/thor/pull/820/hovercard\" href=\"https://github.com/rails/thor/pull/820\">rails/thor#820</a> would enable fixing this, but that would have to be changed to merge this.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48141",
            "title": "Fix chmod race condition when generating key",
            "date_modified": "2023-05-05T18:49:08.000Z",
            "date_published": "2023-05-05T18:49:04.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/33079237?u=76f101f16829322713f7ba0c1496767a861ca89b&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This is a problem that has existed since the introduction of <a href=\"https://github.com/rails/rails/pull/35077/files#r260410047\">ActiveRecord::InsertAll</a>.<br>\nInitially, <code class=\"notranslate\">ActiveRecord::InsertAll</code> used <code class=\"notranslate\">ActiveRecord::Relation::QueryAttribute#value_for_database</code> to convert values. As the code evolved, it switched to using <code class=\"notranslate\">ActiveModel::Type::XXX#serialize</code> to serialize values.<br>\nThis is inconsistent with how attributes are converted in <code class=\"notranslate\">Model#save</code>, which uses <code class=\"notranslate\">ActiveModel::Attribute::FromUser#value_for_database</code>.<br>\nTherefore, in some cases, data created using <code class=\"notranslate\">Model#insert</code> and <code class=\"notranslate\">Model#create</code> may be inconsistent. This PR fixes this issue.</p>\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>Fix value conversion of ActiveRecord::InsertAll::Builder#values_list</li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\"><em>PS: English is not my native language; please excuse typing errors.</em></p>",
            "url": "https://github.com/rails/rails/pull/48139",
            "title": "Fix active record insert values of type cast and serialize",
            "date_modified": "2023-05-05T15:29:20.000Z",
            "date_published": "2023-05-05T15:28:14.000Z",
            "author": {
                "name": "OuYangJinTing",
                "url": "https://github.com/OuYangJinTing"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8878264?u=f2b36c3d2bb7d96ed8bb4009b02eba6f85bec0c1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">We are working a lot with postgresql and schemas. I noticed that the ActiveRecord does not support many options for them. I want to enable possible options while maintaining similar behavior to <code class=\"notranslate\">create_table</code> and <code class=\"notranslate\">drop_table</code></p>\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>Added support of <strong>IF NOT EXISTS</strong> statement in <code class=\"notranslate\">create_schema</code></li>\n<li>Added support for <code class=\"notranslate\">force: cascade</code> option in <code class=\"notranslate\">create_schema</code></li>\n<li><strong>BREAKING CHANGE</strong> Changed default behavior of <code class=\"notranslate\">drop_schema</code>\n<ul dir=\"auto\">\n<li>no longer runs <strong>CASCADE</strong> by default</li>\n<li>supports <code class=\"notranslate\">force: :cascade</code> option, similar to <code class=\"notranslate\">drop_table</code></li>\n</ul>\n</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48132",
            "title": "Postgresql improvements to create_schema and drop_schema ",
            "date_modified": "2023-05-05T08:02:54.000Z",
            "date_published": "2023-05-04T19:55:09.000Z",
            "author": {
                "name": "Adam-Stomski",
                "url": "https://github.com/Adam-Stomski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/3942920?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">\"Fixes #<a href=\"https://github.com/rails/rails/issues/48077\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48077/hovercard\">48077</a>\"</p>\n<p dir=\"auto\">copy of <a href=\"https://github.com/rails/rails/pull/48078\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48078/hovercard\">PR</a> that was closed because of wrong rebase</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">When object is saved with <code class=\"notranslate\">belongs_to</code> association, that associated to object with <code class=\"notranslate\">has_one</code> relation, object actually saved   twice. For example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"class Post &lt; ActiveRecord::Base\n  belongs_to :user\n  belongs_to :poll\n\n  after_commit :test_after_commit\n  # after_save :test_after_commit saved_changes here are exists\n  after_save :test_after_save\n\n  attr_reader :after_save_counter\n\n  def test_after_commit\n    # saved_changes here are blank\n    if saved_change_to_release_stage?(to: 'published')\n      user.increment(:published_posts_count)\n    end\n  end\n\n  def test_after_save\n    # invokes twice\n    @after_save_counter ||= 0\n    @after_save_counter += 1\n  end\nend\n\nclass Poll &lt; ActiveRecord::Base\n  has_one :post\nend\n\npost = Post.new(\n  user: user,\n  title: 'yoyo',\n  release_stage: 'published'\n)\n\npost.poll = Poll.new(multiple: true)\n\npost.save\"><pre class=\"notranslate\"><code class=\"notranslate\">class Post &lt; ActiveRecord::Base\n  belongs_to :user\n  belongs_to :poll\n\n  after_commit :test_after_commit\n  # after_save :test_after_commit saved_changes here are exists\n  after_save :test_after_save\n\n  attr_reader :after_save_counter\n\n  def test_after_commit\n    # saved_changes here are blank\n    if saved_change_to_release_stage?(to: 'published')\n      user.increment(:published_posts_count)\n    end\n  end\n\n  def test_after_save\n    # invokes twice\n    @after_save_counter ||= 0\n    @after_save_counter += 1\n  end\nend\n\nclass Poll &lt; ActiveRecord::Base\n  has_one :post\nend\n\npost = Post.new(\n  user: user,\n  title: 'yoyo',\n  release_stage: 'published'\n)\n\npost.poll = Poll.new(multiple: true)\n\npost.save\n</code></pre></div>\n<p dir=\"auto\">First poll object is saved, then AR try to save post from <code class=\"notranslate\">save_has_one_association</code>, after that invokes <code class=\"notranslate\">save</code> method second time and this second <code class=\"notranslate\">save</code> call clears saved_changes.</p>\n<p dir=\"auto\">I decided to add variable that show that object already saving and prevent second save from <code class=\"notranslate\">save_has_one_association</code> callback</p>",
            "url": "https://github.com/rails/rails/pull/48130",
            "title": "Fix belongs to with has one association multiple savings",
            "date_modified": "2023-05-04T17:43:58.000Z",
            "date_published": "2023-05-04T17:19:08.000Z",
            "author": {
                "name": "briu",
                "url": "https://github.com/briu"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/4815?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48105.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1691544058\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48105\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48105/hovercard\" href=\"https://github.com/rails/rails/issues/48105\">#48105</a></p>",
            "url": "https://github.com/rails/rails/pull/48127",
            "title": "create (and use) /home/rails as home directory in Dockerfile",
            "date_modified": "2023-05-04T12:45:49.000Z",
            "date_published": "2023-05-04T12:45:44.000Z",
            "author": {
                "name": "rubys",
                "url": "https://github.com/rubys"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/25187547?u=4cc9f0eaa9c37d54d5b0f8a10b8124b18f131e3c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This test was introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"71017532\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/19904\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/19904/hovercard\" href=\"https://github.com/rails/rails/pull/19904\">#19904</a>.</p>\n<p dir=\"auto\">In <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"102967575\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/21368\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/21368/hovercard\" href=\"https://github.com/rails/rails/pull/21368\">#21368</a> a bunch of test setup was removed, but the assignment of <code class=\"notranslate\">@set</code> was duplicated.</p>\n<p dir=\"auto\">This removes the extraneous test setup.</p>",
            "url": "https://github.com/rails/rails/pull/48123",
            "title": "Remove redundant test setup",
            "date_modified": "2023-05-04T15:39:53.000Z",
            "date_published": "2023-05-03T21:39:58.000Z",
            "author": {
                "name": "cpjmcquillan",
                "url": "https://github.com/cpjmcquillan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/260602?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the Postgres database adapter. It allows me to create models that are backed by a temporary table and use them just like regular tables. Without this change e.g. <code class=\"notranslate\">insert_all</code> and <code class=\"notranslate\">upsert_all</code> are not possible.</p>\n<h3 dir=\"auto\">Test</h3>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire &quot;bundler/inline&quot;\n\ngemfile(true) do\n  source &quot;https://rubygems.org&quot;\n\n  git_source(:github) { |repo| &quot;https://github.com/#{repo}.git&quot; }\n\n  gem &quot;activerecord&quot;, path: './activerecord'\n  gem &quot;pg&quot;\nend\n\nrequire &quot;active_record&quot;\nrequire &quot;minitest/autorun&quot;\nrequire &quot;logger&quot;\n\nActiveRecord::Base.establish_connection(adapter: &quot;postgresql&quot;, url: &quot;postgres://localhost/rails-issue&quot;) rescue puts 'Please create a DB &quot;rails-issue&quot; yourself first'\nActiveRecord::Base.logger = Logger.new(STDOUT)\n\nclass Post &lt; ActiveRecord::Base\n  def self.with_temp_table(as:)\n    transaction do\n      connection.create_table(table_name, temporary: true, force: true, as: as)\n      yield\n    end\n  end\nend\n\nclass BugTest &lt; Minitest::Test\n  def test_upsert_in_temp_table\n\n    # Create a model backed by a temp table. Prefill the table with some data from a query.\n    Post.with_temp_table(as: &quot;select 1 as id, 'foo' as some_column&quot;) do\n      # Upserts require a unique constraint\n      Post.connection.add_index(Post.table_name, :id, unique: true)\n\n      assert_equal Post.new(id: 1, some_column: 'foo'), Post.sole\n\n      # The following line fails on master with:\n      #\n      #   ActiveRecord::StatementInvalid: PG::SyntaxError: ERROR:  syntax error at or near &quot;)&quot;\n      #   LINE 1: ...id&quot;,&quot;some_column&quot;) VALUES (1, 'bar') ON CONFLICT () DO UPDAT...\n      #\n      # The temp table, including all indices, constraints, etc are not 'seen'\n      # by Rails. The PostgreSQL adapter only considers stuff in the schemas\n      # returned by current_schemas(false). The temporary namespace\n      # 'pg_temp_xyz' is excluded.\n      #\n      # See https://www.postgresql.org/docs/15/functions-info.html\n      #\n      #   current_schemas ( include_implicit boolean )  name[]\n      #\n      #   Returns an array of the names of all schemas presently in the\n      #   effective search path, in their priority order. (Items in the current\n      #   search_path setting that do not correspond to existing, searchable\n      #   schemas are omitted.) If the Boolean argument is true, then\n      #   implicitly-searched system schemas such as pg_catalog are included in\n      #   the result.\n      #\n      # If you include implicit tables, via current_schemas(true), the\n      # temporary table is found, but that is also true for the other system\n      # schemas that we don't want.\n      #\n      # Luckily Postgres provides a means to find the temp schema name via:\n      #\n      #   pg_my_temp_schema ()  oid\n      #\n      #   Returns the OID of the current session's temporary schema, or zero if\n      #   it has none (because it has not created any temporary tables).\n      #\n      # If we add that to the search path, then temp tables work just like\n      # regular tables.\n      Post.upsert_all([{ id: 1, some_column: 'bar' }], unique_by: :id)\n\n      assert_equal Post.new(id: 1, some_column: 'bar'), Post.sole\n    end\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/inline\"</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">\"https://rubygems.org\"</span>\n\n  <span class=\"pl-en\">git_source</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:github</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">repo</span>| <span class=\"pl-s\">\"https://github.com/<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">repo</span><span class=\"pl-kos\">}</span></span>.git\"</span> <span class=\"pl-kos\">}</span>\n\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"activerecord\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">path</span>: <span class=\"pl-s\">'./activerecord'</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"pg\"</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_record\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"minitest/autorun\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"logger\"</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">establish_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">adapter</span>: <span class=\"pl-s\">\"postgresql\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">url</span>: <span class=\"pl-s\">\"postgres://localhost/rails-issue\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">rescue</span> <span class=\"pl-en\">puts</span> <span class=\"pl-s\">'Please create a DB \"rails-issue\" yourself first'</span>\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">with_temp_table</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">as</span>:<span class=\"pl-kos\">)</span>\n    <span class=\"pl-en\">transaction</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create_table</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">table_name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">temporary</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">as</span>: <span class=\"pl-s1\">as</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-k\">yield</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">BugTest</span> &lt; <span class=\"pl-v\">Minitest</span>::<span class=\"pl-v\">Test</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_upsert_in_temp_table</span>\n\n    <span class=\"pl-c\"># Create a model backed by a temp table. Prefill the table with some data from a query.</span>\n    <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">with_temp_table</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">as</span>: <span class=\"pl-s\">\"select 1 as id, 'foo' as some_column\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-c\"># Upserts require a unique constraint</span>\n      <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">add_index</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">table_name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">unique</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span>\n\n      <span class=\"pl-en\">assert_equal</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">some_column</span>: <span class=\"pl-s\">'foo'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">sole</span>\n\n      <span class=\"pl-c\"># The following line fails on master with:</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\">#   ActiveRecord::StatementInvalid: PG::SyntaxError: ERROR:  syntax error at or near \")\"</span>\n      <span class=\"pl-c\">#   LINE 1: ...id\",\"some_column\") VALUES (1, 'bar') ON CONFLICT () DO UPDAT...</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\"># The temp table, including all indices, constraints, etc are not 'seen'</span>\n      <span class=\"pl-c\"># by Rails. The PostgreSQL adapter only considers stuff in the schemas</span>\n      <span class=\"pl-c\"># returned by current_schemas(false). The temporary namespace</span>\n      <span class=\"pl-c\"># 'pg_temp_xyz' is excluded.</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\"># See https://www.postgresql.org/docs/15/functions-info.html</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\">#   current_schemas ( include_implicit boolean )  name[]</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\">#   Returns an array of the names of all schemas presently in the</span>\n      <span class=\"pl-c\">#   effective search path, in their priority order. (Items in the current</span>\n      <span class=\"pl-c\">#   search_path setting that do not correspond to existing, searchable</span>\n      <span class=\"pl-c\">#   schemas are omitted.) If the Boolean argument is true, then</span>\n      <span class=\"pl-c\">#   implicitly-searched system schemas such as pg_catalog are included in</span>\n      <span class=\"pl-c\">#   the result.</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\"># If you include implicit tables, via current_schemas(true), the</span>\n      <span class=\"pl-c\"># temporary table is found, but that is also true for the other system</span>\n      <span class=\"pl-c\"># schemas that we don't want.</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\"># Luckily Postgres provides a means to find the temp schema name via:</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\">#   pg_my_temp_schema ()  oid</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\">#   Returns the OID of the current session's temporary schema, or zero if</span>\n      <span class=\"pl-c\">#   it has none (because it has not created any temporary tables).</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\"># If we add that to the search path, then temp tables work just like</span>\n      <span class=\"pl-c\"># regular tables.</span>\n      <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">upsert_all</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">[</span><span class=\"pl-kos\">{</span> <span class=\"pl-pds\">id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">some_column</span>: <span class=\"pl-s\">'bar'</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">unique_by</span>: <span class=\"pl-pds\">:id</span><span class=\"pl-kos\">)</span>\n\n      <span class=\"pl-en\">assert_equal</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">some_column</span>: <span class=\"pl-s\">'bar'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">sole</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48117",
            "title": "Support upsert in Postgres temp tables",
            "date_modified": "2023-05-05T09:11:00.000Z",
            "date_published": "2023-05-03T09:19:29.000Z",
            "author": {
                "name": "rschellhorn",
                "url": "https://github.com/rschellhorn"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/163168?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">When using the <code class=\"notranslate\">expires_in</code> option to generate an expiration URL, the URL will change each time.<br>\nBy using the <code class=\"notranslate\">expires_at</code> option as shown in the example below, the browser cache can be used for a certain period of time.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"rails_blob_path(user.avatar, disposition: &quot;attachment&quot;, expires_at: 2.hours.from_now.beginning_of_hour)\n&lt;%= image_tag rails_blob_path(user.avatar.variant(resize: &quot;100x100&quot;), expires_at: 2.hours.from_now.beginning_of_hour) %&gt;\"><pre class=\"notranslate\"><span class=\"pl-en\">rails_blob_path</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">avatar</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">disposition</span>: <span class=\"pl-s\">\"attachment\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">expires_at</span>: <span class=\"pl-c1\">2</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">hours</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">from_now</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">beginning_of_hour</span><span class=\"pl-kos\">)</span>\n&lt;%= <span class=\"pl-en\">image_tag</span> <span class=\"pl-en\">rails_blob_path</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">avatar</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">variant</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">resize</span>: <span class=\"pl-s\">\"100x100\"</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">expires_at</span>: <span class=\"pl-c1\">2</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">hours</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">from_now</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">beginning_of_hour</span><span class=\"pl-kos\">)</span> %&gt;</pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Add <code class=\"notranslate\">expires_at</code> option to <code class=\"notranslate\">ActiveStorage::Blob#signed_id</code> and URL helpers.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48115",
            "title": "Add `expires_at` option to `ActiveStorage::Blob#signed_id`",
            "date_modified": "2023-05-02T22:40:06.000Z",
            "date_published": "2023-05-02T22:20:21.000Z",
            "author": {
                "name": "aki77",
                "url": "https://github.com/aki77"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/13070410?u=552efa2d0943af80a64d99ecd7489fce46a9475b&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because Rails doesn't provide by default a way to validate if a number is within the database limit. That's problematic when one is trying to store an ID to another table without foreign key since one would need to manually add the logic for this validation, possibly using <code class=\"notranslate\">validates_numericality_of</code> range.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"MAX_EIGHT_BYTES_SIGNED_NUMBER = 2**63 - 1\nprivate_constant :MAX_EIGHT_BYTES_SIGNED_NUMBER\n\n# It should store a valid database record; thus, it should not be negative and it can go up to the maximum value\n# supported by the column, which is using the default bigint type size of 8 bytes.\nVALID_ID_RANGE = (..MAX_EIGHT_BYTES_SIGNED_NUMBER)\nprivate_constant :VALID_ID_RANGE\n\nvalidates :model_id, numericality: { in: VALID_ID_RANGE }\"><pre class=\"notranslate\"><span class=\"pl-c1\">MAX_EIGHT_BYTES_SIGNED_NUMBER</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">2</span>**<span class=\"pl-c1\">63</span> - <span class=\"pl-c1\">1</span>\n<span class=\"pl-en\">private_constant</span> <span class=\"pl-pds\">:MAX_EIGHT_BYTES_SIGNED_NUMBER</span>\n\n<span class=\"pl-c\"># It should store a valid database record; thus, it should not be negative and it can go up to the maximum value</span>\n<span class=\"pl-c\"># supported by the column, which is using the default bigint type size of 8 bytes.</span>\n<span class=\"pl-c1\">VALID_ID_RANGE</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span>..<span class=\"pl-c1\">MAX_EIGHT_BYTES_SIGNED_NUMBER</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-en\">private_constant</span> <span class=\"pl-pds\">:VALID_ID_RANGE</span>\n\n<span class=\"pl-en\">validates</span> <span class=\"pl-pds\">:model_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">numericality</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">in</span>: <span class=\"pl-c1\">VALID_ID_RANGE</span> <span class=\"pl-kos\">}</span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes <code class=\"notranslate\">ActiveRecord::Validations::NumericalityValidator</code> to support a new value for the <code class=\"notranslate\">in:</code> option: <code class=\"notranslate\">:limit</code>.</p>\n<p dir=\"auto\"><code class=\"notranslate\">:limit</code> will verify the column's SQL type metadata limit to create a range with it. If the value is a <code class=\"notranslate\">virtual attribute</code>, an exception is raised. If the column doesn't have a <code class=\"notranslate\">limit</code> value set, the validation will be ignored.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48114",
            "title": "Add `:limit` to `validates_numericality_of`",
            "date_modified": "2023-05-02T21:49:13.000Z",
            "date_published": "2023-05-02T19:09:43.000Z",
            "author": {
                "name": "edaroit",
                "url": "https://github.com/edaroit"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Their value seem very limited, and I fear they cause users to rescue these specifc errors rather than the general <code class=\"notranslate\">ConnectionFailed</code> one.</p>\n<p dir=\"auto\">FYI <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/adrianna-chang-shopify/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/adrianna-chang-shopify\">@adrianna-chang-shopify</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/jhawthorn/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jhawthorn\">@jhawthorn</a></p>",
            "url": "https://github.com/rails/rails/pull/48109",
            "title": "Get rid of TrilogyAdapter's special errors",
            "date_modified": "2023-05-03T07:28:52.000Z",
            "date_published": "2023-05-02T14:07:10.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/771968?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This commit adds support for <code class=\"notranslate\">:message_pack</code> and <code class=\"notranslate\">:message_pack_allow_marshal</code> as serializers for <code class=\"notranslate\">config.action_dispatch.cookies_serializer</code>, just like <code class=\"notranslate\">config.active_support.message_serializer</code>.</p>\n<p dir=\"auto\">The <code class=\"notranslate\">:message_pack</code> serializer can fall back to deserializing with <code class=\"notranslate\">AS::JSON</code>, and the <code class=\"notranslate\">:message_pack_allow_marshal</code> serializer can fall back to deserializing with <code class=\"notranslate\">AS::JSON</code> or <code class=\"notranslate\">Marshal</code>.  Additionally, the <code class=\"notranslate\">:marshal</code>, <code class=\"notranslate\">:json</code>, and <code class=\"notranslate\">:hybrid</code> / <code class=\"notranslate\">:json_allow_marshal</code> serializers can now fall back to deserializing with <code class=\"notranslate\">AS::MessagePack</code>.  These behaviors make it easier to migrate between cookies serializers.</p>\n<hr>\n<p dir=\"auto\">This is based on top of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1671686920\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47963\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47963/hovercard\" href=\"https://github.com/rails/rails/pull/47963\">#47963</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1671854566\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47964\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47964/hovercard\" href=\"https://github.com/rails/rails/pull/47964\">#47964</a>.  See the 3rd commit for the relevant changes.</p>",
            "url": "https://github.com/rails/rails/pull/48103",
            "title": "Support `:message_pack` as cookies serializer",
            "date_modified": "2023-05-01T20:29:33.000Z",
            "date_published": "2023-05-01T20:23:01.000Z",
            "author": {
                "name": "jonathanhefner",
                "url": "https://github.com/jonathanhefner"
            }
        }
    ]
}