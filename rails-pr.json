{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/3387?u=f1ae005c33bcf5f9b32ee9636d87d0677fe7f035&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">I did a pass on the dev containers guide. Remarks for review:</p>\n<ul dir=\"auto\">\n<li>Following the style in other guides, the intro says \"you will know\" (which makes sense, since it is something that happens \"after\").</li>\n<li>According to <a href=\"https://containers.dev\" rel=\"nofollow\">https://containers.dev</a> \"development container\" and \"dev container\" are written in lowercase (while \"The Development Container Specification\" is spelled that way).</li>\n<li>According to <a href=\"https://code.visualstudio.com\" rel=\"nofollow\">https://code.visualstudio.com</a> \"VS Code\" has a space.</li>\n<li>The VS Code extension is called \"Dev Containers\" (plural).</li>\n<li>Added a tip for macOS, since the OS did not allow the execution of <code class=\"notranslate\">rails-new</code>. Though maybe that would be better documented in the README of <code class=\"notranslate\">rails-new</code> itself?</li>\n<li><del><code class=\"notranslate\">rails-new --help</code> does not list <code class=\"notranslate\">--devcontainer</code> as an option, is the command <code class=\"notranslate\">rails-new blog --devcontainer</code> correct?</del></li>\n<li><del>Let me also add that <code class=\"notranslate\">rails-new blog --devcontainer</code> did not create a <code class=\"notranslate\">.devcontainer</code> folder and VS Code does not recognize the generated Rails application as subject to run in a container. Is the guide up to date in that sense?</del></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52251",
            "title": "Edits in the dev containers guide",
            "date_modified": "2024-07-01T21:42:12.000Z",
            "date_published": "2024-07-01T21:04:17.000Z",
            "author": {
                "name": "fxn",
                "url": "https://github.com/fxn"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/200500?u=328252b84dc40e5d2f8cfb89de4a3e3c5ee49bb0&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because <code class=\"notranslate\">EncryptedAttributeType#type</code> incorrectly always returns <code class=\"notranslate\">:text</code> type since that's the type <code class=\"notranslate\">EncryptedAttributeType</code> inherited from. It doesn't consider the actual <code class=\"notranslate\">cast_type</code> it has.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes two things:</p>\n<ul dir=\"auto\">\n<li>it delegates <code class=\"notranslate\">type</code> method to actual <code class=\"notranslate\">cast_type</code> instead of using one from <code class=\"notranslate\">::ActiveRecord::Type::Text</code></li>\n<li>it changes type class from which <code class=\"notranslate\">EncryptedAttributeType</code> is inherited to more generic <code class=\"notranslate\">::ActiveModel::Type::Value</code>. We don't need this change to fix this issue but I thought it makes more sense to inherit from base type instead of specific <code class=\"notranslate\">::ActiveRecord::Type::Text</code>. I tried to check git history to understand why exactly this type was chosen but it was like this when this encryption feature was implemented (without an explanation) so I'm not completely sure if that's ok to change that.</li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52247",
            "title": "EncryptedAttributeType#type should return cast_type's type.",
            "date_modified": "2024-07-01T19:28:54.000Z",
            "date_published": "2024-07-01T19:22:53.000Z",
            "author": {
                "name": "nashby",
                "url": "https://github.com/nashby"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/28561?u=095779352a57f75e734987829f3f67a10e5780ed&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Related to: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2373086217\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52217\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/52217/hovercard\" href=\"https://github.com/rails/rails/pull/52217\">#52217</a><br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/28561/344766376-0eb45589-76fb-4274-9a6e-e60ceeeb8733.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTk4Nzg5ODEsIm5iZiI6MTcxOTg3ODY4MSwicGF0aCI6Ii8yODU2MS8zNDQ3NjYzNzYtMGViNDU1ODktNzZmYi00Mjc0LTlhNmUtZTYwY2VlZWI4NzMzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA3MDIlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNzAyVDAwMDQ0MVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWFhZWYwZGEzZWI1YzIyZDQ3NjZiZTQxMDI5MmZjNTZkYjcyODg4MzBjMGM3ZTYyZGI4N2QxYWZmZjMyNGMxMDAmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.do5AKPcws5HF7ZWx9GYwmP3gmLvqR2iPz4AA0Hae3S0\"><img width=\"872\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/28561/344766376-0eb45589-76fb-4274-9a6e-e60ceeeb8733.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTk4Nzg5ODEsIm5iZiI6MTcxOTg3ODY4MSwicGF0aCI6Ii8yODU2MS8zNDQ3NjYzNzYtMGViNDU1ODktNzZmYi00Mjc0LTlhNmUtZTYwY2VlZWI4NzMzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA3MDIlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNzAyVDAwMDQ0MVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWFhZWYwZGEzZWI1YzIyZDQ3NjZiZTQxMDI5MmZjNTZkYjcyODg4MzBjMGM3ZTYyZGI4N2QxYWZmZjMyNGMxMDAmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.do5AKPcws5HF7ZWx9GYwmP3gmLvqR2iPz4AA0Hae3S0\" style=\"max-width: 100%;\"></a></p>",
            "url": "https://github.com/rails/rails/pull/52245",
            "title": "Add link guidelines to guides [ci-skip]",
            "date_modified": "2024-07-01T17:45:15.000Z",
            "date_published": "2024-07-01T17:35:34.000Z",
            "author": {
                "name": "p8",
                "url": "https://github.com/p8"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">When converting Action Cable docs from RDoc to Markdown, these two templates were accidentally included in the list of files converted (and the <code class=\"notranslate\">:markup:</code> directive added) because they incorrectly had an <code class=\"notranslate\">.rb</code> extension instead of <code class=\"notranslate\">.rb.tt</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit fixes the extension and removes the <code class=\"notranslate\">:markup:</code> directive.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52239",
            "title": "Fix markup directive in Action Cable templates",
            "date_modified": "2024-07-01T09:55:59.000Z",
            "date_published": "2024-06-30T23:41:56.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6014046?u=3972bfb97451f7f90e051df2e49fb7b8ee83e28d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">While looking for templates using the <code class=\"notranslate\">.rb</code> extension instead of <code class=\"notranslate\">.rb.tt</code>, my search ended up finding this <code class=\"notranslate\">test_helper.rb</code> file. (The other two are fixed in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2382501965\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52239\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/52239/hovercard\" href=\"https://github.com/rails/rails/pull/52239\">#52239</a>)</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ fd | rg &quot;/templates/.*\\.rb$&quot;\n./actioncable/lib/rails/generators/channel/templates/application_cable/channel.rb\n./actioncable/lib/rails/generators/channel/templates/application_cable/connection.rb\n./railties/lib/rails/generators/test_unit/plugin/templates/test_helper.rb\"><pre class=\"notranslate\"><code class=\"notranslate\">$ fd | rg \"/templates/.*\\.rb$\"\n./actioncable/lib/rails/generators/channel/templates/application_cable/channel.rb\n./actioncable/lib/rails/generators/channel/templates/application_cable/connection.rb\n./railties/lib/rails/generators/test_unit/plugin/templates/test_helper.rb\n</code></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Instead of correcting the extension, I opted to remove it because the <code class=\"notranslate\">test_unit:plugin</code> generator appears to be unused.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Am I right in thinking this is unused? The only tests that fail are related to generator namespace fallbacks, but that seems like a side effect of the specific class no longer existing instead of any external behavior changing. I can try updating the tests if we agree it should be removed.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52238",
            "title": "Remove test_unit plugin_generator",
            "date_modified": "2024-07-01T07:42:40.000Z",
            "date_published": "2024-06-30T23:30:59.000Z",
            "author": {
                "name": "skipkayhil",
                "url": "https://github.com/skipkayhil"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/170034?u=a921ef36a26d3da448fde275fd40b1e7d8a3f497&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">In line with the improvements made in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1875197825\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49095\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49095/hovercard\" href=\"https://github.com/rails/rails/pull/49095\">#49095</a>, implements the same lazily yielding backtrace frame for <code class=\"notranslate\">ActiveJob::LogSubcriber</code>. This will improve the performance of <code class=\"notranslate\">verbose_enqueue_logs</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">While researching the current 'verbose logging' features, I noticed that <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1875197825\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49095\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49095/hovercard\" href=\"https://github.com/rails/rails/pull/49095\">#49095</a> introduced a performance improvement from a new Ruby feature.</p>\n<p dir=\"auto\">A few months before, <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1650754219\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47839\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47839/hovercard\" href=\"https://github.com/rails/rails/pull/47839\">#47839</a> got merged which still uses the 'old' way of getting the matching source location. This PR gets that in line with the new, improved way.</p>\n<p dir=\"auto\"><strong>Question:</strong> does this warrant a <code class=\"notranslate\">CHANGELOG</code> entry? I left it out as I think no behavior has changed,</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52232",
            "title": "Improve performance of ActiveJob::LogSubscriber#query_source_location",
            "date_modified": "2024-06-30T07:54:54.000Z",
            "date_published": "2024-06-28T18:17:51.000Z",
            "author": {
                "name": "djfpaagman",
                "url": "https://github.com/djfpaagman"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5122678?u=204301f9f9fe8930fd26fe3bfe65b6ffaffd8b59&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The existing CI templates do not work as expected if <a href=\"https://edgeguides.rubyonrails.org/security.html#custom-credentials\" rel=\"nofollow\">custom credentials</a> are utilized.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ActiveSupport::MessageEncryptor::InvalidMessage: ActiveSupport::MessageEncryptor::InvalidMessage\"><pre class=\"notranslate\"><code class=\"notranslate\">ActiveSupport::MessageEncryptor::InvalidMessage: ActiveSupport::MessageEncryptor::InvalidMessage\n</code></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Improves existing CI templates by adding an <a href=\"https://docs.github.com/en/actions/learn-github-actions/variables\">environment variable</a> to store the <code class=\"notranslate\">RAILS_MASTER_KEY</code> which should be stored as a <a href=\"https://docs.github.com/en/actions/security-guides/using-secrets-in-github-actions\">secret</a>.</p>\n<p dir=\"auto\">This is necessary so that <a href=\"https://edgeguides.rubyonrails.org/security.html#custom-credentials\" rel=\"nofollow\">custom credentials</a> and <a href=\"https://edgeguides.rubyonrails.org/active_record_encryption.html#basic-usage\" rel=\"nofollow\">Active Record Encryption</a> will work as expected in CI.</p>\n<p dir=\"auto\">Since those features are not enabled by default, we comment this value out, which is consistent with how we treat Redis.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52230",
            "title": "CI: Introduce `RAILS_MASTER_KEY` placeholder",
            "date_modified": "2024-06-28T11:23:56.000Z",
            "date_published": "2024-06-27T20:07:38.000Z",
            "author": {
                "name": "stevepolitodesign",
                "url": "https://github.com/stevepolitodesign"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/522155?u=2e71ed2ab56545207a94b885fafc434ee7350cf1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">We have some performance-critical endpoints where we want to allocate least # of objects and use <code class=\"notranslate\">insert_all</code> to write 1000s of rows into the database.</p>\n<p dir=\"auto\">However, we see <code class=\"notranslate\">insert_all</code> being ~2.5x slower compared to manually building <code class=\"notranslate\">INSERT INTO &lt;table&gt; VALUES (...), (...)</code>.</p>\n<p dir=\"auto\">I've been profiling <code class=\"notranslate\">insert_all</code> and that turned out to be largely because it 1) works with arrays of hashes and each hash needs to be traversed 2) it serializes attributes via Attributes API.</p>\n<p dir=\"auto\">That's great default behavior but if we're inserting 2000 tuples of <code class=\"notranslate\">(&lt;foreigh-key&gt;, &lt;foreigh-key&gt;, &lt;foreigh-key&gt;)</code>, we don't want to traverse hashes and run the complexity of casting integers to integers via Attributes API.</p>\n<p dir=\"auto\">I'd like to propose a \"column mode\" for <code class=\"notranslate\">insert_all</code> that takes arrays of arrays (no need to traverse hashes!) and attribute casting is the responsibility of the caller.</p>\n<p dir=\"auto\">With that approach, we're able to make <code class=\"notranslate\">insert_all</code> as fast as direct string building:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ruby 3.3.1 (2024-04-23 revision c56cd86388) [arm64-darwin23]\nWarming up --------------------------------------\n          insert_all     4.000 i/100ms\ninsert_all with columns\n                        11.000 i/100ms\n             raw sql    13.000 i/100ms\n           with Arel    12.000 i/100ms\nCalculating -------------------------------------\n          insert_all     41.522 (± 7.2%) i/s -    168.000 in   4.066766s\ninsert_all with columns\n                         86.048 (±23.2%) i/s -    341.000 in   4.161382s\n             raw sql    114.595 (±14.0%) i/s -    455.000 in   4.055053s\n           with Arel    100.232 (±23.9%) i/s -    384.000 in   4.084465s\n\nComparison:\n             raw sql:      114.6 i/s\n           with Arel:      100.2 i/s - same-ish: difference falls within error\ninsert_all with columns:       86.0 i/s - same-ish: difference falls within error\n          insert_all:       41.5 i/s - 2.76x  slower\"><pre class=\"notranslate\"><code class=\"notranslate\">ruby 3.3.1 (2024-04-23 revision c56cd86388) [arm64-darwin23]\nWarming up --------------------------------------\n          insert_all     4.000 i/100ms\ninsert_all with columns\n                        11.000 i/100ms\n             raw sql    13.000 i/100ms\n           with Arel    12.000 i/100ms\nCalculating -------------------------------------\n          insert_all     41.522 (± 7.2%) i/s -    168.000 in   4.066766s\ninsert_all with columns\n                         86.048 (±23.2%) i/s -    341.000 in   4.161382s\n             raw sql    114.595 (±14.0%) i/s -    455.000 in   4.055053s\n           with Arel    100.232 (±23.9%) i/s -    384.000 in   4.084465s\n\nComparison:\n             raw sql:      114.6 i/s\n           with Arel:      100.2 i/s - same-ish: difference falls within error\ninsert_all with columns:       86.0 i/s - same-ish: difference falls within error\n          insert_all:       41.5 i/s - 2.76x  slower\n</code></pre></div>\n<details><summary>Benchmark code</summary>\n<p dir=\"auto\">\n</p><div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire 'debug'\nrequire &quot;active_record&quot;\nrequire &quot;benchmark/ips&quot;\n\nGC.disable\n\nROWS_COUNT = 1000\n\nActiveRecord::Base.establish_connection({ adapter: &quot;sqlite3&quot;, database: &quot;:memory:&quot; })\n\nclass Commerce &lt; ActiveRecord::Base\n  connection.create_table :commerces, force: true do |t|\n    t.string :name, :email, :title, :tags\n    t.integer :variant_id, :product_id, :inventory_id, :something_id, :another_id\n    t.boolean :fulfilled\n    t.datetime :fulfilled_at, :deleted_at\n    t.timestamps null: true\n  end\nend\n\ndef db_time(value)\n  value.to_formatted_s(:db).inspect\nend\n\nATTRS = {\n  name: &quot;sam&quot;,\n  email: &quot;kirs@shopify.com&quot;,\n  title: &quot;title&quot;,\n  tags: &quot;tag1,tag2,tag3&quot;,\n  variant_id: 1,\n  product_id: 1,\n  inventory_id: 1,\n  something_id: 1,\n  another_id: 1,\n  fulfilled: true,\n  fulfilled_at: Time.now,\n  deleted_at: Time.now\n}\n\nBenchmark.ips do |x|\n  x.warmup = 2\n  x.time   = 4\n\n  relation = Commerce.all\n\n  x.report(&quot;insert_all&quot;) do\n    conn = Commerce.connection\n\n    relation.insert_all(\n      [ATTRS] * ROWS_COUNT\n    )\n  end\n\n  x.report(&quot;insert_all with columns&quot;) do\n    conn = Commerce.connection\n    attrs = ATTRS.dup\n    attrs[:fulfilled_at] = attrs[:fulfilled_at].to_formatted_s(:db)\n    attrs[:deleted_at] = attrs[:deleted_at].to_formatted_s(:db)\n    attrs[:created_at] = Time.now.to_formatted_s(:db)\n    attrs[:updated_at] = attrs[:created_at]\n\n    values = [\n      attrs[:name], attrs[:email], attrs[:title], attrs[:tags], attrs[:variant_id], attrs[:product_id], attrs[:inventory_id], attrs[:something_id], attrs[:another_id], attrs[:fulfilled], attrs[:fulfilled_at], attrs[:deleted_at], attrs[:created_at], attrs[:updated_at]\n    ]\n\n    relation.insert_all(\n      [values] * ROWS_COUNT,\n      columns: %w[name email title tags variant_id product_id inventory_id something_id another_id fulfilled fulfilled_at deleted_at created_at updated_at],\n    )\n  end\n\n  x.report(&quot;raw sql&quot;) do\n    conn = Commerce.connection\n    values = (1..ROWS_COUNT).map do\n      attrs = ATTRS\n      &quot;(#{conn.quote(attrs[:name])}, #{conn.quote(attrs[:email])}, #{conn.quote(attrs[:title])}, #{conn.quote(attrs[:tags])}, #{attrs[:variant_id]}, #{attrs[:product_id]}, #{attrs[:inventory_id]}, #{attrs[:something_id]}, #{attrs[:another_id]}, #{attrs[:fulfilled]}, #{db_time(attrs[:fulfilled_at])}, #{db_time(attrs[:deleted_at])}, #{db_time(Time.now)}, #{db_time(Time.now)})&quot;\n    end\n\n    conn.execute(\n      &quot;INSERT INTO commerces (name, email, title, tags, variant_id, product_id, inventory_id, something_id, another_id, fulfilled, fulfilled_at, deleted_at, created_at, updated_at) &quot;\\\n      &quot;VALUES #{values.join(',')}&quot;\n    )\n  end\n\n  x.report(&quot;with Arel&quot;) do\n    conn = Commerce.connection\n    columns = %w[name email title tags variant_id product_id inventory_id something_id another_id fulfilled fulfilled_at deleted_at created_at updated_at]\n    attrs = ATTRS.dup\n    attrs[:fulfilled_at] = (attrs[:fulfilled_at]).to_formatted_s(:db)\n    attrs[:deleted_at] = (attrs[:deleted_at]).to_formatted_s(:db)\n    attrs[:created_at] = (Time.now).to_formatted_s(:db)\n    attrs[:updated_at] = (Time.now).to_formatted_s(:db)\n\n    values_list = [attrs.values] * ROWS_COUNT\n\n    sql = &quot;INSERT INTO #{Commerce.quoted_table_name} (#{columns.join(',')}) &quot;\n    sql &lt;&lt; conn.visitor.compile(Arel::Nodes::ValuesList.new(values_list))\n    conn.execute(sql)\n  end\n\n  x.compare!\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">'debug'</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_record\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"benchmark/ips\"</span>\n\n<span class=\"pl-c1\">GC</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">disable</span>\n\n<span class=\"pl-c1\">ROWS_COUNT</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">1000</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">establish_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">{</span> <span class=\"pl-pds\">adapter</span>: <span class=\"pl-s\">\"sqlite3\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">database</span>: <span class=\"pl-s\">\":memory:\"</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Commerce</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:commerces</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:email</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:title</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:tags</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">integer</span> <span class=\"pl-pds\">:variant_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:product_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:inventory_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:something_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:another_id</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">boolean</span> <span class=\"pl-pds\">:fulfilled</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">datetime</span> <span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:deleted_at</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">timestamps</span> <span class=\"pl-pds\">null</span>: <span class=\"pl-c1\">true</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">db_time</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-s1\">value</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">inspect</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-c1\">ATTRS</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-pds\">name</span>: <span class=\"pl-s\">\"sam\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">email</span>: <span class=\"pl-s\">\"kirs@shopify.com\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">title</span>: <span class=\"pl-s\">\"title\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">tags</span>: <span class=\"pl-s\">\"tag1,tag2,tag3\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">variant_id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">product_id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">inventory_id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">something_id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">another_id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">fulfilled</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">fulfilled_at</span>: <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">deleted_at</span>: <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">warmup</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">2</span>\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">time</span>   <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">4</span>\n\n  <span class=\"pl-s1\">relation</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Commerce</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">all</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"insert_all\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">conn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Commerce</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span>\n\n    <span class=\"pl-s1\">relation</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">insert_all</span><span class=\"pl-kos\">(</span>\n      <span class=\"pl-kos\">[</span><span class=\"pl-c1\">ATTRS</span><span class=\"pl-kos\">]</span> * <span class=\"pl-c1\">ROWS_COUNT</span>\n    <span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"insert_all with columns\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">conn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Commerce</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span>\n    <span class=\"pl-s1\">attrs</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">ATTRS</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:deleted_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:deleted_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:created_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:updated_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:created_at</span><span class=\"pl-kos\">]</span>\n\n    <span class=\"pl-s1\">values</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span>\n      <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:name</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:email</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:title</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:tags</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:variant_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:product_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:inventory_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:something_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:another_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:deleted_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:created_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:updated_at</span><span class=\"pl-kos\">]</span>\n    <span class=\"pl-kos\">]</span>\n\n    <span class=\"pl-s1\">relation</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">insert_all</span><span class=\"pl-kos\">(</span>\n      <span class=\"pl-kos\">[</span><span class=\"pl-s1\">values</span><span class=\"pl-kos\">]</span> * <span class=\"pl-c1\">ROWS_COUNT</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-pds\">columns</span>: <span class=\"pl-kos\">%w[</span><span class=\"pl-s\">name</span> <span class=\"pl-s\">email</span> <span class=\"pl-s\">title</span> <span class=\"pl-s\">tags</span> <span class=\"pl-s\">variant_id</span> <span class=\"pl-s\">product_id</span> <span class=\"pl-s\">inventory_id</span> <span class=\"pl-s\">something_id</span> <span class=\"pl-s\">another_id</span> <span class=\"pl-s\">fulfilled</span> <span class=\"pl-s\">fulfilled_at</span> <span class=\"pl-s\">deleted_at</span> <span class=\"pl-s\">created_at</span> <span class=\"pl-s\">updated_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span>\n    <span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"raw sql\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">conn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Commerce</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span>\n    <span class=\"pl-s1\">values</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1</span>..<span class=\"pl-c1\">ROWS_COUNT</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">map</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-s1\">attrs</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">ATTRS</span>\n      <span class=\"pl-s\">\"(<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">quote</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:name</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">quote</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:email</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">quote</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:title</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">quote</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:tags</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:variant_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:product_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:inventory_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:something_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:another_id</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-en\">db_time</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-en\">db_time</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:deleted_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-en\">db_time</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>, <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-en\">db_time</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>)\"</span>\n    <span class=\"pl-k\">end</span>\n\n    <span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">execute</span><span class=\"pl-kos\">(</span>\n      <span class=\"pl-s\">\"INSERT INTO commerces (name, email, title, tags, variant_id, product_id, inventory_id, something_id, another_id, fulfilled, fulfilled_at, deleted_at, created_at, updated_at) \"</span>\\\n      <span class=\"pl-s\">\"VALUES <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">values</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">','</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>\"</span>\n    <span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"with Arel\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-s1\">conn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Commerce</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span>\n    <span class=\"pl-s1\">columns</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">%w[</span><span class=\"pl-s\">name</span> <span class=\"pl-s\">email</span> <span class=\"pl-s\">title</span> <span class=\"pl-s\">tags</span> <span class=\"pl-s\">variant_id</span> <span class=\"pl-s\">product_id</span> <span class=\"pl-s\">inventory_id</span> <span class=\"pl-s\">something_id</span> <span class=\"pl-s\">another_id</span> <span class=\"pl-s\">fulfilled</span> <span class=\"pl-s\">fulfilled_at</span> <span class=\"pl-s\">deleted_at</span> <span class=\"pl-s\">created_at</span> <span class=\"pl-s\">updated_at</span><span class=\"pl-kos\">]</span>\n    <span class=\"pl-s1\">attrs</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">ATTRS</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dup</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:fulfilled_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:deleted_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:deleted_at</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:created_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:updated_at</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_formatted_s</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:db</span><span class=\"pl-kos\">)</span>\n\n    <span class=\"pl-s1\">values_list</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-s1\">attrs</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">values</span><span class=\"pl-kos\">]</span> * <span class=\"pl-c1\">ROWS_COUNT</span>\n\n    <span class=\"pl-s1\">sql</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"INSERT INTO <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-v\">Commerce</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">quoted_table_name</span><span class=\"pl-kos\">}</span></span> (<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">columns</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">','</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>) \"</span>\n    <span class=\"pl-s1\">sql</span> &lt;&lt; <span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">visitor</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">compile</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Arel</span>::<span class=\"pl-v\">Nodes</span>::<span class=\"pl-v\">ValuesList</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">values_list</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-s1\">conn</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">execute</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">sql</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">compare!</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\"></p>\n</details> ",
            "url": "https://github.com/rails/rails/pull/52228",
            "title": "ActiveRecord::Relation#insert_all: support column mode for highest performance",
            "date_modified": "2024-06-27T21:12:20.000Z",
            "date_published": "2024-06-27T14:51:32.000Z",
            "author": {
                "name": "kirs",
                "url": "https://github.com/kirs"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/28561?u=095779352a57f75e734987829f3f67a10e5780ed&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><code class=\"notranslate\">STATS_DIRECTORIES</code> is used by third parties to add directories to the statistics output. It's a global constant defined in a Rake file, that gets loaded anytime the Rake commands get loaded.</p>\n<p dir=\"auto\">For example Rspec Rails adds <code class=\"notranslate\">spec</code> directories in a prepended Rake task: <a href=\"https://github.com/rspec/rspec-rails/blob/8c17b4e5020a4d264e8a79e294c58b5c1ef2b005/lib/rspec/rails/tasks/rspec.rake#L43\">https://github.com/rspec/rspec-rails/blob/8c17b4e5020a4d264e8a79e294c58b5c1ef2b005/lib/rspec/rails/tasks/rspec.rake#L43</a></p>\n<p dir=\"auto\">Rake tasks only get loaded if no matching Thor task has been found. This means this constant is only available when the Rake commands have loaded.</p>\n<p dir=\"auto\">As the stats command has now been <a href=\"https://github.com/rails/rails/commit/292c127d46877174d893a7aab2b7cc35856f393a\">moved to a Thor task</a>, calling <code class=\"notranslate\">bin/rails stats</code> will no longer add directories to <code class=\"notranslate\">STATS_DIRECTORIES</code>, as the Rake commands don't get loaded anymore.</p>\n<p dir=\"auto\">To remove the dependency on Rake and avoid a global constant we can add an API to add directories: <code class=\"notranslate\">CodeStatistics.add_directory</code>. <code class=\"notranslate\">STATS_DIRECTORIES</code> is deprecated.</p>\n<p dir=\"auto\"><code class=\"notranslate\">deprecate_constant</code> couldn't be used here as that doesn't seem to work for the root namespace.</p>\n<p dir=\"auto\">This was previously proposed/discussed in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1958810255\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49759\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49759/hovercard\" href=\"https://github.com/rails/rails/pull/49759\">#49759</a>, but I decided to resubmit it with the recent commit to make <code class=\"notranslate\">stats</code> a Thor task.</p>\n<h3 dir=\"auto\">Before</h3>\n<p dir=\"auto\"><code class=\"notranslate\">bin/rake stats</code> adds custom directories (Model specs in this case):</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"bin/rake stats\nDEPRECATION WARNING: `bin/rails stats` as rake task has been deprecated and will be removed in Rails 8.0.\nPlease use `bin/rails stats` as Rails command instead.\n\n (called from block in execute at .../gems/rake-13.1.0/lib/rake/task.rb:281)\nDEPRECATION WARNING: `bin/rails stats` as rake task has been deprecated and will be removed in Rails 8.0.\nPlease use `bin/rails stats` as Rails command instead.\n\n (called from block in execute at .../gems/rake-13.1.0/lib/rake/task.rb:281)\n+----------------------+--------+--------+---------+---------+-----+-------+\n| Name                 |  Lines |    LOC | Classes | Methods | M/C | LOC/M |\n+----------------------+--------+--------+---------+---------+-----+-------+\n| Controllers          |      7 |      7 |       2 |       1 |   0 |     5 |\n...\n| System tests         |      0 |      0 |       0 |       0 |   0 |     0 |\n| Model specs          |      5 |      4 |       0 |       0 |   0 |     0 |\n+----------------------+--------+--------+---------+---------+-----+-------+\n| Total                |    161 |    115 |      14 |       1 |   0 |   113 |\n+----------------------+--------+--------+---------+---------+-----+-------+\"><pre class=\"notranslate\">bin/rake stats\nDEPRECATION WARNING: <span class=\"pl-s\"><span class=\"pl-pds\">`</span>bin/rails stats<span class=\"pl-pds\">`</span></span> as rake task has been deprecated and will be removed <span class=\"pl-k\">in</span> Rails 8.0.\nPlease use <span class=\"pl-s\"><span class=\"pl-pds\">`</span>bin/rails stats<span class=\"pl-pds\">`</span></span> as Rails <span class=\"pl-c1\">command</span> instead.\n\n (called from block <span class=\"pl-k\">in</span> execute at .../gems/rake-13.1.0/lib/rake/task.rb:281)\nDEPRECATION WARNING: <span class=\"pl-s\"><span class=\"pl-pds\">`</span>bin/rails stats<span class=\"pl-pds\">`</span></span> as rake task has been deprecated and will be removed <span class=\"pl-k\">in</span> Rails 8.0.\nPlease use <span class=\"pl-s\"><span class=\"pl-pds\">`</span>bin/rails stats<span class=\"pl-pds\">`</span></span> as Rails <span class=\"pl-c1\">command</span> instead.\n\n (called from block <span class=\"pl-k\">in</span> execute at .../gems/rake-13.1.0/lib/rake/task.rb:281)\n+----------------------+--------+--------+---------+---------+-----+-------+\n<span class=\"pl-k\">|</span> Name                 <span class=\"pl-k\">|</span>  Lines <span class=\"pl-k\">|</span>    LOC <span class=\"pl-k\">|</span> Classes <span class=\"pl-k\">|</span> Methods <span class=\"pl-k\">|</span> M/C <span class=\"pl-k\">|</span> LOC/M <span class=\"pl-k\">|</span>\n+----------------------+--------+--------+---------+---------+-----+-------+\n<span class=\"pl-k\">|</span> Controllers          <span class=\"pl-k\">|</span>      7 <span class=\"pl-k\">|</span>      7 <span class=\"pl-k\">|</span>       2 <span class=\"pl-k\">|</span>       1 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>     5 <span class=\"pl-k\">|</span>\n...\n<span class=\"pl-k\">|</span> System tests         <span class=\"pl-k\">|</span>      0 <span class=\"pl-k\">|</span>      0 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>     0 <span class=\"pl-k\">|</span>\n<span class=\"pl-k\">|</span> Model specs          <span class=\"pl-k\">|</span>      5 <span class=\"pl-k\">|</span>      4 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>     0 <span class=\"pl-k\">|</span>\n+----------------------+--------+--------+---------+---------+-----+-------+\n<span class=\"pl-k\">|</span> Total                <span class=\"pl-k\">|</span>    161 <span class=\"pl-k\">|</span>    115 <span class=\"pl-k\">|</span>      14 <span class=\"pl-k\">|</span>       1 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>   113 <span class=\"pl-k\">|</span>\n+----------------------+--------+--------+---------+---------+-----+-------+</pre></div>\n<p dir=\"auto\"><code class=\"notranslate\">bin/rails stats</code> does <strong>not</strong> add custom directories:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ bin/rails stats\n+----------------------+--------+--------+---------+---------+-----+-------+\n| Name                 |  Lines |    LOC | Classes | Methods | M/C | LOC/M |\n+----------------------+--------+--------+---------+---------+-----+-------+\n| Controllers          |      7 |      7 |       2 |       1 |   0 |     5 |\n...\n| System tests         |      0 |      0 |       0 |       0 |   0 |     0 |\n+----------------------+--------+--------+---------+---------+-----+-------+\n| Total                |    156 |    111 |      14 |       1 |   0 |   109 |\n+----------------------+--------+--------+---------+---------+-----+-------+\"><pre class=\"notranslate\">$ bin/rails stats\n+----------------------+--------+--------+---------+---------+-----+-------+\n<span class=\"pl-k\">|</span> Name                 <span class=\"pl-k\">|</span>  Lines <span class=\"pl-k\">|</span>    LOC <span class=\"pl-k\">|</span> Classes <span class=\"pl-k\">|</span> Methods <span class=\"pl-k\">|</span> M/C <span class=\"pl-k\">|</span> LOC/M <span class=\"pl-k\">|</span>\n+----------------------+--------+--------+---------+---------+-----+-------+\n<span class=\"pl-k\">|</span> Controllers          <span class=\"pl-k\">|</span>      7 <span class=\"pl-k\">|</span>      7 <span class=\"pl-k\">|</span>       2 <span class=\"pl-k\">|</span>       1 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>     5 <span class=\"pl-k\">|</span>\n...\n<span class=\"pl-k\">|</span> System tests         <span class=\"pl-k\">|</span>      0 <span class=\"pl-k\">|</span>      0 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>     0 <span class=\"pl-k\">|</span>\n+----------------------+--------+--------+---------+---------+-----+-------+\n<span class=\"pl-k\">|</span> Total                <span class=\"pl-k\">|</span>    156 <span class=\"pl-k\">|</span>    111 <span class=\"pl-k\">|</span>      14 <span class=\"pl-k\">|</span>       1 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>   109 <span class=\"pl-k\">|</span>\n+----------------------+--------+--------+---------+---------+-----+-------+</pre></div>\n<h3 dir=\"auto\">After</h3>\n<p dir=\"auto\"><code class=\"notranslate\">bin/rake stats</code> adds directories.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ bin/rake stats\nDEPRECATION WARNING: `STATS_DIRECTORIES` is deprecated and will be removed in Rails 8.1! Use `Rails.application.config.code_statistics.directories` instead. (called from block in execute at .../gems/rake-13.1.0/lib/rake/task.rb:281)\nDEPRECATION WARNING: `bin/rake stats` as rake task has been deprecated and will be removed in Rails 8.1.\nPlease use `bin/rails stats` as Rails command instead.\n\n (called from block in execute at .../gems/rake-13.1.0/lib/rake/task.rb:281)\nDEPRECATION WARNING: `bin/rake stats` as rake task has been deprecated and will be removed in Rails 8.1.\nPlease use `bin/rails stats` as Rails command instead.\n\n (called from block in execute at .../gems/rake-13.1.0/lib/rake/task.rb:281)\n+----------------------+--------+--------+---------+---------+-----+-------+\n| Name                 |  Lines |    LOC | Classes | Methods | M/C | LOC/M |\n+----------------------+--------+--------+---------+---------+-----+-------+\n| Controllers          |      7 |      7 |       2 |       1 |   0 |     5 |\n...\n| System tests         |      0 |      0 |       0 |       0 |   0 |     0 |\n| Model specs          |      5 |      4 |       0 |       0 |   0 |     0 |\n+----------------------+--------+--------+---------+---------+-----+-------+\n| Total                |    161 |    115 |      14 |       1 |   0 |   113 |\n+----------------------+--------+--------+---------+---------+-----+-------+\"><pre class=\"notranslate\">$ bin/rake stats\nDEPRECATION WARNING: <span class=\"pl-s\"><span class=\"pl-pds\">`</span>STATS_DIRECTORIES<span class=\"pl-pds\">`</span></span> is deprecated and will be removed <span class=\"pl-k\">in</span> Rails 8.1<span class=\"pl-k\">!</span> Use <span class=\"pl-s\"><span class=\"pl-pds\">`</span>Rails.application.config.code_statistics.directories<span class=\"pl-pds\">`</span></span> instead. (called from block <span class=\"pl-k\">in</span> execute at .../gems/rake-13.1.0/lib/rake/task.rb:281)\nDEPRECATION WARNING: <span class=\"pl-s\"><span class=\"pl-pds\">`</span>bin/rake stats<span class=\"pl-pds\">`</span></span> as rake task has been deprecated and will be removed <span class=\"pl-k\">in</span> Rails 8.1.\nPlease use <span class=\"pl-s\"><span class=\"pl-pds\">`</span>bin/rails stats<span class=\"pl-pds\">`</span></span> as Rails <span class=\"pl-c1\">command</span> instead.\n\n (called from block <span class=\"pl-k\">in</span> execute at .../gems/rake-13.1.0/lib/rake/task.rb:281)\nDEPRECATION WARNING: <span class=\"pl-s\"><span class=\"pl-pds\">`</span>bin/rake stats<span class=\"pl-pds\">`</span></span> as rake task has been deprecated and will be removed <span class=\"pl-k\">in</span> Rails 8.1.\nPlease use <span class=\"pl-s\"><span class=\"pl-pds\">`</span>bin/rails stats<span class=\"pl-pds\">`</span></span> as Rails <span class=\"pl-c1\">command</span> instead.\n\n (called from block <span class=\"pl-k\">in</span> execute at .../gems/rake-13.1.0/lib/rake/task.rb:281)\n+----------------------+--------+--------+---------+---------+-----+-------+\n<span class=\"pl-k\">|</span> Name                 <span class=\"pl-k\">|</span>  Lines <span class=\"pl-k\">|</span>    LOC <span class=\"pl-k\">|</span> Classes <span class=\"pl-k\">|</span> Methods <span class=\"pl-k\">|</span> M/C <span class=\"pl-k\">|</span> LOC/M <span class=\"pl-k\">|</span>\n+----------------------+--------+--------+---------+---------+-----+-------+\n<span class=\"pl-k\">|</span> Controllers          <span class=\"pl-k\">|</span>      7 <span class=\"pl-k\">|</span>      7 <span class=\"pl-k\">|</span>       2 <span class=\"pl-k\">|</span>       1 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>     5 <span class=\"pl-k\">|</span>\n...\n<span class=\"pl-k\">|</span> System tests         <span class=\"pl-k\">|</span>      0 <span class=\"pl-k\">|</span>      0 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>     0 <span class=\"pl-k\">|</span>\n<span class=\"pl-k\">|</span> Model specs          <span class=\"pl-k\">|</span>      5 <span class=\"pl-k\">|</span>      4 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>     0 <span class=\"pl-k\">|</span>\n+----------------------+--------+--------+---------+---------+-----+-------+\n<span class=\"pl-k\">|</span> Total                <span class=\"pl-k\">|</span>    161 <span class=\"pl-k\">|</span>    115 <span class=\"pl-k\">|</span>      14 <span class=\"pl-k\">|</span>       1 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>   113 <span class=\"pl-k\">|</span>\n+----------------------+--------+--------+---------+---------+-----+-------+</pre></div>\n<p dir=\"auto\"><code class=\"notranslate\">bin/rails stats</code> adds directories added in a <code class=\"notranslate\">Raills.application.config.after_initialize</code> block.</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ bin/rails stats\n+----------------------+--------+--------+---------+---------+-----+-------+\n| Name                 |  Lines |    LOC | Classes | Methods | M/C | LOC/M |\n+----------------------+--------+--------+---------+---------+-----+-------+\n| Controllers          |      7 |      7 |       2 |       1 |   0 |     5 |\n...\n| System tests         |      0 |      0 |       0 |       0 |   0 |     0 |\n| Model specs          |      5 |      4 |       0 |       0 |   0 |     0 |\n+----------------------+--------+--------+---------+---------+-----+-------+\n| Total                |    161 |    115 |      14 |       1 |   0 |   113 |\n+----------------------+--------+--------+---------+---------+-----+-------+\n....\"><pre class=\"notranslate\">$ bin/rails stats\n+----------------------+--------+--------+---------+---------+-----+-------+\n<span class=\"pl-k\">|</span> Name                 <span class=\"pl-k\">|</span>  Lines <span class=\"pl-k\">|</span>    LOC <span class=\"pl-k\">|</span> Classes <span class=\"pl-k\">|</span> Methods <span class=\"pl-k\">|</span> M/C <span class=\"pl-k\">|</span> LOC/M <span class=\"pl-k\">|</span>\n+----------------------+--------+--------+---------+---------+-----+-------+\n<span class=\"pl-k\">|</span> Controllers          <span class=\"pl-k\">|</span>      7 <span class=\"pl-k\">|</span>      7 <span class=\"pl-k\">|</span>       2 <span class=\"pl-k\">|</span>       1 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>     5 <span class=\"pl-k\">|</span>\n...\n<span class=\"pl-k\">|</span> System tests         <span class=\"pl-k\">|</span>      0 <span class=\"pl-k\">|</span>      0 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>     0 <span class=\"pl-k\">|</span>\n<span class=\"pl-k\">|</span> Model specs          <span class=\"pl-k\">|</span>      5 <span class=\"pl-k\">|</span>      4 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>       0 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>     0 <span class=\"pl-k\">|</span>\n+----------------------+--------+--------+---------+---------+-----+-------+\n<span class=\"pl-k\">|</span> Total                <span class=\"pl-k\">|</span>    161 <span class=\"pl-k\">|</span>    115 <span class=\"pl-k\">|</span>      14 <span class=\"pl-k\">|</span>       1 <span class=\"pl-k\">|</span>   0 <span class=\"pl-k\">|</span>   113 <span class=\"pl-k\">|</span>\n+----------------------+--------+--------+---------+---------+-----+-------+\n....</pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52226",
            "title": "Add third party hook for `rails stats` Thor command",
            "date_modified": "2024-07-01T15:37:03.000Z",
            "date_published": "2024-06-27T10:46:15.000Z",
            "author": {
                "name": "p8",
                "url": "https://github.com/p8"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5059927?u=54cb27efd35253e1fe86d48663b299bf398d8d84&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">If you try to create a cte that unions for than 2 relationships you get a NoMethodError of</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"undefined method `union' for an instance of Arel::Nodes::UnionAll\"><pre class=\"notranslate\"><code class=\"notranslate\">undefined method `union' for an instance of Arel::Nodes::UnionAll\n</code></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This fix allows you to pass more than 2 relationships to a cte to union them together.</p>\n<p dir=\"auto\">Im calling ast on the nodes because passing the SelectManager around caused the selects to be wrapped in parenthesis which causes a syntax error in sqlite.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52211",
            "title": "Fix creating a CTE with 3 or more relations that are unioned together",
            "date_modified": "2024-06-30T00:24:24.000Z",
            "date_published": "2024-06-25T00:35:22.000Z",
            "author": {
                "name": "npezza93",
                "url": "https://github.com/npezza93"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/4468155?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">When I and my colleagues saw the API document for <code class=\"notranslate\">attribute</code>,<br>\nwe got difficulty understanding what exactly the <code class=\"notranslate\">previous</code> value.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">In order to clarify the document, I have improved the followings.</p>\n<ul dir=\"auto\">\n<li>Change the wording from <code class=\"notranslate\">previous</code> to <code class=\"notranslate\">previously defined</code> for clarification</li>\n<li>Add the similar description for <code class=\"notranslate\">type</code> when not specified</li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">none</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52208",
            "title": "[DOC] Clarify previous (type/value) in Activecord::Attributes `attribute`",
            "date_modified": "2024-06-24T13:32:51.000Z",
            "date_published": "2024-06-24T13:32:12.000Z",
            "author": {
                "name": "aeroastro",
                "url": "https://github.com/aeroastro"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/4468155?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Since the current documentation contains wrong information, we need to fix it.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">The refactoring over <code class=\"notranslate\">attribute</code> was done at <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1166733860\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/44666\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/44666/hovercard\" href=\"https://github.com/rails/rails/pull/44666\">#44666</a>,<br>\nwhich stops <code class=\"notranslate\">attribute</code> from calling <code class=\"notranslate\">define_attribute</code>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">none</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52207",
            "title": "[DOC] Remove wrong document due to refactoring `attribute`",
            "date_modified": "2024-06-24T13:33:00.000Z",
            "date_published": "2024-06-24T11:54:26.000Z",
            "author": {
                "name": "aeroastro",
                "url": "https://github.com/aeroastro"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #50565.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2064752053\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50565\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50565/hovercard\" href=\"https://github.com/rails/rails/issues/50565\">#50565</a></p>\n<p dir=\"auto\">One thing I'd like to figure out in this PR is <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2010260417\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rack/rack/issues/2137\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rack/rack/pull/2137/hovercard\" href=\"https://github.com/rack/rack/pull/2137\">rack/rack#2137</a>, so still investigating. This is more just an FYI, if folks would like to help.</p>",
            "url": "https://github.com/rails/rails/pull/52206",
            "title": "wip: drop support for Rack < 3",
            "date_modified": "2024-06-24T11:20:16.000Z",
            "date_published": "2024-06-24T08:04:37.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/44280450?u=5d0b7f0d7535c39131a9d2d513cbf4691236b6e4&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Similar to what was done in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1718310267\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48266\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48266/hovercard\" href=\"https://github.com/rails/rails/pull/48266\">#48266</a>, add <code class=\"notranslate\">type</code> attribute in source of video and audio tag.</p>\n<p dir=\"auto\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/source\" rel=\"nofollow\">MDN Doc: <source> tag</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52198",
            "title": "Add `type` attribute in source of video and audio tag",
            "date_modified": "2024-06-23T06:53:09.000Z",
            "date_published": "2024-06-23T01:27:25.000Z",
            "author": {
                "name": "heka1024",
                "url": "https://github.com/heka1024"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #52190.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2367503804\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52190\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/52190/hovercard\" href=\"https://github.com/rails/rails/issues/52190\">#52190</a></p>\n<p dir=\"auto\">/cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/artemas/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/artemas\">@artemas</a></p>",
            "url": "https://github.com/rails/rails/pull/52196",
            "title": "ActionText `rich_text_area` should respect ActiveStorage proxy mode",
            "date_modified": "2024-06-22T23:58:04.000Z",
            "date_published": "2024-06-22T23:37:15.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/28509627?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">Fix return values for HTTP Digest authentication api docs for method authenticate. It returns true when authenticate is successful and returns false otherwise.<br>\nAlso added .present? to return false when request.authorization returns nil</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52194",
            "title": "Fix return values for authenticate in docs and add present? to return false when nil",
            "date_modified": "2024-06-27T22:49:35.000Z",
            "date_published": "2024-06-22T18:30:26.000Z",
            "author": {
                "name": "kaushikhande",
                "url": "https://github.com/kaushikhande"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/28561?u=095779352a57f75e734987829f3f67a10e5780ed&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Mention which blob can't be transformed and what content_type it has.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52193",
            "title": "Improve ActiveStorage::InvariableError message",
            "date_modified": "2024-06-30T19:49:43.000Z",
            "date_published": "2024-06-22T16:33:02.000Z",
            "author": {
                "name": "p8",
                "url": "https://github.com/p8"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/44280450?u=5d0b7f0d7535c39131a9d2d513cbf4691236b6e4&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Summary</h3>\n<p dir=\"auto\">This pull request modifies the HTTP cache handling behavior in Rails to better align with the HTTP specification. Specifically, the change ensures that the ETag header takes precedence over other conditions when determining if a request is fresh.</p>\n<h3 dir=\"auto\">Details</h3>\n<p dir=\"auto\">Previously, the logic required both the ETag and Last-Modified headers to match for a request to be considered fresh. The new logic prioritizes the ETag header, which is in accordance with the guidance provided in the <a href=\"http://tools.ietf.org/html/rfc7232#section-6\" rel=\"nofollow\">RFC 7232, Section 6</a></p>\n<h3 dir=\"auto\">Changes Made</h3>\n<ul dir=\"auto\">\n<li>Refactored the HTTP cache handling code to ensure that the ETag header takes precedence over the Last-Modified header.</li>\n<li>Updated relevant tests to reflect this new behavior.</li>\n</ul>\n<h3 dir=\"auto\">Reference</h3>\n<ul dir=\"auto\">\n<li><a href=\"http://tools.ietf.org/html/rfc7232#section-6\" rel=\"nofollow\">RFC 7232, Section 6</a></li>\n<li><a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/If-None-Match\" rel=\"nofollow\">MDN: If-None-Match<br>\n</a></li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52191",
            "title": "Prefer ETag over Last-Modified for `fresh_when` and `stale?` according to HTTP speicification",
            "date_modified": "2024-07-01T18:43:48.000Z",
            "date_published": "2024-06-22T10:38:12.000Z",
            "author": {
                "name": "heka1024",
                "url": "https://github.com/heka1024"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #52183.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2366680034\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52183\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/52183/hovercard\" href=\"https://github.com/rails/rails/issues/52183\">#52183</a>.</p>\n<p dir=\"auto\">The problem was that the locale and the timezone are set only when running the <code class=\"notranslate\">perform</code> method of the job<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/16d8b82d5e2aca4780c5d10b1fe9a90b33a0e84e/activejob/lib/active_job/translation.rb#L8-L10\">rails/activejob/lib/active_job/translation.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 8 to 10\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/16d8b82d5e2aca4780c5d10b1fe9a90b33a0e84e\">16d8b82</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L8\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"8\"></td>\n          <td id=\"LC8\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">around_perform</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">job</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">block</span>| </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L9\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"9\"></td>\n          <td id=\"LC9\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-v\">I18n</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">with_locale</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">job</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">locale</span><span class=\"pl-kos\">,</span> &amp;<span class=\"pl-s1\">block</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L10\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"10\"></td>\n          <td id=\"LC10\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\n<div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/16d8b82d5e2aca4780c5d10b1fe9a90b33a0e84e/activejob/lib/active_job/execution.rb#L45-L51\">rails/activejob/lib/active_job/execution.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 45 to 51\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/16d8b82d5e2aca4780c5d10b1fe9a90b33a0e84e\">16d8b82</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L45\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"45\"></td>\n          <td id=\"LC45\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">perform_now</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L46\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"46\"></td>\n          <td id=\"LC46\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-c\"># Guard against jobs that were persisted before we started counting executions by zeroing out nil counters</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L47\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"47\"></td>\n          <td id=\"LC47\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">executions</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-en\">executions</span> || <span class=\"pl-c1\">0</span><span class=\"pl-kos\">)</span> + <span class=\"pl-c1\">1</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L48\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"48\"></td>\n          <td id=\"LC48\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L49\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"49\"></td>\n          <td id=\"LC49\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">deserialize_arguments_if_needed</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L50\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"50\"></td>\n          <td id=\"LC50\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L51\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"51\"></td>\n          <td id=\"LC51\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">_perform_job</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\n<div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/16d8b82d5e2aca4780c5d10b1fe9a90b33a0e84e/activejob/lib/active_job/execution.rb#L65-L70\">rails/activejob/lib/active_job/execution.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 65 to 70\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/16d8b82d5e2aca4780c5d10b1fe9a90b33a0e84e\">16d8b82</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L65\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"65\"></td>\n          <td id=\"LC65\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">_perform_job</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L66\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"66\"></td>\n          <td id=\"LC66\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-v\">ActiveSupport</span>::<span class=\"pl-v\">ExecutionContext</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:job</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-smi\">self</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L67\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"67\"></td>\n          <td id=\"LC67\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">run_callbacks</span> <span class=\"pl-pds\">:perform</span> <span class=\"pl-k\">do</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L68\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"68\"></td>\n          <td id=\"LC68\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">perform</span><span class=\"pl-kos\">(</span>*<span class=\"pl-en\">arguments</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L69\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"69\"></td>\n          <td id=\"LC69\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">end</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L70\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"70\"></td>\n          <td id=\"LC70\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">But when the job raises </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/16d8b82d5e2aca4780c5d10b1fe9a90b33a0e84e/activejob/lib/active_job/execution.rb#L52-L58\">rails/activejob/lib/active_job/execution.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 52 to 58\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/16d8b82d5e2aca4780c5d10b1fe9a90b33a0e84e\">16d8b82</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L52\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"52\"></td>\n          <td id=\"LC52\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">rescue</span> <span class=\"pl-v\">Exception</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">exception</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L53\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"53\"></td>\n          <td id=\"LC53\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-s1\">handled</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">rescue_with_handler</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">exception</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L54\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"54\"></td>\n          <td id=\"LC54\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">return</span> <span class=\"pl-s1\">handled</span> <span class=\"pl-k\">if</span> <span class=\"pl-s1\">handled</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L55\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"55\"></td>\n          <td id=\"LC55\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L56\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"56\"></td>\n          <td id=\"LC56\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">run_after_discard_procs</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">exception</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L57\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"57\"></td>\n          <td id=\"LC57\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">raise</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L58\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"58\"></td>\n          <td id=\"LC58\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n, we are outside of <code class=\"notranslate\">around_perform</code> block and so the global values are not correctly set. So we need to wrap the whole <code class=\"notranslate\">perform_now</code> method.<p></p>",
            "url": "https://github.com/rails/rails/pull/52188",
            "title": "Preserve timezone and locale in ActiveJob exception handlers",
            "date_modified": "2024-06-21T20:54:10.000Z",
            "date_published": "2024-06-21T20:52:17.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2853450?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #52182.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2366635297\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52182\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/52182/hovercard\" href=\"https://github.com/rails/rails/issues/52182\">#52182</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Make a hash of the composite primary key so the where clause knows to check for multiple columns, one column per key, instead of a single column with all the key names.</p>",
            "url": "https://github.com/rails/rails/pull/52186",
            "title": "Fix `missing(:association)` and `associated(:association)` for composite primary keys",
            "date_modified": "2024-06-22T09:56:32.000Z",
            "date_published": "2024-06-21T16:31:06.000Z",
            "author": {
                "name": "jackozi",
                "url": "https://github.com/jackozi"
            }
        }
    ]
}