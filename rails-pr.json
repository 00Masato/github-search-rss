{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/18366969?u=e6919af135d360a17f71ab7380f0d57fe08be21a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because raise an error when adding columns in a new migration if <code class=\"notranslate\">foregin_key</code> is included.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes fix an error when adding columns in a new migration if <code class=\"notranslate\">foregin_key</code> is included.<br>\nThe error occurs in cases where <code class=\"notranslate\">foregin_key</code> is specified such as <code class=\"notranslate\">add_reference</code> in an old migration definition. For example, the bellow:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class ChangeTableUsers &lt; ActiveRecord::Migration[6.0]\n  def change\n    add_reference :users, :posts, foregin_key: true\n  end\nend\n\n#=&gt; eval error: Unknown key: :foregin_key. Valid keys are: :limit, :precision, :scale, :default, :null, :collation, :comment, :primary_key, :if_exists, :if_not_exists, :auto_increment, :charset, :as, :size, :unsigned, :first, :after, :type, :stored\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">ChangeTableUsers</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Migration</span><span class=\"pl-kos\">[</span><span class=\"pl-c1\">6.0</span><span class=\"pl-kos\">]</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">change</span>\n    <span class=\"pl-en\">add_reference</span> <span class=\"pl-pds\">:users</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:posts</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">foregin_key</span>: <span class=\"pl-c1\">true</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-c\">#=&gt; eval error: Unknown key: :foregin_key. Valid keys are: :limit, :precision, :scale, :default, :null, :collation, :comment, :primary_key, :if_exists, :if_not_exists, :auto_increment, :charset, :as, :size, :unsigned, :first, :after, :type, :stored</span></pre></div>\n<p dir=\"auto\">An error is generated if an option other than the allowed option is entered. The <code class=\"notranslate\">foregin_key</code> is not included in the allowed options, but it is necessary, so it was added.</p>\n<p dir=\"auto\">Also, <code class=\"notranslate\">add_reference</code> is now compatible with lower versions.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<ul dir=\"auto\">\n<li>Modified PR: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1394020895\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46178\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/46178/hovercard\" href=\"https://github.com/rails/rails/pull/46178\">#46178</a></li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48495",
            "title": "Added `foregin_key` to the allowed validation options for managing columns and tables in migration",
            "date_modified": "2023-06-16T07:16:22.000Z",
            "date_published": "2023-06-16T07:16:19.000Z",
            "author": {
                "name": "soartec-lab",
                "url": "https://github.com/soartec-lab"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/509837?u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48485.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1759188604\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48485\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48485/hovercard\" href=\"https://github.com/rails/rails/issues/48485\">#48485</a></p>",
            "url": "https://github.com/rails/rails/pull/48494",
            "title": "Support beginless and endless ranges in `to_fs`",
            "date_modified": "2023-06-16T06:48:00.000Z",
            "date_published": "2023-06-16T06:35:34.000Z",
            "author": {
                "name": "ghiculescu",
                "url": "https://github.com/ghiculescu"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5279284?u=40cbc3d0cb818159797fa8856c88c9e87fd8bd49&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Update NOTE for add_enum_value - Enum values can be renamed.<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1204835730\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/44898\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/44898/hovercard\" href=\"https://github.com/rails/rails/pull/44898\">#44898</a></p>\n<p dir=\"auto\">cc: <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/rayfaddis/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/rayfaddis\">@rayfaddis</a></p>",
            "url": "https://github.com/rails/rails/pull/48492",
            "title": "Update NOTE for add_enum_value [ci skip] ",
            "date_modified": "2023-06-16T00:09:11.000Z",
            "date_published": "2023-06-16T00:09:07.000Z",
            "author": {
                "name": "sampatbadhe",
                "url": "https://github.com/sampatbadhe"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/22918438?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">If a has_one association uses a composite primary key, and part of the composite primary key changes on the owner, these changes need to be reflected on the belonging object's foreign key.</p>\n<p dir=\"auto\">This was not working previously, because <code class=\"notranslate\">#_record_changed?</code> was not equipped to handle composite primary key associations, so we were not recognizing that the belonging object's foreign key needed to be updated when the owner's primary key changed.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Maintain the same check as was previously used in <code class=\"notranslate\">#_record_changed?</code>, but adjust it to accommodate composite primary | foreign keys. This means checking that the record has <em>all</em> attributes that form the primary key on the owner, and then checking that the composite FK values don't match the owner's PK. This indicates that the record has changed, and that we should update its foreign key values accordingly.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included. (N/A)</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48491",
            "title": "Bugfix: Ensure has_one associations saved when part of CPK has changed",
            "date_modified": "2023-06-15T22:36:57.000Z",
            "date_published": "2023-06-15T22:25:16.000Z",
            "author": {
                "name": "adrianna-chang-shopify",
                "url": "https://github.com/adrianna-chang-shopify"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5162312?u=e1b3c0f7c6dc600253bf15c99f618b9b2d39c500&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because eager loading models and associations with composite primary keys is currently broken.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes join dependency assignment to properly handle nodes with composite primary keys.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I also had to change <code class=\"notranslate\">distinct_relation_for_primary_key</code> to handle composite keys for has_many/has_one relations. I chose to use <code class=\"notranslate\">Array#transpose</code> because we basically have to turn <code class=\"notranslate\">[[id], [other_id]]</code> into <code class=\"notranslate\">[[id, other_id]]</code>, or <code class=\"notranslate\">[[cpk_id_1, cpk_id_2], [other_cpk_id_1, other_cpk_id_2]]</code> into <code class=\"notranslate\">[[cpk_id_1, other_cpk_id_1], [cpk_id_2, other_cpk_id_2]]</code> in the composite primary key case.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">I chose to include the patch for belongs_to and has_many/has_one in one PR. Happy to split it into two if needed.</p>",
            "url": "https://github.com/rails/rails/pull/48490",
            "title": "Eager load composite primary keys models",
            "date_modified": "2023-06-15T21:31:40.000Z",
            "date_published": "2023-06-15T20:48:20.000Z",
            "author": {
                "name": "gmcgibbon",
                "url": "https://github.com/gmcgibbon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5162312?u=e1b3c0f7c6dc600253bf15c99f618b9b2d39c500&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because composite primary key models do not autosave properly when their association primary key is set to <code class=\"notranslate\">:id</code>. In models with composite primary keys, the <code class=\"notranslate\">#id</code> accessor will return an array, where we actually want the id column value.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes has_one autosaving to use <code class=\"notranslate\">_read_attribute</code> instead of <code class=\"notranslate\">public_send</code> so that it won't use the <code class=\"notranslate\">#id</code> accessor.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Are we concerned with this breaking behaviour of existing apps?</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48489",
            "title": "Use _read_attribute when autosaving has_one associations",
            "date_modified": "2023-06-15T20:52:22.000Z",
            "date_published": "2023-06-15T19:11:10.000Z",
            "author": {
                "name": "gmcgibbon",
                "url": "https://github.com/gmcgibbon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2651240?u=97e6903620ef2874e2231cee9eb2654b7811d750&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Apply scope to has_one/has_many association subqueries.</p>\n<p dir=\"auto\">Given:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Author &lt; ApplicationRecord\n  has_many :welcome_posts, -&gt; { where(title: &quot;welcome&quot;) } , class_name: &quot;Post&quot;\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Author</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">has_many</span> <span class=\"pl-pds\">:welcome_posts</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">title</span>: <span class=\"pl-s\">\"welcome\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span> <span class=\"pl-kos\">,</span> <span class=\"pl-pds\">class_name</span>: <span class=\"pl-s\">\"Post\"</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Before:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Author.where(welcome_posts: Post.all)\n#=&gt; SELECT (...) WHERE &quot;authors&quot;.&quot;id&quot; IN (SELECT &quot;posts&quot;.&quot;author_id&quot; FROM &quot;posts&quot;)\"><pre class=\"notranslate\"><span class=\"pl-v\">Author</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">welcome_posts</span>: <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">all</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\">#=&gt; SELECT (...) WHERE \"authors\".\"id\" IN (SELECT \"posts\".\"author_id\" FROM \"posts\")</span></pre></div>\n<p dir=\"auto\">Later:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Author.where(welcome_posts: Post.all)\n#=&gt; SELECT (...) WHERE &quot;authors&quot;.&quot;id&quot; IN (SELECT &quot;posts&quot;.&quot;author_id&quot; FROM &quot;posts&quot; WHERE &quot;posts&quot;.&quot;title&quot; = 'welcome')\"><pre class=\"notranslate\"><span class=\"pl-v\">Author</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">welcome_posts</span>: <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">all</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\">#=&gt; SELECT (...) WHERE \"authors\".\"id\" IN (SELECT \"posts\".\"author_id\" FROM \"posts\" WHERE \"posts\".\"title\" = 'welcome')</span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48487",
            "title": "Apply scope to has_one/has_many association subqueries",
            "date_modified": "2023-06-16T03:47:16.000Z",
            "date_published": "2023-06-15T18:13:11.000Z",
            "author": {
                "name": "lazaronixon",
                "url": "https://github.com/lazaronixon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/45299?u=7d70bac77efa7641741857d155a3eb8d7941a35f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Make <code class=\"notranslate\">assert_changes</code> error messages show objects with <code class=\"notranslate\">.inspect</code> so that <code class=\"notranslate\">nil</code> is displayed as \"nil\" instead of an empty string, we can differentiate strings and symbols, etc.</p>\n<p dir=\"auto\">Make <code class=\"notranslate\">assert_no_changes</code> error messages surface the actual value.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">Let me know if I should update the CHANGELOG as this is a minor change.</p>",
            "url": "https://github.com/rails/rails/pull/48482",
            "title": "Improve error messages of `assert_changes` and `assert_no_changes`",
            "date_modified": "2023-06-15T09:18:29.000Z",
            "date_published": "2023-06-15T09:18:25.000Z",
            "author": {
                "name": "pcreux",
                "url": "https://github.com/pcreux"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2651240?u=97e6903620ef2874e2231cee9eb2654b7811d750&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Since version 7.0.5 <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/bdbe58b50461dc44c42df4d5427fa78aeb1debcb/hovercard\" href=\"https://github.com/rails/rails/commit/bdbe58b50461dc44c42df4d5427fa78aeb1debcb\"><tt>bdbe58b</tt></a>  we are able to properly keep integrity in <code class=\"notranslate\">has_one</code> relationships, so when we create a new client<code class=\"notranslate\">account.create_client!(...)</code> it will prevent duplicated clients, but we can still bypass it on the other side of the relationship using <code class=\"notranslate\">Client.create!(..., account: existing_account)</code>.</p>\n<p dir=\"auto\">That said I'm proposing to add a new option <code class=\"notranslate\">unique</code> to the <code class=\"notranslate\">belongs_to</code> method. Here are some advantages of this approach...</p>\n<ul dir=\"auto\">\n<li>Unique indexes are not required.</li>\n<li>Different from unique indexes we can use it with an optional association.</li>\n<li>Take advantage of the new <code class=\"notranslate\">belongs_to_required_validates_foreign_key</code>.</li>\n<li>Validation API, messages, etc...</li>\n</ul>\n<p dir=\"auto\">Before:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Client\n  belongs_to :account; validates_uniqueness_of(:account, allow_nil: true, message: :unique)\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Client</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:account</span><span class=\"pl-kos\">;</span> <span class=\"pl-en\">validates_uniqueness_of</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:account</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">allow_nil</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">message</span>: <span class=\"pl-pds\">:unique</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Later:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Client\n  belongs_to :account, unique: true\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Client</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:account</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">unique</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\"><a href=\"https://thoughtbot.com/blog/rails-has-one-limitations\" rel=\"nofollow\">https://thoughtbot.com/blog/rails-has-one-limitations</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48480",
            "title": "Add unique option to belongs_to association",
            "date_modified": "2023-06-15T20:44:25.000Z",
            "date_published": "2023-06-15T07:00:03.000Z",
            "author": {
                "name": "lazaronixon",
                "url": "https://github.com/lazaronixon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1080678?u=b6e211b7766e6aa01e794067f67dd65d419c0150&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Rails 7.2 will remove support for <code class=\"notranslate\">#remove_connection</code> in favor of <code class=\"notranslate\">#remove_connection_pool</code>. This deprecation also represents a change in behavior. <code class=\"notranslate\">#remove_connection_pool</code> will not accept a <code class=\"notranslate\">name</code> argument as it should always be called on the class that owns the pool an application wants removed. In addition it will no longer reset a subclass with it's own connection to the parent pool.</p>\n<p dir=\"auto\">Previous behavior:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class ActiveRecord::Base\nend\n\nclass Post &lt; ActiveRecord::Base\n  establish_connection :post_db\nend\n\nPost.remove_connection\n=&gt; would reassign Post to `ActiveRecord::Base`  and `Post.connected?` returns `true`.\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">establish_connection</span> <span class=\"pl-pds\">:post_db</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">remove_connection</span>\n<span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">would</span> <span class=\"pl-en\">reassign</span> <span class=\"pl-en\">Post</span> <span class=\"pl-en\">to</span> <span class=\"pl-s\">`ActiveRecord::Base`</span>  <span class=\"pl-k\">and</span> <span class=\"pl-s\">`Post.connected?`</span><span class=\"pl-kos\"></span> <span class=\"pl-en\">returns</span> <span class=\"pl-s\">`true`</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span></pre></div>\n<p dir=\"auto\">New behavior:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class ActiveRecord::Base\nend\n\nclass Post &lt; ActiveRecord::Base\n  establish_connection :post_db\nend\n\nPost.remove_connection\n=&gt; Removes the pool keyed on `Post` and `Post.connected?` returns `nil`.\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">establish_connection</span> <span class=\"pl-pds\">:post_db</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">remove_connection</span>\n<span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">Removes</span> <span class=\"pl-en\">the</span> <span class=\"pl-en\">pool</span> <span class=\"pl-en\">keyed</span> <span class=\"pl-en\">on</span> <span class=\"pl-s\">`Post`</span> <span class=\"pl-k\">and</span> <span class=\"pl-s\">`Post.connected?`</span><span class=\"pl-kos\"></span> <span class=\"pl-en\">returns</span> <span class=\"pl-s\">`nil`</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span></pre></div>\n<p dir=\"auto\">If the <code class=\"notranslate\">Post</code> class does not have its own connection and <code class=\"notranslate\">Post.remove_connection</code> is called, the behavior is unchanged. Active Record will not remove the pool belonging to <code class=\"notranslate\">ActiveRecord::Base</code>. To remove the parent pool, applications should call <code class=\"notranslate\">ActiveRecord::Base.remove_connection</code> directly.</p>\n<p dir=\"auto\">I chose to add a new method instead of deprecating behavior in the current one because this behavior change isn't worth the overhead of a config option. I also think it's more likely to get feedback if this is a dealbreaker change.</p>\n<p dir=\"auto\">I'm making this change because due to the current design of Active Record connection management, it does not make sense that <code class=\"notranslate\">remove_connection</code> would reassign connections to the parent class. In a multi-db application this would be dangerous, we would not want to assign <code class=\"notranslate\">AnimalsRecord</code> to <code class=\"notranslate\">ActiveRecord::Base</code> if they are completely different databases. In addition it does not make sense to take a <code class=\"notranslate\">name</code> argument when the <code class=\"notranslate\">name</code> should be derived from the connection_specification_name on self.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<hr>\n<p dir=\"auto\">cc/ <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a> in case you have strong opinions on this.</p>\n<p dir=\"auto\">Background:<br>\nI noticed that this was added for manageiq in <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/6458610d0b95049bbc847cbc1039d6f5be8cc30c/hovercard\" href=\"https://github.com/rails/rails/commit/6458610d0b95049bbc847cbc1039d6f5be8cc30c\"><tt>6458610</tt></a> from this report <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"154095811\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24959\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24959/hovercard\" href=\"https://github.com/rails/rails/issues/24959\">#24959</a>. I don't think we should keep supporting this because its behavior is really surprising given the current design of connection management.</p>",
            "url": "https://github.com/rails/rails/pull/48478",
            "title": "Deprecate `#remove_connection` in favor of `#remove_connection_pool`.",
            "date_modified": "2023-06-14T21:23:31.000Z",
            "date_published": "2023-06-14T21:13:36.000Z",
            "author": {
                "name": "eileencodes",
                "url": "https://github.com/eileencodes"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/26221?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">For local environments (development and test), Rails creates a secrets file. However this file is called development_secret.txt, which imho is confusing as it is used by both dev and test environments.</p>\n\n<p dir=\"auto\">This Pull Request has been created because naming of local secret file is confusing</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the name of the generate secret method as well as the secrets file itself.<br>\nBoth in development and test environment a secret file is generated if no secret_key_base exists, however, the file is always called <code class=\"notranslate\">development_secret.txt</code>. As Rails defines <code class=\"notranslate\">development</code> and <code class=\"notranslate\">test</code> environments as <code class=\"notranslate\">local</code>, it makes sense to call this file <code class=\"notranslate\">local_secret.txt</code>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">So this PR changes <code class=\"notranslate\">def generate_development_secret</code> to <code class=\"notranslate\">def generate_local_secret</code><br>\nand<br>\n<code class=\"notranslate\">development_secret.txt</code> to <code class=\"notranslate\">local.secret.txt</code>.</p>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48471",
            "title": "Improve naming of local secret generation",
            "date_modified": "2023-06-15T19:13:11.000Z",
            "date_published": "2023-06-14T11:41:33.000Z",
            "author": {
                "name": "mdh",
                "url": "https://github.com/mdh"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/13816206?u=b3f1167e3181e3e4b093f443511446e576d13d9e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This PR <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48445.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1751360731\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48445\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48445/hovercard\" href=\"https://github.com/rails/rails/issues/48445\">#48445</a> .</p>\n<p dir=\"auto\">As per the current behaviour, Two queries are being fired to validate uniqueness of an encrypted attribute even in cases when <strong>encrypted_type.previous_types</strong> is nil. An additional query with the current encrypted/ciphered value should not be fired.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR updates the loop in <strong><a href=\"https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/extended_deterministic_uniqueness_validator.rb#L17\">ExtendedDeterministicUniquenessValidator</a></strong> to iterate over <strong>encrypted_type.previous_types</strong> only i.e. to exclude the current encrypted_type.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">For Additional context Please refer to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1751360731\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48445\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48445/hovercard\" href=\"https://github.com/rails/rails/issues/48445\">#48445</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48462",
            "title": "Do not revalidate encrypted attribute with current encrypted_type",
            "date_modified": "2023-06-13T14:48:12.000Z",
            "date_published": "2023-06-13T12:57:02.000Z",
            "author": {
                "name": "iamradioactive",
                "url": "https://github.com/iamradioactive"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/771968?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This commit adds support for replacing the compressor used for serialized cache entries.  Custom compressors must respond to <code class=\"notranslate\">deflate</code> and <code class=\"notranslate\">inflate</code>.  For example:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"module MyCompressor\n  def self.deflate(string)\n    # compression logic...\n  end\n\n  def self.inflate(compressed)\n    # decompression logic...\n  end\nend\n\nconfig.cache_store = :redis_cache_store, { compressor: MyCompressor }\"><pre class=\"notranslate\"><span class=\"pl-k\">module</span> <span class=\"pl-v\">MyCompressor</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">deflate</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">string</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-c\"># compression logic...</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">inflate</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">compressed</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-c\"># decompression logic...</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">cache_store</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">:redis_cache_store</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">compressor</span>: <span class=\"pl-v\">MyCompressor</span> <span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">Additionally, as part of this work, a new optimization has been added for cache format version 7.1 such that the version and expiry of cache entries can be checked without deserializing (or decompressing) the entries.</p>\n<p dir=\"auto\">Also as part of this work, custom cache coders now support compression when the cache format version is &gt;= 7.1, and they benefit from the improvements introduced by cache format version 7.1 (namely, lazy deserialization from this commit, and optimized serialization of bare strings from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1694791749\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48122\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48122/hovercard\" href=\"https://github.com/rails/rails/pull/48122\">#48122</a>).</p>\n<hr>\n<p dir=\"auto\">/cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a> since you expressed interest in this in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1736309755\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48368\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48368/hovercard?comment_id=1572814330&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/issues/48368#issuecomment-1572814330\">#48368 (comment)</a>.</p>",
            "url": "https://github.com/rails/rails/pull/48451",
            "title": "Support replacing cache compressor",
            "date_modified": "2023-06-16T08:21:24.000Z",
            "date_published": "2023-06-11T21:27:10.000Z",
            "author": {
                "name": "jonathanhefner",
                "url": "https://github.com/jonathanhefner"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/57028?u=a8e7c3d4b3f9ea54f1302bca3bedf0a4f228aa0e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because I recently stumbled upon a use case where I needed to send a bounce email (with <code class=\"notranslate\">ActionMailbox.bounce_with</code>, but without going through ActiveJob and a queue. Since this seems like a reasonable use case, I suggest adding an option to <code class=\"notranslate\">bounce_with</code> to allow for the immediate delivery of the bounce email.</p>\n<h3 dir=\"auto\">Details</h3>\n<p dir=\"auto\">This Pull Request changes <code class=\"notranslate\">ActionMailbox::Base#bounce_with</code> to accept an optional kwarg, <code class=\"notranslate\">:deliver_now</code>, which, if <code class=\"notranslate\">true</code>, provokes the sending of the bounce email without going through a queue.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\" # Enqueues the bounce email\nMyMailbox.bounce_with MyMailer.my_method(args)\n\n# Delivers the email immediately\nMyMailbox.bounce_with MyMailer.my_method(args, deliver_now: true)\"><pre class=\"notranslate\"> <span class=\"pl-c\"># Enqueues the bounce email</span>\n<span class=\"pl-v\">MyMailbox</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">bounce_with</span> <span class=\"pl-v\">MyMailer</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">my_method</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">args</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-c\"># Delivers the email immediately</span>\n<span class=\"pl-v\">MyMailbox</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">bounce_with</span> <span class=\"pl-v\">MyMailer</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">my_method</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">args</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">deliver_now</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48446",
            "title": "Bounce emails can be sent with `deliver_now`",
            "date_modified": "2023-06-11T10:59:19.000Z",
            "date_published": "2023-06-11T10:59:15.000Z",
            "author": {
                "name": "r3trofitted",
                "url": "https://github.com/r3trofitted"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6142?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">It can remove hundreds of lines of deprecation warning backtraces from spamming the console or the logs.  It maintains forward compatibility with the <code class=\"notranslate\">pg</code> gem, which will eventually require the new behavior.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">It's very small: just a single <code class=\"notranslate\">**</code> for some keyword args.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<ul dir=\"auto\">\n<li>See the original issue for more context: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1680963007\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48046\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48046/hovercard\" href=\"https://github.com/rails/rails/issues/48046\">#48046</a></li>\n<li>Backported PR: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1681132170\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48048\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48048/hovercard\" href=\"https://github.com/rails/rails/pull/48048\">#48048</a> (from tiramizoo/pg-1-5-warning)</li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48435",
            "title": "Backport: Fix the pg 1.5.0 deprecation warning",
            "date_modified": "2023-06-09T16:59:32.000Z",
            "date_published": "2023-06-09T16:55:15.000Z",
            "author": {
                "name": "nevans",
                "url": "https://github.com/nevans"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/15172605?u=c9831ccf188358c7be46eb4c634002b47ebb1068&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1712735611\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48241\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48241/hovercard\" href=\"https://github.com/rails/rails/pull/48241\">#48241</a> detects when certain auto-populated columns should be appended to a <code class=\"notranslate\">RETURNING</code> clause. However, in certain cases it may be necessary for the application to explicitly specify additional columns. e.g. Database Triggers.</p>\n<p dir=\"auto\">This feature was discussed in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1326221102\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45736\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/45736/hovercard\" href=\"https://github.com/rails/rails/issues/45736\">#45736</a> and briefly with Matthew Draper in the Discord channel.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR adds the ability for the application to specify those attributes with the <code class=\"notranslate\">reload_attributes</code> class method.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Additionally a very minor edge case was handled. The application could try to assign a value to a virtual column which essentially results in a no-op. The values persisted in the database would be the same regardless. However, in doing so the value from <code class=\"notranslate\">RETURNING</code> wasn't being reflected on the instance attributes after create. See the newly added test and removal of the <code class=\"notranslate\">_read_attribute</code> check.</p>\n<p dir=\"auto\">Performing this nil check with <code class=\"notranslate\">_read_attribute</code> will also not be compatible when <code class=\"notranslate\">RETURNING</code> is implemented on <code class=\"notranslate\">UPDATE</code>.  As it is expected that the instance's attributes will be prepopulated with non-nil values. (WIP here: <a href=\"https://github.com/abaldwin88/rails/tree/virtual_stored_column_returning_on_update\">https://github.com/abaldwin88/rails/tree/virtual_stored_column_returning_on_update</a>)</p>\n<hr>\n<p dir=\"auto\">Paging: <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/nvasilevski/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/nvasilevski\">@nvasilevski</a></p>",
            "url": "https://github.com/rails/rails/pull/48434",
            "title": "Add `ActiveRecord.reload_attributes`",
            "date_modified": "2023-06-14T15:10:39.000Z",
            "date_published": "2023-06-09T16:30:33.000Z",
            "author": {
                "name": "abaldwin88",
                "url": "https://github.com/abaldwin88"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><code class=\"notranslate\">Trilogy</code> adapter has a custom implementation of <code class=\"notranslate\">exec_insert</code> method which is a complete duplication of the abstract <code class=\"notranslate\">exec_insert</code> with the <strong>only difference</strong>:  Trilogy's exec insert used to return an unwrapped result while abstract implementation returns <code class=\"notranslate\">ActiveRecord::Result</code>. Though we believe it goes against the method signature as trilogy result and <code class=\"notranslate\">AR::Result</code> do not implement the same interface. Changing the result type to be Active Record result causes only one issue - <code class=\"notranslate\">last_insert_method</code> can not fetch the last inserted id value from <code class=\"notranslate\">ActiveRecord::Result</code> as it doesn't provide such value.  In order to address it we are introducing a new <code class=\"notranslate\">ActiveRecord::TrilogyResult</code> class which is a child class of <code class=\"notranslate\">Result</code> with the only difference - it implements <code class=\"notranslate\">last_insert_id</code> to be used by the <code class=\"notranslate\">last_inserted_id</code> method. The <code class=\"notranslate\">Result</code> itself had to be extended to store the reference to the <code class=\"notranslate\">raw_result</code></p>\n<h3 dir=\"auto\">Alternative solutions for <code class=\"notranslate\">last_inserted_id</code></h3>\n<ol dir=\"auto\">\n<li>Instead of introducing new <code class=\"notranslate\">TrilogyResult</code> class we could have added <code class=\"notranslate\">last_inserted_id</code> method directly to the <code class=\"notranslate\">Result</code> but it doesn't seem correct as not every adapter has such concept as <code class=\"notranslate\">last_inserted_id</code>. For example being able to call <code class=\"notranslate\">last_inserted_id</code> when using <code class=\"notranslate\">PostgresqlAdapter</code> won't make much sense.</li>\n<li>We could have done the same what <code class=\"notranslate\">mysql2</code> adapter does - reach into <code class=\"notranslate\">@connection</code> to get the value:<br>\n<div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/2a904bf58828e79c10e7838cb5a7550f8a1b5581/activerecord/lib/active_record/connection_adapters/mysql2/database_statements.rb#L69\">rails/activerecord/lib/active_record/connection_adapters/mysql2/database_statements.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 69\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/2a904bf58828e79c10e7838cb5a7550f8a1b5581\">2a904bf</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L69\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"69\"></td>\n          <td id=\"LC69\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">@raw_connection</span>&amp;.<span class=\"pl-en\">last_id</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n as Trilogy raw connection also provides <code class=\"notranslate\">last_insert_id</code> method. Though it feels much lower-level to reach into the raw connection and relying on <code class=\"notranslate\">Result</code> seems to be a much better abstraction</li>\n</ol>",
            "url": "https://github.com/rails/rails/pull/48428",
            "title": "Remove custom `exec_insert` method from Trilogy adapter",
            "date_modified": "2023-06-12T18:52:17.000Z",
            "date_published": "2023-06-09T01:16:25.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><code class=\"notranslate\">exec_insert</code> and <code class=\"notranslate\">insert</code> methods accept a <code class=\"notranslate\">returning</code> argument, however only PostgreSQL adapter fully supports it. This commit adds a validation that raises in case if value passed as <code class=\"notranslate\">returning</code> is not supported by the adapter.</p>\n<p dir=\"auto\">The check allows to supply one-sized Array for the \"unsupported\" case as technically SQLite and MySQL can return the inserted row id, but no more than that, at least at this moment.</p>\n<h3 dir=\"auto\">Implementation details</h3>\n<p dir=\"auto\">Since <code class=\"notranslate\">insert</code> method eventually calls into <code class=\"notranslate\">exec_insert</code> the validation only exists in the <code class=\"notranslate\">exec_insert</code> method. Validation is extracted into a separate method so both default and Trilogy's <code class=\"notranslate\">exec_insert</code> implementation can share it</p>",
            "url": "https://github.com/rails/rails/pull/48418",
            "title": "Raise if `exec_insert` and `insert` are used with an unsupported `returning` value",
            "date_modified": "2023-06-09T01:17:14.000Z",
            "date_published": "2023-06-07T14:44:41.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/18366969?u=e6919af135d360a17f71ab7380f0d57fe08be21a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because there is no explanation of <code class=\"notranslate\">ActiveRecord::Relation#pick</code> in the guide.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes to add the documentation for <code class=\"notranslate\">ActiveRecord::Relation#pick</code> to the guide.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<ul dir=\"auto\">\n<li>api url: <a href=\"https://edgeapi.rubyonrails.org/classes/ActiveRecord/Calculations.html#method-i-pluck\" rel=\"nofollow\">https://edgeapi.rubyonrails.org/classes/ActiveRecord/Calculations.html#method-i-pluck</a></li>\n<li>edge guide url: <a href=\"https://edgeguides.rubyonrails.org/active_record_querying.html#pluck\" rel=\"nofollow\">https://edgeguides.rubyonrails.org/active_record_querying.html#pluck</a></li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48404",
            "title": "Added documentation for `ActiveRecord::Relation#pick` [skip ci]",
            "date_modified": "2023-06-14T02:56:03.000Z",
            "date_published": "2023-06-06T07:02:14.000Z",
            "author": {
                "name": "soartec-lab",
                "url": "https://github.com/soartec-lab"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/193936?u=0009ccae9daa72c7b1c8590f9c67560b29a54902&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Add support for multi column where syntax (aka <code class=\"notranslate\">WHERE (id, user) IN ((1, 'Josef'), (2, 'Jimmy'))</code>) for PostgreSQL adapter.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"values = [[1, 'Josef'], [2, 'Jimmy']]\nUser.where('(id, name) IN (?)', values).to_sql\n# =&gt; SELECT &quot;users&quot;.* FROM &quot;users&quot; WHERE ((id, name) IN ((1, 'Josef'),(2, 'Jimmy')))\"><pre class=\"notranslate\"><span class=\"pl-s1\">values</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">[</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'Josef'</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">[</span><span class=\"pl-c1\">2</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'Jimmy'</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">]</span>\n<span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">'(id, name) IN (?)'</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">values</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_sql</span>\n<span class=\"pl-c\"># =&gt; SELECT \"users\".* FROM \"users\" WHERE ((id, name) IN ((1, 'Josef'),(2, 'Jimmy')))</span></pre></div>\n<p dir=\"auto\">currently this raises an exception</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/app/vendor/bundle/ruby/3.1.0/gems/activerecord-7.0.4.3/lib/active_record/connection_adapters/abstract/quoting.rb:25:in `quote': can't quote Array (TypeError)\"><pre class=\"notranslate\"><code class=\"notranslate\">/app/vendor/bundle/ruby/3.1.0/gems/activerecord-7.0.4.3/lib/active_record/connection_adapters/abstract/quoting.rb:25:in `quote': can't quote Array (TypeError)\n</code></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">It is possible to chain <code class=\"notranslate\">OR</code> conditions like <code class=\"notranslate\">WHERE (id = 1 AND user = 'Josef') OR (id = 2 AND user = 'Jimmy')</code>, but in my use case I do need to handle ten thousands of individual values. Per my testing this approach is heavy for PostgreSQL planner and affects planning time according to <code class=\"notranslate\">EXPLAIN</code>.</p>\n<ul dir=\"auto\">\n<li>1 000 conditions of 2 values combined by OR\n<ul dir=\"auto\">\n<li>Planning Time: 280.032 ms</li>\n</ul>\n</li>\n<li>10 000 conditions of 2 values combined by OR\n<ul dir=\"auto\">\n<li>Planning Time: 27598.735 ms</li>\n</ul>\n</li>\n</ul>\n<p dir=\"auto\">compared to multi-column WHERE</p>\n<ul dir=\"auto\">\n<li>1 000 conditions of 2 values using \"multi-where\"\n<ul dir=\"auto\">\n<li>Planning Time: 8.722 ms</li>\n</ul>\n</li>\n<li>10 000 conditions of 2 values using \"multi-where\"\n<ul dir=\"auto\">\n<li>Planning Time: 131.082 ms</li>\n</ul>\n</li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">It is also easier to compose query this way. Using <code class=\"notranslate\">or</code> query needs to be composed in iterative way.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"values = [ [1, 'Josef'], ... ] # array of 10 000 values\nscope = User.all\n\nvalues.each do |value|\n  scope = scope.or(User.where(id: value[0], name: value[1])\nend\n\nscope.load # execute\"><pre class=\"notranslate\"><span class=\"pl-s1\">values</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span> <span class=\"pl-kos\">[</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'Josef'</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> ... <span class=\"pl-kos\">]</span> <span class=\"pl-c\"># array of 10 000 values</span>\n<span class=\"pl-s1\">scope</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">all</span>\n\n<span class=\"pl-s1\">values</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">value</span>|\n  <span class=\"pl-s1\">scope</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">scope</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">or</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">id</span>: <span class=\"pl-s1\">value</span><span class=\"pl-kos\">[</span><span class=\"pl-c1\">0</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">name</span>: <span class=\"pl-s1\">value</span><span class=\"pl-kos\">[</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-en\">end</span>\n\n<span class=\"pl-s1\">scope</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">load</span> <span class=\"pl-c\"># execute</span></pre></div>\n<p dir=\"auto\"><em>I had troubles even with this approach since <code class=\"notranslate\">or</code> doesn't work properly when called without starting where chain already on scope. But I'm not 100% sure I wasn't doing something wrong. I had to do following actually.</em></p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"values = [ [1, 'Josef'], ... ] # array of 10 000 values\nscope = User.all\n\n# start where chain first\nfirst_value = values.shift \nscope = scope.where(id: first_value[0], name: first_value[1])\n\n# handle rest with or\nvalues.each do |value|\n  scope = scope.or(User.where(id: value[0], name: value[1])\nend\n\nscope.load # execute\"><pre class=\"notranslate\"><span class=\"pl-s1\">values</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">[</span> <span class=\"pl-kos\">[</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'Josef'</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> ... <span class=\"pl-kos\">]</span> <span class=\"pl-c\"># array of 10 000 values</span>\n<span class=\"pl-s1\">scope</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">all</span>\n\n<span class=\"pl-c\"># start where chain first</span>\n<span class=\"pl-s1\">first_value</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">values</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">shift</span> \n<span class=\"pl-s1\">scope</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">scope</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">id</span>: <span class=\"pl-s1\">first_value</span><span class=\"pl-kos\">[</span><span class=\"pl-c1\">0</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">name</span>: <span class=\"pl-s1\">first_value</span><span class=\"pl-kos\">[</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-c\"># handle rest with or</span>\n<span class=\"pl-s1\">values</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">each</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">value</span>|\n  <span class=\"pl-s1\">scope</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">scope</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">or</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">id</span>: <span class=\"pl-s1\">value</span><span class=\"pl-kos\">[</span><span class=\"pl-c1\">0</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">name</span>: <span class=\"pl-s1\">value</span><span class=\"pl-kos\">[</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-en\">end</span>\n\n<span class=\"pl-s1\">scope</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">load</span> <span class=\"pl-c\"># execute</span></pre></div>\n<p dir=\"auto\">If welcomed, this could be later turned into feature of hash version of where arguments and being supported across all adapters just using the most optimised way available.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"User.where([:id, :name] =&gt; [[1, 'Josef'], [2, 'Jimmy']])\n# =&gt; uses multi-where when supported (PostgreSQL only) or OR chained combinations for the rest\"><pre class=\"notranslate\"><span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">[</span><span class=\"pl-pds\">:id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:name</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-kos\">[</span><span class=\"pl-kos\">[</span><span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'Josef'</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">[</span><span class=\"pl-c1\">2</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">'Jimmy'</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\"># =&gt; uses multi-where when supported (PostgreSQL only) or OR chained combinations for the rest</span></pre></div>\n<h3 dir=\"auto\">Tip</h3>\n<p dir=\"auto\"><em>for quick local test, I used following patch</em></p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"module CustomPostgreSQLQuoting\n  def quote(value)\n    if value.is_a?(Array)\n      &quot;(#{value.map { |v| super(v) }.join(', ')})&quot;\n    else\n      super\n    end\n  end\nend\n\nActiveRecord::ConnectionAdapters::PostgreSQLAdapter.prepend(CustomPostgreSQLQuoting)\"><pre class=\"notranslate\"><span class=\"pl-k\">module</span> <span class=\"pl-v\">CustomPostgreSQLQuoting</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">quote</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-k\">if</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">is_a?</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Array</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-s\">\"(<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">map</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">v</span>| <span class=\"pl-smi\">super</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">v</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">', '</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">}</span></span>)\"</span>\n    <span class=\"pl-k\">else</span>\n      <span class=\"pl-smi\">super</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">ConnectionAdapters</span>::<span class=\"pl-v\">PostgreSQLAdapter</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">prepend</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">CustomPostgreSQLQuoting</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1586757199\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47410\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47410/hovercard?comment_id=1434957200&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/pull/47410#issuecomment-1434957200\">#47410 (comment)</a> as well</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48393",
            "title": "Support nested array bind parameter for PostgreSQL parameter.",
            "date_modified": "2023-06-06T10:44:04.000Z",
            "date_published": "2023-06-04T12:31:54.000Z",
            "author": {
                "name": "simi",
                "url": "https://github.com/simi"
            }
        }
    ]
}