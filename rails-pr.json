{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/30030?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>",
            "url": "https://github.com/rails/rails/pull/48755",
            "title": "Try out rack head (3.1).",
            "date_modified": "2023-07-17T23:20:40.000Z",
            "date_published": "2023-07-17T23:16:40.000Z",
            "author": {
                "name": "ioquatix",
                "url": "https://github.com/ioquatix"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/771968?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This adds an optimization for cache format version 7.1 such that expired and version-mismatched cache entries do not deserialize their values.</p>\n<hr>\n<p dir=\"auto\">This is extracted from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1751610988\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48451\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48451/hovercard\" href=\"https://github.com/rails/rails/pull/48451\">#48451</a>.  See the 2nd commit for the relevant changes.</p>",
            "url": "https://github.com/rails/rails/pull/48754",
            "title": "Lazily deserialize cache entries",
            "date_modified": "2023-07-17T21:30:24.000Z",
            "date_published": "2023-07-17T21:30:19.000Z",
            "author": {
                "name": "jonathanhefner",
                "url": "https://github.com/jonathanhefner"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/25471753?u=02d46ed8488b3d37aebd8f3931134fbb5154f3ef&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created to change the code example in the Active Storage guide. Initially it made me confused and I believe this subtle change would improve clarity.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Currently the service specified here is <code class=\"notranslate\">:s3</code> and it could be confused for the <code class=\"notranslate\">Service::S3Service</code>. The modified code example shows more clarity to the reader that the service in this case here refers to the bucket name outlined in <code class=\"notranslate\">storage.yml</code> rather than the adapter service.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48752",
            "title": "Use different bucket name in AS Guide for clarity",
            "date_modified": "2023-07-17T19:07:14.000Z",
            "date_published": "2023-07-17T19:07:10.000Z",
            "author": {
                "name": "wildmaples",
                "url": "https://github.com/wildmaples"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/992076?u=ba1643f551498c236569d8247bae783189bff167&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because [REPLACE ME]</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes [REPLACE ME]</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48749",
            "title": "update cache when has_one:through",
            "date_modified": "2023-07-17T16:59:14.000Z",
            "date_published": "2023-07-17T16:59:03.000Z",
            "author": {
                "name": "wyattades",
                "url": "https://github.com/wyattades"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/214488?u=2e5d226a7c0a802293c9677da96f0ebe7bff82d1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">When checking what columns are defined in an arbitrary model, you may use <code class=\"notranslate\">console</code> or other tools to output the model class.<br>\nHowever, when a model has many columns, it can be difficult to read when displayed on a single line.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"p User\n# =&gt; User(id: integer, first_name: string, last_name: string, birth_at: datetime, email: string, address: string, active: boolean, parent_id: integer, type: string, created_at: datetime, updated_at: datetime)\"><pre class=\"notranslate\"><span class=\"pl-en\">p</span> <span class=\"pl-v\">User</span>\n<span class=\"pl-c\"># =&gt; User(id: integer, first_name: string, last_name: string, birth_at: datetime, email: string, address: string, active: boolean, parent_id: integer, type: string, created_at: datetime, updated_at: datetime)</span></pre></div>\n<p dir=\"auto\">NOTE: <a href=\"https://github.com/rails/rails/pull/15172\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/15172/hovercard\">implement ActiveRecord::Base#pretty_print by notEthan · Pull Request #15172 · rails/rails</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveRecord::Base.pretty_print</code> を定義して <code class=\"notranslate\">pp</code> 出力に対応させました。<br>\nDefine <code class=\"notranslate\">ActiveRecord::Base.pretty_print</code> to support <code class=\"notranslate\">pp</code> output.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"pp User\n# =&gt; User(\n#     id: integer,\n#     first_name: string,\n#     last_name: string,\n#     birth_at: datetime,\n#     email: string,\n#     address: string,\n#     active: boolean,\n#     parent_id: integer,\n#     type: string,\n#     created_at: datetime,\n#     updated_at: datetime)\"><pre class=\"notranslate\"><span class=\"pl-en\">pp</span> <span class=\"pl-v\">User</span>\n<span class=\"pl-c\"># =&gt; User(</span>\n<span class=\"pl-c\">#     id: integer,</span>\n<span class=\"pl-c\">#     first_name: string,</span>\n<span class=\"pl-c\">#     last_name: string,</span>\n<span class=\"pl-c\">#     birth_at: datetime,</span>\n<span class=\"pl-c\">#     email: string,</span>\n<span class=\"pl-c\">#     address: string,</span>\n<span class=\"pl-c\">#     active: boolean,</span>\n<span class=\"pl-c\">#     parent_id: integer,</span>\n<span class=\"pl-c\">#     type: string,</span>\n<span class=\"pl-c\">#     created_at: datetime,</span>\n<span class=\"pl-c\">#     updated_at: datetime)</span></pre></div>\n<p dir=\"auto\">The format and implementation are based on <a href=\"https://github.com/rails/rails/blob/e18791c0bf2e03d3e6380f69b44e946564c6f873/activerecord/lib/active_record/core.rb#L682-L705\"><code class=\"notranslate\">ActiveRecord::Base#pretty_print</code></a> and <a href=\"https://github.com/rails/rails/blob/e18791c0bf2e03d3e6380f69b44e946564c6f873/activerecord/lib/active_record/core.rb#L332-L346\"><code class=\"notranslate\">ActiveRecord::Base.inspect</code></a>.</p>\n<p dir=\"auto\">Note: Output of <code class=\"notranslate\">ActiveRecord::Base#pretty_print</code> is as follows.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"pp User.new\n# =&gt; #&lt;User:0x00007f0431d6dc88\n#     id: nil,\n#     first_name: nil,\n#     last_name: nil,\n#     birth_at: nil,\n#     email: nil,\n#     address: nil,\n#     active: nil,\n#     parent_id: nil,\n#     type: nil,\n#     created_at: nil,\n#     updated_at: nil&gt;\"><pre class=\"notranslate\"><span class=\"pl-en\">pp</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span>\n<span class=\"pl-c\"># =&gt; #&lt;User:0x00007f0431d6dc88</span>\n<span class=\"pl-c\">#     id: nil,</span>\n<span class=\"pl-c\">#     first_name: nil,</span>\n<span class=\"pl-c\">#     last_name: nil,</span>\n<span class=\"pl-c\">#     birth_at: nil,</span>\n<span class=\"pl-c\">#     email: nil,</span>\n<span class=\"pl-c\">#     address: nil,</span>\n<span class=\"pl-c\">#     active: nil,</span>\n<span class=\"pl-c\">#     parent_id: nil,</span>\n<span class=\"pl-c\">#     type: nil,</span>\n<span class=\"pl-c\">#     created_at: nil,</span>\n<span class=\"pl-c\">#     updated_at: nil&gt;</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I also found the following problem when implementing <code class=\"notranslate\">ActiveRecord::Base#pretty_print</code> and have addressed it.</p>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/rails/rails/pull/18474\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/18474/hovercard\">pretty_print will use #inspect if a subclass redefines it by notEthan · Pull Request #18474 · rails/rails</a></li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48745",
            "title": "Implemented ActiveRecord::Base.pretty_print to work with PP.",
            "date_modified": "2023-07-17T15:32:08.000Z",
            "date_published": "2023-07-17T15:13:20.000Z",
            "author": {
                "name": "osyo-manga",
                "url": "https://github.com/osyo-manga"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Followup: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1799258482\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48716\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48716/hovercard\" href=\"https://github.com/rails/rails/pull/48716\">#48716</a></p>\n<p dir=\"auto\"><code class=\"notranslate\">model.connection_pool.schema_reflection</code> is never falsy, so that <code class=\"notranslate\">if</code> was pointless.</p>\n<p dir=\"auto\">Instead we more properly check if the schema cache contains that table.</p>\n<p dir=\"auto\">I also added some more comments to explain why the initializer tries so hard not to touch the database.</p>\n<p dir=\"auto\"><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a></p>",
            "url": "https://github.com/rails/rails/pull/48743",
            "title": "Cleanup `define_attribute_methods` initializer",
            "date_modified": "2023-07-17T14:46:49.000Z",
            "date_published": "2023-07-17T11:15:07.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/514063?u=7b0b24d6d590d840aeaf85a43d5f4994282fc03f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request is a follow up to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1719338839\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48273\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48273/hovercard\" href=\"https://github.com/rails/rails/pull/48273\">#48273</a><br>\nFeedback in that PR requested an adjustment to the link text in the Guide and to add some information to Action View Helpers API docs.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes link text in a guide file and adds info to Action View Helpers API docs landing page.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">/cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/zzak/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/zzak\">@zzak</a> since this PR started with me, bounced off him after a tweak, and continues with me for some extra based on feedback.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48741",
            "title": "Adjust link text and add info to AV Helpers API docs",
            "date_modified": "2023-07-17T19:14:17.000Z",
            "date_published": "2023-07-15T15:21:20.000Z",
            "author": {
                "name": "mikepmunroe",
                "url": "https://github.com/mikepmunroe"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/9117775?u=c5242a1b05e8272b9475a772e76fb3c5a7177445&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Partially <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48164.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1699572304\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48164\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48164/hovercard\" href=\"https://github.com/rails/rails/issues/48164\">#48164</a>. Followup to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1707080058\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48200\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48200/hovercard\" href=\"https://github.com/rails/rails/pull/48200\">#48200</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\"><code class=\"notranslate\">within_new_transaction</code> currently discards connections if an error is raised which may have left the connection in a transaction. This change updates that logic to discard connections in an <code class=\"notranslate\">ensure</code> block to handle cases where an error is not raised, for instance if the thread is killed.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Replaces <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1708832796\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48224\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48224/hovercard\" href=\"https://github.com/rails/rails/pull/48224\">#48224</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48740",
            "title": "Discard connection in ensure, not rescue",
            "date_modified": "2023-07-15T08:10:51.000Z",
            "date_published": "2023-07-15T08:08:55.000Z",
            "author": {
                "name": "nicholasdower",
                "url": "https://github.com/nicholasdower"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/96156234?u=9ced8d6ac6128a8dea78e7f0d9233669ff0ffecf&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because of the bug raised in issue <a href=\"https://github.com/rails/rails/issues/48651\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48651/hovercard\">48651</a>.</p>\n<p dir=\"auto\">Say you have the following models in Rails 7.0.6, and have used an enum in one and aliases in the other.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Publisher &lt; ApplicationRecord\n  belongs_to :listing\n\n  enum name: {\n    foo: 0,\n    bar: 1\n  }\nend\n\nclass Listing &lt; ApplicationRecord\n  has_many :publishers, dependent: :destroy\n  has_one :foo_listing, -&gt; { foo }, class_name: Publisher.name\n  has_one :bar_listing, -&gt; { bar }, class_name: Publisher.name\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Publisher</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:listing</span>\n\n  <span class=\"pl-en\">enum</span> <span class=\"pl-pds\">name</span>: <span class=\"pl-kos\">{</span>\n    <span class=\"pl-pds\">foo</span>: <span class=\"pl-c1\">0</span><span class=\"pl-kos\">,</span>\n    <span class=\"pl-pds\">bar</span>: <span class=\"pl-c1\">1</span>\n  <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Listing</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">has_many</span> <span class=\"pl-pds\">:publishers</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">dependent</span>: <span class=\"pl-pds\">:destroy</span>\n  <span class=\"pl-en\">has_one</span> <span class=\"pl-pds\">:foo_listing</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">foo</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">class_name</span>: <span class=\"pl-v\">Publisher</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span>\n  <span class=\"pl-en\">has_one</span> <span class=\"pl-pds\">:bar_listing</span><span class=\"pl-kos\">,</span> <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">bar</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">class_name</span>: <span class=\"pl-v\">Publisher</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">If you have an instance of Listing that has a foo publisher but not a bar publisher and call:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Listing.joins(:foo_listing).where.missing(:bar_listing)\"><pre class=\"notranslate\"><span class=\"pl-v\">Listing</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">joins</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:foo_listing</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">missing</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:bar_listing</span><span class=\"pl-kos\">)</span></pre></div>\n<p dir=\"auto\">It returns nothing whereas one would expect it to return the Listing you created that only has a <code class=\"notranslate\">:foo_listing</code></p>\n<p dir=\"auto\">Please see bug fix if more detail is needed linked above.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the missing method in <code class=\"notranslate\">active_record/relation/query_methods.rb</code></p>\n<p dir=\"auto\">Adds another conditional check in the missing query method  in ActiveRecord. This extra check makes sure that the values in <code class=\"notranslate\">:joins</code> are different than the values in <code class=\"notranslate\">:left_outer_joins</code>.  When they are it is likely that you are using an enum.  I do this checking first for the existence of values in <code class=\"notranslate\">:joins</code> and <code class=\"notranslate\">:left_outer_joins</code>.  Then I compare the size of the intersection of the two Arrays to the size of the <code class=\"notranslate\">:joins</code> Array. If they are different then it implements the scope method excluding the desired enum alias.  The <code class=\"notranslate\">size</code> method was used to keep this performant.  This passes all checks in ActiveRecord, including those from <a href=\"https://github.com/rails/rails/issues/47909\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/47909/hovercard\">47940</a> and <a href=\"https://github.com/rails/rails/pull/45015\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/45015/hovercard\">45015</a>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<ul dir=\"auto\">\n<li>[ X] This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li>[ X] Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li>[ X] Tests are added or updated if you fix a bug or add a feature.</li>\n<li>[ X] CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48738",
            "title": "Restores functionality to the missing method when using enums and fixes #48651",
            "date_modified": "2023-07-14T19:42:24.000Z",
            "date_published": "2023-07-14T19:34:45.000Z",
            "author": {
                "name": "paulreece",
                "url": "https://github.com/paulreece"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48714.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1799178211\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48714\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48714/hovercard\" href=\"https://github.com/rails/rails/issues/48714\">#48714</a>.</p>\n<p dir=\"auto\">Currently, when we have an <code class=\"notranslate\">accepts_nested_attributes_for</code> for a child relation with a custom primary key, when assigning child attributes we must use <code class=\"notranslate\">\"id\"</code> key with a value to provide a primary key, which can be confusing (as in the linked issue).</p>\n<p dir=\"auto\">Example:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Owner &lt; ApplicationRecord\n  has_many :pets\n  accepts_nested_attributes_for :pets\nend\n\nclass Pet &lt; ApplicationRecord\n  self.primary_key = :pet_id # custom primary key name\n  belongs_to :owner\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Owner</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">has_many</span> <span class=\"pl-pds\">:pets</span>\n  <span class=\"pl-en\">accepts_nested_attributes_for</span> <span class=\"pl-pds\">:pets</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Pet</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">primary_key</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">:pet_id</span> <span class=\"pl-c\"># custom primary key name</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:owner</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Before:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"owner.update(pets_attributes: { id: 2, name: &quot;parrot&quot; }) # works, because we used &quot;id&quot; as a key\nowner.update(pets_attributes: { pet_id: 2, name: &quot;parrot&quot; }) # does not work\"><pre class=\"notranslate\"><span class=\"pl-en\">owner</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">update</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">pets_attributes</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">id</span>: <span class=\"pl-c1\">2</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">name</span>: <span class=\"pl-s\">\"parrot\"</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\"># works, because we used \"id\" as a key</span>\n<span class=\"pl-en\">owner</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">update</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">pets_attributes</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">pet_id</span>: <span class=\"pl-c1\">2</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">name</span>: <span class=\"pl-s\">\"parrot\"</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">)</span> <span class=\"pl-c\"># does not work</span></pre></div>\n<p dir=\"auto\">After - both variants are working</p>",
            "url": "https://github.com/rails/rails/pull/48733",
            "title": "Allow `accepts_nested_attributes_for` to accept associated record attributes with custom primary keys",
            "date_modified": "2023-07-13T18:02:16.000Z",
            "date_published": "2023-07-13T14:38:31.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/4473199?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">…when there are no foreign keys or indexes.  This will produce valid code without linting issues (issue: Trailing whitespace detected)</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Schema generator was generating files with linting issues (Trailing whitespace detected) <strong>when there is no foreign_keys in the database</strong>. Developer who care about linting has to manually fix those issues after every schema dump operation (e.g. <code class=\"notranslate\">rails db:migrate</code>).</p>\n<p dir=\"auto\">Example of schema file <strong>with linting issue</strong> (extra newline on L6):</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ActiveRecord::Schema[7.0].define(version: 2023_03_14_145511) do\n  create_table &quot;action_logs&quot;, force: :cascade do |t|\n    t.string &quot;action&quot;, null: false\n    t.index [&quot;deleted_at&quot;], name: &quot;index_action_logs_on_deleted_at&quot;\n  end\n\nend\"><pre class=\"notranslate\"><code class=\"notranslate\">ActiveRecord::Schema[7.0].define(version: 2023_03_14_145511) do\n  create_table \"action_logs\", force: :cascade do |t|\n    t.string \"action\", null: false\n    t.index [\"deleted_at\"], name: \"index_action_logs_on_deleted_at\"\n  end\n\nend\n</code></pre></div>\n<p dir=\"auto\">Example of schema file <strong>without</strong> linting issues:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ActiveRecord::Schema[7.0].define(version: 2023_03_14_145511) do\n  create_table &quot;action_logs&quot;, force: :cascade do |t|\n    t.string &quot;action&quot;, null: false\n    t.index [&quot;deleted_at&quot;], name: &quot;index_action_logs_on_deleted_at&quot;\n  end\nend\"><pre class=\"notranslate\"><code class=\"notranslate\">ActiveRecord::Schema[7.0].define(version: 2023_03_14_145511) do\n  create_table \"action_logs\", force: :cascade do |t|\n    t.string \"action\", null: false\n    t.index [\"deleted_at\"], name: \"index_action_logs_on_deleted_at\"\n  end\nend\n</code></pre></div>\n<h3 dir=\"auto\">Details</h3>\n<p dir=\"auto\">We should NOT attach a newline after last table definition. Extra newline is needed only if foreign keys definitions exists in the database.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\">  This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\">  Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\">  Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\">  CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48731",
            "title": "Prevent extra newlines after table generation block in shema.rb",
            "date_modified": "2023-07-13T15:56:45.000Z",
            "date_published": "2023-07-13T10:26:54.000Z",
            "author": {
                "name": "knagode",
                "url": "https://github.com/knagode"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/4473199?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Prior this change <code class=\"notranslate\">rails generate migration drop_users</code> generated migration file with empty <code class=\"notranslate\">def change</code> body. <a href=\"https://stackoverflow.com/questions/4020131/rails-db-migration-how-to-drop-a-table\" rel=\"nofollow\">A lot of users are surprised</a> about this not yet being implemented.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"class DropUsers&lt; ActiveRecord::Migration[7.0]\n  def change\n  end\nend\"><pre class=\"notranslate\"><code class=\"notranslate\">class DropUsers&lt; ActiveRecord::Migration[7.0]\n  def change\n  end\nend\n</code></pre></div>\n<h3 dir=\"auto\">Details</h3>\n<p dir=\"auto\">This PR improve codebase in order to generate proper drop migration:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"class DropUsers&lt; ActiveRecord::Migration[7.0]\n  def change\n     drop_table :users\n  end\nend\"><pre class=\"notranslate\"><code class=\"notranslate\">class DropUsers&lt; ActiveRecord::Migration[7.0]\n  def change\n     drop_table :users\n  end\nend\n</code></pre></div>\n<p dir=\"auto\">Note: Implementation does not contain tests because there is no base code for migration generators yet - it would require quite some efforts to add this. If someone knows how test for such a thing should be written, please give me some hints.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\">  This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\">  Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\">  Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\">  CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48729",
            "title": "Add migration generator for drop table action",
            "date_modified": "2023-07-13T15:54:43.000Z",
            "date_published": "2023-07-13T08:25:55.000Z",
            "author": {
                "name": "knagode",
                "url": "https://github.com/knagode"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/509837?u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Before:</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/509837/253184628-13c6ee19-e1be-49d8-809b-03f61c4d5030.png\"><img src=\"https://user-images.githubusercontent.com/509837/253184628-13c6ee19-e1be-49d8-809b-03f61c4d5030.png\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<ul dir=\"auto\">\n<li>Moves the code example directly below where it's referenced, and the note about naming after it.</li>\n<li>Adds a code example for the other config mentioned.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48728",
            "title": "Improve AR Encryption docs",
            "date_modified": "2023-07-13T06:40:25.000Z",
            "date_published": "2023-07-13T06:30:53.000Z",
            "author": {
                "name": "ghiculescu",
                "url": "https://github.com/ghiculescu"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/366910?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><ol dir=\"auto\">\n<li><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #24390.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"145144564\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24390\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24390/hovercard\" href=\"https://github.com/rails/rails/issues/24390\">#24390</a>, a bug on indexing association validation errors.</li>\n<li>Add<code class=\"notranslate\">index_errors: :nested_attributes_order</code> mode for an alternative ordering of errors.</li>\n</ol>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">GitLab is using <code class=\"notranslate\">index_errors</code> but has to <a href=\"https://gitlab.com/gitlab-org/gitlab/-/merge_requests/51623#note_490919557\" rel=\"nofollow\">workaround its bug</a>, which is <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"145144564\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24390\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24390/hovercard\" href=\"https://github.com/rails/rails/issues/24390\">#24390</a>. That bug is about association validation error having the incorrect index because the indexing can be computed from an incomplete collection of association records. The fix would be to index from the full association collection.</p>\n<p dir=\"auto\"><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/tijwelch/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tijwelch\">@tijwelch</a> first created <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"150878938\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24728\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/24728/hovercard\" href=\"https://github.com/rails/rails/pull/24728\">#24728</a>, however <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/markedmondson/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/markedmondson\">@markedmondson</a>  pointed out that <a href=\"https://github.com/rails/rails/pull/24728#issuecomment-321361869\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/24728/hovercard\"><code class=\"notranslate\">reject_if</code> would not work properly</a>. Also, from the discussions I found that people have two different interpretations of what \"indexing\" means:</p>\n<ol dir=\"auto\">\n<li>to index by association order (based on database order), which is the current behavior</li>\n<li>to index by nested attributes order (and <code class=\"notranslate\">reject_if</code> is only applicable here)</li>\n</ol>\n<p dir=\"auto\">Those two are conflicting goals. To cater to both of them, this PR also adds a new ordering mode called <code class=\"notranslate\">nested_attributes_order</code>. This mode is more applicable to GitLab's use case, where the frontend could pass nested attributes in arbitrary order, and still want the error index to match such order.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds a new class called <code class=\"notranslate\">ActiveRecord::Associations::NestedError</code>, which handles the calculation of index. The original index logic exists in <code class=\"notranslate\">AutosaveAssociation</code> and is moved into this class. Base on <code class=\"notranslate\">index_errors</code> setting, it would choose whether to index based on <code class=\"notranslate\">association.target</code> order or nested attributes order.</p>\n<p dir=\"auto\">For nested attributes order, when nested_attributes are assigned (via a setter like <code class=\"notranslate\">roles_attributes=</code>), the array of the corresponding records will be stored in the association object as <code class=\"notranslate\">nested_attributes_target</code>. The <code class=\"notranslate\">NestedError</code> can then access this array to compute the index. The <code class=\"notranslate\">reject_if</code> would also work since if something is rejected, the <code class=\"notranslate\">nested_attributes_target</code> would have <code class=\"notranslate\">nil</code> in its place as a placeholder, therefore maintaining the overall index.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48727",
            "title": "Fix index_errors and provide :nested_attributes_order mode",
            "date_modified": "2023-07-18T01:49:30.000Z",
            "date_published": "2023-07-13T03:13:17.000Z",
            "author": {
                "name": "lulalala",
                "url": "https://github.com/lulalala"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1798866939\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48712\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48712/hovercard\" href=\"https://github.com/rails/rails/issues/48712\">#48712</a>.</p>\n<p dir=\"auto\">The problem was that <code class=\"notranslate\">.first</code> method call, used in the condition, evaluated lazy enumerator, and thus lead to the problematic behavior.</p>",
            "url": "https://github.com/rails/rails/pull/48720",
            "title": "Fix `Enumerable#sum` for `Enumerator#lazy`",
            "date_modified": "2023-07-12T12:03:05.000Z",
            "date_published": "2023-07-12T12:03:02.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/33979976?u=55cb7b791cdb7adf94ee02066347b63c0f835fe3&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #47918.\">Closes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1663004010\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47918\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/47918/hovercard\" href=\"https://github.com/rails/rails/issues/47918\">#47918</a></p>\n<h3 dir=\"auto\">Context</h3>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveStorage::Mirror</code> is really nice to have. However when you define a Mirror service on storage.yml , the upload to the mirror actually happens inline, instead of using <code class=\"notranslate\">ActiveStorage::MirrorJob</code>.</p>\n<p dir=\"auto\">This actually slows down any uploads to the service, because it is performed n times (n being the number of mirrors), inline, instead of using the <code class=\"notranslate\">ActiveStorage::MirrorJob</code>.</p>\n<h3 dir=\"auto\">Fix</h3>\n<p dir=\"auto\">Before this commit, when a file was uploaded to a mirror service, the file upload to each service (primary and mirrors) was happening synchronously:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def upload(key, io, checksum: nil, **options)\n  each_service.collect do |service|\n    io.rewind\n    service.upload key, io, checksum: checksum, **options\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">def</span> <span class=\"pl-en\">upload</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">io</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">checksum</span>: <span class=\"pl-c1\">nil</span><span class=\"pl-kos\">,</span> **<span class=\"pl-s1\">options</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-en\">each_service</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">collect</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">service</span>|\n    <span class=\"pl-s1\">io</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rewind</span>\n    <span class=\"pl-s1\">service</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">upload</span> <span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">io</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">checksum</span>: <span class=\"pl-s1\">checksum</span><span class=\"pl-kos\">,</span> **<span class=\"pl-s1\">options</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">In this commit, we change this behavior to only upload the file to the primary service synchronously and then enqueue a job to upload the file to the mirrors asynchronously.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def upload(key, io, checksum: nil, **options)\n  io.rewind\n  primary.upload key, io, checksum: checksum, **options\n  mirror_later key, checksum: checksum\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">def</span> <span class=\"pl-en\">upload</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">io</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">checksum</span>: <span class=\"pl-c1\">nil</span><span class=\"pl-kos\">,</span> **<span class=\"pl-s1\">options</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-s1\">io</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">rewind</span>\n  <span class=\"pl-en\">primary</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">upload</span> <span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">io</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">checksum</span>: <span class=\"pl-s1\">checksum</span><span class=\"pl-kos\">,</span> **<span class=\"pl-s1\">options</span>\n  <span class=\"pl-en\">mirror_later</span> <span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">checksum</span>: <span class=\"pl-s1\">checksum</span>\n<span class=\"pl-k\">end</span></pre></div>",
            "url": "https://github.com/rails/rails/pull/48718",
            "title": "ActiveStorage mirror uploads should be asynchronous",
            "date_modified": "2023-07-11T22:04:43.000Z",
            "date_published": "2023-07-11T21:51:38.000Z",
            "author": {
                "name": "alexandreruban",
                "url": "https://github.com/alexandreruban"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/92044?u=68c6916605dc9a38a01fc4b0a11d0536fa232be9&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I believe the previous phrasing could be interpreted ambiguously. See discussion in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1799158435\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48713\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48713/hovercard\" href=\"https://github.com/rails/rails/issues/48713\">#48713</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">n/a</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">n/a</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48715",
            "title": "Clarify comment about debug log level.",
            "date_modified": "2023-07-11T15:28:04.000Z",
            "date_published": "2023-07-11T15:27:04.000Z",
            "author": {
                "name": "jcoyne",
                "url": "https://github.com/jcoyne"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/99586?u=b4abd791d83e768c72cb832147b4a210caecf47d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Rails 7 uses Turbo/Stimulus by default. Turbo adds disabled attributes when submitting form (see <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"993156012\" data-permission-text=\"Title is private\" data-url=\"https://github.com/hotwired/turbo/issues/386\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/hotwired/turbo/pull/386/hovercard\" href=\"https://github.com/hotwired/turbo/pull/386\">hotwired/turbo#386</a>). As the PR describes, we can change submission text when form is submitted.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"button                  .show-when-disabled { display: none; }\nbutton[disabled]        .show-when-disabled { display: initial; }\n\nbutton                  .show-when-enabled { display: initial; }\nbutton[disabled]        .show-when-enabled { display: none; }\"><pre class=\"notranslate\"><code class=\"notranslate\">button                  .show-when-disabled { display: none; }\nbutton[disabled]        .show-when-disabled { display: initial; }\n\nbutton                  .show-when-enabled { display: initial; }\nbutton[disabled]        .show-when-enabled { display: none; }\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt;button&gt;\n  &lt;span class=&quot;show-when-enabled&quot;&gt;Submit&lt;/span&gt;\n  &lt;span class=&quot;show-when-disabled&quot;&gt;Submitting...&lt;/span&gt;\n&lt;/button&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">&lt;button&gt;\n  &lt;span class=\"show-when-enabled\"&gt;Submit&lt;/span&gt;\n  &lt;span class=\"show-when-disabled\"&gt;Submitting...&lt;/span&gt;\n&lt;/button&gt;\n</code></pre></div>\n<p dir=\"auto\">This is only possible with the button tag. Because input tag does not allow child elements.</p>\n<p dir=\"auto\">It also seems like that button tags are preferred way nowadays.</p>\n<blockquote>\n<p dir=\"auto\"><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/button\" rel=\"nofollow\">https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/button</a><br>\nNote: While  elements of type button are still perfectly valid<br>\nHTML, the newer  element is now the favored way to create<br>\nbuttons. Given that a 's label text is inserted between the<br>\nopening and closing tags, you can include HTML in the label, even<br>\nimages.</p><p dir=\"auto\"></p>\n<p></p></blockquote>",
            "url": "https://github.com/rails/rails/pull/48711",
            "title": "Change form template to use button tag",
            "date_modified": "2023-07-11T10:32:31.000Z",
            "date_published": "2023-07-11T10:32:27.000Z",
            "author": {
                "name": "shouichi",
                "url": "https://github.com/shouichi"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/380564?u=2c5759e8d2dfc73b598bd6f8baaabbcc1517aa8a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because providing developer friendly security and privacy tooling is so important.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Adding <a href=\"https://github.com/Bearer/bearer\">Bearer</a> open-source tool to the resources section as an alternative to Brakeman. It covers both Ruby and JS code, which is practical for modern Rails application.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This tool is also referenced by OWASP in the <a href=\"https://cheatsheetseries.owasp.org/cheatsheets/Ruby_on_Rails_Cheat_Sheet.html#tools\" rel=\"nofollow\">Rails cheat sheet</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48703",
            "title": "Adding a new resource to the Security documentation",
            "date_modified": "2023-07-13T09:12:03.000Z",
            "date_published": "2023-07-10T11:25:04.000Z",
            "author": {
                "name": "gmontard",
                "url": "https://github.com/gmontard"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54629302?u=be8de5137bf940532cddd05aff823129ab8a39db&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created to update some inconsistent documentation for the public methods  <code class=\"notranslate\">ActiveRecord::QueryMethods#structurally_compatible?</code>, <code class=\"notranslate\">ActiveRecord::QueryMethods#and?</code> and <code class=\"notranslate\">ActiveRecord::QueryMethods#or?</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">In <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"638651790\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/39634\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/39634/hovercard\" href=\"https://github.com/rails/rails/pull/39634\">#39634</a>, <code class=\"notranslate\">#structurally_incompatible_values_for</code> was updated so that a given relation is only considered structurally incompatible to the current relation if it explicitly uses relation value methods that either vary from (eg. joining on a different table) or are not included in the current relation.</p>\n<p dir=\"auto\">The public method <code class=\"notranslate\">#structurally_compatible?</code> was affected by this change but currently has an example in its documentation that is inconsistent with the current functionality:</p>\n<p dir=\"auto\"><strong>Expected:</strong><br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/a5fc471b3f4bbd02e6be38dae023526a49e7d049/activerecord/lib/active_record/relation/query_methods.rb#L1011-L1012\">rails/activerecord/lib/active_record/relation/query_methods.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 1011 to 1012\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/a5fc471b3f4bbd02e6be38dae023526a49e7d049\">a5fc471</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L1011\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1011\"></td>\n          <td id=\"LC1011\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\">#    Post.joins(:comments).structurally_compatible?(Post.where(\"id = 1\"))</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1012\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1012\"></td>\n          <td id=\"LC1012\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\">#    # =&gt; false</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\"><strong>Actual</strong></p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Post.joins(:comments).structurally_compatible?(Post.where(&quot;id = 1&quot;))\n# =&gt; true\"><pre class=\"notranslate\"><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">joins</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:comments</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">structurally_compatible?</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"id = 1\"</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\"># =&gt; true</span></pre></div>\n<p dir=\"auto\">The descriptions for <code class=\"notranslate\">#structurally_compatible?</code>, <code class=\"notranslate\">#and</code> and <code class=\"notranslate\">#or</code> also imply that the two relations need to include the exact same relation value methods, which is no longer true.</p>\n<p dir=\"auto\">This PR simply updates the documentation for these methods so that:</p>\n<ol dir=\"auto\">\n<li>The 'new' functionality is reflected in the descriptions.</li>\n<li>The incorrect result for the example in <code class=\"notranslate\">#structurally_compatible?</code> is fixed.</li>\n</ol>\n<p dir=\"auto\">I've also added 2 more examples to <code class=\"notranslate\">#structurally_compatible?</code> to make the expected output clearer.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">Originally, I opened this issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1795195618\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48694\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48694/hovercard\" href=\"https://github.com/rails/rails/issues/48694\">#48694</a> and a PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1795198692\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48695\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48695/hovercard\" href=\"https://github.com/rails/rails/pull/48695\">#48695</a> to address it by reverting the changes in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"638651790\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/39634\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/39634/hovercard\" href=\"https://github.com/rails/rails/pull/39634\">#39634</a>. However, I concluded that:</p>\n<ul dir=\"auto\">\n<li>The changes and reasoning in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"638651790\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/39634\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/39634/hovercard\" href=\"https://github.com/rails/rails/pull/39634\">#39634</a> make sense in that a majority of the time the given relation will probably just vary by <code class=\"notranslate\">#where</code>. I was a bit on the fence at first cause I felt like consistently raising an error here might prevent unexpected query results and provide a more meaningful error than the ones you might get due to a malformed query (like referencing a table in the given relation that's only been joined to in the current relation), but at the same time I can see how that approach can be considered to be a bit too heavy handed.</li>\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"638651790\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/39634\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/39634/hovercard\" href=\"https://github.com/rails/rails/pull/39634\">#39634</a> was merged 3 years ago and I don't see any other open issues relating to it, so I think it's more reasonable to just update the documentation at this point than to revert the changes in that PR which might result in breaking changes on apps running on edge or when upgrading to the version this commit ends up in.</li>\n</ul>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48700",
            "title": "Update inconsistent documentation for `#structurally_compatible?`, `#and` and `#or`",
            "date_modified": "2023-07-16T01:25:17.000Z",
            "date_published": "2023-07-09T21:24:03.000Z",
            "author": {
                "name": "joshuay03",
                "url": "https://github.com/joshuay03"
            }
        }
    ]
}