{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/9117775?u=c5242a1b05e8272b9475a772e76fb3c5a7177445&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Please consider viewing the diff with whitespace disabled: <a href=\"https://github.com/rails/rails/pull/48224/files?w=1\">https://github.com/rails/rails/pull/48224/files?w=1</a></p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">A proposal for a way to improve the fix for <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1699572304\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48164\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48164/hovercard\" href=\"https://github.com/rails/rails/issues/48164\">#48164</a> which was added in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1707080058\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48200\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48200/hovercard\" href=\"https://github.com/rails/rails/pull/48200\">#48200</a>. Please see <a href=\"https://github.com/rails/rails/issues/48164#issuecomment-1544018445\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48164/hovercard\">this discussion</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Introduces the concept of a transaction lock. This is used to detect cases where <code class=\"notranslate\">within_new_transaction</code> raises, potentially leaving the connection in a transaction, and the attempt to discard the connection fails.</p>\n<p dir=\"auto\">The idea is to store and acquire a new lock before attempting to begin a transaction, and to only discard the lock once the transaction state is definitely known. If <code class=\"notranslate\">within_new_transaction</code> raises, without the lock being discarded, subsequent attempts to create a transaction will detect this and discard the connection.</p>\n<p dir=\"auto\">Note that no such check is performed in other methods which may use a connection in an unknown transaction state. For instance, it will still be possible to invoke <code class=\"notranslate\">execute</code>. In case this change ends up being acceptable, such checks could be added.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48224",
            "title": "Use locks to detect connections which are in an unknown transaction state",
            "date_modified": "2023-05-14T06:23:12.000Z",
            "date_published": "2023-05-14T06:22:20.000Z",
            "author": {
                "name": "nicholasdower",
                "url": "https://github.com/nicholasdower"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1518299?u=a2dd8dd1835679cfd6b1924ef63a6e61ea62fa2a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48185.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1703067636\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48185\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48185/hovercard\" href=\"https://github.com/rails/rails/issues/48185\">#48185</a></p>\n<p dir=\"auto\">Action Cable can be mounted standalone, but it loses the health check route provided by the railties.<br>\nThis change adds configuration for a health check rack app and a health check route to \"mount\" the rack app.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48222",
            "title": "Add health check on standalone Action Cable",
            "date_modified": "2023-05-14T03:41:48.000Z",
            "date_published": "2023-05-13T23:44:05.000Z",
            "author": {
                "name": "JoeDupuis",
                "url": "https://github.com/JoeDupuis"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/119425?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I18n.translate is called with wrong arguments, key is missing.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes argument list of I18n.translate, adds a missing key.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This call is made in the case when translation is missing and there is a default in the options.<br>\nTests are not affected. I18n.translate returns correct results using options hash as key, which also is missing.<br>\nIt depends on particular I18n backend and may cause inexplicable errors.</p>",
            "url": "https://github.com/rails/rails/pull/48220",
            "title": "Adds missing key argument for I18n.translate",
            "date_modified": "2023-05-13T16:10:22.000Z",
            "date_published": "2023-05-13T16:10:19.000Z",
            "author": {
                "name": "artemas",
                "url": "https://github.com/artemas"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Alternative to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1646855043\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47813\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47813/hovercard\" href=\"https://github.com/rails/rails/pull/47813\">#47813</a> to import the linter files directly to Rails source tree</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ zzak@mbp16 rails % ruby -v\nruby 3.2.2 (2023-03-30 revision e51014f9c0) [arm64-darwin22]\n\n\n\n$ zzak@mbp16 rails % bundle exec tools/check-changelogs .\n.............\n\n13 changelogs inspected, 0 offenses detected\n\n\n\n$ zzak@mbp16 rails % bundle exec tools/check-config-docs .\n\n\n\n$ zzak@mbp16 rails % bundle exec tools/check-links .\nhttps://edgeapi.rubyonrails.org/classes/ActiveSupport/MessageEncryptor.html#method-i-encrypt_and_sign\"><pre class=\"notranslate\">$ zzak@mbp16 rails % ruby -v\nruby 3.2.2 (2023-03-30 revision e51014f9c0) [arm64-darwin22]\n\n\n\n$ zzak@mbp16 rails % bundle <span class=\"pl-c1\">exec</span> tools/check-changelogs <span class=\"pl-c1\">.</span>\n.............\n\n13 changelogs inspected, 0 offenses detected\n\n\n\n$ zzak@mbp16 rails % bundle <span class=\"pl-c1\">exec</span> tools/check-config-docs <span class=\"pl-c1\">.</span>\n\n\n\n$ zzak@mbp16 rails % bundle <span class=\"pl-c1\">exec</span> tools/check-links <span class=\"pl-c1\">.</span>\nhttps://edgeapi.rubyonrails.org/classes/ActiveSupport/MessageEncryptor.html#method-i-encrypt_and_sign</pre></div>",
            "url": "https://github.com/rails/rails/pull/48216",
            "title": "Import rails-bin linter to rails internal tools lib",
            "date_modified": "2023-05-13T06:53:46.000Z",
            "date_published": "2023-05-13T06:53:46.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/7676464?u=e3a4f142edc023655c98b3299edc577d8e79969c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Updating the reflect_on_all_associations method to<br>\nallow for more then one symbol to be accepted. It<br>\nkeeps current functionality as well. If method is<br>\npresented with no symbols it will return all associations.</p>\n\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because [REPLACE ME]</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes [REPLACE ME]</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48208",
            "title": "Updating the reflect_on_all_associations method to allow for more then one symbol to be accepted.",
            "date_modified": "2023-05-12T19:36:20.000Z",
            "date_published": "2023-05-12T19:36:16.000Z",
            "author": {
                "name": "mgm702",
                "url": "https://github.com/mgm702"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">We want a way to be able to audit the public API of Rails, and find things that are missing <code class=\"notranslate\">:nodoc:</code>.</p>\n<p dir=\"auto\">This was implemented in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1707161137\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/sdoc/issues/222\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/sdoc/pull/222/hovercard\" href=\"https://github.com/rails/sdoc/pull/222\">rails/sdoc#222</a>, and we're pulling in the latest branch to use it here.</p>\n<p dir=\"auto\">In the future we might want a way to diff this data in some way, for example to provide PRs with feedback that introduce new classes or methods for reviewers to quickly check.</p>",
            "url": "https://github.com/rails/rails/pull/48202",
            "title": "Add namelist rake task",
            "date_modified": "2023-05-12T08:19:46.000Z",
            "date_published": "2023-05-12T08:19:42.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1518299?u=a2dd8dd1835679cfd6b1924ef63a6e61ea62fa2a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48013.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1678979503\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48013\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48013/hovercard\" href=\"https://github.com/rails/rails/issues/48013\">#48013</a></p>\n<p dir=\"auto\">If two routes end up with the same score when trying to recall the url from url_for, we currently pick the one with highest precedence (order of the route file).</p>\n<p dir=\"auto\">This change bumps the current route (if matched) in front of the others.</p>\n<p dir=\"auto\">The repro for the issue could help understand what this is trying to fix: <a href=\"https://gist.github.com/JoeDupuis/e0f18020c85a05d5188ee35485685387\">https://gist.github.com/JoeDupuis/e0f18020c85a05d5188ee35485685387</a></p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48013.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1678979503\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48013\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48013/hovercard\" href=\"https://github.com/rails/rails/issues/48013\">#48013</a></p>\n<p dir=\"auto\">We are already trying to recall the current request with <code class=\"notranslate\">url_for</code>, this helps recalling the correct route when there is multiple hit.</p>\n<p dir=\"auto\">Currently, only the router knows which route is served. This adds the current route in the rack env allowing class further in the request to infer things from it.</p>\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>I don't know if we should merge this. I could see it as confusing if someone is calling url_for in the context of a request vs outside of a request (test or mailer). But then again, <a href=\"https://github.com/rails/rails/issues/48013\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48013/hovercard\">it's also confusing to users if we don't</a>.</li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">A bit of fun trivia. The current (7.0.4.2) guide for <code class=\"notranslate\">ActionController::UrlFor</code> mention:</p>\n<blockquote>\n<p dir=\"auto\">This module requires the host class to implement env which needs to be Rack-compatible and request which is either an instance of ActionDispatch::Request <strong>or an object that responds to the host, optional_port, protocol, and symbolized_path_parameter methods.</strong></p>\n</blockquote>\n<p dir=\"auto\">Which led me to write an initial version of this where I was checking if the request object responds to <code class=\"notranslate\">current_route</code> to make sure the code would still work if the request is not an <code class=\"notranslate\">ActionDispatch::Request</code>.</p>\n<p dir=\"auto\">Then I noticed while reading the same doc through the code that <a href=\"https://github.com/rails/rails/commit/d69501a3d60f07dc68578278041ed74682084c9a\">this was changed</a> and I was unnecessarily playing hard mode <g-emoji class=\"g-emoji\" alias=\"man_facepalming\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f926-2642.png\">🤦‍♂️</g-emoji> <g-emoji class=\"g-emoji\" alias=\"laughing\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f606.png\">😆</g-emoji></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48201",
            "title": "Allow url_for to prioritize the current route on ambiguous recall.",
            "date_modified": "2023-05-14T03:41:25.000Z",
            "date_published": "2023-05-12T07:27:29.000Z",
            "author": {
                "name": "JoeDupuis",
                "url": "https://github.com/JoeDupuis"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1518299?u=a2dd8dd1835679cfd6b1924ef63a6e61ea62fa2a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><a href=\"https://github.com/rails/rails/commit/e68bfaf1fe1a7890a67af6f444281185f507cf9e#diff-8b09ea0c52da5a4c3aa0eadbe23c3df5e77cbdb850f04fde04fd1e30b7e010ce\">UrlRewriter was removed in 2010</a> The <code class=\"notranslate\">url_rewriter_test.rb</code> stuck around. Now, it is really just testing <code class=\"notranslate\">url_for</code>.  Most of the tests are identical.</p>\n<p dir=\"auto\">Some tests in <code class=\"notranslate\">url_rewriter_test.rb</code> were missing in the <code class=\"notranslate\">url_for</code> spec so I moved them.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Hoping to save a spelunking trip for the next person who works around <code class=\"notranslate\">url_for</code> <g-emoji class=\"g-emoji\" alias=\"grin\" fallback-src=\"https://github.githubassets.com/images/icons/emoji/unicode/1f601.png\">😁</g-emoji></p>\n<p dir=\"auto\">I am working on a couple of PRs and was trying to make sense of some of the tests. I found these redundant and confusing. Then with a bit of digging I realized there used to be a <code class=\"notranslate\">UrlRewriter</code> class.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG -- N/A</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48199",
            "title": "Remove UrlRewriter tests",
            "date_modified": "2023-05-14T03:42:08.000Z",
            "date_published": "2023-05-12T04:29:15.000Z",
            "author": {
                "name": "JoeDupuis",
                "url": "https://github.com/JoeDupuis"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/771968?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">In <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1327776549\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45752\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/45752/hovercard\" href=\"https://github.com/rails/rails/pull/45752\">#45752</a>, a <code class=\"notranslate\">:params</code> kwarg was added to <code class=\"notranslate\">assert_enqueued_email_with</code> so that mailer params and args could be specified simultaneously. However, for backward compatibility, the old behavior of treating an <code class=\"notranslate\">:args</code> Hash as params was preserved.  The result is that if both <code class=\"notranslate\">:params</code> and <code class=\"notranslate\">:args</code> are specified and <code class=\"notranslate\">:args</code> is a Hash, <code class=\"notranslate\">:params</code> is ignored.</p>\n<p dir=\"auto\">This commit deprecates specifying params via <code class=\"notranslate\">:args</code> (i.e. passing a Hash to <code class=\"notranslate\">:args</code>).</p>\n<p dir=\"auto\">After the deprecated behavior is removed, it will be possible to pass a Hash to <code class=\"notranslate\">:args</code>, and the Hash will be treated as named args instead.</p>",
            "url": "https://github.com/rails/rails/pull/48194",
            "title": "Deprecate params via `:args` for `assert_enqueued_email_with`",
            "date_modified": "2023-05-11T19:11:33.000Z",
            "date_published": "2023-05-11T18:07:34.000Z",
            "author": {
                "name": "jonathanhefner",
                "url": "https://github.com/jonathanhefner"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/28561?u=095779352a57f75e734987829f3f67a10e5780ed&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Active Model generates methods for each attribute to handle dirty changes. As these methods are generated and depend on the attributes in the model, they can't be found when searching for them in the API documentation.</p>\n<p dir=\"auto\">We can use the <code class=\"notranslate\">:method:</code> directive to document them in the form of <code class=\"notranslate\">[attribute]_will_change</code>, <code class=\"notranslate\">[attribute_name]_previously_was</code>, etc. This notation is <a href=\"https://github.com/rails/rails/blob/cb1073e664c41c3c4c87dee4788cc2a326247b4f/activemodel/lib/active_model/dirty.rb#L112\">already used</a> in the documentation of ActiveModel::Dirty.</p>\n<p dir=\"auto\">An alternative could be documenting the methods as: <code class=\"notranslate\">*_will_change</code>, <code class=\"notranslate\">*_previously_was</code>, etc...</p>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://user-images.githubusercontent.com/28561/237787512-af5b48e5-901a-4596-8890-041b78d05611.png\"><img width=\"1339\" alt=\"image\" src=\"https://user-images.githubusercontent.com/28561/237787512-af5b48e5-901a-4596-8890-041b78d05611.png\" style=\"max-width: 100%;\"></a>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48193",
            "title": "Document generated dirty attribute methods [ci-skip]",
            "date_modified": "2023-05-12T21:41:33.000Z",
            "date_published": "2023-05-11T17:53:05.000Z",
            "author": {
                "name": "p8",
                "url": "https://github.com/p8"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/674321?u=784b6dfff67d37694fa5f914a25273855a065e79&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">When building a new Service for ActiveStorage, we got two requirements:</p>\n<ol dir=\"auto\">\n<li>We need to direct upload a file with <code class=\"notranslate\">POST</code> method instead of <code class=\"notranslate\">PUT</code>, and send credential(token), key(filename) and file(binary to upload) with <code class=\"notranslate\">Content-Type:   multipart/form-data; boundary=&lt;frontier&gt;</code>, instead of sending them with headers.</li>\n<li>We are creating a SaaS that make each Tenant has their own Cloud Service configuration, hence it's not possible to write all service configurations into <code class=\"notranslate\">config/storage.yml</code>. For now, <code class=\"notranslate\">ActiveStorage::Blob</code> has an anonymous validator to check <code class=\"notranslate\">service_name</code> has to be declared in <code class=\"notranslate\">ActiveStorage::Blob.services</code>, we can't disable this validator.</li>\n</ol>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\"><strong>I think it's better to make them configurable like this:</strong></p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# write my own service\nmodule ActiveStorage\n  class Service::QiniumService &lt; Service\n\n    # declare direct upload with HTTP POST method\n    def http_method_for_direct_upload\n      'POST'\n    end\n\n   # declare direct upload response type, &quot;text&quot; or &quot;json&quot;\n    def http_response_type_for_direct_upload\n      'json'\n    end\n\n    # declare direct upload file as multipart/form-data, the value of ':file' is the form data key to file\n    def form_data_for_direct_upload(key, expires_in:, content_type:, content_length:, checksum:, **)\n      put_policy = Qinium::PutPolicy.new(config, key: key, expires_in: expires_in)\n      put_policy.fsize_limit = content_length.to_i + 1000\n      put_policy.mime_limit = content_type\n      put_policy.detect_mime = 1\n      put_policy.insert_only = 1\n      {\n        key: key,\n        token: put_policy.to_token,\n        ':file': 'file'\n      }\n    end\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># write my own service</span>\n<span class=\"pl-k\">module</span> <span class=\"pl-v\">ActiveStorage</span>\n  <span class=\"pl-k\">class</span> <span class=\"pl-v\">Service</span>::<span class=\"pl-v\">QiniumService</span> &lt; <span class=\"pl-v\">Service</span>\n\n    <span class=\"pl-c\"># declare direct upload with HTTP POST method</span>\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">http_method_for_direct_upload</span>\n      <span class=\"pl-s\">'POST'</span>\n    <span class=\"pl-k\">end</span>\n\n   <span class=\"pl-c\"># declare direct upload response type, \"text\" or \"json\"</span>\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">http_response_type_for_direct_upload</span>\n      <span class=\"pl-s\">'json'</span>\n    <span class=\"pl-k\">end</span>\n\n    <span class=\"pl-c\"># declare direct upload file as multipart/form-data, the value of ':file' is the form data key to file</span>\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">form_data_for_direct_upload</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">expires_in</span>:<span class=\"pl-kos\">,</span> <span class=\"pl-s1\">content_type</span>:<span class=\"pl-kos\">,</span> <span class=\"pl-s1\">content_length</span>:<span class=\"pl-kos\">,</span> <span class=\"pl-s1\">checksum</span>:<span class=\"pl-kos\">,</span> **<span class=\"pl-kos\">)</span>\n      <span class=\"pl-s1\">put_policy</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Qinium</span>::<span class=\"pl-v\">PutPolicy</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">config</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">key</span>: <span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">expires_in</span>: <span class=\"pl-s1\">expires_in</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-s1\">put_policy</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">fsize_limit</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">content_length</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_i</span> + <span class=\"pl-c1\">1000</span>\n      <span class=\"pl-s1\">put_policy</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">mime_limit</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s1\">content_type</span>\n      <span class=\"pl-s1\">put_policy</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">detect_mime</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">1</span>\n      <span class=\"pl-s1\">put_policy</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">insert_only</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">1</span>\n      <span class=\"pl-kos\">{</span>\n        <span class=\"pl-pds\">key</span>: <span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span>\n        <span class=\"pl-pds\">token</span>: <span class=\"pl-s1\">put_policy</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_token</span><span class=\"pl-kos\">,</span>\n        <span class=\"pl-s\">':file'</span>: <span class=\"pl-s\">'file'</span>\n      <span class=\"pl-kos\">}</span>\n    <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">With above changes, <code class=\"notranslate\">ActiveStorage::Service</code> can support all types of HTTP methods, send token to cloud service with HTTP header or form data.</p>\n<p dir=\"auto\"><strong>change <code class=\"notranslate\">activestorage/app/models/active_storage/blob.rb</code> anonymous validator to named one:</strong></p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"  validate do\n    if service_name_changed? &amp;&amp; service_name.present?\n      services.fetch(service_name) do\n        errors.add(:service_name, :invalid)\n      end\n    end\n  end\"><pre class=\"notranslate\">  <span class=\"pl-en\">validate</span> <span class=\"pl-k\">do</span>\n    <span class=\"pl-k\">if</span> <span class=\"pl-en\">service_name_changed?</span> &amp;&amp; <span class=\"pl-en\">service_name</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">present?</span>\n      <span class=\"pl-en\">services</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">fetch</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">service_name</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n        <span class=\"pl-en\">errors</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">add</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:service_name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:invalid</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-k\">end</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">changes to</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"validate :validate_service_name_in_services, if: -&gt; { service_name_changed? &amp;&amp; service_name.present? }\nprivate\n    def validate_service_name_in_services\n      services.fetch(service_name) do\n        errors.add(:service_name, :invalid)\n      end\n    end\"><pre class=\"notranslate\"><span class=\"pl-en\">validate</span> <span class=\"pl-pds\">:validate_service_name_in_services</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">if</span>: <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">service_name_changed?</span> &amp;&amp; <span class=\"pl-en\">service_name</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">present?</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">private</span>\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">validate_service_name_in_services</span>\n      <span class=\"pl-en\">services</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">fetch</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">service_name</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n        <span class=\"pl-en\">errors</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">add</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:service_name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:invalid</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-k\">end</span>\n    <span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Now, we can write our own Module prepend to ActiveStorage::Blob, to override <code class=\"notranslate\">validate_service_name_in_services</code>, such as:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"module ActiveStorageSaas::BlobModelMixin\n  private\n    def validate_service_name_in_services\n      # dynamically define service name per TenantStorageService#id, later we can resolve tenant storage\n      #   configuration by parsing TenantStorageService:1 to tenant_storage = TenantStorageService.find(1)\n      #   tenant_storage.service_name =&gt; Real Storage Service Name\n      #.  tenant_storage.service_options =&gt; options to make instance of Service\n      /^TenantStorageService:\\d+$/.match?(service_name) || super\n    end\nend\n\nActiveSupport.on_load(:active_storage_blob) do\n  prepend ActiveStorageSaas::BlobModelMixin\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">module</span> <span class=\"pl-v\">ActiveStorageSaas</span>::<span class=\"pl-v\">BlobModelMixin</span>\n  <span class=\"pl-k\">private</span>\n    <span class=\"pl-k\">def</span> <span class=\"pl-en\">validate_service_name_in_services</span>\n      <span class=\"pl-c\"># dynamically define service name per TenantStorageService#id, later we can resolve tenant storage</span>\n      <span class=\"pl-c\">#   configuration by parsing TenantStorageService:1 to tenant_storage = TenantStorageService.find(1)</span>\n      <span class=\"pl-c\">#   tenant_storage.service_name =&gt; Real Storage Service Name</span>\n      <span class=\"pl-c\">#.  tenant_storage.service_options =&gt; options to make instance of Service</span>\n      <span class=\"pl-pds\">/^TenantStorageService:<span class=\"pl-cce\">\\d</span>+$/</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">match?</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">service_name</span><span class=\"pl-kos\">)</span> || <span class=\"pl-smi\">super</span>\n    <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">ActiveSupport</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">on_load</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:active_storage_blob</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">prepend</span> <span class=\"pl-v\">ActiveStorageSaas</span>::<span class=\"pl-v\">BlobModelMixin</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<ul dir=\"auto\">\n<li>This is another PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1282501642\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45442\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/45442/hovercard\" href=\"https://github.com/rails/rails/pull/45442\">#45442</a> that has the same requirement to customize HTTP Method</li>\n<li>This is my real project that is working on this PR : <a href=\"https://github.com/xiaohui-zhangxh/activestorage_qinium/blob/main/lib/active_storage/service/qinium_service.rb\">https://github.com/xiaohui-zhangxh/activestorage_qinium/blob/main/lib/active_storage/service/qinium_service.rb</a></li>\n<li>This is my real project that need to make our Tenants have their own storage configurations : <a href=\"https://github.com/xiaohui-zhangxh/activestorage_saas/blob/main/lib/active_storage/service/saas_service.rb\">https://github.com/xiaohui-zhangxh/activestorage_saas/blob/main/lib/active_storage/service/saas_service.rb</a></li>\n<li>A duplicate PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1341323333\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/45839\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/45839/hovercard\" href=\"https://github.com/rails/rails/pull/45839\">#45839</a> to fix tests errors</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48189",
            "title": "Support more direct upload services by customize HTTP method and respose type",
            "date_modified": "2023-05-11T09:34:16.000Z",
            "date_published": "2023-05-11T09:34:11.000Z",
            "author": {
                "name": "xiaohui-zhangxh",
                "url": "https://github.com/xiaohui-zhangxh"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48173.\">Fix</span>: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1701211131\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48173\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48173/hovercard\" href=\"https://github.com/rails/rails/issues/48173\">#48173</a></p>\n<p dir=\"auto\">If for some reason the column identification fails, we should fallback to the old error rendering with only line information.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/tenderlove/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tenderlove\">@tenderlove</a></p>\n<p dir=\"auto\">FYI <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/jasonkim/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jasonkim\">@jasonkim</a></p>",
            "url": "https://github.com/rails/rails/pull/48184",
            "title": "Properly fallback when ERB column can't be computed",
            "date_modified": "2023-05-11T06:56:11.000Z",
            "date_published": "2023-05-10T01:44:32.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/93165947?u=4aafc929ec1b2d5baf1afc9508c950960c371f71&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">I have added a new test case that raises an error if the credentials cannot be decrypted.</p>\n\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because [This test case aims to verify that an error is raised if the credentials cannot be decrypted. By adding this new test case, the codebase's testing coverage will be improved, which can help detect and fix potential issues and bugs.]</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes [Raises an error if the credentials cannot be decrypted.]</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48181",
            "title": "Raises an error if the credentials cannot be decrypted",
            "date_modified": "2023-05-12T13:35:44.000Z",
            "date_published": "2023-05-09T21:16:16.000Z",
            "author": {
                "name": "ajee10x",
                "url": "https://github.com/ajee10x"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/771968?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This adds <code class=\"notranslate\">Object#isolated_copy</code> (as a private API) which performs a <code class=\"notranslate\">deep_dup</code> unless the object is frozen or a non-anonymous module.  In which case, it simply returns <code class=\"notranslate\">self</code>.</p>\n<p dir=\"auto\">TODO:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> tests</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> update <code class=\"notranslate\">thread_mattr_accessor</code> docs</li>\n</ul>\n<hr>\n<p dir=\"auto\"><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a> <code class=\"notranslate\">Module#deep_dup</code> returning <code class=\"notranslate\">self</code> may cause unexpected behavior (see <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1702310736\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48178\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48178/hovercard\" href=\"https://github.com/rails/rails/pull/48178\">#48178</a>).  What do you think of replacing <code class=\"notranslate\">Module#deep_dup</code> with <code class=\"notranslate\">Module#isolated_copy</code>?  (In other words, restoring the original behavior of <code class=\"notranslate\">Module#deep_dup</code>, and defining <code class=\"notranslate\">Module#isolated_copy</code> with the specialized behavior instead.)</p>",
            "url": "https://github.com/rails/rails/pull/48179",
            "title": "Add `Object#isolated_copy`",
            "date_modified": "2023-05-10T18:03:32.000Z",
            "date_published": "2023-05-09T16:37:22.000Z",
            "author": {
                "name": "jonathanhefner",
                "url": "https://github.com/jonathanhefner"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2145?u=852c36277afc8bff6cfd2565a665294841184ecc&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because writing <code class=\"notranslate\">Rails.application.credentials</code> can be a tad cumbersome.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes <code class=\"notranslate\">Rails</code> to have a convenient <code class=\"notranslate\">credentials</code> method for one less hop to get to credentials. (Similar to <code class=\"notranslate\">Rails.configuration</code>)</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48147",
            "title": "Add credentials convenience method on Rails",
            "date_modified": "2023-05-07T23:44:53.000Z",
            "date_published": "2023-05-06T04:07:39.000Z",
            "author": {
                "name": "mattpolito",
                "url": "https://github.com/mattpolito"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR allows aliasing columns named with one of the reserved<br>\nmethods like <code class=\"notranslate\">id</code>, <code class=\"notranslate\">id_before_type_cast</code>, <code class=\"notranslate\">id_was</code>, etc if database<br>\nschema happed to have one of these.</p>\n<p dir=\"auto\">Currently there is no convenient way of reading the <code class=\"notranslate\">id</code> column value<br>\nwhich is not being used as a primary key as <code class=\"notranslate\">id</code> in Rails is a reserved<br>\nterm which means \"an identifier\" or the value stored in the primary key<br>\ncolumn.</p>\n<p dir=\"auto\">Given a <code class=\"notranslate\">posts</code> table with both <code class=\"notranslate\">id</code> and <code class=\"notranslate\">title</code> columns where <code class=\"notranslate\">title</code><br>\nis being used as a primary key it is possible to alias <code class=\"notranslate\">id</code> attribute<br>\nto a new name so we can fetch the column value.</p>\n<p dir=\"auto\">For example:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Post &lt; ActiveRecord::Base\n  self.primary_key = :title\n  alias_attribute :post_id, :id\nend\n\npost = Post.create(title: &quot;Hello world&quot;)\npost.post_id # =&gt; 1\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">primary_key</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">:title</span>\n  <span class=\"pl-en\">alias_attribute</span> <span class=\"pl-pds\">:post_id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:id</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">post</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">title</span>: <span class=\"pl-s\">\"Hello world\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">post_id</span> <span class=\"pl-c\"># =&gt; 1</span></pre></div>\n<h3 dir=\"auto\">Technical details</h3>\n<p dir=\"auto\">Currently aliasing an attribute like <code class=\"notranslate\">alias_attribute :subject, :title</code> will define <code class=\"notranslate\">&lt;prefix_subject_suffix&gt;</code> methods that directly delegate to the <code class=\"notranslate\">*title*</code> methods. For example the <code class=\"notranslate\">subject</code> reader would look like:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def subject\n  title\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">def</span> <span class=\"pl-en\">subject</span>\n  <span class=\"pl-en\">title</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">This works fine but doesn't work when aliasing any of the Active Record reserved methods so in current implementation an alias like <code class=\"notranslate\">alias_attribute :subject, :id</code> ends up generating</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def subject\n  id\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">def</span> <span class=\"pl-en\">subject</span>\n  <span class=\"pl-en\">id</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">which will return the value behind the <code class=\"notranslate\">primary_key</code> column and not the <code class=\"notranslate\">id</code> column value.</p>\n<p dir=\"auto\">With the change we are proposing aliasing reserved method will generate methods that call into so-called \"proxy\" methods that read directly from the attributes. So aliasing <code class=\"notranslate\">id</code> attribute will generate:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def subject\n  attribute(&quot;id&quot;)\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">def</span> <span class=\"pl-en\">subject</span>\n  <span class=\"pl-en\">attribute</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"id\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/d503e893056650524caaf9ffe0364417224c051a/activemodel/lib/active_model/attributes.rb#L148-L149\">rails/activemodel/lib/active_model/attributes.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 148 to 149\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/d503e893056650524caaf9ffe0364417224c051a\">d503e89</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L148\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"148\"></td>\n          <td id=\"LC148\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">attribute</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attr_name</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L149\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"149\"></td>\n          <td id=\"LC149\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-c1\">@attributes</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">fetch_value</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">attr_name</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">along with <code class=\"notranslate\">attribute_was?</code> <code class=\"notranslate\">attribute_changed?</code>, etc and allow to access the <code class=\"notranslate\">id</code> value directly.</p>\n<p dir=\"auto\">Since now we have versions of the alias attribute method body we had to make sure we are using two different namespaces to avoid one of the bodies being cached. This is to prevent issues when a non Active Record model, like an Active Model model aliases <code class=\"notranslate\">id</code> and pollutes the <code class=\"notranslate\">:alias_attribute</code> namespace cache with a non-primary key implementation.</p>\n<h3 dir=\"auto\">Long-term plans</h3>\n<p dir=\"auto\">Despite of the solution being generic enough to allow for any of the reserved method names to be aliased, Rails currently disallows having schema with columns named as one of the reserved methods. The exception will be raised from:<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/e7f7a13950abfd980089fc581b56128ea4a04f8e/activerecord/lib/active_record/attribute_methods.rb#L89\">rails/activerecord/lib/active_record/attribute_methods.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 89\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/e7f7a13950abfd980089fc581b56128ea4a04f8e\">e7f7a13</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L89\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"89\"></td>\n          <td id=\"LC89\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">raise</span> <span class=\"pl-v\">DangerousAttributeError</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">method_name</span><span class=\"pl-kos\">}</span></span> is defined by Active Record. Check to make sure that you don't have an attribute or method with the same name.\"</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\nHowever eventually Rails may end up relaxing this restriction assuming that a model could alias the reserved method column. For example if the application ends up in a situation where it needs to work with a schema that contains columns named with reserved terms it could alias these columns like:<p></p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"alias_attribute :delete_value, :delete\nalias_attribute :save_value, :save\nalias_attribute :update_value, :update\n...\"><pre class=\"notranslate\"><span class=\"pl-en\">alias_attribute</span> <span class=\"pl-pds\">:delete_value</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:delete</span>\n<span class=\"pl-en\">alias_attribute</span> <span class=\"pl-pds\">:save_value</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:save</span>\n<span class=\"pl-en\">alias_attribute</span> <span class=\"pl-pds\">:update_value</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:update</span>\n...</pre></div>\n<h3 dir=\"auto\">Side note</h3>\n<p dir=\"auto\">Overall it looks like the <code class=\"notranslate\">alias_attribute</code> generation could be simplified and we could at least get rid of one of the regexes<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/d503e893056650524caaf9ffe0364417224c051a/activemodel/lib/active_model/attribute_methods.rb#L67-L68\">rails/activemodel/lib/active_model/attribute_methods.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 67 to 68\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/d503e893056650524caaf9ffe0364417224c051a\">d503e89</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L67\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"67\"></td>\n          <td id=\"LC67\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">NAME_COMPILABLE_REGEXP</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">/<span class=\"pl-cce\">\\A</span>[a-zA-Z_]<span class=\"pl-cce\">\\w</span>*[!?=]?<span class=\"pl-cce\">\\z</span>/</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L68\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"68\"></td>\n          <td id=\"LC68\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">CALL_COMPILABLE_REGEXP</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">/<span class=\"pl-cce\">\\A</span>[a-zA-Z_]<span class=\"pl-cce\">\\w</span>*[!?]?<span class=\"pl-cce\">\\z</span>/</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Also <code class=\"notranslate\">COMPILABLE</code> term doesn't seem to be the best fit for the logic anymore. As far as I can tell it used to differentiate between methods built inline like a string (compiled) and methods that were defined using <code class=\"notranslate\">define_method</code><br>\nWe are not using <code class=\"notranslate\">define_method</code> anymore which means both of the branches are \"complied\" in the legacy terms.<br>\nSo it looks like we can refactor the logic to only do the <code class=\"notranslate\">.match</code> once to determine whether we want a <code class=\"notranslate\">send</code> body or <code class=\"notranslate\">self.method</code> body. It may not result in any performance gains but overall the logic is complex and it would be nice to simplify it a bit.</p>",
            "url": "https://github.com/rails/rails/pull/48144",
            "title": "Call proxy attribute methods for reserved aliases ",
            "date_modified": "2023-05-12T19:31:37.000Z",
            "date_published": "2023-05-05T21:00:13.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/33079237?u=76f101f16829322713f7ba0c1496767a861ca89b&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This is a problem that has existed since the introduction of <a href=\"https://github.com/rails/rails/pull/35077/files#r260410047\">ActiveRecord::InsertAll</a>.<br>\nInitially, <code class=\"notranslate\">ActiveRecord::InsertAll</code> used <code class=\"notranslate\">ActiveRecord::Relation::QueryAttribute#value_for_database</code> to convert values. As the code evolved, it switched to using <code class=\"notranslate\">ActiveModel::Type::XXX#serialize</code> to serialize values.<br>\nThis is inconsistent with how attributes are converted in <code class=\"notranslate\">Model#save</code>, which uses <code class=\"notranslate\">ActiveModel::Attribute::FromUser#value_for_database</code>.<br>\nTherefore, in some cases, data created using <code class=\"notranslate\">Model#insert</code> and <code class=\"notranslate\">Model#create</code> may be inconsistent. This PR fixes this issue.</p>\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>Fix value conversion of ActiveRecord::InsertAll::Builder#values_list</li>\n</ul>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/boblail/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/boblail\">@boblail</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/tenderlove/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tenderlove\">@tenderlove</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/kamipo/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/kamipo\">@kamipo</a></p>\n<p dir=\"auto\"><em>PS: English is not my native language; please excuse typing errors.</em></p>",
            "url": "https://github.com/rails/rails/pull/48139",
            "title": "Fix active record insert values of type cast and serialize",
            "date_modified": "2023-05-12T03:34:22.000Z",
            "date_published": "2023-05-05T15:28:14.000Z",
            "author": {
                "name": "OuYangJinTing",
                "url": "https://github.com/OuYangJinTing"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8878264?u=f2b36c3d2bb7d96ed8bb4009b02eba6f85bec0c1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">We are working a lot with postgresql and schemas. I noticed that the ActiveRecord does not support many options for them. I want to enable possible options while maintaining similar behavior to <code class=\"notranslate\">create_table</code> and <code class=\"notranslate\">drop_table</code></p>\n<h3 dir=\"auto\">Detail</h3>\n<ul dir=\"auto\">\n<li>Added support of <strong>IF NOT EXISTS</strong> statement in <code class=\"notranslate\">create_schema</code></li>\n<li>Added support for <code class=\"notranslate\">force: cascade</code> option in <code class=\"notranslate\">create_schema</code></li>\n<li><strong>BREAKING CHANGE</strong> Changed default behavior of <code class=\"notranslate\">drop_schema</code>\n<ul dir=\"auto\">\n<li>no longer runs <strong>CASCADE</strong> by default</li>\n<li>supports <code class=\"notranslate\">force: :cascade</code> option, similar to <code class=\"notranslate\">drop_table</code></li>\n</ul>\n</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48132",
            "title": "Postgresql improvements to create_schema and drop_schema ",
            "date_modified": "2023-05-11T22:36:39.000Z",
            "date_published": "2023-05-04T19:55:09.000Z",
            "author": {
                "name": "Adam-Stomski",
                "url": "https://github.com/Adam-Stomski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/3942920?u=b2d7cc12552ed41425f062fff196679a0d733d69&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">\"Fixes #<a href=\"https://github.com/rails/rails/issues/48077\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48077/hovercard\">48077</a>\"</p>\n<p dir=\"auto\">copy of <a href=\"https://github.com/rails/rails/pull/48078\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48078/hovercard\">PR</a> that was closed because of wrong rebase</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">When object is saved with <code class=\"notranslate\">belongs_to</code> association, that associated to object with <code class=\"notranslate\">has_one</code> relation, object actually saved   twice. For example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"class Post &lt; ActiveRecord::Base\n  belongs_to :user\n  belongs_to :poll\n\n  after_commit :test_after_commit\n  # after_save :test_after_commit saved_changes here are exists\n  after_save :test_after_save\n\n  attr_reader :after_save_counter\n\n  def test_after_commit\n    # saved_changes here are blank\n    if saved_change_to_release_stage?(to: 'published')\n      user.increment(:published_posts_count)\n    end\n  end\n\n  def test_after_save\n    # invokes twice\n    @after_save_counter ||= 0\n    @after_save_counter += 1\n  end\nend\n\nclass Poll &lt; ActiveRecord::Base\n  has_one :post\nend\n\npost = Post.new(\n  user: user,\n  title: 'yoyo',\n  release_stage: 'published'\n)\n\npost.poll = Poll.new(multiple: true)\n\npost.save\"><pre class=\"notranslate\"><code class=\"notranslate\">class Post &lt; ActiveRecord::Base\n  belongs_to :user\n  belongs_to :poll\n\n  after_commit :test_after_commit\n  # after_save :test_after_commit saved_changes here are exists\n  after_save :test_after_save\n\n  attr_reader :after_save_counter\n\n  def test_after_commit\n    # saved_changes here are blank\n    if saved_change_to_release_stage?(to: 'published')\n      user.increment(:published_posts_count)\n    end\n  end\n\n  def test_after_save\n    # invokes twice\n    @after_save_counter ||= 0\n    @after_save_counter += 1\n  end\nend\n\nclass Poll &lt; ActiveRecord::Base\n  has_one :post\nend\n\npost = Post.new(\n  user: user,\n  title: 'yoyo',\n  release_stage: 'published'\n)\n\npost.poll = Poll.new(multiple: true)\n\npost.save\n</code></pre></div>\n<p dir=\"auto\">First poll object is saved, then AR try to save post from <code class=\"notranslate\">save_has_one_association</code>, after that invokes <code class=\"notranslate\">save</code> method second time and this second <code class=\"notranslate\">save</code> call clears saved_changes.</p>\n<p dir=\"auto\">I decided to add variable that show that object already saving and prevent second save from <code class=\"notranslate\">save_has_one_association</code> callback</p>",
            "url": "https://github.com/rails/rails/pull/48130",
            "title": "Fix belongs to with has one association multiple savings",
            "date_modified": "2023-05-04T17:43:58.000Z",
            "date_published": "2023-05-04T17:19:08.000Z",
            "author": {
                "name": "briu",
                "url": "https://github.com/briu"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/260602?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the Postgres database adapter. It allows me to create models that are backed by a temporary table and use them just like regular tables. Without this change e.g. <code class=\"notranslate\">insert_all</code> and <code class=\"notranslate\">upsert_all</code> are not possible.</p>\n<h3 dir=\"auto\">Test</h3>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# frozen_string_literal: true\n\nrequire &quot;bundler/inline&quot;\n\ngemfile(true) do\n  source &quot;https://rubygems.org&quot;\n\n  git_source(:github) { |repo| &quot;https://github.com/#{repo}.git&quot; }\n\n  gem &quot;activerecord&quot;, path: './activerecord'\n  gem &quot;pg&quot;\nend\n\nrequire &quot;active_record&quot;\nrequire &quot;minitest/autorun&quot;\nrequire &quot;logger&quot;\n\nActiveRecord::Base.establish_connection(adapter: &quot;postgresql&quot;, url: &quot;postgres://localhost/rails-issue&quot;) rescue puts 'Please create a DB &quot;rails-issue&quot; yourself first'\nActiveRecord::Base.logger = Logger.new(STDOUT)\n\nclass Post &lt; ActiveRecord::Base\n  def self.with_temp_table(as:)\n    transaction do\n      connection.create_table(table_name, temporary: true, force: true, as: as)\n      yield\n    end\n  end\nend\n\nclass BugTest &lt; Minitest::Test\n  def test_upsert_in_temp_table\n\n    # Create a model backed by a temp table. Prefill the table with some data from a query.\n    Post.with_temp_table(as: &quot;select 1 as id, 'foo' as some_column&quot;) do\n      # Upserts require a unique constraint\n      Post.connection.add_index(Post.table_name, :id, unique: true)\n\n      assert_equal Post.new(id: 1, some_column: 'foo'), Post.sole\n\n      # The following line fails on master with:\n      #\n      #   ActiveRecord::StatementInvalid: PG::SyntaxError: ERROR:  syntax error at or near &quot;)&quot;\n      #   LINE 1: ...id&quot;,&quot;some_column&quot;) VALUES (1, 'bar') ON CONFLICT () DO UPDAT...\n      #\n      # The temp table, including all indices, constraints, etc are not 'seen'\n      # by Rails. The PostgreSQL adapter only considers stuff in the schemas\n      # returned by current_schemas(false). The temporary namespace\n      # 'pg_temp_xyz' is excluded.\n      #\n      # See https://www.postgresql.org/docs/15/functions-info.html\n      #\n      #   current_schemas ( include_implicit boolean ) → name[]\n      #\n      #   Returns an array of the names of all schemas presently in the\n      #   effective search path, in their priority order. (Items in the current\n      #   search_path setting that do not correspond to existing, searchable\n      #   schemas are omitted.) If the Boolean argument is true, then\n      #   implicitly-searched system schemas such as pg_catalog are included in\n      #   the result.\n      #\n      # If you include implicit tables, via current_schemas(true), the\n      # temporary table is found, but that is also true for the other system\n      # schemas that we don't want.\n      #\n      # Luckily Postgres provides a means to find the temp schema name via:\n      #\n      #   pg_my_temp_schema () → oid\n      #\n      #   Returns the OID of the current session's temporary schema, or zero if\n      #   it has none (because it has not created any temporary tables).\n      #\n      # If we add that to the search path, then temp tables work just like\n      # regular tables.\n      Post.upsert_all([{ id: 1, some_column: 'bar' }], unique_by: :id)\n\n      assert_equal Post.new(id: 1, some_column: 'bar'), Post.sole\n    end\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># frozen_string_literal: true</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"bundler/inline\"</span>\n\n<span class=\"pl-en\">gemfile</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">source</span> <span class=\"pl-s\">\"https://rubygems.org\"</span>\n\n  <span class=\"pl-en\">git_source</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:github</span><span class=\"pl-kos\">)</span> <span class=\"pl-kos\">{</span> |<span class=\"pl-s1\">repo</span>| <span class=\"pl-s\">\"https://github.com/<span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-s1\">repo</span><span class=\"pl-kos\">}</span></span>.git\"</span> <span class=\"pl-kos\">}</span>\n\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"activerecord\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">path</span>: <span class=\"pl-s\">'./activerecord'</span>\n  <span class=\"pl-en\">gem</span> <span class=\"pl-s\">\"pg\"</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_record\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"minitest/autorun\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"logger\"</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">establish_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">adapter</span>: <span class=\"pl-s\">\"postgresql\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">url</span>: <span class=\"pl-s\">\"postgres://localhost/rails-issue\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">rescue</span> <span class=\"pl-en\">puts</span> <span class=\"pl-s\">'Please create a DB \"rails-issue\" yourself first'</span>\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">logger</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Logger</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">STDOUT</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">with_temp_table</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">as</span>:<span class=\"pl-kos\">)</span>\n    <span class=\"pl-en\">transaction</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create_table</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">table_name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">temporary</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">as</span>: <span class=\"pl-s1\">as</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-k\">yield</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">BugTest</span> &lt; <span class=\"pl-v\">Minitest</span>::<span class=\"pl-v\">Test</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-en\">test_upsert_in_temp_table</span>\n\n    <span class=\"pl-c\"># Create a model backed by a temp table. Prefill the table with some data from a query.</span>\n    <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">with_temp_table</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">as</span>: <span class=\"pl-s\">\"select 1 as id, 'foo' as some_column\"</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-c\"># Upserts require a unique constraint</span>\n      <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">add_index</span><span class=\"pl-kos\">(</span><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">table_name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:id</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">unique</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">)</span>\n\n      <span class=\"pl-en\">assert_equal</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">some_column</span>: <span class=\"pl-s\">'foo'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">sole</span>\n\n      <span class=\"pl-c\"># The following line fails on master with:</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\">#   ActiveRecord::StatementInvalid: PG::SyntaxError: ERROR:  syntax error at or near \")\"</span>\n      <span class=\"pl-c\">#   LINE 1: ...id\",\"some_column\") VALUES (1, 'bar') ON CONFLICT () DO UPDAT...</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\"># The temp table, including all indices, constraints, etc are not 'seen'</span>\n      <span class=\"pl-c\"># by Rails. The PostgreSQL adapter only considers stuff in the schemas</span>\n      <span class=\"pl-c\"># returned by current_schemas(false). The temporary namespace</span>\n      <span class=\"pl-c\"># 'pg_temp_xyz' is excluded.</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\"># See https://www.postgresql.org/docs/15/functions-info.html</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\">#   current_schemas ( include_implicit boolean ) → name[]</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\">#   Returns an array of the names of all schemas presently in the</span>\n      <span class=\"pl-c\">#   effective search path, in their priority order. (Items in the current</span>\n      <span class=\"pl-c\">#   search_path setting that do not correspond to existing, searchable</span>\n      <span class=\"pl-c\">#   schemas are omitted.) If the Boolean argument is true, then</span>\n      <span class=\"pl-c\">#   implicitly-searched system schemas such as pg_catalog are included in</span>\n      <span class=\"pl-c\">#   the result.</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\"># If you include implicit tables, via current_schemas(true), the</span>\n      <span class=\"pl-c\"># temporary table is found, but that is also true for the other system</span>\n      <span class=\"pl-c\"># schemas that we don't want.</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\"># Luckily Postgres provides a means to find the temp schema name via:</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\">#   pg_my_temp_schema () → oid</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\">#   Returns the OID of the current session's temporary schema, or zero if</span>\n      <span class=\"pl-c\">#   it has none (because it has not created any temporary tables).</span>\n      <span class=\"pl-c\">#</span>\n      <span class=\"pl-c\"># If we add that to the search path, then temp tables work just like</span>\n      <span class=\"pl-c\"># regular tables.</span>\n      <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">upsert_all</span><span class=\"pl-kos\">(</span><span class=\"pl-kos\">[</span><span class=\"pl-kos\">{</span> <span class=\"pl-pds\">id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">some_column</span>: <span class=\"pl-s\">'bar'</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">]</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">unique_by</span>: <span class=\"pl-pds\">:id</span><span class=\"pl-kos\">)</span>\n\n      <span class=\"pl-en\">assert_equal</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">id</span>: <span class=\"pl-c1\">1</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">some_column</span>: <span class=\"pl-s\">'bar'</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">sole</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48117",
            "title": "Support upsert in Postgres temp tables",
            "date_modified": "2023-05-08T17:58:14.000Z",
            "date_published": "2023-05-03T09:19:29.000Z",
            "author": {
                "name": "rschellhorn",
                "url": "https://github.com/rschellhorn"
            }
        }
    ]
}