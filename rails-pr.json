{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/432189?u=506d1970ba73221b27c114e09ac18fc34a1dccc0&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"319127073\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/32776\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/32776/hovercard\" href=\"https://github.com/rails/rails/pull/32776\">#32776</a> replaced references to <code class=\"notranslate\">ActionController::TestCase</code> and <code class=\"notranslate\">ActionDispatch::IntegrationTest</code> in this file with lazy load hooks to avoid loading them prematurely, but these requires meant that they were still loaded anyway.</p>\n<p dir=\"auto\">Aside from the direct benefit of loading as little as possible until necessary, this will allow users of <a href=\"https://github.com/amatsuda/routes_lazy_routes\">https://github.com/amatsuda/routes_lazy_routes</a> to run e.g. a model test without loading the application's routes, which can reduce boot time significantly for large applications.</p>",
            "url": "https://github.com/rails/rails/pull/51150",
            "title": "Don't force controller or integration tests to load",
            "date_modified": "2024-02-21T03:57:58.000Z",
            "date_published": "2024-02-21T03:57:54.000Z",
            "author": {
                "name": "eugeneius",
                "url": "https://github.com/eugeneius"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Ref: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2088694143\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50793\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50793/hovercard\" href=\"https://github.com/rails/rails/pull/50793\">#50793</a></p>\n<p dir=\"auto\">To make not caching connection checkout viable, we need to reduced the amount of places where we need a connection.</p>\n<p dir=\"auto\">Once big source of this is query/relation building, where in many cases it eagerly quote and interpolation bound values in SQL fragments.</p>\n<p dir=\"auto\">Doing this requires an active connection because both MySQL and Postgres may quote values differently based on the connection settings.</p>\n<p dir=\"auto\">Instead of eagerly doing all this, we can instead just insert these as bound values in the Arel AST. For adapters with prepared statements this is better anyway as it will avoid leaking statements, and for those that don't support it, it will simply delay the quoting to just before the query is executed.</p>\n<p dir=\"auto\">For now now only a subset of the API is migrated over, namely the <code class=\"notranslate\">where(\"title = ?\", something)</code> form.</p>\n<p dir=\"auto\">There is also <code class=\"notranslate\">where(\"title = %s\", something)</code> that I'm afraid won't be able to be fixed and probably should be deprecated.</p>\n<p dir=\"auto\">As well as <code class=\"notranslate\">where(\"title = :title\")</code> which I think is doable in a followup.</p>\n<p dir=\"auto\">One issue I'm yet to solve is handling of come types on SQLite3, e.g.:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ActiveRecord::ConnectionAdapters::SQLite3Adapter::BindParameterTest#test_where_with_duration_for_string_column_using_bind_parameters:\nTypeError: can't cast ActiveSupport::Duration\n\nbin/test test/cases/adapters/sqlite3/bind_parameter_test.rb:42\n\nActiveRecord::ConnectionAdapters::SQLite3Adapter::BindParameterTest#test_where_with_rational_for_string_column_using_bind_parameters:\nRuntimeError: can't prepare Rational\n\nbin/test test/cases/adapters/sqlite3/bind_parameter_test.rb:37\"><pre class=\"notranslate\"><code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter::BindParameterTest#test_where_with_duration_for_string_column_using_bind_parameters:\nTypeError: can't cast ActiveSupport::Duration\n\nbin/test test/cases/adapters/sqlite3/bind_parameter_test.rb:42\n\nActiveRecord::ConnectionAdapters::SQLite3Adapter::BindParameterTest#test_where_with_rational_for_string_column_using_bind_parameters:\nRuntimeError: can't prepare Rational\n\nbin/test test/cases/adapters/sqlite3/bind_parameter_test.rb:37\n</code></pre></div>\n<p dir=\"auto\">These two tests would pass previously because the values were eagerly casted to string to be quoted, but it's very unclear to me if this was really intentional, so I need to dig a bit deeper.</p>\n<p dir=\"auto\">Also CC <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a> because I noticed <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1465878565\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46600\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/46600/hovercard\" href=\"https://github.com/rails/rails/pull/46600\">#46600</a> so it look like you were headed in this same direction? Perhaps you have some insights to share.</p>",
            "url": "https://github.com/rails/rails/pull/51139",
            "title": "Relation#where build BoundSqlLiteral rather than eagerly interpolate",
            "date_modified": "2024-02-20T15:43:07.000Z",
            "date_published": "2024-02-20T13:33:02.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/49816584?u=4918bbfadc3c8dc7e0ecb7d4cc23075ca75eef38&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because we have so many syntax sugar, like for <code class=\"notranslate\">present?</code> method we have <code class=\"notranslate\">blank?</code>, and so on, so, that's would be really nice to add opposite method for a <code class=\"notranslate\">exists?</code> instead of writing always <code class=\"notranslate\">!</code>, or using unless</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes adds just an inverted <code class=\"notranslate\">exists?</code> method called <code class=\"notranslate\">missing?</code>. So, it's really simple, but powerful change</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51138",
            "title": "Add syntax sugar as inverted exists? method",
            "date_modified": "2024-02-20T22:27:16.000Z",
            "date_published": "2024-02-20T12:58:43.000Z",
            "author": {
                "name": "loqimean",
                "url": "https://github.com/loqimean"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/90490?u=759a58d59fb3604e02b9f62a8bd1e4978be7cffd&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">A non-array column can be queried via <code class=\"notranslate\">where(name: [value1, value2])</code> which is automatically converted to <code class=\"notranslate\">name IN (value1, value2)</code> in SQL. An array column would treat that array as the value to search for, so it'd be natural to expect an array of arrays would result in an <code class=\"notranslate\">IN</code> query. Unfortunately, that wasn't the case as <code class=\"notranslate\">where(name: [[value1], [value2]])</code> would return <code class=\"notranslate\">name = {{value1}, {value2}}</code> in SQL, instead of <code class=\"notranslate\">name IN ({value1}, {value2})</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">That behavior stemmed from the fact that Active Record would force equality comparison for array columns if the value was an array. In order to allow <code class=\"notranslate\">IN</code> queries this check was change to check whether it's a <strong>one-dimensional</strong> array by checking that the first item of is not an array.</p>\n<p dir=\"auto\">After these changes the following logic applies for querying array columns:</p>\n<ol dir=\"auto\">\n<li>Using a one-dimensional array results in an ordinary equality query.</li>\n<li>Using a two-dimensional array produces an <code class=\"notranslate\">IN</code> query.</li>\n</ol>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51137",
            "title": "Support IN queries on array columns",
            "date_modified": "2024-02-20T15:02:04.000Z",
            "date_published": "2024-02-20T12:01:26.000Z",
            "author": {
                "name": "gregnavis",
                "url": "https://github.com/gregnavis"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/6406203?u=6ae5fa861bad1cec1bc5139afc2d96fcc21c5ef8&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Currently, columns that are marked for removal from the database must first be added to the <code class=\"notranslate\">ignored_columns</code> list, lest we suffer a failed deploy that requires manual intervention. This critical step can be overlooked because it's an additive change in a situation where code is typically being removed from a codebase, and trying to prevent this situation with linters and automated tests is tricky.</p>\n<p dir=\"auto\">It would be great to be able to lean in the opposite direction by explicitly defining which columns the model has access to, similar to how we define strong params. When it's time to remove a column from the db, the column name is removed from <code class=\"notranslate\">permitted_columns</code> and all of its references are removed from the model, eliminating the need to modify <code class=\"notranslate\">ignored_columns</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds <code class=\"notranslate\">permitted_columns</code> and <code class=\"notranslate\">permitted_columns=</code> to <code class=\"notranslate\">ActiveRecord::ModelSchema</code>, which acts as an inverse to <code class=\"notranslate\">ignored_columns</code>. When set, only columns specified in <code class=\"notranslate\">permitted_columns</code> will be referenced by the model.  If a column name is specified in both <code class=\"notranslate\">permitted_columns</code> and <code class=\"notranslate\">ignored_columns</code>, then it is ignored.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51136",
            "title": "Add `permitted_columns` to ActiveRecord, inverse of `ignored_columns`",
            "date_modified": "2024-02-20T22:47:45.000Z",
            "date_published": "2024-02-20T11:27:33.000Z",
            "author": {
                "name": "scottwhudson",
                "url": "https://github.com/scottwhudson"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2651240?u=d1c170b78ab342593d0ad83baee8556ed046846f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Previously enums without keywords were always mapped to integers and indexed by position, now it is converted based on the column type, it works for strings and database enums as well.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# Before\nenum status: { proposed: &quot;proposed&quot;, written: &quot;written&quot;, published: &quot;published&quot; }\n\n# After\nenum status: [:proposed, :written, :published]\"><pre class=\"notranslate\"><span class=\"pl-c\"># Before</span>\n<span class=\"pl-en\">enum</span> <span class=\"pl-pds\">status</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">proposed</span>: <span class=\"pl-s\">\"proposed\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">written</span>: <span class=\"pl-s\">\"written\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">published</span>: <span class=\"pl-s\">\"published\"</span> <span class=\"pl-kos\">}</span>\n\n<span class=\"pl-c\"># After</span>\n<span class=\"pl-en\">enum</span> <span class=\"pl-pds\">status</span>: <span class=\"pl-kos\">[</span><span class=\"pl-pds\">:proposed</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:written</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:published</span><span class=\"pl-kos\">]</span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #47278.\">closes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1573022682\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47278\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47278/hovercard\" href=\"https://github.com/rails/rails/pull/47278\">#47278</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51124",
            "title": "Map enums using array to the correct column type",
            "date_modified": "2024-02-20T21:12:30.000Z",
            "date_published": "2024-02-19T08:04:04.000Z",
            "author": {
                "name": "lazaronixon",
                "url": "https://github.com/lazaronixon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/40373?u=97283b5a00bd596840c2024f7e430ac9e41ca503&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The new AllowBrowser feature was added in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2061123087\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50505\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50505/hovercard\" href=\"https://github.com/rails/rails/pull/50505\">#50505</a> . It permits setting minimum browser versions for an application, defines and documents a <code class=\"notranslate\">:modern</code> version-set as requiring a list of certain features, and adds that option to the default config for new apps.</p>\n<p dir=\"auto\">This PR has been created to make two minor corrections to <code class=\"notranslate\">:modern</code>, one to its versions, one to its documentation.</p>\n<h3 dir=\"auto\">Detail</h3>\n<ol dir=\"auto\">\n<li>In <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/24264baeae1d57743aa87b4fcb88e55a42cc850a/hovercard\" href=\"https://github.com/rails/rails/commit/24264baeae1d57743aa87b4fcb88e55a42cc850a\"><tt>24264ba</tt></a>, adjust the <code class=\"notranslate\">:modern</code> browser versions to match the description of required features. Specifically, CSS nesting isn't supported by Chrome until 120, Opera until 106 (<a href=\"https://caniuse.com/css-nesting\" rel=\"nofollow\">1</a>, <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/Nesting_selector#browser_compatibility\" rel=\"nofollow\">2</a>).</li>\n<li>In <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/ff0291291a2c93f40c92a306f4fc3025bd8bdbc0/hovercard\" href=\"https://github.com/rails/rails/commit/ff0291291a2c93f40c92a306f4fc3025bd8bdbc0\"><tt>ff02912</tt></a>, remove badging from the documentation's list of required features, because it's still a <a href=\"https://www.w3.org/TR/badging/\" rel=\"nofollow\">spec</a> that isn't fully implemented by any current browser (<a href=\"https://caniuse.com/mdn-api_notification_badge\" rel=\"nofollow\">1</a>, <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Badging_API#browser_compatibility\" rel=\"nofollow\">2</a>).</li>\n</ol>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Personally I'm not convinced this feature will be a good default for new apps, but if it's going to be offered, it should be correct for its stated purpose.</p>\n<p dir=\"auto\">For fun, I benchmarked <code class=\"notranslate\">UserAgent.parse.browser</code> on my laptop and it runs in about 40 microseconds, which is faster than I'd expected. But the runtime <code class=\"notranslate\">require \"useragent\"</code> added 30 milliseconds to the first request.</p>\n<p dir=\"auto\">The <code class=\"notranslate\">useragent</code> gem was <a href=\"https://github.com/gshutler/useragent\">last updated</a> five years ago, and its browser recognition code is all <a href=\"https://github.com/gshutler/useragent/tree/master/lib/user_agent/browsers\">7 to 9 years old</a>. It seems inappropriate to have a <code class=\"notranslate\">:modern</code> default that doesn't recognize Edge (2015). There's a <a href=\"https://github.com/art19/useragent\">fork by art19</a> that recognizes Edge, but it adds 54 other browsers too, so it has 4x the LoC, and its <code class=\"notranslate\">require</code> is 90 milliseconds. Something in-between might be nice.</p>\n<p dir=\"auto\">I made a <a href=\"https://docs.google.com/spreadsheets/d/13hz5ndUBDeTqAKwYCv5CyAMGpcCVkc5hwJ7Is7BG0qo/edit#gid=0\" rel=\"nofollow\">google spreadsheet</a> listing browser versions that support each of the <code class=\"notranslate\">:modern</code> features listed. The tl;dr is that badges and css nesting are the most-restrictive requirement for every major browser except Firefox (which was late to support css :has).</p>",
            "url": "https://github.com/rails/rails/pull/51121",
            "title": "Fix AllowBrowser versions",
            "date_modified": "2024-02-20T17:39:15.000Z",
            "date_published": "2024-02-18T18:08:50.000Z",
            "author": {
                "name": "jamiemccarthy",
                "url": "https://github.com/jamiemccarthy"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/314453?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Specifically, <code class=\"notranslate\">.where([:id] =&gt; [])</code> is now equivalent to <code class=\"notranslate\">where(:id =&gt; [])</code>.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This behaviour fixes <code class=\"notranslate\">#collection_singular_ids=</code> for relations with composite query constraints when used in forms, as <code class=\"notranslate\">ids_writer</code> compacts blank values before looking up matching records, efectively calling <code class=\"notranslate\">.where(primary_key =&gt; [])</code> when, for example, all checkboxes were deselected by a user on a form.</p>\n<p dir=\"auto\">The error indicative of the behaviour that this commit attempts to fix: <code class=\"notranslate\">Arel::Visitors::UnsupportedVisitError: Unsupported argument type: NilClass. Construct an Arel node instead.</code></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\"><code class=\"notranslate\">#reduce</code> returns <code class=\"notranslate\">nil</code> when operating on empty collections. This commit adds a separate branch for handling an empty query set in <code class=\"notranslate\">PredicateBuilder#grouping_queries</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51116",
            "title": "Handle empty array value in query builder's tuple syntax",
            "date_modified": "2024-02-17T15:58:42.000Z",
            "date_published": "2024-02-17T15:58:38.000Z",
            "author": {
                "name": "Slotos",
                "url": "https://github.com/Slotos"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5655861?u=efbdd9ae575115738b76de2c1aae359e7631db79&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h1 dir=\"auto\">Use WEBP as the default format for representations</h1>\n<p dir=\"auto\">This pull request updates the <code class=\"notranslate\">default_variant_format</code> method in the <code class=\"notranslate\">representable.rb</code> file. Previously, the default image format was PNG. With this change, the default image format is now WEBP.</p>\n<p dir=\"auto\">This change is made to improve the performance of our web pages, as <a href=\"https://caniuse.com/webp\" rel=\"nofollow\">all major browsers support WEBP images</a>, which are generally smaller in size compared to PNG images, without any significant loss in image quality. This will help in faster loading of images and improve the overall user experience.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51115",
            "title": "Change Default Variant Format from PNG to WEBP",
            "date_modified": "2024-02-17T11:42:12.000Z",
            "date_published": "2024-02-17T10:02:14.000Z",
            "author": {
                "name": "6temes",
                "url": "https://github.com/6temes"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54629302?u=be8de5137bf940532cddd05aff823129ab8a39db&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #33155.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"333434461\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/33155\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/33155/hovercard\" href=\"https://github.com/rails/rails/issues/33155\">#33155</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Updates <code class=\"notranslate\">#load_target</code> in <code class=\"notranslate\">ActiveRecord::Associations::CollectionAssociation</code> and <code class=\"notranslate\">ActiveRecord::Associations::Association</code> (which is inherited by <code class=\"notranslate\">ActiveRecord::Associations::SingularAssociation</code>) to set the through association target using the middle record when the current record has not yet been persisted.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">I usually include coverage before opening a PR but I'd like some initial feedback on this before I do that given that it's a change to a core part of AR and I'm not certain that a patch will be accepted for this issue. However, I've got <a href=\"https://github.com/rails/rails/issues/33155#issuecomment-1949912960\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/33155/hovercard\">a reproduction script</a> which passes against this branch.</p>\n<p dir=\"auto\">There also seems to have been <a href=\"https://github.com/rails/rails/pull/38562\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/38562/hovercard\">another attempted patch</a> which didn't end up getting merged.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51114",
            "title": "[Fix #33155] Set through target for new records",
            "date_modified": "2024-02-17T12:05:15.000Z",
            "date_published": "2024-02-17T09:15:40.000Z",
            "author": {
                "name": "joshuay03",
                "url": "https://github.com/joshuay03"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1398?u=c811c584ad0578eb4902088362067bb4c98cff93&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">While <code class=\"notranslate\">fields_for</code> currently accepts a lambda as an argument for <code class=\"notranslate\">child_index</code>, that lambda is called without any arguments. Being that we are enumerating the association on <code class=\"notranslate\">fields_for</code> at the time the lambda is called, we have an opportunity to pass the child of the association down to the lambda.  This could simplify the case where you may want to use the <code class=\"notranslate\">id</code> of an Active Record object as the index.  So with this change you could do something like this:</p>\n<div class=\"highlight highlight-text-html-erb notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"&lt;%= author_form.fields_for :books, child_index: -&gt;(book) { book.id } do |book_form| %&gt;\n  &lt;%= book_form.text_field :name %&gt;\n&lt;% end %&gt;\"><pre class=\"notranslate\"><span class=\"pl-k\">&lt;%=</span> author_form.fields_for :books, child_index: -&gt;(book) { book.id } do |book_form| <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">  &lt;%=</span> book_form.text_field :name <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">&lt;%</span> end <span class=\"pl-k\">%&gt;</span><span class=\"pl-en\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-kos\"></span><span class=\"pl-pds\"></span><span class=\"pl-c1\"></span><span class=\"pl-kos\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-kos\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-kos\"></span><span class=\"pl-k\"></span><span class=\"pl-s1\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-k\"></span></pre></div>\n<p dir=\"auto\">Prior to this, you would have had to enumerate the association yourself:</p>\n<div class=\"highlight highlight-text-html-erb notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"&lt;% author.books.each do |book| %&gt;\n  &lt;%= author_form.fields_for :books, book, child_index: book.id do |book_form| %&gt;\n    &lt;%= book_form.text_field :name %&gt;\n  &lt;% end %&gt;\n&lt;% end %&gt;\"><pre class=\"notranslate\"><span class=\"pl-k\">&lt;%</span> author.books.each do |book| <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">  &lt;%=</span> author_form.fields_for :books, book, child_index: book.id do |book_form| <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">    &lt;%=</span> book_form.text_field :name <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">  &lt;%</span> end <span class=\"pl-k\">%&gt;</span><span class=\"pl-k\"></span>\n<span class=\"pl-k\">&lt;%</span> end <span class=\"pl-k\">%&gt;</span><span class=\"pl-en\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-k\"></span><span class=\"pl-s1\"></span><span class=\"pl-en\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-kos\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-pds\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-k\"></span><span class=\"pl-s1\"></span><span class=\"pl-s1\"></span><span class=\"pl-kos\"></span><span class=\"pl-en\"></span><span class=\"pl-pds\"></span><span class=\"pl-k\"></span><span class=\"pl-k\"></span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Accepts passing the association's child as an argument in a lambda as the <code class=\"notranslate\">child_index</code> option in <code class=\"notranslate\">fields_for</code>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Used <a href=\"https://github.com/rails/rails/pull/19661\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/19661/hovercard\">PR 19661</a> as a guide when passing a lambda to <code class=\"notranslate\">child_index</code> was originally introduced.</p>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51110",
            "title": "Accept a `child_index` lambda on `fields_for` with an argument",
            "date_modified": "2024-02-16T21:47:33.000Z",
            "date_published": "2024-02-16T20:19:57.000Z",
            "author": {
                "name": "keegnotrub",
                "url": "https://github.com/keegnotrub"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">When using sharding and the <code class=\"notranslate\">test</code> primary config is named differently than <code class=\"notranslate\">development</code> primary config, like</p>\n<div class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"development:\n  primary: # can be any name, not necessary 'primary'\n    adapter: sqlite3\n    database: dev_db\n  secondary:\n    adapter: sqlite3\n    database: secondary_dev_db\n    schema_dump: false\ntest:\n  primary_test: # note the different name\n    adapter: sqlite3\n    database: test_db\n  secondary_test:\n    adapter: sqlite3\n    database: secondary_test_db\n    schema_dump: false\"><pre class=\"notranslate\"><span class=\"pl-ent\">development</span>:\n  <span class=\"pl-ent\">primary</span>: <span class=\"pl-c\"><span class=\"pl-c\">#</span> can be any name, not necessary 'primary'</span>\n    <span class=\"pl-ent\">adapter</span>: <span class=\"pl-s\">sqlite3</span>\n    <span class=\"pl-ent\">database</span>: <span class=\"pl-s\">dev_db</span>\n  <span class=\"pl-ent\">secondary</span>:\n    <span class=\"pl-ent\">adapter</span>: <span class=\"pl-s\">sqlite3</span>\n    <span class=\"pl-ent\">database</span>: <span class=\"pl-s\">secondary_dev_db</span>\n    <span class=\"pl-ent\">schema_dump</span>: <span class=\"pl-c1\">false</span>\n<span class=\"pl-ent\">test</span>:\n  <span class=\"pl-ent\">primary_test</span>: <span class=\"pl-c\"><span class=\"pl-c\">#</span> note the different name</span>\n    <span class=\"pl-ent\">adapter</span>: <span class=\"pl-s\">sqlite3</span>\n    <span class=\"pl-ent\">database</span>: <span class=\"pl-s\">test_db</span>\n  <span class=\"pl-ent\">secondary_test</span>:\n    <span class=\"pl-ent\">adapter</span>: <span class=\"pl-s\">sqlite3</span>\n    <span class=\"pl-ent\">database</span>: <span class=\"pl-s\">secondary_test_db</span>\n    <span class=\"pl-ent\">schema_dump</span>: <span class=\"pl-c1\">false</span></pre></div>\n<p dir=\"auto\">rails is unable to use the default <code class=\"notranslate\">schema.rb</code> file when running <code class=\"notranslate\">rails db:test:prepare</code>. It generates the following error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"app/db/shard_one_test_schema.rb doesn't exist yet. Run `bin/rails db:migrate` to create it, then try again. \nIf you do not intend to use a database, you should instead alter app/config/application.rb to limit the \nframeworks that will be loaded.\"><pre class=\"notranslate\"><code class=\"notranslate\">app/db/shard_one_test_schema.rb doesn't exist yet. Run `bin/rails db:migrate` to create it, then try again. \nIf you do not intend to use a database, you should instead alter app/config/application.rb to limit the \nframeworks that will be loaded.\n</code></pre></div>\n<p dir=\"auto\">When they both are named the same, rails just \"erroneously\" uses the one from the <code class=\"notranslate\">development</code> configuration and it succeeds.</p>",
            "url": "https://github.com/rails/rails/pull/51103",
            "title": "Fix `db:test:prepare` when using sharding and test primary config is named differently than development primary config",
            "date_modified": "2024-02-17T09:54:51.000Z",
            "date_published": "2024-02-16T14:33:04.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/509837?u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1870707368\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49072\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49072/hovercard\" href=\"https://github.com/rails/rails/pull/49072\">#49072</a> allowed you to turn <code class=\"notranslate\">support_unencrypted_data</code> on a global level, then turn it off for specific attributes. But it didn't allow the inverse: you couldn't turn the config off globally, and then turn it on for a specific attribute.</p>\n<p dir=\"auto\">This PR adds support for that, which should make the setting's behaviour less surprising.</p>",
            "url": "https://github.com/rails/rails/pull/51100",
            "title": "Encryption: allow turning on `support_unencrypted_data` at a per-attribute level",
            "date_modified": "2024-02-16T05:59:34.000Z",
            "date_published": "2024-02-16T05:58:33.000Z",
            "author": {
                "name": "ghiculescu",
                "url": "https://github.com/ghiculescu"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/809410?u=d89171dbae587727d4f61de8d128c02f16269174&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I encountered an issue that <code class=\"notranslate\">:race_condition_ttl</code> can still suffer from dog pile effect in the use case of high intense services because during the period of extending expiration time, other process can still access the same entry and try to regenerate the cache at the same time.</p>\n<p dir=\"auto\">While searching for solutions, I realized probabilistic early expiration approach might be a simpler and more efficient solution. It is a technique to avoid the dog pile effect (aka cache stampede) by expiring the cache before the TTL.</p>\n<p dir=\"auto\">I implemented this method based on the paper<sup><a href=\"#user-content-fn-1-9c3c00b255024b8df804441715732adb\" id=\"user-content-fnref-1-9c3c00b255024b8df804441715732adb\" data-footnote-ref=\"\" aria-describedby=\"footnote-label\">1</a></sup> which uses probabilistic decision with the exponential function <code class=\"notranslate\">Exp(λ)</code> and demonstrates to be optimal.</p>\n<h3 dir=\"auto\">Detail</h3>\n<ol dir=\"auto\">\n<li>Add new option <code class=\"notranslate\">early_expiration</code> to <code class=\"notranslate\">ActiveSupport::Cache::Store#fetch</code>.</li>\n<li>Add new method <code class=\"notranslate\">ActiveSupport::Cache::Entry#should_expire_early?(beta: 1)</code>.</li>\n<li>Add new instance variable <code class=\"notranslate\">@generation_time</code> to <code class=\"notranslate\">ActiveSupport::Cache::Entry</code>.</li>\n</ol>\n<p dir=\"auto\">Here is a simple implementation to illustrate the approach:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"def x_fetch(key, ttl, beta = 1)\n  value, delta, expiry = read(key)\n  if value.nil? || Time.now − delta * beta * Math.log(rand) ≥ expiry\n    start = Time.now\n    value = yield\n    delta = Time.now – start\n    write(key, value, delta, ttl)\n  end\n  return value\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">def</span> <span class=\"pl-en\">x_fetch</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">ttl</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">beta</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">1</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-s1\">value</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">delta</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">expiry</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">read</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">key</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">if</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">nil?</span> || <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span><span class=\"pl-kos\"></span> <span class=\"pl-en\">−</span> <span class=\"pl-s1\">delta</span> * <span class=\"pl-s1\">beta</span> * <span class=\"pl-v\">Math</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">log</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">rand</span><span class=\"pl-kos\">)</span> <span class=\"pl-en\">≥</span> <span class=\"pl-s1\">expiry</span>\n    <span class=\"pl-s1\">start</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span>\n    <span class=\"pl-s1\">value</span> <span class=\"pl-c1\">=</span> <span class=\"pl-k\">yield</span>\n    <span class=\"pl-s1\">delta</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">Time</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">now</span> <span class=\"pl-en\">–</span> <span class=\"pl-s1\">start</span>\n    <span class=\"pl-en\">write</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">key</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">delta</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">ttl</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">return</span> <span class=\"pl-s1\">value</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I created a stacked histogram comparing the stampede sizes between <code class=\"notranslate\">:race_condition_ttl</code> (fetch) and <code class=\"notranslate\">:early_expiration</code> (x_fetch):</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/809410/305307854-01dc5a69-4206-458e-ad76-c52637f9f00b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDg0ODgzOTgsIm5iZiI6MTcwODQ4ODA5OCwicGF0aCI6Ii84MDk0MTAvMzA1MzA3ODU0LTAxZGM1YTY5LTQyMDYtNDU4ZS1hZDc2LWM1MjYzN2Y5ZjAwYi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwMjIxJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDIyMVQwNDAxMzhaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0yZmYxNGRiY2VkZjZmZDE1MzFhODkxZDI0NzA2ZWQ0ZjRiMWMwZjViMGFjNzAwZGNmMzQyMjViY2YxMzkzNTE3JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.Zj_a2ikaBZc6w6W9rIip4Hm3gVjbEgEz9sCiWwYjxgs\"><img src=\"https://private-user-images.githubusercontent.com/809410/305307854-01dc5a69-4206-458e-ad76-c52637f9f00b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDg0ODgzOTgsIm5iZiI6MTcwODQ4ODA5OCwicGF0aCI6Ii84MDk0MTAvMzA1MzA3ODU0LTAxZGM1YTY5LTQyMDYtNDU4ZS1hZDc2LWM1MjYzN2Y5ZjAwYi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwMjIxJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDIyMVQwNDAxMzhaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0yZmYxNGRiY2VkZjZmZDE1MzFhODkxZDI0NzA2ZWQ0ZjRiMWMwZjViMGFjNzAwZGNmMzQyMjViY2YxMzkzNTE3JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.Zj_a2ikaBZc6w6W9rIip4Hm3gVjbEgEz9sCiWwYjxgs\" alt=\"800k_histogram\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">As the histogram shows, <code class=\"notranslate\">:early_expiration</code> has smaller stampede size compared to <code class=\"notranslate\">:race_condition_ttl</code>.</p>\n<p dir=\"auto\">For the definition of \"the stampede sizes\", please refer to <a href=\"https://cseweb.ucsd.edu/~avattani/papers/cache_stampede.pdf\" rel=\"nofollow\">the paper</a>.</p>\n<p dir=\"auto\">Note that the benchmark is generated using 16 threads. The difference could be more significant with higher number of threads.</p>\n<p dir=\"auto\">For more information, please refer to the <a href=\"https://github.com/tonytonyjan/rails_cache_stampede_benchmark\">benchmark repository</a>.</p>\n<p dir=\"auto\">The benchmark repository: <a href=\"https://github.com/tonytonyjan/rails_cache_stampede_benchmark\">https://github.com/tonytonyjan/rails_cache_stampede_benchmark</a><br>\nThe paper: <a href=\"https://cseweb.ucsd.edu/~avattani/papers/cache_stampede.pdf\" rel=\"nofollow\">https://cseweb.ucsd.edu/~avattani/papers/cache_stampede.pdf</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<section data-footnotes=\"\" class=\"footnotes\"><h2 id=\"footnote-label\" class=\"sr-only\" dir=\"auto\">Footnotes</h2>\n<ol dir=\"auto\">\n<li id=\"user-content-fn-1-9c3c00b255024b8df804441715732adb\">\n<p dir=\"auto\"><a href=\"https://cseweb.ucsd.edu/~avattani/papers/cache_stampede.pdf\">Vattani, A.; Chierichetti, F.; Lowenstein, K. (2015), Optimal Probabilistic Cache Stampede Prevention, Proceedings of the VLDB Endowment, VLDB</a> <a href=\"#user-content-fnref-1-9c3c00b255024b8df804441715732adb\" data-footnote-backref=\"\" aria-label=\"Back to reference 1\" class=\"data-footnote-backref\">↩</a></p>\n</li>\n</ol>\n</section>",
            "url": "https://github.com/rails/rails/pull/51099",
            "title": "Add a new option `early_expiration` to `ActiveSupport::Cache::Store#fetch` to avoid dog pile effect",
            "date_modified": "2024-02-17T12:13:37.000Z",
            "date_published": "2024-02-16T05:09:34.000Z",
            "author": {
                "name": "tonytonyjan",
                "url": "https://github.com/tonytonyjan"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8122246?u=2dbe607a66a7616297b78647eeb4e0dbff657c3a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">ActiveSupport::LocalCache::Middleware</code> clears the local cache after each requests, but when using the <code class=\"notranslate\">with_local_cache</code> method, this could be counter intuitive as this method is supposed to use a local cache for the duration of the block:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Rails.cache.with_local_cache do\n  get &quot;/&quot; \n  # Before this patch: Cache is cleared here\nend\n# After this patch: Cache is cleared here\"><pre class=\"notranslate\"><span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">cache</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">with_local_cache</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">get</span> <span class=\"pl-s\">\"/\"</span> \n  <span class=\"pl-c\"># Before this patch: Cache is cleared here</span>\n<span class=\"pl-k\">end</span>\n<span class=\"pl-c\"># After this patch: Cache is cleared here</span></pre></div>\n<p dir=\"auto\">Asserting on the state of the cache in an integration test isn't possible (by default in test environment the store is a NullStore), unless the cache strategy is temporary changed.<br>\nThis patch makes it easier to check the cache after a request but also allow make subsequent requests to hit the cache.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Rails.cache.with_local_cache\n  get &quot;/&quot;\n  get &quot;/&quot;\n  assert_no_cache_miss\nend\"><pre class=\"notranslate\"><span class=\"pl-v\">Rails</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">cache</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">with_local_cache</span>\n  <span class=\"pl-en\">get</span> <span class=\"pl-s\">\"/\"</span>\n  <span class=\"pl-en\">get</span> <span class=\"pl-s\">\"/\"</span>\n  <span class=\"pl-en\">assert_no_cache_miss</span>\n<span class=\"pl-en\">end</span></pre></div>\n<p dir=\"auto\">This Pull Request has been created because [REPLACE ME]</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51098",
            "title": "Don't clear the local cache on each requests with `with_local_cache`:",
            "date_modified": "2024-02-15T23:39:06.000Z",
            "date_published": "2024-02-15T23:38:21.000Z",
            "author": {
                "name": "Edouard-chin",
                "url": "https://github.com/Edouard-chin"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54629302?u=be8de5137bf940532cddd05aff823129ab8a39db&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #51095.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2135927044\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51095\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51095/hovercard\" href=\"https://github.com/rails/rails/issues/51095\">#51095</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Updates the error page displayed when a view template is missing to account for nested controller paths in the suggested correct path for the missing template.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">Testing steps: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2135927044\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51095\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51095/hovercard?comment_id=1945603654&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/issues/51095#issuecomment-1945603654\">#51095 (comment)</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51096",
            "title": "[Fix #51095] Missing template error page showing incorrect view path example for nested controller path",
            "date_modified": "2024-02-19T05:14:37.000Z",
            "date_published": "2024-02-15T08:37:46.000Z",
            "author": {
                "name": "joshuay03",
                "url": "https://github.com/joshuay03"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><del>Debugging why a CI job get stuck is particularly painful as the output doesn't contain any information whatsoever.</del></p>\n<p dir=\"auto\"><del>By enabling <code class=\"notranslate\">--verbose</code> we ensure the last line of the CI job is the name of the test that got stuck, helping debug.</del></p>\n<p dir=\"auto\">Similarly, it's hard to figure out why a particular job is slow, so enabling <code class=\"notranslate\">--profile</code> would make it easy to spot some low hanging fruits to improve CI speed.</p>\n<p dir=\"auto\">Edit: <code class=\"notranslate\">--verbose</code> is a bit too much, so leaving it out for now.</p>",
            "url": "https://github.com/rails/rails/pull/51080",
            "title": "Run tests with `--profile` on CI",
            "date_modified": "2024-02-14T21:57:13.000Z",
            "date_published": "2024-02-14T10:30:08.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/60958871?u=6bb040ef46f49caf975a7d884ff0951b56134008&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><strong>Motivation / Background</strong></p>\n<p dir=\"auto\">Currently, the <code class=\"notranslate\">where.associated</code> method in Rails only allows filtering associated records with an <code class=\"notranslate\">inner join</code>, which can potentially override existing join types in the query. The fix ensures that the association is joined using the appropriate join type (either inner join or left outer join) based on the existing joins in the scope. This prevents unintentional overrides of existing join types and ensures consistency in the generated SQL queries.</p>\n<p dir=\"auto\">Example:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\" User.left_outer_joins(:orders).where.associated(:orders).count\"><pre class=\"notranslate\"> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">left_outer_joins</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:orders</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">associated</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:orders</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">count</span></pre></div>\n<p dir=\"auto\">Old query</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"SELECT COUNT(*) FROM &quot;users&quot; INNER JOIN &quot;orders&quot; ON &quot;orders&quot;.&quot;user_id&quot; = &quot;users&quot;.&quot;id&quot; WHERE &quot;orders&quot;.&quot;id&quot; IS NOT NULL\"><pre class=\"notranslate\"><span class=\"pl-k\">SELECT</span> <span class=\"pl-c1\">COUNT</span>(<span class=\"pl-k\">*</span>) <span class=\"pl-k\">FROM</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">INNER JOIN</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>orders<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">ON</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>orders<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>user_id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">WHERE</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>orders<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">IS NOT NULL</span></pre></div>\n<p dir=\"auto\">after fixing the issue, the query:<br>\nNew Query</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"SELECT COUNT(*) FROM &quot;users&quot; LEFT OUTER JOIN &quot;orders&quot; ON &quot;orders&quot;.&quot;user_id&quot; = &quot;users&quot;.&quot;id&quot; WHERE &quot;orders&quot;.&quot;id&quot; IS NOT NULL\"><pre class=\"notranslate\"><span class=\"pl-k\">SELECT</span> <span class=\"pl-c1\">COUNT</span>(<span class=\"pl-k\">*</span>) <span class=\"pl-k\">FROM</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">LEFT OUTER JOIN</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>orders<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">ON</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>orders<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>user_id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">=</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>users<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">WHERE</span> <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>orders<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>id<span class=\"pl-pds\">\"</span></span> <span class=\"pl-k\">IS NOT NULL</span></pre></div>\n<p dir=\"auto\">This enhancement empowers developers with greater flexibility in querying associated data, facilitating scenarios such as:</p>\n<ul dir=\"auto\">\n<li>Retrieving posts with authors, even if some posts lack an assigned author (utilizing left_joins).</li>\n<li>Obtaining comments associated with specific users, encompassing orphaned comments without a user (employing multiple joins with varied types).</li>\n</ul>\n<p dir=\"auto\"><strong>Detail</strong></p>\n<p dir=\"auto\">The pivotal improvement in this Pull Request is the inclusion of a check ensuring that associations are joined using the appropriate join type (either inner join or left outer join) based on existing joins within the scope. This safeguards against unintentional overrides of existing join types and fosters consistency in the generated SQL queries.</p>\n<p dir=\"auto\"><strong>Additional Information</strong></p>\n<p dir=\"auto\">This refinement is informed by common requirements articulated by Rails developers in various forums and discussions. Analogous functionality is prevalent in certain popular ORM extensions, underscoring its utility. The implementation is crafted to preserve clarity and coherence within the existing codebase.</p>\n<p dir=\"auto\">Note: This is a draft description and should be adapted to your specific implementation details and the project's context.</p>\n<p dir=\"auto\">FYI: After merging this PR, I will check the <code class=\"notranslate\">missing</code> method and fix this issue in a separate PR alternative same PR.</p>\n<p dir=\"auto\"><strong>Performance:</strong></p>\n<ul dir=\"auto\">\n<li>Benchmark Before the fix:</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Benchmark.ips do |x| \n  x.report('joins') { User.joins(:comments, :orders).where.associated(:orders) }\n  x.report('left_joins') { User.left_joins(:comments, :orders).where.associated(:orders) }\n  x.report('left_outer_joins') { User.left_outer_joins(:comments, :orders).where.associated(:orders) }\n  x.report('with out joins') { User.where.associated(:orders) }\nend\"><pre class=\"notranslate\"><code class=\"notranslate\">Benchmark.ips do |x| \n  x.report('joins') { User.joins(:comments, :orders).where.associated(:orders) }\n  x.report('left_joins') { User.left_joins(:comments, :orders).where.associated(:orders) }\n  x.report('left_outer_joins') { User.left_outer_joins(:comments, :orders).where.associated(:orders) }\n  x.report('with out joins') { User.where.associated(:orders) }\nend\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Warming up --------------------------------------\n  joins                        3.260k i/100ms\n  left_joins                3.261k i/100ms\n  left_outer_joins     3.234k i/100ms\n  with out joins         3.518k i/100ms\nCalculating -------------------------------------\n  joins                         32.610k (± 0.7%) i/s -    166.260k in   5.098730s\n  left_joins                 32.240k (± 1.1%) i/s -    163.050k in   5.058117s\n  left_outer_joins      32.395k (± 0.5%) i/s -    164.934k in   5.091447s\n  with out joins          35.337k (± 0.6%) i/s -    179.418k in   5.077489s\"><pre lang=\"info\" class=\"notranslate\"><code class=\"notranslate\">Warming up --------------------------------------\n  joins                        3.260k i/100ms\n  left_joins                3.261k i/100ms\n  left_outer_joins     3.234k i/100ms\n  with out joins         3.518k i/100ms\nCalculating -------------------------------------\n  joins                         32.610k (± 0.7%) i/s -    166.260k in   5.098730s\n  left_joins                 32.240k (± 1.1%) i/s -    163.050k in   5.058117s\n  left_outer_joins      32.395k (± 0.5%) i/s -    164.934k in   5.091447s\n  with out joins          35.337k (± 0.6%) i/s -    179.418k in   5.077489s\n</code></pre></div>\n<ul dir=\"auto\">\n<li>Benchmark After the fix:</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Benchmark.ips do |x| \n  x.report('joins') { User.joins(:comments, :orders).where.associated(:orders) }\n  x.report('left_joins') { User.left_joins(:comments, :orders).where.associated(:orders) }\n  x.report('left_outer_joins') { User.left_outer_joins(:comments, :orders).where.associated(:orders) }\n  x.report('with out joins') { User.where.associated(:orders) }\nend\n\"><pre class=\"notranslate\"><code class=\"notranslate\">Benchmark.ips do |x| \n  x.report('joins') { User.joins(:comments, :orders).where.associated(:orders) }\n  x.report('left_joins') { User.left_joins(:comments, :orders).where.associated(:orders) }\n  x.report('left_outer_joins') { User.left_outer_joins(:comments, :orders).where.associated(:orders) }\n  x.report('with out joins') { User.where.associated(:orders) }\nend\n\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Warming up --------------------------------------\n  joins                          3.278k i/100ms\n  left_joins                  3.264k i/100ms\n  left_outer_joins       3.245k i/100ms\n  with out joins           3.434k i/100ms\nCalculating -------------------------------------\n  joins                           31.688k (± 3.8%) i/s -    160.622k in   5.076856s\n  left_joins                   32.432k (± 1.1%) i/s -    163.200k in   5.032760s\n  left_outer_joins        32.398k (± 1.4%) i/s -    162.250k in   5.009054s\n  with out joins            34.698k (± 1.3%) i/s -    175.134k in   5.048274s\"><pre class=\"notranslate\"><code class=\"notranslate\">Warming up --------------------------------------\n  joins                          3.278k i/100ms\n  left_joins                  3.264k i/100ms\n  left_outer_joins       3.245k i/100ms\n  with out joins           3.434k i/100ms\nCalculating -------------------------------------\n  joins                           31.688k (± 3.8%) i/s -    160.622k in   5.076856s\n  left_joins                   32.432k (± 1.1%) i/s -    163.200k in   5.032760s\n  left_outer_joins        32.398k (± 1.4%) i/s -    162.250k in   5.009054s\n  with out joins            34.698k (± 1.3%) i/s -    175.134k in   5.048274s\n</code></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51078",
            "title": "Fix override existing join types in the query in the `where.associated` method",
            "date_modified": "2024-02-20T23:43:52.000Z",
            "date_published": "2024-02-14T06:16:01.000Z",
            "author": {
                "name": "saleh-alhaddad",
                "url": "https://github.com/saleh-alhaddad"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8813886?u=ee98f4955f20293ff922bdc55d7ee1945e365fcb&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Solving <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2132791988\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51067\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51067/hovercard\" href=\"https://github.com/rails/rails/issues/51067\">#51067</a></p>\n<p dir=\"auto\">I'm only familiar with writing rails tests in rspec, I wrote a test after skimming the other syntax in the file but please let me know if there is a better way. <code class=\"notranslate\">record.reload</code> should raise an exception if the record was deleted by <code class=\"notranslate\">create_table</code> dropping the table.</p>\n<div class=\"markdown-alert markdown-alert-note\" dir=\"auto\"><p class=\"markdown-alert-title\" dir=\"auto\"><svg class=\"octicon octicon-info mr-2\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path d=\"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z\"></path></svg>Note</p><p dir=\"auto\">Currently limited to a web editor so I don't have the ability to squash commits or run the full test suite, will try to grab some time to clean up the branch and validate tests when my personal machine is accessible</p>\n</div>\n\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2132791988\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51067\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51067/hovercard\" href=\"https://github.com/rails/rails/issues/51067\">#51067</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes <code class=\"notranslate\">create_table</code> to ignore the <code class=\"notranslate\">force</code> option (which drops the table) if the <code class=\"notranslate\">if_not_exists</code> option is present</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">If you copy a <code class=\"notranslate\">create_table</code> migration from a schema dump and add the <code class=\"notranslate\">if_not_exists</code> guard but forget to remove <code class=\"notranslate\">force</code>, it will drop your table when you migrate it.</p>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51071",
            "title": "Fix #51067 create_table if_not_exists guard S prevent force drop_table",
            "date_modified": "2024-02-14T16:40:57.000Z",
            "date_published": "2024-02-13T18:20:19.000Z",
            "author": {
                "name": "allisonphillips",
                "url": "https://github.com/allisonphillips"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/7265?u=4e4b392ac516396a83c93a4777886c7690a9b332&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">With a bi-directional has one through association, where the join model belongs to each parent with <code class=\"notranslate\">dependent: :destroy</code>, destroying either parent should destroy the through record and the other parent.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"class Left &lt; ActiveRecord::Base\n  has_one :middle, dependent: :destroy\n  has_one :right, through: :middle\nend\n\nclass Middle &lt; ActiveRecord::Base\n  belongs_to :left, dependent: :destroy\n  belongs_to :right, dependent: :destroy\nend\n\nclass Right &lt; ActiveRecord::Base\n  has_one :middle, dependent: :destroy\n  has_one :left, through: :middle\nend\"><pre class=\"notranslate\"><code class=\"notranslate\">class Left &lt; ActiveRecord::Base\n  has_one :middle, dependent: :destroy\n  has_one :right, through: :middle\nend\n\nclass Middle &lt; ActiveRecord::Base\n  belongs_to :left, dependent: :destroy\n  belongs_to :right, dependent: :destroy\nend\n\nclass Right &lt; ActiveRecord::Base\n  has_one :middle, dependent: :destroy\n  has_one :left, through: :middle\nend\n</code></pre></div>\n<p dir=\"auto\">However this only worked from one end.  When destroying the \"non-working\" end, the join model was correctly destroyed but the other end was not.</p>\n<p dir=\"auto\">In the example above:</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">right.destroy</code> correctly destroys its <code class=\"notranslate\">middle</code> and its <code class=\"notranslate\">left</code>;</li>\n<li><code class=\"notranslate\">left.destroy</code> destroys its <code class=\"notranslate\">middle</code> but not its <code class=\"notranslate\">right</code>.</li>\n</ul>\n<p dir=\"auto\">The end which worked depended on the order of <code class=\"notranslate\">belongs_to</code> statements in the join model.</p>\n<p dir=\"auto\">This commit ensures that the no matter which end you destroy, the far end is destroyed (along with the join record).</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #50948.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2114571381\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50948\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/50948/hovercard\" href=\"https://github.com/rails/rails/issues/50948\">#50948</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51066",
            "title": "Fix bi-directional destroying of has_one :through",
            "date_modified": "2024-02-14T19:18:44.000Z",
            "date_published": "2024-02-13T16:52:49.000Z",
            "author": {
                "name": "airblade",
                "url": "https://github.com/airblade"
            }
        }
    ]
}