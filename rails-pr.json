{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/11493?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This patch simply removes unnecessary <code class=\"notranslate\">gem</code> activations of minitest.</p>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">minitest used to be a CRuby's stdlib from Rubies <code class=\"notranslate\">&gt;= 1.9.1</code> to <code class=\"notranslate\">&lt; 2.2.0</code>.<br>\nAnd the <code class=\"notranslate\">gem 'minitest'</code> call in the Rails codebase was added at <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/6f74d36c4263a6cbbc6dc32a03edeed04faefbd9/hovercard\" href=\"https://github.com/rails/rails/commit/6f74d36c4263a6cbbc6dc32a03edeed04faefbd9\"><tt>6f74d36</tt></a> because at that time <code class=\"notranslate\">require 'minitest'</code> could load either a gem version or the stdlib one, and we wanted to make sure not to load the stdlib minitest.</p>\n<p dir=\"auto\">2.years.since then, CRuby's bundled minitest had been removed in 2.2.0 at <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/ruby/ruby/commit/7cda8222ca6fa109e531705579164f56f29f8068/hovercard\" href=\"https://github.com/ruby/ruby/commit/7cda8222ca6fa109e531705579164f56f29f8068\">ruby/ruby@<tt>7cda822</tt></a><br>\nand now that Ruby &lt; 2.2 is no longer supported in Rails 7, we can just safely drop this <code class=\"notranslate\">gem \"minitest\"</code> call in favor of simple <code class=\"notranslate\">require</code> that is already written there.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48544",
            "title": "Get rid of unnecessary `gem \"minitest\"` calls",
            "date_modified": "2023-06-21T11:24:13.000Z",
            "date_published": "2023-06-21T11:24:09.000Z",
            "author": {
                "name": "amatsuda",
                "url": "https://github.com/amatsuda"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/509837?u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">ref: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1757611245\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48477\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48477/hovercard\" href=\"https://github.com/rails/rails/issues/48477\">#48477</a></p>\n<p dir=\"auto\">Using forms inside emails is not common, but it's possible, and it's also possible to share views between controllers and mailers. Currently if a controller sets a <code class=\"notranslate\">default_form_builder</code> that's different from the global config, mailers that use the same views will not default to the same <code class=\"notranslate\">FormBuilder</code>. To fix this, this PR adds a <code class=\"notranslate\">default_form_builder</code> method for mailers that does the same thing as its controller sibling.</p>",
            "url": "https://github.com/rails/rails/pull/48542",
            "title": "Introduce `ActionMailer::FormBuilder`",
            "date_modified": "2023-06-21T08:20:47.000Z",
            "date_published": "2023-06-21T08:18:50.000Z",
            "author": {
                "name": "ghiculescu",
                "url": "https://github.com/ghiculescu"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/28561?u=095779352a57f75e734987829f3f67a10e5780ed&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">GlobalID is a dependency of Active Job and Action Text. It adds <code class=\"notranslate\">to_gid</code> and <code class=\"notranslate\">to_sgid</code> methods to Active Model and Active Record classes.</p>\n<p dir=\"auto\">Trying to find the documentation of these methods can be confusing as they are not present in the API docs.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">By symlinking the globalid gem from the Gemfile we can include it in the API documentation. After the <code class=\"notranslate\">rdoc</code> task has run we can remove the symlink. I'd prefer to remove to symlink in an <code class=\"notranslate\">ensure</code> block but that doesn't seem to be supported by Rake.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This could also be used to add all the <code class=\"notranslate\">turbo-rails</code> methods to the API docs, like <code class=\"notranslate\"> broadcast_append_to</code>  and <code class=\"notranslate\">turbo_stream_from</code> (that is used in video demo on <a href=\"https://rubyonrails.org/\" rel=\"nofollow\">https://rubyonrails.org/</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48541",
            "title": "Add GlobalID to the API docs",
            "date_modified": "2023-06-21T06:36:55.000Z",
            "date_published": "2023-06-21T06:29:25.000Z",
            "author": {
                "name": "p8",
                "url": "https://github.com/p8"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/100725?u=43e1f20c541088357f0cfc80d80063299892e394&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">I've tested Rails 7.1 Dockerfile template in Rails 7.0 app with MRSK on GitHub Actions and found that a bit more optimization can be applied.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds minor optimization to dockerignore template.</p>\n<p dir=\"auto\">During the build process, the setup-ruby@v1 GitHub Action leaves artifacts in the ~/vendor/bundle folder, resulting in two full bundles in the final build: one in the default /usr/local/bundle directory specified in the Dockerfile template, and another in the /rails/vendor/bundle directory. By ignoring the /rails/vendor/bundle directory, we can significantly reduce the size of the final image.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48540",
            "title": "Added Dockerfile instructions to remove artifacts and node_modules",
            "date_modified": "2023-06-21T07:32:04.000Z",
            "date_published": "2023-06-21T06:16:44.000Z",
            "author": {
                "name": "igor-alexandrov",
                "url": "https://github.com/igor-alexandrov"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5162312?u=e1b3c0f7c6dc600253bf15c99f618b9b2d39c500&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request has been created because <code class=\"notranslate\">has_one</code> CPK associations with <code class=\"notranslate\">dependent: :nullify</code> don't currently work.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request changes the nullification code in <code class=\"notranslate\">ActiveRecord::Associations::HasOneAssociation</code> to iterate through foreign key columns and nullify them if they don't belong to the model's primary keys.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I had to add an extra test model to make a scenario where part of a composite primary key shouldn't be nullified. Does it make sense?</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48539",
            "title": "Add support for nullifying composite primary key has_one associations",
            "date_modified": "2023-06-21T16:08:20.000Z",
            "date_published": "2023-06-21T03:59:45.000Z",
            "author": {
                "name": "gmcgibbon",
                "url": "https://github.com/gmcgibbon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2651240?u=97e6903620ef2874e2231cee9eb2654b7811d750&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Support queries with regular expressions on supported databases. (PostgreSQL/MySQL)</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Post.where(title: /ThInKiNg/)\n#=&gt; SELECT * FROM posts WHERE title REGEXP 'ThInKiNg'; --MySQL\n#=&gt; SELECT * FROM posts WHERE title ~* 'ThInKiNg'; --PostgreSQL\n\nPost.where.not(title: /ThInKiNg/)\n#=&gt; SELECT * FROM posts WHERE title NOT REGEXP 'ThInKiNg'; --MySQL\n#=&gt; SELECT * FROM posts WHERE title !~* 'ThInKiNg'; --PostgreSQL    \"><pre class=\"notranslate\"><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">title</span>: <span class=\"pl-pds\">/ThInKiNg/</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\">#=&gt; SELECT * FROM posts WHERE title REGEXP 'ThInKiNg'; --MySQL</span>\n<span class=\"pl-c\">#=&gt; SELECT * FROM posts WHERE title ~* 'ThInKiNg'; --PostgreSQL</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">not</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">title</span>: <span class=\"pl-pds\">/ThInKiNg/</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\">#=&gt; SELECT * FROM posts WHERE title NOT REGEXP 'ThInKiNg'; --MySQL</span>\n<span class=\"pl-c\">#=&gt; SELECT * FROM posts WHERE title !~* 'ThInKiNg'; --PostgreSQL    </span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48538",
            "title": "Support queries with regular expressions",
            "date_modified": "2023-06-21T05:16:41.000Z",
            "date_published": "2023-06-21T03:57:38.000Z",
            "author": {
                "name": "lazaronixon",
                "url": "https://github.com/lazaronixon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5512772?u=bbae6d87b3499e6b3662664cf4be0e84cc40f6d2&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This commit changes bodies of methods generated by <code class=\"notranslate\">alias_attribute</code> along with generating these methods lazily.</p>\n<p dir=\"auto\">Previously the body of the <code class=\"notranslate\">alias_attribute :new_title, :title</code> was <code class=\"notranslate\">def new_title; title; end</code>. This commit changes it to <code class=\"notranslate\">def new_title; attribute(\"title\"); end</code>.</p>\n<p dir=\"auto\">This allows for <code class=\"notranslate\">alias_attribute</code> to be used to alias attributes named with a reserved names like <code class=\"notranslate\">id</code>:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"  class Topic &lt; ActiveRecord::Base\n    self.primary_key = :title\n    alias_attribute :id_value, :id\n  end\n\n  Topic.new.id_value # =&gt; 1\"><pre class=\"notranslate\">  <span class=\"pl-k\">class</span> <span class=\"pl-v\">Topic</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n    <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">primary_key</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">:title</span>\n    <span class=\"pl-en\">alias_attribute</span> <span class=\"pl-pds\">:id_value</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:id</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-v\">Topic</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">id_value</span> <span class=\"pl-c\"># =&gt; 1</span></pre></div>\n<h2 dir=\"auto\">Implementation details</h2>\n<p dir=\"auto\"><code class=\"notranslate\">method_defined_within?</code> method has been moved from <code class=\"notranslate\">activerecord</code> to <code class=\"notranslate\">activemodel</code> so both can use it</p>\n<h3 dir=\"auto\">Body generation</h3>\n<p dir=\"auto\">Most of the methods for the alias attribute will now be generated by <code class=\"notranslate\">define_proxy_call</code> unless the model redefines the <code class=\"notranslate\">target_name</code> attribute method, for example:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Post &lt; ApplicationRecord\n alias_attribute :subject, :title\n\n def title_was\n  ...\n end\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n <span class=\"pl-en\">alias_attribute</span> <span class=\"pl-pds\">:subject</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:title</span>\n\n <span class=\"pl-k\">def</span> <span class=\"pl-en\">title_was</span>\n  ...\n <span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">will issue a deprecation warning that asks for the <code class=\"notranslate\">subject_was</code> to be overridden as well since next version of Rails will not make <code class=\"notranslate\">subject_was</code> method to call into the <code class=\"notranslate\">title_was</code>. This is a very unlikely situation and I genuinely expect no applications to ever see the deprecation warning but still something that does require a deprecation cycle.</p>\n<p dir=\"auto\">When the deprecation is gone the <code class=\"notranslate\">alias_attribute</code> definition can become as simple as:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"      def alias_attribute(new_name, old_name)\n        self.attribute_aliases = attribute_aliases.merge(new_name.to_s =&gt; old_name.to_s)\n        define_attribute_method(old_name, as: new_name)\n      end\"><pre class=\"notranslate\">      <span class=\"pl-k\">def</span> <span class=\"pl-en\">alias_attribute</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">new_name</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">old_name</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">attribute_aliases</span> <span class=\"pl-c1\">=</span> <span class=\"pl-en\">attribute_aliases</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">merge</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">new_name</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_s</span> <span class=\"pl-c1\">=&gt;</span> <span class=\"pl-s1\">old_name</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_s</span><span class=\"pl-kos\">)</span>\n        <span class=\"pl-en\">define_attribute_method</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">old_name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">as</span>: <span class=\"pl-s1\">new_name</span><span class=\"pl-kos\">)</span>\n      <span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">where <code class=\"notranslate\">as:</code> will have to be added but semantically <code class=\"notranslate\">alias_attribute</code> will behave as \"define all the same as we define for the original attribute but now under a different name\"</p>\n<h3 dir=\"auto\">Lazy method generation</h3>\n<p dir=\"auto\"><code class=\"notranslate\">alias_attribute</code> used to generate all the methods eagerly but it doesn't allow us to have the full picture of <code class=\"notranslate\">self</code> in the context and check for methods being overridden. So we are changing to lazily define these attributes whenever the first instance of the class has been initialized. If application is booted in the <code class=\"notranslate\">EAGER_LOAD</code> mode a hook from initializer will iterate over dependants and force the attribute methods to be generated. This is very similar to how Active Record generates attributes based on schema.</p>\n<p dir=\"auto\"><code class=\"notranslate\">alias_attribute</code> now only registers the intention to define an alias in <code class=\"notranslate\">@attribute_aliases_to_generate</code> variable which will be used to define methods for all aliases later. <code class=\"notranslate\">generate_alias_attributes</code> pops values from  <code class=\"notranslate\">@attribute_aliases_to_generate</code> and generates attribute methods for each alias. <code class=\"notranslate\">generate_alias_attributes</code> also sets <code class=\"notranslate\">_alias_attributes_mass_generated</code> to <code class=\"notranslate\">true</code> so the next call to <code class=\"notranslate\">alias_attribute</code> will eagerly define all the methods. This is to support alias attribute definitions like <code class=\"notranslate\">MyModel.alias_attribute :new</code></p>\n<p dir=\"auto\">As a result it may slightly improve the boot time but it wasn't the initial goal.</p>\n<h4 dir=\"auto\">Concerns with lazy alias methods generation</h4>\n<p dir=\"auto\">Overall we are doing almost the same as what Active Record does to define attributes based on schema apart from one thing:<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/a543aee44f29abc966285ec3c5c30cfe2576fc8c/activerecord/lib/active_record/attribute_methods.rb#L58\">rails/activerecord/lib/active_record/attribute_methods.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 58\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/a543aee44f29abc966285ec3c5c30cfe2576fc8c\">a543aee</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L58\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"58\"></td>\n          <td id=\"LC58\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">generated_attribute_methods</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">synchronize</span> <span class=\"pl-k\">do</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Active Record uses mutex to ensure only one thread will be defining attributes. However at this moment I can't come up with a real-world scenario where multiple threads will attempt to define alias attributes so I decided not to use mutex until we have a clear understanding of the situation we are trying to prevent. I would appreciate any kind of insights on the need to use mutex for Active Record attributes generation</p>",
            "url": "https://github.com/rails/rails/pull/48533",
            "title": "Call proxy methods from `alias_attribute` generated methods",
            "date_modified": "2023-06-20T18:43:00.000Z",
            "date_published": "2023-06-20T17:00:43.000Z",
            "author": {
                "name": "nvasilevski",
                "url": "https://github.com/nvasilevski"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2651240?u=97e6903620ef2874e2231cee9eb2654b7811d750&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Fix unscope with multiple not conditions</p>\n<p dir=\"auto\">Before:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Post.where.not(body: &quot;hello&quot;, title: &quot;sti me&quot;).unscope(where: :title)\n#=&gt; SELECT * FROM posts WHERE NOT (body = 'hello' AND title = 'sti me')\"><pre class=\"notranslate\"><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">not</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">body</span>: <span class=\"pl-s\">\"hello\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">title</span>: <span class=\"pl-s\">\"sti me\"</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">unscope</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">where</span>: <span class=\"pl-pds\">:title</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\">#=&gt; SELECT * FROM posts WHERE NOT (body = 'hello' AND title = 'sti me')</span></pre></div>\n<p dir=\"auto\">Later:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Post.where.not(body: &quot;hello&quot;, title: &quot;sti me&quot;).unscope(where: :title)\n#=&gt; SELECT * FROM posts WHERE NOT (body = 'hello')\"><pre class=\"notranslate\"><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">not</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">body</span>: <span class=\"pl-s\">\"hello\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">title</span>: <span class=\"pl-s\">\"sti me\"</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">unscope</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">where</span>: <span class=\"pl-pds\">:title</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-c\">#=&gt; SELECT * FROM posts WHERE NOT (body = 'hello')</span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48531",
            "title": "Fix unscope with multiple not conditions",
            "date_modified": "2023-06-21T14:59:52.000Z",
            "date_published": "2023-06-20T15:29:58.000Z",
            "author": {
                "name": "lazaronixon",
                "url": "https://github.com/lazaronixon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/129938?u=7637e813584057fbf1a3fa83dca8b4d444c16f79&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This adds a new Active Record encryption option to support previous data encrypted non-deterministically with a SHA1 hash digest.</p>\n<p dir=\"auto\">There is currently a problem with Active Record encryption for users updating from 7.0 to 7.1 Before <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1200151545\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/44873\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/44873/hovercard\" href=\"https://github.com/rails/rails/pull/44873\">#44873</a>, data encrypted with non-deterministic encryption was always using SHA-1. The reason is that <code class=\"notranslate\">ActiveSupport::KeyGenerator.hash_digest_class</code> was set in an <code class=\"notranslate\">after_initialize</code> block in the railtie config, but encryption config was running before that, so it was effectively using the previous default SHA1. That means that existing users are using SHA256 for non deterministic encryption, and SHA1 for deterministic encryption.</p>\n<p dir=\"auto\">This adds a new option <code class=\"notranslate\">support_sha1_for_non_deterministic_encryption</code> that users can enable to support for SHA1 and SHA256 when decrypting existing data.</p>\n<p dir=\"auto\">The new option will kick-in by default for versions prior to 7.1. The idea is that:</p>\n<ul dir=\"auto\">\n<li>Existing users updating from 7.0, won't have to set it, as it will get enabled by default.</li>\n<li>Users starting with 7.1 will have the option disabled.</li>\n</ul>\n<p dir=\"auto\">Big thanks to <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/duduribeiro/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/duduribeiro\">@duduribeiro</a> for the thorough investigation and debugging here, as he was the one identifying the issue and who explored alternatives to fix the problem (see <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1763776125\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48520\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48520/hovercard\" href=\"https://github.com/rails/rails/pull/48520\">#48520</a>). I added him as the co-author of the commit I ported from that PR.</p>\n<p dir=\"auto\">Pending:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Validate patch in real scenarios</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Update new framework default initializer</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Update CHANGELOG</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Update documentation</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Suite passing</li>\n</ul>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48204.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1707228995\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48204\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48204/hovercard\" href=\"https://github.com/rails/rails/issues/48204\">#48204</a>.<br>\n<span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #48520.\">Closes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1763776125\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48520\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48520/hovercard\" href=\"https://github.com/rails/rails/pull/48520\">#48520</a>.</p>",
            "url": "https://github.com/rails/rails/pull/48530",
            "title": "Add a encryption option to support previous data encrypted non-deterministically with a SHA1 hash digest",
            "date_modified": "2023-06-21T15:40:18.000Z",
            "date_published": "2023-06-20T13:42:22.000Z",
            "author": {
                "name": "jorgemanrubia",
                "url": "https://github.com/jorgemanrubia"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/771411?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This commit changes the active_record_encryption.configuration to be set on an after initialize block. After PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1200151545\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/44873\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/44873/hovercard\" href=\"https://github.com/rails/rails/pull/44873\">#44873</a>, we can configure now hash_digest_class that will be used on ActiveRecord::Encryption. But the docs said that we could change it via an initializer by setting<br>\nRails.application.config.active_record.encryption.hash_digest_class. This wasn't working because the railtie<br>\n\"active_record_encryption.configuration\" was being set before the initializer was loaded. This changes this behave to configure the active_record encryption after the initialize was loaded.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I found this while debugging <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1707228995\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48204\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48204/hovercard\" href=\"https://github.com/rails/rails/issues/48204\">#48204</a> and I noticed that the PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1200151545\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/44873\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/44873/hovercard\" href=\"https://github.com/rails/rails/pull/44873\">#44873</a> added an option to configure the hash_class used to encrypt the attribute by setting the <code class=\"notranslate\">ActiveRecord::Encryption.config.hash_digest_class</code> on the initializer. But while debugging my issue, I found that the code to use this hash_digest_class wasn't using the different hash_digest_class that I set and I noticed that the ActiveRecord::Encryption was only configured only at the <code class=\"notranslate\">active_record</code> railtie before the custom initializers I have.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    initializer &quot;active_record_encryption.configuration&quot; do |app|\n      ActiveRecord::Encryption.configure \\\n         primary_key: app.credentials.dig(:active_record_encryption, :primary_key),\n         deterministic_key: app.credentials.dig(:active_record_encryption, :deterministic_key),\n         key_derivation_salt: app.credentials.dig(:active_record_encryption, :key_derivation_salt),\n         **config.active_record.encryption\"><pre class=\"notranslate\">    <span class=\"pl-en\">initializer</span> <span class=\"pl-s\">\"active_record_encryption.configuration\"</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">app</span>|\n      <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Encryption</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">configure</span> \\\n         <span class=\"pl-pds\">primary_key</span>: <span class=\"pl-s1\">app</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">credentials</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dig</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:active_record_encryption</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:primary_key</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span>\n         <span class=\"pl-pds\">deterministic_key</span>: <span class=\"pl-s1\">app</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">credentials</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dig</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:active_record_encryption</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:deterministic_key</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span>\n         <span class=\"pl-pds\">key_derivation_salt</span>: <span class=\"pl-s1\">app</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">credentials</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">dig</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:active_record_encryption</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:key_derivation_salt</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span>\n         **<span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">active_record</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">encryption</span></pre></div>\n<p dir=\"auto\">and my <code class=\"notranslate\">new_framework_defaults_7_1</code> was loaded after that.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48520",
            "title": "Wrap active_record_encryption.configuration on an after initialize",
            "date_modified": "2023-06-20T05:21:23.000Z",
            "date_published": "2023-06-19T15:32:17.000Z",
            "author": {
                "name": "duduribeiro",
                "url": "https://github.com/duduribeiro"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/75765648?u=1dc3ffb2f347af44627baa665b1b2dff0abd7dd1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Currently, insert_all/upsert_all only accept array of hashes, so I want to make it accept array of models as well.<br>\nExample:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Book.insert_all([\n  Book.new(title: &quot;Rework&quot;, author: &quot;David&quot;),\n  Book.new(title: &quot;Eloquent Ruby&quot;, author: &quot;Russ&quot;)\n])\"><pre class=\"notranslate\"><code class=\"notranslate\">Book.insert_all([\n  Book.new(title: \"Rework\", author: \"David\"),\n  Book.new(title: \"Eloquent Ruby\", author: \"Russ\")\n])\n</code></pre></div>\n\n<h3 dir=\"auto\">Detail</h3>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">If you do not want timestamp values to be updated automatically, you must set record_timestamps to false.<br>\nExample:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Book.insert_all([Book.new(title: &quot;Rework&quot;, author: &quot;David&quot;)])\nBook.last.updated_at = '2023-05-23 20:37:10.97 UTC'\n\nBook.insert_all([Book.new(title: &quot;Rework&quot;, author: &quot;David&quot;)], record_timestamps: false)\nBook.last.updated_at = nil\"><pre class=\"notranslate\"><code class=\"notranslate\">Book.insert_all([Book.new(title: \"Rework\", author: \"David\")])\nBook.last.updated_at = '2023-05-23 20:37:10.97 UTC'\n\nBook.insert_all([Book.new(title: \"Rework\", author: \"David\")], record_timestamps: false)\nBook.last.updated_at = nil\n</code></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48513",
            "title": "Allow insert_all/upsert_all to use an array of models",
            "date_modified": "2023-06-21T12:08:18.000Z",
            "date_published": "2023-06-18T13:30:51.000Z",
            "author": {
                "name": "TakuyaKurimoto",
                "url": "https://github.com/TakuyaKurimoto"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/509837?u=697e4a265d5359363a5d57a24b07f9a79cb0b08a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48463.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1755595459\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48463\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48463/hovercard\" href=\"https://github.com/rails/rails/issues/48463\">#48463</a></p>\n<p dir=\"auto\">Since <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"998126151\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/43227\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/43227/hovercard\" href=\"https://github.com/rails/rails/pull/43227\">#43227</a>, the default CSP suggested in the initializer does not work with empty sessions. See <a href=\"https://github.com/rails/rails/pull/43227#issuecomment-1191692615\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/43227/hovercard\">this comment</a> for an example issue and workaround.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR just adds a fallback in case the session has not been loaded. I also updated the railties test to match the config in the default initializer.</p>",
            "url": "https://github.com/rails/rails/pull/48510",
            "title": "Allow default CSP setup to work with empty sessions",
            "date_modified": "2023-06-20T12:40:04.000Z",
            "date_published": "2023-06-18T07:50:25.000Z",
            "author": {
                "name": "ghiculescu",
                "url": "https://github.com/ghiculescu"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/54629302?u=be8de5137bf940532cddd05aff823129ab8a39db&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created to <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #47357.\">fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1580073071\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/47357\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/47357/hovercard\" href=\"https://github.com/rails/rails/issues/47357\">#47357</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request ensures that when using <code class=\"notranslate\">scoping</code> on update, delete and reload, scopes are only applied if <code class=\"notranslate\">all_queries: true</code> and only default scopes with <code class=\"notranslate\">all_queries: true</code> are applied. Because all default scopes are applied initially with the <code class=\"notranslate\">where</code> clause when scoping, my approach was to remove the unneeded scopes after the fact in these three scenarios.</p>\n<p dir=\"auto\">Except for the update and delete cases <strong>without</strong> <code class=\"notranslate\">scoping(all_queries: true)</code>, all other tests failed initially (4/6).</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Added <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/pjambet/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/pjambet\">@pjambet</a> as a co-author since they thoroughly documented all the expected and actual behaviour and tests.</p>\n<p dir=\"auto\">Unsure if this needs a CHANGELOG entry?</p>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48509",
            "title": "[Fix #47357] Inconsistent update, delete, reload behaviour with `#scoping` and default scopes",
            "date_modified": "2023-06-18T07:31:30.000Z",
            "date_published": "2023-06-17T14:33:33.000Z",
            "author": {
                "name": "joshuay03",
                "url": "https://github.com/joshuay03"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/11679928?u=cda9703c49801755597161a69ed96a87c27b4a0d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48486.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1759285533\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48486\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48486/hovercard\" href=\"https://github.com/rails/rails/issues/48486\">#48486</a></p>\n<p dir=\"auto\">Saving ranges with an empty range</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Simply return if the string is empty, the same as it's being done for an \"empty\" string.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48507",
            "title": "Fix empty string saving for ranges",
            "date_modified": "2023-06-21T08:21:23.000Z",
            "date_published": "2023-06-16T19:10:35.000Z",
            "author": {
                "name": "szymonlipka",
                "url": "https://github.com/szymonlipka"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/142719?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">When eager_load is enabled and something (like the frozen_record gem) tries to load yaml files that use <code class=\"notranslate\">ActiveRecord::FixtureSet.identify(...)</code> we'll get an uninitialized constant error.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">With a new rails app, add the <code class=\"notranslate\">frozen_record</code> gem and two files:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ cat app/models/ice.rb\nclass Ice &lt; FrozenRecord::Base\n  self.base_path = Rails.root.join(&quot;db/data&quot;).to_s\nend\n$ cat db/data/ices.yml.erb\n- y: &lt;%= ActiveRecord::FixtureSet.identify(:fake) %&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">$ cat app/models/ice.rb\nclass Ice &lt; FrozenRecord::Base\n  self.base_path = Rails.root.join(\"db/data\").to_s\nend\n$ cat db/data/ices.yml.erb\n- y: &lt;%= ActiveRecord::FixtureSet.identify(:fake) %&gt;\n</code></pre></div>\n<p dir=\"auto\">Running <code class=\"notranslate\">CI=true bin/rails test</code> will abort with an uninitialized constant error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ CI=1 bin/rails test\n(erb):1:in `&lt;main&gt;': uninitialized constant ActiveRecord::FixtureSet (NameError)\n\n_erbout = +''; _erbout.&lt;&lt; &quot;- y: &quot;.freeze; _erbout.&lt;&lt;(( ActiveRecord::FixtureSet.identify(:fake) ).to_s); _erbout.&lt;&lt; &quot;\\n&quot;.freeze\"><pre class=\"notranslate\"><code class=\"notranslate\">$ CI=1 bin/rails test\n(erb):1:in `&lt;main&gt;': uninitialized constant ActiveRecord::FixtureSet (NameError)\n\n_erbout = +''; _erbout.&lt;&lt; \"- y: \".freeze; _erbout.&lt;&lt;(( ActiveRecord::FixtureSet.identify(:fake) ).to_s); _erbout.&lt;&lt; \"\\n\".freeze\n</code></pre></div>\n<h3 dir=\"auto\">Notes</h3>\n<p dir=\"auto\">It may be worth noting that this file is already autoloaded in this module for a different constant:<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/df24e61cfb9a0e61f35989e35da487299d805e03/activerecord/lib/active_record.rb#L84\">rails/activerecord/lib/active_record.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 84\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/df24e61cfb9a0e61f35989e35da487299d805e03\">df24e61</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L84\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"84\"></td>\n          <td id=\"LC84\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">autoload</span> <span class=\"pl-pds\">:TestFixtures</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"active_record/fixtures\"</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Simply adding the autoload line introduced a circular require<br>\n(fixtures.rb defines FixtureSet but before that it tries to load files beneath that namespace)<br>\nso I moved those requires down to after the class definition<br>\nas is done in<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/7dd67dc285fcdbb788cbdcdcaf53f6ce588bf7e5/activesupport/lib/active_support/deprecation.rb#L35-L54\">rails/activesupport/lib/active_support/deprecation.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 35 to 54\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha\" href=\"/rails/rails/commit/7dd67dc285fcdbb788cbdcdcaf53f6ce588bf7e5\">7dd67dc</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L35\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"35\"></td>\n          <td id=\"LC35\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">class</span> <span class=\"pl-v\">Deprecation</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L36\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"36\"></td>\n          <td id=\"LC36\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-c\"># active_support.rb sets an autoload for ActiveSupport::Deprecation.</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L37\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"37\"></td>\n          <td id=\"LC37\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-c\">#</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L38\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"38\"></td>\n          <td id=\"LC38\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-c\"># If these requires were at the top of the file the constant would not be</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L39\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"39\"></td>\n          <td id=\"LC39\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-c\"># defined by the time their files were loaded. Since some of them reopen</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L40\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"40\"></td>\n          <td id=\"LC40\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-c\"># ActiveSupport::Deprecation its autoload would be triggered, resulting in</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L41\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"41\"></td>\n          <td id=\"LC41\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-c\"># a circular require warning for active_support/deprecation.rb.</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L42\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"42\"></td>\n          <td id=\"LC42\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-c\">#</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L43\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"43\"></td>\n          <td id=\"LC43\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-c\"># So, we define the constant first, and load dependencies later.</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L44\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"44\"></td>\n          <td id=\"LC44\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/deprecation/instance_delegator\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L45\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"45\"></td>\n          <td id=\"LC45\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/deprecation/behaviors\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L46\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"46\"></td>\n          <td id=\"LC46\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/deprecation/reporting\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L47\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"47\"></td>\n          <td id=\"LC47\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/deprecation/disallowed\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L48\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"48\"></td>\n          <td id=\"LC48\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/deprecation/constant_accessor\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L49\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"49\"></td>\n          <td id=\"LC49\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/deprecation/method_wrappers\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L50\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"50\"></td>\n          <td id=\"LC50\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/deprecation/proxy_wrappers\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L51\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"51\"></td>\n          <td id=\"LC51\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/deprecation/deprecators\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L52\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"52\"></td>\n          <td id=\"LC52\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_support/core_ext/module/deprecation\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L53\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"53\"></td>\n          <td id=\"LC53\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">require</span> <span class=\"pl-s\">\"concurrent/atomic/thread_local_var\"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L54\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"54\"></td>\n          <td id=\"LC54\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48506",
            "title": "Autoload ActiveRecord::FixtureSet",
            "date_modified": "2023-06-21T00:39:50.000Z",
            "date_published": "2023-06-16T18:45:25.000Z",
            "author": {
                "name": "rwstauner",
                "url": "https://github.com/rwstauner"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/45299?u=7d70bac77efa7641741857d155a3eb8d7941a35f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Make <code class=\"notranslate\">assert_changes</code> error messages show objects with <code class=\"notranslate\">.inspect</code> so that <code class=\"notranslate\">nil</code> is displayed as \"nil\" instead of an empty string, we can differentiate strings and symbols, etc.</p>\n<p dir=\"auto\">Make <code class=\"notranslate\">assert_no_changes</code> error messages surface the actual value.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<p dir=\"auto\">Let me know if I should update the CHANGELOG as this is a minor change.</p>",
            "url": "https://github.com/rails/rails/pull/48482",
            "title": "Improve error messages of `assert_changes` and `assert_no_changes`",
            "date_modified": "2023-06-15T09:18:29.000Z",
            "date_published": "2023-06-15T09:18:25.000Z",
            "author": {
                "name": "pcreux",
                "url": "https://github.com/pcreux"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2651240?u=97e6903620ef2874e2231cee9eb2654b7811d750&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Since version 7.0.5 <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/bdbe58b50461dc44c42df4d5427fa78aeb1debcb/hovercard\" href=\"https://github.com/rails/rails/commit/bdbe58b50461dc44c42df4d5427fa78aeb1debcb\"><tt>bdbe58b</tt></a>  we are able to properly keep integrity in <code class=\"notranslate\">has_one</code> relationships, so when we create a new record <code class=\"notranslate\">account.create_client(...)</code> it will prevent duplication, but we can still bypass it on the other side of the relationship using <code class=\"notranslate\">Client.create!(..., account: existing_account)</code>.</p>\n<p dir=\"auto\">That said I'm proposing to add a new option <code class=\"notranslate\">unique</code> to the <code class=\"notranslate\">belongs_to</code> method. Here are some advantages of this approach...</p>\n<ul dir=\"auto\">\n<li>Unique indexes are not required.</li>\n<li>Different from unique indexes we can use it with an optional association.</li>\n<li>Take advantage of the new <code class=\"notranslate\">belongs_to_required_validates_foreign_key</code>.</li>\n<li>Validation API, messages, etc...</li>\n</ul>\n<p dir=\"auto\">Before:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Client\n  belongs_to :account; validates_uniqueness_of(:account, allow_nil: true, message: :unique)\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Client</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:account</span><span class=\"pl-kos\">;</span> <span class=\"pl-en\">validates_uniqueness_of</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">:account</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">allow_nil</span>: <span class=\"pl-c1\">true</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">message</span>: <span class=\"pl-pds\">:unique</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Later:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Client\n  belongs_to :account, unique: true\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Client</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:account</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">unique</span>: <span class=\"pl-c1\">true</span>\n<span class=\"pl-k\">end</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\"><a href=\"https://thoughtbot.com/blog/rails-has-one-limitations\" rel=\"nofollow\">https://thoughtbot.com/blog/rails-has-one-limitations</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48480",
            "title": "Add unique option to belongs_to association",
            "date_modified": "2023-06-17T19:55:43.000Z",
            "date_published": "2023-06-15T07:00:03.000Z",
            "author": {
                "name": "lazaronixon",
                "url": "https://github.com/lazaronixon"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1080678?u=b6e211b7766e6aa01e794067f67dd65d419c0150&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Rails 7.2 will remove support for <code class=\"notranslate\">#remove_connection</code> in favor of <code class=\"notranslate\">#remove_connection_pool</code>. This deprecation also represents a change in behavior. <code class=\"notranslate\">#remove_connection_pool</code> will not accept a <code class=\"notranslate\">name</code> argument as it should always be called on the class that owns the pool an application wants removed. In addition it will no longer reset a subclass with it's own connection to the parent pool.</p>\n<p dir=\"auto\">Previous behavior:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class ActiveRecord::Base\nend\n\nclass Post &lt; ActiveRecord::Base\n  establish_connection :post_db\nend\n\nPost.remove_connection\n=&gt; would reassign Post to `ActiveRecord::Base`  and `Post.connected?` returns `true`.\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">establish_connection</span> <span class=\"pl-pds\">:post_db</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">remove_connection</span>\n<span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">would</span> <span class=\"pl-en\">reassign</span> <span class=\"pl-en\">Post</span> <span class=\"pl-en\">to</span> <span class=\"pl-s\">`ActiveRecord::Base`</span>  <span class=\"pl-k\">and</span> <span class=\"pl-s\">`Post.connected?`</span><span class=\"pl-kos\"></span> <span class=\"pl-en\">returns</span> <span class=\"pl-s\">`true`</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span></pre></div>\n<p dir=\"auto\">New behavior:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class ActiveRecord::Base\nend\n\nclass Post &lt; ActiveRecord::Base\n  establish_connection :post_db\nend\n\nPost.remove_connection\n=&gt; Removes the pool keyed on `Post` and `Post.connected?` returns `nil`.\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">Post</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">establish_connection</span> <span class=\"pl-pds\">:post_db</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">remove_connection</span>\n<span class=\"pl-c1\">=&gt;</span> <span class=\"pl-en\">Removes</span> <span class=\"pl-en\">the</span> <span class=\"pl-en\">pool</span> <span class=\"pl-en\">keyed</span> <span class=\"pl-en\">on</span> <span class=\"pl-s\">`Post`</span> <span class=\"pl-k\">and</span> <span class=\"pl-s\">`Post.connected?`</span><span class=\"pl-kos\"></span> <span class=\"pl-en\">returns</span> <span class=\"pl-s\">`nil`</span><span class=\"pl-kos\">.</span><span class=\"pl-en\"></span></pre></div>\n<p dir=\"auto\">If the <code class=\"notranslate\">Post</code> class does not have its own connection and <code class=\"notranslate\">Post.remove_connection</code> is called, the behavior is unchanged. Active Record will not remove the pool belonging to <code class=\"notranslate\">ActiveRecord::Base</code>. To remove the parent pool, applications should call <code class=\"notranslate\">ActiveRecord::Base.remove_connection</code> directly.</p>\n<p dir=\"auto\">I chose to add a new method instead of deprecating behavior in the current one because this behavior change isn't worth the overhead of a config option. I also think it's more likely to get feedback if this is a dealbreaker change.</p>\n<p dir=\"auto\">I'm making this change because due to the current design of Active Record connection management, it does not make sense that <code class=\"notranslate\">remove_connection</code> would reassign connections to the parent class. In a multi-db application this would be dangerous, we would not want to assign <code class=\"notranslate\">AnimalsRecord</code> to <code class=\"notranslate\">ActiveRecord::Base</code> if they are completely different databases. In addition it does not make sense to take a <code class=\"notranslate\">name</code> argument when the <code class=\"notranslate\">name</code> should be derived from the connection_specification_name on self.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>\n<hr>\n<p dir=\"auto\">cc/ <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a> in case you have strong opinions on this.</p>\n<p dir=\"auto\">Background:<br>\nI noticed that this was added for manageiq in <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/6458610d0b95049bbc847cbc1039d6f5be8cc30c/hovercard\" href=\"https://github.com/rails/rails/commit/6458610d0b95049bbc847cbc1039d6f5be8cc30c\"><tt>6458610</tt></a> from this report <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"154095811\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/24959\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/24959/hovercard\" href=\"https://github.com/rails/rails/issues/24959\">#24959</a>. I don't think we should keep supporting this because its behavior is really surprising given the current design of connection management.</p>",
            "url": "https://github.com/rails/rails/pull/48478",
            "title": "Deprecate `#remove_connection` in favor of `#remove_connection_pool`.",
            "date_modified": "2023-06-14T21:23:31.000Z",
            "date_published": "2023-06-14T21:13:36.000Z",
            "author": {
                "name": "eileencodes",
                "url": "https://github.com/eileencodes"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/13816206?u=b3f1167e3181e3e4b093f443511446e576d13d9e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This PR <span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #48445.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1751360731\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48445\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48445/hovercard\" href=\"https://github.com/rails/rails/issues/48445\">#48445</a> .</p>\n<p dir=\"auto\">As per the current behaviour, Two queries are being fired to validate uniqueness of an encrypted attribute even in cases when <strong>encrypted_type.previous_types</strong> is nil. An additional query with the current encrypted/ciphered value should not be fired.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR updates the loop in <strong><a href=\"https://github.com/rails/rails/blob/main/activerecord/lib/active_record/encryption/extended_deterministic_uniqueness_validator.rb#L17\">ExtendedDeterministicUniquenessValidator</a></strong> to iterate over <strong>encrypted_type.previous_types</strong> only i.e. to exclude the current encrypted_type.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">For Additional context Please refer to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1751360731\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48445\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48445/hovercard\" href=\"https://github.com/rails/rails/issues/48445\">#48445</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/48462",
            "title": "Do not revalidate encrypted attribute with current encrypted_type",
            "date_modified": "2023-06-13T14:48:12.000Z",
            "date_published": "2023-06-13T12:57:02.000Z",
            "author": {
                "name": "iamradioactive",
                "url": "https://github.com/iamradioactive"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/771968?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This commit adds support for replacing the compressor used for serialized cache entries.  Custom compressors must respond to <code class=\"notranslate\">deflate</code> and <code class=\"notranslate\">inflate</code>.  For example:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"module MyCompressor\n  def self.deflate(string)\n    # compression logic...\n  end\n\n  def self.inflate(compressed)\n    # decompression logic...\n  end\nend\n\nconfig.cache_store = :redis_cache_store, { compressor: MyCompressor }\"><pre class=\"notranslate\"><span class=\"pl-k\">module</span> <span class=\"pl-v\">MyCompressor</span>\n  <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">deflate</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">string</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-c\"># compression logic...</span>\n  <span class=\"pl-k\">end</span>\n\n  <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">inflate</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">compressed</span><span class=\"pl-kos\">)</span>\n    <span class=\"pl-c\"># decompression logic...</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">config</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">cache_store</span> <span class=\"pl-c1\">=</span> <span class=\"pl-pds\">:redis_cache_store</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">compressor</span>: <span class=\"pl-v\">MyCompressor</span> <span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">Additionally, as part of this work, a new optimization has been added for cache format version 7.1 such that the version and expiry of cache entries can be checked without deserializing (or decompressing) the entries.</p>\n<p dir=\"auto\">Also as part of this work, custom cache coders now support compression when the cache format version is &gt;= 7.1, and they benefit from the improvements introduced by cache format version 7.1 (namely, lazy deserialization from this commit, and optimized serialization of bare strings from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1694791749\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48122\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48122/hovercard\" href=\"https://github.com/rails/rails/pull/48122\">#48122</a>).</p>\n<hr>\n<p dir=\"auto\">/cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a> since you expressed interest in this in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1736309755\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48368\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/48368/hovercard?comment_id=1572814330&amp;comment_type=issue_comment\" href=\"https://github.com/rails/rails/issues/48368#issuecomment-1572814330\">#48368 (comment)</a>.</p>",
            "url": "https://github.com/rails/rails/pull/48451",
            "title": "Support replacing cache compressor",
            "date_modified": "2023-06-21T08:26:54.000Z",
            "date_published": "2023-06-11T21:27:10.000Z",
            "author": {
                "name": "jonathanhefner",
                "url": "https://github.com/jonathanhefner"
            }
        }
    ]
}