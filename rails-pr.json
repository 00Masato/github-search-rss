{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/8122246?u=2dbe607a66a7616297b78647eeb4e0dbff657c3a&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Add doc to explain how to migrate to the new BroadcastLogger:</p>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">This should make it easier for apps or libraries that were previously relying on the private API. Also took the opportunity to tweak the doc of the BroadcastLogger to mention what happens when calling a non-standard method.</p>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49494.\">Fix</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1927900439\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49494\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49494/hovercard\" href=\"https://github.com/rails/rails/issues/49494\">#49494</a></p>\n</li>\n</ul>\n<p dir=\"auto\">cc/ <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/mensfeld/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/mensfeld\">@mensfeld</a> Hopefully this should make it clearer!</p>",
            "url": "https://github.com/rails/rails/pull/49518",
            "title": "Add doc to explain how to migrate to the new BroadcastLogger:",
            "date_modified": "2023-10-06T17:11:02.000Z",
            "date_published": "2023-10-06T17:10:58.000Z",
            "author": {
                "name": "Edouard-chin",
                "url": "https://github.com/Edouard-chin"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/14923?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49516.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1930611803\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49516\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49516/hovercard\" href=\"https://github.com/rails/rails/issues/49516\">#49516</a></p>\n<p dir=\"auto\">This Pull Request has been created because it clarifies instructions</p>",
            "url": "https://github.com/rails/rails/pull/49517",
            "title": "Fix typo in exception message re: raise_on_missing_callback_actions",
            "date_modified": "2023-10-06T16:53:30.000Z",
            "date_published": "2023-10-06T16:53:26.000Z",
            "author": {
                "name": "benstein",
                "url": "https://github.com/benstein"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/4685176?u=a21aedc92c0cafb71a134e8af830fcbbe9014f5d&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This Pull Request was created to fix a small bug introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1684129600\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48066\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48066/hovercard\" href=\"https://github.com/rails/rails/pull/48066\">#48066</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This changes the logged message when a job is started. Before, the logged message always attempted to include the <code class=\"notranslate\">enqueued_at</code> info. Unfortunately, for jobs that are run with <code class=\"notranslate\">perform_now</code>, they are not enqueued and instead executed immediately. This left <code class=\"notranslate\">enqueued_at</code> as <code class=\"notranslate\">nil</code> which in turn caused a <code class=\"notranslate\">NoMethodError</code> to be raised when attempting to call <code class=\"notranslate\">utc</code> on the <code class=\"notranslate\">nil</code> value.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49515",
            "title": "Don't log enqueuing details when the job wasn't enqueued",
            "date_modified": "2023-10-06T15:35:33.000Z",
            "date_published": "2023-10-06T15:35:28.000Z",
            "author": {
                "name": "dustinbrownman",
                "url": "https://github.com/dustinbrownman"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">As of <a href=\"https://github.com/rails/rails/pull/47144\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/47144/hovercard\">#47144</a>, <code class=\"notranslate\">response.parsed_body</code> supports parsing both <code class=\"notranslate\">format: :json</code> and <code class=\"notranslate\">format: :html</code> responses. This commit updates the documentation to reflect that.</p>\n<p dir=\"auto\">Additionally, it cribs the <code class=\"notranslate\">ActionDispatch::IntegrationTest</code> documentation that mentions <code class=\"notranslate\">register_encoder</code>, and copies it to the method definition so that the documentation entry for that method has descriptive information.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49513",
            "title": "Document `ActionDispatch::IntegrationTest#register_encoder` [ci skip]",
            "date_modified": "2023-10-06T14:16:18.000Z",
            "date_published": "2023-10-06T14:16:14.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5122678?u=204301f9f9fe8930fd26fe3bfe65b6ffaffd8b59&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Prior to this commit, calls to <code class=\"notranslate\">gem_group</code> would amend the <code class=\"notranslate\">Gemfile</code> even if there was an existing <a href=\"https://bundler.io/guides/groups.html\" rel=\"nofollow\">gem group</a>, resulting in duplication.</p>\n<p dir=\"auto\">This commit prepends existing gem groups with the added gem.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Because <code class=\"notranslate\">gem_group</code> invokes <code class=\"notranslate\">instance_eval(&amp;block)</code> via <code class=\"notranslate\">with_indentation</code>, a call to <code class=\"notranslate\">gem</code> is made. This means we needed to do the following:</p>\n<ol dir=\"auto\">\n<li>Check if the <code class=\"notranslate\">Gemfile</code> contains an existing gem group in <code class=\"notranslate\">gem_group</code>.</li>\n<li>Pass information about that  existing gem group to the <code class=\"notranslate\">gem</code> method.</li>\n</ol>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Because the <code class=\"notranslate\">Gemfile</code> used in existing tests has a <code class=\"notranslate\">:test</code> and <code class=\"notranslate\">:development, :test</code> groups, we modify the existing tests to use groups not used in the <code class=\"notranslate\">Gemfile</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49512",
            "title": "`Rails::Generators::Actions#gem_group`: Prepend existing gem groups",
            "date_modified": "2023-10-06T13:21:46.000Z",
            "date_published": "2023-10-06T12:55:22.000Z",
            "author": {
                "name": "stevepolitodesign",
                "url": "https://github.com/stevepolitodesign"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49502.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1928943686\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49502\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49502/hovercard\" href=\"https://github.com/rails/rails/issues/49502\">#49502</a>.</p>\n<p dir=\"auto\">This bug was introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1712735611\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/48241\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/48241/hovercard\" href=\"https://github.com/rails/rails/pull/48241\">#48241</a>. Since <code class=\"notranslate\">IDENTITY</code> columns in PostgreSQL do not have defaults, they are not auto populated via the changes made in that PR. Thus we need to consider them separately.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/nvasilevski/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/nvasilevski\">@nvasilevski</a></p>",
            "url": "https://github.com/rails/rails/pull/49504",
            "title": "Fix auto populating `IDENTITY` columns for PostgreSQL",
            "date_modified": "2023-10-06T07:37:29.000Z",
            "date_published": "2023-10-05T20:43:28.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/717637?u=685121f22ceb01c9e4650173c8eedae4cd070aa9&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Backports the fix from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1419232597\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/46305\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/46305/hovercard\" href=\"https://github.com/rails/rails/pull/46305\">#46305</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Calling <code class=\"notranslate\">Rails.cache.increment</code> drops the existing TTL, which is an issue on the current release of Rails, 7.0.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">Some of the changes introduced in <a href=\"https://github.com/rails/rails/pull/46305\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/46305/hovercard\">the original<br>\nPR</a> were discarded, such as the <code class=\"notranslate\">normalize_</code> methods, as well as the change that originated in <a href=\"https://github.com/rails/rails/pull/45068\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/45068/hovercard\">that PR</a> that sets a value if none exists.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49503",
            "title": "Backport to 7-0-stable: MemoryStore: preserve entry ttl when incrementing",
            "date_modified": "2023-10-05T23:08:07.000Z",
            "date_published": "2023-10-05T19:56:25.000Z",
            "author": {
                "name": "pjambet",
                "url": "https://github.com/pjambet"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5122678?u=204301f9f9fe8930fd26fe3bfe65b6ffaffd8b59&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This commit is a follow-up to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1921037200\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49448\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49448/hovercard\" href=\"https://github.com/rails/rails/pull/49448\">#49448</a>, with regards to <a href=\"https://github.com/rails/rails/pull/49448#issuecomment-1743061538\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49448/hovercard\">this comment</a>.</p>\n<p dir=\"auto\">Prior to this commit, logging and debugging for<br>\n<a href=\"https://api.rubyonrails.org/v7.0.8/classes/Rails/Generators/Actions.html\" rel=\"nofollow\">Rails::Generators::Actions</a> was limited even when enabling <code class=\"notranslate\">RAILS_LOG_TO_STDOUT</code>. This was because the private <code class=\"notranslate\">action</code> method in the corresponding test was capturing <code class=\"notranslate\">$stdout</code>.</p>\n<h4 dir=\"auto\">Before</h4>\n<details open=\"\" class=\"details-reset border rounded-2\">\n  <summary class=\"px-3 py-2\">\n    <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-device-camera-video\">\n    <path d=\"M16 3.75v8.5a.75.75 0 0 1-1.136.643L11 10.575v.675A1.75 1.75 0 0 1 9.25 13h-7.5A1.75 1.75 0 0 1 0 11.25v-6.5C0 3.784.784 3 1.75 3h7.5c.966 0 1.75.784 1.75 1.75v.675l3.864-2.318A.75.75 0 0 1 16 3.75Zm-6.5 1a.25.25 0 0 0-.25-.25h-7.5a.25.25 0 0 0-.25.25v6.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-6.5ZM11 8.825l3.5 2.1v-5.85l-3.5 2.1Z\"></path>\n</svg>\n    <span aria-label=\"Video description CleanShot.2023-10-04.at.19.49.42.mp4\" class=\"m-1\">CleanShot.2023-10-04.at.19.49.42.mp4</span>\n    <span class=\"dropdown-caret\"></span>\n  </summary>\n\n  <video src=\"https://user-images.githubusercontent.com/5122678/272740937-caa0dbb9-2664-41cf-83fd-e130effa87be.mp4\" data-canonical-src=\"https://user-images.githubusercontent.com/5122678/272740937-caa0dbb9-2664-41cf-83fd-e130effa87be.mp4\" controls=\"controls\" muted=\"muted\" class=\"d-block rounded-bottom-2 border-top width-fit\" style=\"max-height:640px; min-height: 200px\">\n\n  </video>\n</details>\n\n<h4 dir=\"auto\">After</h4>\n<details open=\"\" class=\"details-reset border rounded-2\">\n  <summary class=\"px-3 py-2\">\n    <svg aria-hidden=\"true\" height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\" class=\"octicon octicon-device-camera-video\">\n    <path d=\"M16 3.75v8.5a.75.75 0 0 1-1.136.643L11 10.575v.675A1.75 1.75 0 0 1 9.25 13h-7.5A1.75 1.75 0 0 1 0 11.25v-6.5C0 3.784.784 3 1.75 3h7.5c.966 0 1.75.784 1.75 1.75v.675l3.864-2.318A.75.75 0 0 1 16 3.75Zm-6.5 1a.25.25 0 0 0-.25-.25h-7.5a.25.25 0 0 0-.25.25v6.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-6.5ZM11 8.825l3.5 2.1v-5.85l-3.5 2.1Z\"></path>\n</svg>\n    <span aria-label=\"Video description CleanShot.2023-10-04.at.19.50.14.mp4\" class=\"m-1\">CleanShot.2023-10-04.at.19.50.14.mp4</span>\n    <span class=\"dropdown-caret\"></span>\n  </summary>\n\n  <video src=\"https://user-images.githubusercontent.com/5122678/272740960-c5753449-f678-4486-b297-9be48a4e7619.mp4\" data-canonical-src=\"https://user-images.githubusercontent.com/5122678/272740960-c5753449-f678-4486-b297-9be48a4e7619.mp4\" controls=\"controls\" muted=\"muted\" class=\"d-block rounded-bottom-2 border-top width-fit\" style=\"max-height:640px; min-height: 200px\">\n\n  </video>\n</details>\n\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">We simply conditionally capture the <code class=\"notranslate\">stdout</code> like we did in  <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1921037200\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49448\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49448/hovercard\" href=\"https://github.com/rails/rails/pull/49448\">#49448</a>.</p>\n<div class=\"highlight highlight-source-diff notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"4220d82e93 Improve generator logging and debugging\ndiff --git a/railties/test/generators/actions_test.rb b/railties/test/generators/actions_test.rb\nindex 6b5cdcf781..51a006ca87 100644\n--- a/railties/test/generators/actions_test.rb\n+++ b/railties/test/generators/actions_test.rb\n@@ -720,7 +720,11 @@ def test_log_with_status_with_quiet\n \n   private\n     def action(...)\n-      capture(:stdout) { generator.send(...) }\n+      if ENV[&quot;RAILS_LOG_TO_STDOUT&quot;] == &quot;true&quot;\n+        generator.send(...)\n+      else\n+        capture(:stdout) { generator.send(...) }\n+      end\n     end\n \n     def revoke(...)\n\"><pre class=\"notranslate\">4220d82e93 Improve generator logging and debugging\n<span class=\"pl-c1\">diff --git a/railties/test/generators/actions_test.rb b/railties/test/generators/actions_test.rb</span>\nindex 6b5cdcf781..51a006ca87 100644\n<span class=\"pl-md\">--- a/railties/test/generators/actions_test.rb</span>\n<span class=\"pl-mi1\">+++ b/railties/test/generators/actions_test.rb</span>\n<span class=\"pl-mdr\">@@ -720,7 +720,11 @@</span> def test_log_with_status_with_quiet\n \n   private\n     def action(...)\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>      capture(:stdout) { generator.send(...) }</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      if ENV[\"RAILS_LOG_TO_STDOUT\"] == \"true\"</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        generator.send(...)</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      else</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>        capture(:stdout) { generator.send(...) }</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>      end</span>\n     end\n \n     def revoke(...)\n</pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">It's possible other call sites in the test suite need to be updated, but I wanted to keep this commit focused.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49490",
            "title": "Improve `Rails::Generators::Actions` logging and debugging",
            "date_modified": "2023-10-05T13:11:49.000Z",
            "date_published": "2023-10-04T23:57:03.000Z",
            "author": {
                "name": "stevepolitodesign",
                "url": "https://github.com/stevepolitodesign"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/717637?u=685121f22ceb01c9e4650173c8eedae4cd070aa9&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Checking if the current transaction is materialized cannot be done directly from the <code class=\"notranslate\">materialized?</code> method because <code class=\"notranslate\">NullTransaction</code> doesn't implemented <code class=\"notranslate\">materialized?</code></p>\n<p dir=\"auto\">A workaround is to first check if the transaction is open:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"current_transaction = ActiveRecord::Base.connection.current_transaction\ncurrent_transaction.open? &amp;&amp; current_transaction.materialized?\"><pre class=\"notranslate\"><span class=\"pl-s1\">current_transaction</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-s1\">current_transaction</span>\n<span class=\"pl-s1\">current_transaction</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">open?</span> &amp;&amp; <span class=\"pl-s1\">current_transaction</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">materialized?</span></pre></div>\n<p dir=\"auto\">With this change we can skip the extra check on <code class=\"notranslate\">open?</code></p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"current_transaction = ActiveRecord::Base.connection.current_transaction\ncurrent_transaction.materialized?\"><pre class=\"notranslate\"><span class=\"pl-s1\">current_transaction</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-s1\">current_transaction</span>\n<span class=\"pl-s1\">current_transaction</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">materialized?</span></pre></div>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR continues the null object pattern approach for the <code class=\"notranslate\">NullTransaction</code> by implementing <code class=\"notranslate\">materialized?</code> to always return <code class=\"notranslate\">false</code>, the same way it always returns <code class=\"notranslate\">false</code> for <code class=\"notranslate\">open?</code></p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<p dir=\"auto\">I couldn't find existing tests for this, so wasn't sure whether or not to add some.</p>\n<p dir=\"auto\"><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a> I was told to ask you about this change.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49488",
            "title": "Add materialized? to NullTransaction",
            "date_modified": "2023-10-05T01:05:33.000Z",
            "date_published": "2023-10-04T16:11:07.000Z",
            "author": {
                "name": "pjambet",
                "url": "https://github.com/pjambet"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Sometimes there are context-specific reasons to validate a particular field on an associated model. While it's possible to opt-into and opt-out of validation with contexts (the <code class=\"notranslate\">on:</code> option), this commit proposes an alternative that extends validations declared with <code class=\"notranslate\">validates_associated</code> and <code class=\"notranslate\">validates ..., associated: true</code>.</p>\n<p dir=\"auto\">For example, consider a <code class=\"notranslate\">User</code> model with an optional <code class=\"notranslate\">name</code> attribute. In most cases, the <code class=\"notranslate\">User#name</code> isn't required, but let's say that a name <em>is</em> required when the <code class=\"notranslate\">User</code> is related to a <code class=\"notranslate\">Book</code> as its <code class=\"notranslate\">Author</code>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">With the changes in this commit, the <code class=\"notranslate\">Book</code> can` pass a block to declare additional validations on the relationship:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class Book &lt; ActiveRecord::Base\n  belongs_to :author, class: User\n\n  validates_associated :author do |author|\n    author.validates_presence_of :name\n  end\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">Book</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">belongs_to</span> <span class=\"pl-pds\">:author</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">class</span>: <span class=\"pl-v\">User</span>\n\n  <span class=\"pl-en\">validates_associated</span> <span class=\"pl-pds\">:author</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">author</span>|\n    <span class=\"pl-s1\">author</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">validates_presence_of</span> <span class=\"pl-pds\">:name</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">The block's parameter is optional, and can be omitted:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"validates_associated :author do\n  validates_presence_of :name\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">validates_associated</span> <span class=\"pl-pds\">:author</span> <span class=\"pl-k\">do</span>\n  <span class=\"pl-en\">validates_presence_of</span> <span class=\"pl-pds\">:name</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">When configuring the validation with options, pass a lambda as the +with:+ option:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"validates_associated :author,\n  with: -&gt; { validates_presence_of :name },\n  unless: :anonymous?\"><pre class=\"notranslate\"><span class=\"pl-en\">validates_associated</span> <span class=\"pl-pds\">:author</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">with</span>: <span class=\"pl-c1\">-&gt;</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">validates_presence_of</span> <span class=\"pl-pds\">:name</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">unless</span>: <span class=\"pl-pds\">:anonymous?</span></pre></div>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49486",
            "title": "Extend `validates_associated` to accept a block",
            "date_modified": "2023-10-04T14:02:06.000Z",
            "date_published": "2023-10-04T13:56:45.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/73684?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This test runs the <code class=\"notranslate\">test_expression_index</code> test if <code class=\"notranslate\">supports_expression_index?</code> returns true.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">SQL statement to create unique index for generated column.</p>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">sqlite3</code> adapter CREATE UNIQUE INDEX \"topics_index\" ON \"topics\" ((LOWER(title)))</li>\n<li><code class=\"notranslate\">mysql2</code> and <code class=\"notranslate\">trilogy</code> adapter CREATE UNIQUE INDEX <code class=\"notranslate\">topics_index</code> ON <code class=\"notranslate\">topics</code> ((LOWER(title)))</li>\n<li><code class=\"notranslate\">postgresql</code> adapter CREATE UNIQUE INDEX \"topics_index\" ON \"topics\" ((LOWER(title)))</li>\n</ul>\n<p dir=\"auto\">Follow up <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1925660444\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49483\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49483/hovercard\" href=\"https://github.com/rails/rails/pull/49483\">#49483</a></p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">None</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49485",
            "title": "Run `test_expression_index` if `supports_expression_index?` returns true",
            "date_modified": "2023-10-04T16:22:08.000Z",
            "date_published": "2023-10-04T13:53:28.000Z",
            "author": {
                "name": "yahonda",
                "url": "https://github.com/yahonda"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/14188887?u=3dde79468bf488ae7744ccb72af99477151f9c4c&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #49327.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1904264534\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49327\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/49327/hovercard\" href=\"https://github.com/rails/rails/issues/49327\">#49327</a></p>\n<p dir=\"auto\">This Pull Request simply changes the wording around the definition of what are resource routes and, specifically, what's a \"resourceful controller\", by calling it a \"resource controller\" instead.</p>\n<p dir=\"auto\">As discussed in the issue, although the previous term was fine given the context of the guide, it was probably an improper term, since the meaning seems to be \"the controller for a given resource\" rather than a special type of controller that is said to be resourceful. Furthermore, the term itself, as far as I know, I've only ever seen in the rails guides, whereas <code class=\"notranslate\">resource controller</code> seems to be of more common use.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">As stated above, I change here <code class=\"notranslate\">resourceful controller</code> to <code class=\"notranslate\">resource controller</code>.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">N/A</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49472",
            "title": "[ci skip] Change `resourceful` to `resource` for clarity",
            "date_modified": "2023-10-04T10:46:14.000Z",
            "date_published": "2023-10-03T13:50:48.000Z",
            "author": {
                "name": "mateusdeap",
                "url": "https://github.com/mateusdeap"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">We had a few cases of tests being skipped accidentally on CI hence not being ran for a long time (e.g. <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1916984752\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/49414\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49414/hovercard\" href=\"https://github.com/rails/rails/pull/49414\">#49414</a>).</p>\n<p dir=\"auto\">Skipping make sense when running the test suite locally, e.g. you may not have Redis or some other dependency running.</p>\n<p dir=\"auto\">But on CI, a test not being ran should be considered an error.</p>",
            "url": "https://github.com/rails/rails/pull/49455",
            "title": "Turn skips into errors on Rails CI",
            "date_modified": "2023-10-02T12:01:52.000Z",
            "date_published": "2023-10-02T11:26:57.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Prior to this commit, Blob analysis could only involve a single Analyzer. By default, the metadata typically includes information about dimensions (for image and video).</p>\n<p dir=\"auto\">If applications need to include more involved analysis, they also have to re-implement the dimension analysis on their own (either through composition, inheritance, or copy-pasting).</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This commit extends analysis to support <em>multiple</em> anaylzer classes by replacing <a href=\"https://ruby-doc.org/core-3.0.2/Enumerable.html#method-i-detect\" rel=\"nofollow\">Enumerable#detect</a> with <a href=\"https://ruby-doc.org/core-3.0.2/Enumerable.html#method-i-select\" rel=\"nofollow\">Enumerable#select</a>, and a <a href=\"https://ruby-doc.org/3.2.2/Hash.html#method-i-hash\" rel=\"nofollow\">Hash#merge</a> with an <a href=\"https://ruby-doc.org/core-3.0.2/Enumerable.html#method-i-reduce\" rel=\"nofollow\">Enumerable#reduce</a>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49445",
            "title": "Support multiple analyzers during `ActiveStorage::Blob#analyze`",
            "date_modified": "2023-10-01T21:15:46.000Z",
            "date_published": "2023-10-01T15:18:51.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/47848?u=41ccf0d1865a17f47d140f73a3293f1f3559fc0f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">We use <code class=\"notranslate\">klass</code> because <code class=\"notranslate\">class</code> is a reserved word in Ruby.</p>\n<p dir=\"auto\">But, any word ending with the suffix <code class=\"notranslate\">_class</code> isn't reserved, so we don't need to use the suffix <code class=\"notranslate\">_klass</code> anywhere.</p>",
            "url": "https://github.com/rails/rails/pull/49425",
            "title": "No more _klass",
            "date_modified": "2023-09-29T20:21:39.000Z",
            "date_published": "2023-09-29T00:36:08.000Z",
            "author": {
                "name": "rafaelfranca",
                "url": "https://github.com/rafaelfranca"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">The intent is to skip them if you don't have PG running locally but on CI it's supposed to be running.</p>\n<p dir=\"auto\">If we fail to connect, we should fail CI, not skip these tests.</p>",
            "url": "https://github.com/rails/rails/pull/49414",
            "title": "Do not skip Action Cable PG tests on CI",
            "date_modified": "2023-09-28T08:30:52.000Z",
            "date_published": "2023-09-28T08:30:48.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/688886?u=75c4028c534ed5024b1c9bbbe0144e4ea065a847&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">This PR resolves pg_stat_statements churn for Postgres databases, as described on the forum: <a href=\"https://discuss.rubyonrails.org/t/83667\" rel=\"nofollow\">https://discuss.rubyonrails.org/t/83667</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Currently, array inclusion queries like <code class=\"notranslate\">where(id: [1,2])</code> generate the SQL <code class=\"notranslate\">id IN (1, 2)</code>. Each distinct array length gets normalized separately, resulting in a high number of duplicates in pg_stat_statements and causing churn as there is a limit on the number of queries tracked.</p>\n<p dir=\"auto\">This PR adds a patch for Postgres that generates <code class=\"notranslate\">id = any('{1,2}')</code>, which pg_stat_statements normalizes as a single query no matter the array length.</p>\n<p dir=\"auto\"><code class=\"notranslate\">NOT IN</code> is implemented using <code class=\"notranslate\">!= all()</code> <a href=\"https://stackoverflow.com/a/11730845\" rel=\"nofollow\">https://stackoverflow.com/a/11730845</a></p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This turns out to be a good deal faster (using Postgres 15.4). Here are the min and max iterations per second from several benchmark runs:</p>\n<ul dir=\"auto\">\n<li>490 - 600 on the main branch</li>\n<li>750 - 950 on this branch with <code class=\"notranslate\">BENCHMARK_PREPARED=1</code></li>\n<li>780 - 1020 on this branch with <code class=\"notranslate\">BENCHMARK_PREPARED=0</code></li>\n</ul>\n<details><summary>Here's the benchmark:</summary>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"# Adapted from activerecord/examples/performance.rb\n\nrequire &quot;active_record&quot;\nrequire &quot;benchmark/ips&quot;\n\nTIME    = (ENV[&quot;BENCHMARK_TIME&quot;] || 20).to_i\nRECORDS = (ENV[&quot;BENCHMARK_RECORDS&quot;] || TIME * 1000).to_i\n\nconn = {\n  adapter: &quot;postgresql&quot;,\n  database: &quot;postgres&quot;,\n  prepared_statements: ENV[&quot;BENCHMARK_PREPARED&quot;] == &quot;1&quot;\n}\n\nActiveRecord::Base.establish_connection(conn)\n\nclass User &lt; ActiveRecord::Base\n  connection.create_table :users, force: true do |t|\n    t.string :name, :email\n    t.timestamps\n  end\nend\n\ndef progress_bar(int); print &quot;.&quot; if (int % 100).zero? ; end\n\nputs &quot;Generating data...&quot;\n\nmodule ActiveRecord\n  class Faker\n    LOREM = &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse non aliquet diam. Curabitur vel urna metus, quis malesuada elit.\n     Integer consequat tincidunt felis. Etiam non erat dolor. Vivamus imperdiet nibh sit amet diam eleifend id posuere diam malesuada. Mauris at accumsan sem.\n     Donec id lorem neque. Fusce erat lorem, ornare eu congue vitae, malesuada quis neque. Maecenas vel urna a velit pretium fermentum. Donec tortor enim,\n     tempor venenatis egestas a, tempor sed ipsum. Ut arcu justo, faucibus non imperdiet ac, interdum at diam. Pellentesque ipsum enim, venenatis ut iaculis vitae,\n     varius vitae sem. Sed rutrum quam ac elit euismod bibendum. Donec ultricies ultricies magna, at lacinia libero mollis aliquam. Sed ac arcu in tortor elementum\n     tincidunt vel interdum sem. Curabitur eget erat arcu. Praesent eget eros leo. Nam magna enim, sollicitudin vehicula scelerisque in, vulputate ut libero.\n     Praesent varius tincidunt commodo&quot;.split\n\n    def self.name\n      LOREM.grep(/^\\w*$/).sort_by { rand }.first(2).join &quot; &quot;\n    end\n\n    def self.email\n      LOREM.grep(/^\\w*$/).sort_by { rand }.first(2).join(&quot;@&quot;) + &quot;.com&quot;\n    end\n  end\nend\n\nbegin\n  puts &quot;Inserting #{RECORDS} users...&quot;\n  RECORDS.times do |record|\n    user = User.create(\n      created_at: Date.today,\n      name: ActiveRecord::Faker.name,\n      email: ActiveRecord::Faker.email\n    )\n    progress_bar(record)\n  end\n  puts &quot;Done!\\n&quot;\n\n  Benchmark.ips(TIME) do |x|\n    x.report &quot;Model.where(id: [...])&quot; do\n      User.where(id: (1..100).to_a).count\n    end\n  end\nensure\n  User.connection.drop_table :users\nend\"><pre class=\"notranslate\"><span class=\"pl-c\"># Adapted from activerecord/examples/performance.rb</span>\n\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"active_record\"</span>\n<span class=\"pl-en\">require</span> <span class=\"pl-s\">\"benchmark/ips\"</span>\n\n<span class=\"pl-c1\">TIME</span>    <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"BENCHMARK_TIME\"</span><span class=\"pl-kos\">]</span> || <span class=\"pl-c1\">20</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_i</span>\n<span class=\"pl-c1\">RECORDS</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">(</span><span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"BENCHMARK_RECORDS\"</span><span class=\"pl-kos\">]</span> || <span class=\"pl-c1\">TIME</span> * <span class=\"pl-c1\">1000</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_i</span>\n\n<span class=\"pl-s1\">conn</span> <span class=\"pl-c1\">=</span> <span class=\"pl-kos\">{</span>\n  <span class=\"pl-pds\">adapter</span>: <span class=\"pl-s\">\"postgresql\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">database</span>: <span class=\"pl-s\">\"postgres\"</span><span class=\"pl-kos\">,</span>\n  <span class=\"pl-pds\">prepared_statements</span>: <span class=\"pl-c1\">ENV</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"BENCHMARK_PREPARED\"</span><span class=\"pl-kos\">]</span> == <span class=\"pl-s\">\"1\"</span>\n<span class=\"pl-kos\">}</span>\n\n<span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">establish_connection</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">conn</span><span class=\"pl-kos\">)</span>\n\n<span class=\"pl-k\">class</span> <span class=\"pl-v\">User</span> &lt; <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Base</span>\n  <span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:users</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-c1\">true</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">string</span> <span class=\"pl-pds\">:name</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:email</span>\n    <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">timestamps</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">def</span> <span class=\"pl-en\">progress_bar</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">int</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">;</span> <span class=\"pl-en\">print</span> <span class=\"pl-s\">\".\"</span> <span class=\"pl-k\">if</span> <span class=\"pl-kos\">(</span><span class=\"pl-s1\">int</span> % <span class=\"pl-c1\">100</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">zero?</span> <span class=\"pl-kos\">;</span> <span class=\"pl-k\">end</span>\n\n<span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Generating data...\"</span>\n\n<span class=\"pl-k\">module</span> <span class=\"pl-v\">ActiveRecord</span>\n  <span class=\"pl-k\">class</span> <span class=\"pl-v\">Faker</span>\n    <span class=\"pl-c1\">LOREM</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse non aliquet diam. Curabitur vel urna metus, quis malesuada elit.</span>\n<span class=\"pl-s\">     Integer consequat tincidunt felis. Etiam non erat dolor. Vivamus imperdiet nibh sit amet diam eleifend id posuere diam malesuada. Mauris at accumsan sem.</span>\n<span class=\"pl-s\">     Donec id lorem neque. Fusce erat lorem, ornare eu congue vitae, malesuada quis neque. Maecenas vel urna a velit pretium fermentum. Donec tortor enim,</span>\n<span class=\"pl-s\">     tempor venenatis egestas a, tempor sed ipsum. Ut arcu justo, faucibus non imperdiet ac, interdum at diam. Pellentesque ipsum enim, venenatis ut iaculis vitae,</span>\n<span class=\"pl-s\">     varius vitae sem. Sed rutrum quam ac elit euismod bibendum. Donec ultricies ultricies magna, at lacinia libero mollis aliquam. Sed ac arcu in tortor elementum</span>\n<span class=\"pl-s\">     tincidunt vel interdum sem. Curabitur eget erat arcu. Praesent eget eros leo. Nam magna enim, sollicitudin vehicula scelerisque in, vulputate ut libero.</span>\n<span class=\"pl-s\">     Praesent varius tincidunt commodo\"</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">split</span>\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span>\n      <span class=\"pl-c1\">LOREM</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">grep</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/^<span class=\"pl-cce\">\\w</span>*$/</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">sort_by</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">rand</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">2</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span> <span class=\"pl-s\">\" \"</span>\n    <span class=\"pl-k\">end</span>\n\n    <span class=\"pl-k\">def</span> <span class=\"pl-smi\">self</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">email</span>\n      <span class=\"pl-c1\">LOREM</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">grep</span><span class=\"pl-kos\">(</span><span class=\"pl-sr\">/^<span class=\"pl-cce\">\\w</span>*$/</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">sort_by</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">rand</span> <span class=\"pl-kos\">}</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">first</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">2</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">join</span><span class=\"pl-kos\">(</span><span class=\"pl-s\">\"@\"</span><span class=\"pl-kos\">)</span> + <span class=\"pl-s\">\".com\"</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-k\">begin</span>\n  <span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Inserting <span class=\"pl-s1\"><span class=\"pl-kos\">#{</span><span class=\"pl-c1\">RECORDS</span><span class=\"pl-kos\">}</span></span> users...\"</span>\n  <span class=\"pl-c1\">RECORDS</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">times</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">record</span>|\n    <span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">create</span><span class=\"pl-kos\">(</span>\n      <span class=\"pl-pds\">created_at</span>: <span class=\"pl-v\">Date</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">today</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-pds\">name</span>: <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Faker</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span><span class=\"pl-kos\">,</span>\n      <span class=\"pl-pds\">email</span>: <span class=\"pl-v\">ActiveRecord</span>::<span class=\"pl-v\">Faker</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">email</span>\n    <span class=\"pl-kos\">)</span>\n    <span class=\"pl-en\">progress_bar</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">record</span><span class=\"pl-kos\">)</span>\n  <span class=\"pl-k\">end</span>\n  <span class=\"pl-en\">puts</span> <span class=\"pl-s\">\"Done!<span class=\"pl-cce\">\\n</span>\"</span>\n\n  <span class=\"pl-v\">Benchmark</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">ips</span><span class=\"pl-kos\">(</span><span class=\"pl-c1\">TIME</span><span class=\"pl-kos\">)</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">x</span>|\n    <span class=\"pl-s1\">x</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">report</span> <span class=\"pl-s\">\"Model.where(id: [...])\"</span> <span class=\"pl-k\">do</span>\n      <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">where</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">id</span>: <span class=\"pl-kos\">(</span><span class=\"pl-c1\">1</span>..<span class=\"pl-c1\">100</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_a</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">count</span>\n    <span class=\"pl-k\">end</span>\n  <span class=\"pl-k\">end</span>\n<span class=\"pl-k\">ensure</span>\n  <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">connection</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">drop_table</span> <span class=\"pl-pds\">:users</span>\n<span class=\"pl-k\">end</span></pre></div>\n</details>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49388",
            "title": "Reduce pg_stat_statements churn using `= any()` instead of `IN ()`",
            "date_modified": "2023-10-04T14:26:35.000Z",
            "date_published": "2023-09-26T16:23:19.000Z",
            "author": {
                "name": "seanlinsley",
                "url": "https://github.com/seanlinsley"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/47848?u=41ccf0d1865a17f47d140f73a3293f1f3559fc0f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">It is not removing all the shards connections when we call it.</p>\n<p dir=\"auto\">It is because the first time we call it we are resetting the <code class=\"notranslate\">connection_specification_name</code> so the next call doesn't find the right connection pool.</p>",
            "url": "https://github.com/rails/rails/pull/49382",
            "title": "Add failing test for remove_connection",
            "date_modified": "2023-09-28T17:05:37.000Z",
            "date_published": "2023-09-26T00:16:29.000Z",
            "author": {
                "name": "rafaelfranca",
                "url": "https://github.com/rafaelfranca"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Follow-up to <a href=\"https://github.com/rails/rails/pull/49371\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/49371/hovercard\">#49371</a></p>\n<p dir=\"auto\">In the wake of the deprecation of <code class=\"notranslate\">tag(:div)</code> in favor of <code class=\"notranslate\">tag.div</code>, this commit replaces all calls made internally with the more modern syntax.</p>\n<p dir=\"auto\">This change is separate from the deprecation cycle, since there are <strong>slight</strong> behavioral changes, since the HTML output changes from self-closing elements like <code class=\"notranslate\">&lt;input /&gt;</code> to open void elements like <code class=\"notranslate\">&lt;input&gt;</code>.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49377",
            "title": "Action View: Remove internal calls to `tag` with positional arguments",
            "date_modified": "2023-10-05T23:47:01.000Z",
            "date_published": "2023-09-25T13:10:59.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5077225?u=e9f968c9eb790ee7734442f6b7998155400ad1d8&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">SQLite is a feature-rich database engine, and production usage is only growing. We need Rails' support to offer developers the range and scope of its features.</p>\n<p dir=\"auto\">The PostgreSQL adapter supports deferred foreign keys, and SQLite itself has support <a href=\"https://www.sqlite.org/foreignkeys.html#fk_deferred\" rel=\"nofollow\">deferred foreign keys</a> <a href=\"https://www.sqlite.org/releaselog/3_7_6.html\" rel=\"nofollow\">since at least 2011</a>.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Implementing the full <code class=\"notranslate\">supports_deferrable_constraints?</code> contract allows foreign keys to be deferred by adding the <code class=\"notranslate\">:deferrable</code> key to the <code class=\"notranslate\">foreign_key</code> options in the <code class=\"notranslate\">add_reference</code> and <code class=\"notranslate\">add_foreign_key</code> methods.</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"add_reference :person, :alias, foreign_key: { deferrable: :deferred }\nadd_reference :alias, :person, foreign_key: { deferrable: :deferred }\"><pre class=\"notranslate\"><span class=\"pl-en\">add_reference</span> <span class=\"pl-pds\">:person</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:alias</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">foreign_key</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">deferrable</span>: <span class=\"pl-pds\">:deferred</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-en\">add_reference</span> <span class=\"pl-pds\">:alias</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:person</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">foreign_key</span>: <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">deferrable</span>: <span class=\"pl-pds\">:deferred</span> <span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">In this PR, I am adding full support for the SQLite3Adapter by implementing:</p>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaCreation#visit_AddForeignKey</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaCreation#visit_ForeignKeyDefinition</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#supports_deferrable_constraints?</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaStatements#assert_valid_deferrable</code></p>\n<p dir=\"auto\">and altering:</p>\n<p dir=\"auto\"><code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3::SchemaStatements#add_foreign_key</code><br>\n<code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#foreign_keys</code></p>\n<h3 dir=\"auto\">Additional Info</h3>\n<p dir=\"auto\">In order to get the <code class=\"notranslate\">ActiveRecord::ConnectionAdapters::SQLite3Adapter#foreign_keys</code> method working properly, I had to add a query to get the <code class=\"notranslate\">CREATE TABLE</code> sql and parse which foreign key constraints are deferrable and which of those are deferred. In order to support this use-case, I extracted a <code class=\"notranslate\">table_structure_sql</code> method which now <code class=\"notranslate\">table_structure_with_collation</code> relies on.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Changes that are unrelated should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/49376",
            "title": "The SQLite3 adapter now implements the `supports_deferrable_constraints?` contract",
            "date_modified": "2023-10-03T11:51:08.000Z",
            "date_published": "2023-09-25T08:41:00.000Z",
            "author": {
                "name": "fractaledmind",
                "url": "https://github.com/fractaledmind"
            }
        }
    ]
}