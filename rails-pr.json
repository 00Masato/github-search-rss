{
    "version": "https://jsonfeed.org/version/1",
    "title": "rails/rails pr",
    "home_page_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "feed_url": "https://00masato.github.io/github-search-rss/rails-pr.json",
    "description": "rails/rails pr on GitHub",
    "items": [
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/3124?u=6ece6a5a8b8ea32c5fa94c325d151bc01d1e44e8&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR uses the <a href=\"https://github.com/minitest/minitest/pull/1002\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/minitest/minitest/pull/1002/hovercard\">possible Minitest manual plugin API</a> to manually register the Rails minitest plugin.</p>\n<p dir=\"auto\">First, it renames the minitest plugin so that Minitest will never try to automatically load the Rails minitest plugin <em>outside</em> of Rails applications.</p>\n<p dir=\"auto\">Second, it changes our test helper to require the Minitest plugin and manually register it.  This allows the Rails plugin to participate in Minitests' plugin lifecycle, but <em>only</em> within the context of a Rails application.  Other non-Rails applications<br>\nwill never inadvertently load this plugin.</p>\n<p dir=\"auto\">I think I'll have to do some refactoring to get our CI to pass, but if the Minitest PR lands, we can merge this.</p>\n<p dir=\"auto\">Here is the manual registration in action:</p>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/3124/339146591-87509f06-d4c4-4187-8a81-d2bbb7a4acd1.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTgyMzczODgsIm5iZiI6MTcxODIzNzA4OCwicGF0aCI6Ii8zMTI0LzMzOTE0NjU5MS04NzUwOWYwNi1kNGM0LTQxODctOGE4MS1kMmJiYjdhNGFjZDEucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDYxMyUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA2MTNUMDAwNDQ4WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9OTljMmI1OTYwYmQ5NzBmNWM3NzM0MTkzMzAxNjg3OWQyMTRmYWNiZTgyYTQ5Yzg3MDA1NGQ4YzU2Y2E0MjJkNyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.zEoAJvQxRqy9D1X6zISR8_Bnd2-g3Q7csTDgmrkEi4U\"><img width=\"1593\" alt=\"Screenshot 2024-06-12 at 3 06 59‚ÄØPM\" src=\"https://private-user-images.githubusercontent.com/3124/339146591-87509f06-d4c4-4187-8a81-d2bbb7a4acd1.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTgyMzczODgsIm5iZiI6MTcxODIzNzA4OCwicGF0aCI6Ii8zMTI0LzMzOTE0NjU5MS04NzUwOWYwNi1kNGM0LTQxODctOGE4MS1kMmJiYjdhNGFjZDEucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDYxMyUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA2MTNUMDAwNDQ4WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9OTljMmI1OTYwYmQ5NzBmNWM3NzM0MTkzMzAxNjg3OWQyMTRmYWNiZTgyYTQ5Yzg3MDA1NGQ4YzU2Y2E0MjJkNyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.zEoAJvQxRqy9D1X6zISR8_Bnd2-g3Q7csTDgmrkEi4U\" style=\"max-width: 100%;\"></a>\n<p dir=\"auto\">Rails specific help text is still shown:</p>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/3124/339146496-22719bfc-c0b9-4294-8e1f-eec3f080b41a.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTgyMzczODgsIm5iZiI6MTcxODIzNzA4OCwicGF0aCI6Ii8zMTI0LzMzOTE0NjQ5Ni0yMjcxOWJmYy1jMGI5LTQyOTQtOGUxZi1lZWMzZjA4MGI0MWEucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDYxMyUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA2MTNUMDAwNDQ4WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9OGY5YmE0MmMxYWViOThjMzEwOWRiZTlmNTBlYmQ5Y2MyNTJjZGIyZjkxNGM0ZGRlMGRhYmNlMzkyNmZiZjJmMiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.HzhCYuoCZNXTqy_p_2JDlH1DQBD8o9vkcpmNw2Fmvhs\"><img width=\"1593\" alt=\"Screenshot 2024-06-12 at 3 08 22‚ÄØPM\" src=\"https://private-user-images.githubusercontent.com/3124/339146496-22719bfc-c0b9-4294-8e1f-eec3f080b41a.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTgyMzczODgsIm5iZiI6MTcxODIzNzA4OCwicGF0aCI6Ii8zMTI0LzMzOTE0NjQ5Ni0yMjcxOWJmYy1jMGI5LTQyOTQtOGUxZi1lZWMzZjA4MGI0MWEucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDYxMyUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA2MTNUMDAwNDQ4WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9OGY5YmE0MmMxYWViOThjMzEwOWRiZTlmNTBlYmQ5Y2MyNTJjZGIyZjkxNGM0ZGRlMGRhYmNlMzkyNmZiZjJmMiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.HzhCYuoCZNXTqy_p_2JDlH1DQBD8o9vkcpmNw2Fmvhs\" style=\"max-width: 100%;\"></a>",
            "url": "https://github.com/rails/rails/pull/52109",
            "title": "[WIP] Manually register the Rails Minitest plugin",
            "date_modified": "2024-06-12T22:26:48.000Z",
            "date_published": "2024-06-12T22:08:43.000Z",
            "author": {
                "name": "tenderlove",
                "url": "https://github.com/tenderlove"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/19192189?u=dd60737844a9db7f1475bab21fc3e5258a405e15&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes pull request #52017.\">Closes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2332824181\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52017\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/52017/hovercard\" href=\"https://github.com/rails/rails/pull/52017\">#52017</a></p>\n<h3 dir=\"auto\"><code class=\"notranslate\">.current_transaction</code> lifetime</h3>\n<p dir=\"auto\">One concern raised by <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/fxn/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/fxn\">@fxn</a> is users holding on the return value of <code class=\"notranslate\">.current_transaction</code> beyond the point where it is committed / rolled back / invalidated.</p>\n<p dir=\"auto\">I believe this is an invalid use of the API, just like holding <code class=\"notranslate\">ActiveRecord::Base.connection</code> beyond the scope of a request is, and may even lead to terrible results.</p>\n<p dir=\"auto\">However we can be more explicit and strict about it, so I changed the callback registration methods to raise an error when called on a finalized transaction.</p>\n<h3 dir=\"auto\"><code class=\"notranslate\">:transaction</code> event payload</h3>\n<p dir=\"auto\">Another concern of <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/fxn/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/fxn\">@fxn</a> was the usability of the null-object in the Active Record notification payloads, and I agree that while the null-object make sense when calling <code class=\"notranslate\">Model.current_transaction</code>, it doesn't make sense to include it in the payload of events. The goal of the <code class=\"notranslate\">.current_transaction</code> API is to allow implementing transaction aware code in a streamlined way.</p>\n<p dir=\"auto\">The goal of the <code class=\"notranslate\">:transaction</code> in events however it to allow logging whether a query was inside a transaction or not, so it's much more ergonomic for it to be nilable. So I kept <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a> 's change that passes <code class=\"notranslate\">transaction: nil</code> in <code class=\"notranslate\">sql.active_record</code> events when not inside a transaction. I also added test coverage to make sure it behaves consistently whether we're inside a transactional test or not.</p>\n<h3 dir=\"auto\">Refactoring</h3>\n<p dir=\"auto\">I also kept the separation between internal and \"user\" transaction objects, as I think it's a nice way to limit the effectively exposed API, and prevent users from abusing that API too much.</p>\n<h2 dir=\"auto\">Non addressed concerns</h2>\n<h3 dir=\"auto\">Callback ordering</h3>\n<p dir=\"auto\"><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/fxn/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/fxn\">@fxn</a> also raised the following concern:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Post.current_transaction.after_commit { should_be_called_last }\nPost.current_transaction.before_commit { should_be_called_first }\"><pre class=\"notranslate\"><span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">current_transaction</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">after_commit</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">should_be_called_last</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">current_transaction</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">before_commit</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">should_be_called_first</span> <span class=\"pl-kos\">}</span></pre></div>\n<p dir=\"auto\">In the example above, the call order is inconsistent whether you are inside a transaction or not.</p>\n<p dir=\"auto\">I don't have an answer to this aside from documenting it. But I really don't think it's big enough of a problem to justify returning <code class=\"notranslate\">nil</code> in <code class=\"notranslate\">.current_transaction</code>, because it would result in the above code turning into:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"if Post.current_transaction\n  Post.current_transaction.after_commit { should_be_called_last }\n  Post.current_transaction.before_commit { should_be_called_first }\nelse\n  should_be_called_first\n  should_be_called_last\nend\"><pre class=\"notranslate\"><span class=\"pl-k\">if</span> <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">current_transaction</span>\n  <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">current_transaction</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">after_commit</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">should_be_called_last</span> <span class=\"pl-kos\">}</span>\n  <span class=\"pl-v\">Post</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">current_transaction</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">before_commit</span> <span class=\"pl-kos\">{</span> <span class=\"pl-en\">should_be_called_first</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">else</span>\n  <span class=\"pl-en\">should_be_called_first</span>\n  <span class=\"pl-en\">should_be_called_last</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Which, in my opinion, is more verbose, inelegant and ultimately more error prone, as you now have two code paths to keep in sync.</p>\n<p dir=\"auto\">One option however could be to simply not expose <code class=\"notranslate\">before_commit</code>, which arguably is much much less useful than <code class=\"notranslate\">after_commit</code> and <code class=\"notranslate\">after_callback</code> and which I only really included for completeness. As a matter of fact, the private API we currently use at Shopify to register callbacks on transactions only offer <code class=\"notranslate\">after_commit</code> and <code class=\"notranslate\">after_rollback</code>, so I can't justify a need for it, and we could always consider adding it later if users come up with use cases.</p>",
            "url": "https://github.com/rails/rails/pull/52104",
            "title": "Harden the `.current_transaction` API",
            "date_modified": "2024-06-12T16:11:01.000Z",
            "date_published": "2024-06-12T09:59:45.000Z",
            "author": {
                "name": "casperisfine",
                "url": "https://github.com/casperisfine"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/30030?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">See <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2341930906\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52066\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/52066/hovercard\" href=\"https://github.com/rails/rails/issues/52066\">#52066</a> for context. This PR also includes <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2347602697\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52096\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/52096/hovercard\" href=\"https://github.com/rails/rails/pull/52096\">#52096</a> so that all tests pass.</p>\n<p dir=\"auto\">Rack 3 introduced several features to enhance how \"streaming\" responses are handled.</p>\n<ul dir=\"auto\">\n<li>The presence of <code class=\"notranslate\">body#to_ary</code> indicates that a response can be buffered (i.e. converted to an Array of String instances, without affecting the application behaviour).</li>\n<li><code class=\"notranslate\">#each</code> consumes the body, i.e. yields successive chunks that can be sent incrementally using chunked encoding. This is also somewhat valid for Rack 2.</li>\n<li>Instead of responding to <code class=\"notranslate\">#each</code>, a body can respond to <code class=\"notranslate\">#call</code>, which gets invoked like a partial hijack and has identical semantics.</li>\n</ul>\n<p dir=\"auto\">Rails is still generating <code class=\"notranslate\">transfer-encoding: chunked</code> encoded responses as a Rack body, which can cause problems:</p>\n<ul dir=\"auto\">\n<li>Other Rack middleware may not be able to correctly manipulate the response body because it is encoded.\n<ul dir=\"auto\">\n<li>e.g. <code class=\"notranslate\">rack-cache</code> has been mentioned. However, it's <a href=\"https://github.com/socketry/async-http-cache/blob/main/lib/async/http/cache/general.rb#L171-L178\">absolutely possible to cache streaming responses</a> and this is just a limitation of the current implementation of Rails.</li>\n</ul>\n</li>\n<li><code class=\"notranslate\">transfer-encoding</code> is not supported by HTTP/2 as every response is effectively considered chunked and the wire format uses binary framing rather than length-prefixed chunked encoding. The Rails implementation is more limited than necessary in this regard.</li>\n<li>The complexity of the implementation is unnecessarily high and specific to HTTP/1. In addition, this complexity is already handled by the servers in a protocol-appropriate way.</li>\n</ul>\n<p dir=\"auto\">This change removes the explicit transfer encoding and instead relies on servers to correctly encode the response.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52094",
            "title": "Utilize Rack 3 streaming.",
            "date_modified": "2024-06-12T16:28:44.000Z",
            "date_published": "2024-06-12T00:49:50.000Z",
            "author": {
                "name": "ioquatix",
                "url": "https://github.com/ioquatix"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/474442?u=d5b5e080bdb67e9d1402d3f2490398c4015555c1&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\">This Pull Request has been created because <code class=\"notranslate\">to_time</code> on TimeWithZone object does not preserve timezone information. This PR adds a config to preserve timezone information when calling <code class=\"notranslate\">to_time</code> on TimeWithZone object.</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This Pull Request adds a new config value <code class=\"notranslate\">:zone</code> for <code class=\"notranslate\">ActiveSupport.to_time_preserves_timezone</code>. In addition, the existing <code class=\"notranslate\">true</code> value for <code class=\"notranslate\">ActiveSupport.to_time_preserves_timezone</code> has been changed to <code class=\"notranslate\">:offset</code> and preserves the previous behavior of using UTC offset.<br>\nWhen it's set to <code class=\"notranslate\">:zone</code>, <code class=\"notranslate\">to_time</code> will return a Time object with the same timezone as the TimeWithZone object.<br>\nDefault value for <code class=\"notranslate\">ActiveSupport.to_time_preserves_timezone</code> is now <code class=\"notranslate\">:zone</code> in 8.0.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">cc: <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/jhawthorn/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/jhawthorn\">@jhawthorn</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a></p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52091",
            "title": "Add a config for preserving timezone information when calling `to_time` on TimeWithZone object",
            "date_modified": "2024-06-12T23:57:19.000Z",
            "date_published": "2024-06-11T19:09:34.000Z",
            "author": {
                "name": "jasonkim",
                "url": "https://github.com/jasonkim"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/131752?u=32ddf1119b1d189c9bd241a721b36ea01c29f61e&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">At one point (I believe ruby 1.9.2) Time could only represent values between 1970 and the integer overflow in 2038. On modern Ruby there does not seem to be a limit.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&gt;&gt; Time.at(2**128)\n=&gt; 10783118943836478994022445751222-08-06 01:04:16 -0700\"><pre class=\"notranslate\"><code class=\"notranslate\">&gt;&gt; Time.at(2**128)\n=&gt; 10783118943836478994022445751222-08-06 01:04:16 -0700\n</code></pre></div>\n<p dir=\"auto\"><code class=\"notranslate\">TimeWithZone</code> will also convert a <code class=\"notranslate\">DateTime</code> to a <code class=\"notranslate\">Time</code> when initialized with one, so the code we had to catch this overflow and to deal with <code class=\"notranslate\">DateTime</code> is dead. This commit removes this code and adjusts the test to be more general (the old test passed but we might as well keep a better version of the test to check that we have a large both negative and positive range).</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ docker run -e 'ALL_RUBY_SINCE=ruby-1.8' --rm rubylang/all-ruby ./all-ruby -e 'puts Time.at(2**64)'\nruby-1.8.0            -e:1:in `at': bignum too big to convert into `int' (RangeError)\n                      \tfrom -e:1\n                  exit 1\nruby-1.8.1            -e:1:in `at': bignum too big to convert into `int' (RangeError)\n                      \tfrom -e:1\n                  exit 1\nruby-1.8.2-preview1   -e:1:in `at': bignum too big to convert into `long' (RangeError)\n                      \tfrom -e:1\n                  exit 1\n...\nruby-1.8.6-p420       -e:1:in `at': bignum too big to convert into `long' (RangeError)\n                      \tfrom -e:1\n                  exit 1\nruby-1.8.7-preview1   Thu Jan 01 00:00:00 +0000 1970\n...\nruby-1.8.7-p374       Thu Jan 01 00:00:00 +0000 1970\nruby-1.9.0-0          -e:1:in `at': bignum too big to convert into `long' (RangeError)\n                      \tfrom -e:1:in `&lt;main&gt;'\n                  exit 1\n...\nruby-1.9.1-p431       -e:1:in `at': bignum too big to convert into `long' (RangeError)\n                      \tfrom -e:1:in `&lt;main&gt;'\n                  exit 1\nruby-1.9.2-preview1   584554051223-11-09 07:00:16 +0000\n...\nruby-3.4.0-preview1   584554051223-11-09 07:00:16 +0000\"><pre class=\"notranslate\"><code class=\"notranslate\">$ docker run -e 'ALL_RUBY_SINCE=ruby-1.8' --rm rubylang/all-ruby ./all-ruby -e 'puts Time.at(2**64)'\nruby-1.8.0            -e:1:in `at': bignum too big to convert into `int' (RangeError)\n                      \tfrom -e:1\n                  exit 1\nruby-1.8.1            -e:1:in `at': bignum too big to convert into `int' (RangeError)\n                      \tfrom -e:1\n                  exit 1\nruby-1.8.2-preview1   -e:1:in `at': bignum too big to convert into `long' (RangeError)\n                      \tfrom -e:1\n                  exit 1\n...\nruby-1.8.6-p420       -e:1:in `at': bignum too big to convert into `long' (RangeError)\n                      \tfrom -e:1\n                  exit 1\nruby-1.8.7-preview1   Thu Jan 01 00:00:00 +0000 1970\n...\nruby-1.8.7-p374       Thu Jan 01 00:00:00 +0000 1970\nruby-1.9.0-0          -e:1:in `at': bignum too big to convert into `long' (RangeError)\n                      \tfrom -e:1:in `&lt;main&gt;'\n                  exit 1\n...\nruby-1.9.1-p431       -e:1:in `at': bignum too big to convert into `long' (RangeError)\n                      \tfrom -e:1:in `&lt;main&gt;'\n                  exit 1\nruby-1.9.2-preview1   584554051223-11-09 07:00:16 +0000\n...\nruby-3.4.0-preview1   584554051223-11-09 07:00:16 +0000\n</code></pre></div>",
            "url": "https://github.com/rails/rails/pull/52084",
            "title": "Remove dead code for DateTime-backed TimeWithZone",
            "date_modified": "2024-06-12T18:48:49.000Z",
            "date_published": "2024-06-11T00:38:12.000Z",
            "author": {
                "name": "jhawthorn",
                "url": "https://github.com/jhawthorn"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #52074.\">Fixes</span>  <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2343095558\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52074\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/52074/hovercard\" href=\"https://github.com/rails/rails/issues/52074\">#52074</a>.</p>\n<p dir=\"auto\">Previously, when the record was created with an enum value not in the list and then retrieved from the database, it had <code class=\"notranslate\">nil</code> as the enum's value. Now, it will have the actual value.</p>\n<p dir=\"auto\">I am not sure if this will be expected for users or not. But other methods in the <code class=\"notranslate\">EnumType</code> class seems like doing similar things, like, for example, storing the original value if there is no a match in the enum definition. </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/rails/rails/blob/0733ab511877d6b61932615ca7d51b069fbe5cb3/activerecord/lib/active_record/enum.rb#L180-L200\">rails/activerecord/lib/active_record/enum.rb</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 180 to 200\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/rails/rails/commit/0733ab511877d6b61932615ca7d51b069fbe5cb3\">0733ab5</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L180\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"180\"></td>\n          <td id=\"LC180\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">cast</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L181\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"181\"></td>\n          <td id=\"LC181\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">if</span> <span class=\"pl-en\">mapping</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">has_key?</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L182\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"182\"></td>\n          <td id=\"LC182\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">value</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">to_s</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L183\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"183\"></td>\n          <td id=\"LC183\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">elsif</span> <span class=\"pl-en\">mapping</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">has_value?</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L184\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"184\"></td>\n          <td id=\"LC184\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">mapping</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">key</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L185\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"185\"></td>\n          <td id=\"LC185\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">else</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L186\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"186\"></td>\n          <td id=\"LC186\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">value</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">presence</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L187\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"187\"></td>\n          <td id=\"LC187\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-k\">end</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L188\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"188\"></td>\n          <td id=\"LC188\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L189\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"189\"></td>\n          <td id=\"LC189\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L190\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"190\"></td>\n          <td id=\"LC190\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">deserialize</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L191\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"191\"></td>\n          <td id=\"LC191\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">mapping</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">key</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">subtype</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">deserialize</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L192\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"192\"></td>\n          <td id=\"LC192\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L193\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"193\"></td>\n          <td id=\"LC193\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L194\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"194\"></td>\n          <td id=\"LC194\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">serialize</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L195\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"195\"></td>\n          <td id=\"LC195\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">subtype</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">serialize</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">mapping</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">fetch</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L196\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"196\"></td>\n          <td id=\"LC196\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L197\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"197\"></td>\n          <td id=\"LC197\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L198\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"198\"></td>\n          <td id=\"LC198\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">def</span> <span class=\"pl-en\">serializable?</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">,</span> &amp;<span class=\"pl-s1\">block</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L199\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"199\"></td>\n          <td id=\"LC199\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">   <span class=\"pl-en\">subtype</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">serializable?</span><span class=\"pl-kos\">(</span><span class=\"pl-en\">mapping</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">fetch</span><span class=\"pl-kos\">(</span><span class=\"pl-s1\">value</span><span class=\"pl-kos\">,</span> <span class=\"pl-s1\">value</span><span class=\"pl-kos\">)</span><span class=\"pl-kos\">,</span> &amp;<span class=\"pl-s1\">block</span><span class=\"pl-kos\">)</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L200\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"200\"></td>\n          <td id=\"LC200\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">end</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>",
            "url": "https://github.com/rails/rails/pull/52078",
            "title": "Fix creating records without partial inserts and enum with database default not in the definition",
            "date_modified": "2024-06-10T11:08:31.000Z",
            "date_published": "2024-06-10T11:08:27.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/12777550?u=415303ec1c626279c440cf729435fc0ee833d1c9&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/>\n<h3 dir=\"auto\">Motivation / Background</h3>\n\n<p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #51817.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2295142022\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51817\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51817/hovercard\" href=\"https://github.com/rails/rails/issues/51817\">#51817</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Currently, Rails doesn't have a mechanism to allow the main record to efficiently access its <code class=\"notranslate\">has_one :through</code> associations via the middle record.</p>\n<p dir=\"auto\">When we define a <code class=\"notranslate\">has_one :through</code> association, Rails creates a <code class=\"notranslate\">HasOneThroughAssociation</code> object within that record. Like all other Association objects, <code class=\"notranslate\">HasOneThroughAssociation</code> works independently and doesn't check the loading status of other associations. If it doesn't find the record within the object itself, it simply queries the database. And this triggers an additional query even when all associated records are preloaded.</p>\n<p dir=\"auto\">On top of that, making another query for an already loaded association results in having two identical records in memory. This can confuse developers about which record is the single source of truth. When one record is updated, the other remains unchanged. Here is an example:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"member.membership.club.name = 'New Club'\n\nmember.membership.club.name # =&gt; 'New Club'\nmember.club.name            # =&gt; 'Old Club'\"><pre class=\"notranslate\"><span class=\"pl-en\">member</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">membership</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">club</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">'New Club'</span>\n\n<span class=\"pl-en\">member</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">membership</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">club</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span> <span class=\"pl-c\"># =&gt; 'New Club'</span>\n<span class=\"pl-en\">member</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">club</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">name</span>            <span class=\"pl-c\"># =&gt; 'Old Club'</span></pre></div>\n<p dir=\"auto\">The changes prevent the additional query and ensure there is a single source of truth.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">I tried to apply the same approach to the <code class=\"notranslate\">has_many :through</code> association, but it is not as straightforward as the <code class=\"notranslate\">has_one :through</code> association. All the final records are stored in each middle record's association object. So, we need to find a better way to implement this. I will look into this more and create another PR if I find a solution.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52060",
            "title": "[Fix #51817] Allow Preloaded `has_one :through` Associations to be Accessed Without Additional Database Queries",
            "date_modified": "2024-06-12T02:23:23.000Z",
            "date_published": "2024-06-08T11:11:29.000Z",
            "author": {
                "name": "Jay0921",
                "url": "https://github.com/Jay0921"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/83998?u=8bb33de7a19d113d9f589689f6d15bb622b132bd&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">There are many cases when using double quotes is necessary to properly identify type &amp; column names in PostgreSQL. This PR aims to address one subset of cases relating to Rails's support of PG Enums in <code class=\"notranslate\">schema.rb</code>.</p>\n<p dir=\"auto\">As it stands, PG Enums that require quote identifiers can be successfully created with the migration DSL, but these type names do not currently survive the round-trip to <code class=\"notranslate\">schema.rb</code>, breaking subsequent <code class=\"notranslate\">schema:load</code> calls.</p>\n<p dir=\"auto\">(If this change is accepted, I have additional cases I would propose in follow-up PRs, but I am focusing on one change at a time.)</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Note that I'm using <code class=\"notranslate\">.</code> here as an example, but there are other reasons why quote identifiers can be necessary, including case sensitivity.</p>\n<h4 dir=\"auto\">Before:</h4>\n<p dir=\"auto\"><em>Without</em> this PR's changes, the following migration:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"create_enum '&quot;my.status&quot;', %w[complete in_progress]\ncreate_table :things do |t|\n  t.enum :status, enum_type: '&quot;my.status&quot;', default: &quot;in_progress&quot;, null: false\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">create_enum</span> <span class=\"pl-s\">'\"my.status\"'</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">%w[</span><span class=\"pl-s\">complete</span> <span class=\"pl-s\">in_progress</span><span class=\"pl-kos\">]</span>\n<span class=\"pl-en\">create_table</span> <span class=\"pl-pds\">:things</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">enum</span> <span class=\"pl-pds\">:status</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">enum_type</span>: <span class=\"pl-s\">'\"my.status\"'</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">default</span>: <span class=\"pl-s\">\"in_progress\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">null</span>: <span class=\"pl-c1\">false</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">Produces the following in the <code class=\"notranslate\">schema.rb</code> file:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"create_enum &quot;my.status&quot;, [&quot;complete&quot;, &quot;in_progress&quot;]\n\ncreate_table &quot;things&quot;, force: :cascade do |t|\n  t.enum &quot;status&quot;, default: &quot;in_progress&quot;, null: false, enum_type: &quot;&quot;my.status&quot;&quot;\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">create_enum</span> <span class=\"pl-s\">\"my.status\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">[</span><span class=\"pl-s\">\"complete\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"in_progress\"</span><span class=\"pl-kos\">]</span>\n\n<span class=\"pl-en\">create_table</span> <span class=\"pl-s\">\"things\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-pds\">:cascade</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">enum</span> <span class=\"pl-s\">\"status\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">default</span>: <span class=\"pl-s\">\"in_progress\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">null</span>: <span class=\"pl-c1\">false</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">enum_type</span>: <span class=\"pl-s\">\"\"</span><span class=\"pl-en\">my</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">status</span><span class=\"pl-s\">\"\"</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">üêõ Both the <code class=\"notranslate\">create_enum</code> statement and the <code class=\"notranslate\">:enum_type</code> option do not function as expected. The former produces a <code class=\"notranslate\">PG::InvalidSchemaName</code> error (because it assumes <code class=\"notranslate\">my.</code> is a PG schema), and the latter is not even valid Ruby.</p>\n<h4 dir=\"auto\">After:</h4>\n<p dir=\"auto\"><em>With</em> this PR's changes, <code class=\"notranslate\">schema.rb</code> contains the following:</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"create_enum &quot;\\&quot;my.status\\&quot;&quot;, [&quot;complete&quot;, &quot;in_progress&quot;]\n\ncreate_table &quot;things&quot;, force: :cascade do |t|\n  t.enum &quot;status&quot;, default: &quot;in_progress&quot;, null: false, enum_type: &quot;\\&quot;my.status\\&quot;&quot;\nend\"><pre class=\"notranslate\"><span class=\"pl-en\">create_enum</span> <span class=\"pl-s\">\"<span class=\"pl-cce\">\\\"</span>my.status<span class=\"pl-cce\">\\\"</span>\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">[</span><span class=\"pl-s\">\"complete\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-s\">\"in_progress\"</span><span class=\"pl-kos\">]</span>\n\n<span class=\"pl-en\">create_table</span> <span class=\"pl-s\">\"things\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">force</span>: <span class=\"pl-pds\">:cascade</span> <span class=\"pl-k\">do</span> |<span class=\"pl-s1\">t</span>|\n  <span class=\"pl-s1\">t</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">enum</span> <span class=\"pl-s\">\"status\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">default</span>: <span class=\"pl-s\">\"in_progress\"</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">null</span>: <span class=\"pl-c1\">false</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">enum_type</span>: <span class=\"pl-s\">\"<span class=\"pl-cce\">\\\"</span>my.status<span class=\"pl-cce\">\\\"</span>\"</span>\n<span class=\"pl-k\">end</span></pre></div>\n<p dir=\"auto\">This should resolve cases where quote identifiers are necessary, without impacting cases where they are not <em>strictly</em> necessary.</p>\n<h3 dir=\"auto\">Additional information</h3>\n\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/52049",
            "title": "[ActiveRecord] Support PG enums with names that require quote-ident",
            "date_modified": "2024-06-10T16:33:11.000Z",
            "date_published": "2024-06-07T19:03:28.000Z",
            "author": {
                "name": "smudge",
                "url": "https://github.com/smudge"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2575027?u=e7a9fe052c03fa59da09e064fdfacf2b1f627c2f&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This commit aims to clarify the types of arguments mentioned by the Association Callback documentation. In some cases, <code class=\"notranslate\">firm</code> arguments implied the object was a <code class=\"notranslate\">Firm</code>, but <code class=\"notranslate\">record</code> arguments did not imply any particular class.</p>\n<p dir=\"auto\">Similarly, the <code class=\"notranslate\">has_many</code> method documentation did not mention any of the Association Callback arguments (i.e. <code class=\"notranslate\">before_add</code>, <code class=\"notranslate\">after_add</code>, <code class=\"notranslate\">before_remove</code>, <code class=\"notranslate\">after_remove</code>). This commit includes those options in the list and links to the more thorough documentation under the Association Callbacks heading.</p>",
            "url": "https://github.com/rails/rails/pull/52047",
            "title": "Improve Active Record Association Callbacks docs [ci skip]",
            "date_modified": "2024-06-08T11:23:52.000Z",
            "date_published": "2024-06-07T17:51:03.000Z",
            "author": {
                "name": "seanpdoyle",
                "url": "https://github.com/seanpdoyle"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Based off the IRB tests: <a href=\"https://github.com/ruby/irb/blob/master/test/irb/helper.rb#L112-L120\">https://github.com/ruby/irb/blob/master/test/irb/helper.rb#L112-L120</a></p>\n<p dir=\"auto\">For example if you add this to your <code class=\"notranslate\">~/.irbrc</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"IRB.conf[:PROMPT_MODE] = :SIMPLE\"><pre class=\"notranslate\"><code class=\"notranslate\">IRB.conf[:PROMPT_MODE] = :SIMPLE\n</code></pre></div>\n<p dir=\"auto\">This will result in the following test failures:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"F\n\nFailure:\nFullStackConsoleTest#test_prompt_allows_changing_irb_name [test/application/console_test.rb:32]:\n&quot;foo(test)&gt;&quot; expected, but got:\n\n&gt;&gt; a = 1\na = 1\n=&gt; ...\n&gt;&gt; .\nExpected &quot;&gt;&gt; a = 1\\r\\r\\na = 1\\r\\n=&gt; ...\\r\\n&gt;&gt; &quot; to include &quot;foo(test)&gt;&quot;.\n\nbin/test test/application/console_test.rb:120\n\n.............F\n\nFailure:\nFullStackConsoleTest#test_test_console_prompt [test/application/console_test.rb:32]:\n&quot;app-template(test)&gt; &quot; expected, but got:\n\n112123&gt;&gt; 123\n=&gt; 123\n&gt;&gt; .\nExpected &quot;\\r\\n112123&gt;&gt; 123\\r\\r\\n=&gt; 123\\r\\n&gt;&gt; &quot; to include &quot;app-template(test)&gt; &quot;.\n\nbin/test test/application/console_test.rb:152\n\n...F\n\nFailure:\nFullStackConsoleTest#test_prompt_is_properly_set [test/application/console_test.rb:32]:\n&quot;app-template(test)&gt;&quot; expected, but got:\n\n&gt;&gt; a = 1\na = 1\n=&gt; ...\n&gt;&gt; .\nExpected &quot;&gt;&gt; a = 1\\r\\r\\na = 1\\r\\n=&gt; ...\\r\\n&gt;&gt; &quot; to include &quot;app-template(test)&gt;&quot;.\n\nbin/test test/application/console_test.rb:113\n\nF\n\nFailure:\nFullStackConsoleTest#test_production_console_prompt [test/application/console_test.rb:32]:\n&quot;app-template(prod)&gt;&quot; expected, but got:\n\n112123&gt;&gt; 123\n=&gt; 123\n&gt;&gt; .\nExpected &quot;\\r\\n112123&gt;&gt; 123\\r\\r\\n=&gt; 123\\r\\n&gt;&gt; &quot; to include &quot;app-template(prod)&gt;&quot;.\n\nbin/test test/application/console_test.rb:138\n\n...F\n\nFailure:\nFullStackConsoleTest#test_development_console_prompt [test/application/console_test.rb:32]:\n&quot;app-template(dev)&gt; &quot; expected, but got:\n\n112123&gt;&gt; 123\n=&gt; 123\n&gt;&gt; .\nExpected &quot;\\r\\n112123&gt;&gt; 123\\r\\r\\n=&gt; 123\\r\\n&gt;&gt; &quot; to include &quot;app-template(dev)&gt; &quot;.\n\nbin/test test/application/console_test.rb:145\n\nFinished in 137.655994s, 0.1743 runs/s, 1.8815 assertions/s.\n24 runs, 259 assertions, 5 failures, 0 errors, 0 skips\"><pre class=\"notranslate\"><code class=\"notranslate\">F\n\nFailure:\nFullStackConsoleTest#test_prompt_allows_changing_irb_name [test/application/console_test.rb:32]:\n\"foo(test)&gt;\" expected, but got:\n\n&gt;&gt; a = 1\na = 1\n=&gt; ...\n&gt;&gt; .\nExpected \"&gt;&gt; a = 1\\r\\r\\na = 1\\r\\n=&gt; ...\\r\\n&gt;&gt; \" to include \"foo(test)&gt;\".\n\nbin/test test/application/console_test.rb:120\n\n.............F\n\nFailure:\nFullStackConsoleTest#test_test_console_prompt [test/application/console_test.rb:32]:\n\"app-template(test)&gt; \" expected, but got:\n\n112123&gt;&gt; 123\n=&gt; 123\n&gt;&gt; .\nExpected \"\\r\\n112123&gt;&gt; 123\\r\\r\\n=&gt; 123\\r\\n&gt;&gt; \" to include \"app-template(test)&gt; \".\n\nbin/test test/application/console_test.rb:152\n\n...F\n\nFailure:\nFullStackConsoleTest#test_prompt_is_properly_set [test/application/console_test.rb:32]:\n\"app-template(test)&gt;\" expected, but got:\n\n&gt;&gt; a = 1\na = 1\n=&gt; ...\n&gt;&gt; .\nExpected \"&gt;&gt; a = 1\\r\\r\\na = 1\\r\\n=&gt; ...\\r\\n&gt;&gt; \" to include \"app-template(test)&gt;\".\n\nbin/test test/application/console_test.rb:113\n\nF\n\nFailure:\nFullStackConsoleTest#test_production_console_prompt [test/application/console_test.rb:32]:\n\"app-template(prod)&gt;\" expected, but got:\n\n112123&gt;&gt; 123\n=&gt; 123\n&gt;&gt; .\nExpected \"\\r\\n112123&gt;&gt; 123\\r\\r\\n=&gt; 123\\r\\n&gt;&gt; \" to include \"app-template(prod)&gt;\".\n\nbin/test test/application/console_test.rb:138\n\n...F\n\nFailure:\nFullStackConsoleTest#test_development_console_prompt [test/application/console_test.rb:32]:\n\"app-template(dev)&gt; \" expected, but got:\n\n112123&gt;&gt; 123\n=&gt; 123\n&gt;&gt; .\nExpected \"\\r\\n112123&gt;&gt; 123\\r\\r\\n=&gt; 123\\r\\n&gt;&gt; \" to include \"app-template(dev)&gt; \".\n\nbin/test test/application/console_test.rb:145\n\nFinished in 137.655994s, 0.1743 runs/s, 1.8815 assertions/s.\n24 runs, 259 assertions, 5 failures, 0 errors, 0 skips\n</code></pre></div>",
            "url": "https://github.com/rails/rails/pull/52045",
            "title": "Avoid running console tests against users IRB config",
            "date_modified": "2024-06-08T10:48:48.000Z",
            "date_published": "2024-06-07T11:21:08.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This PR replaces <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2335914495\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52026\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/52026/hovercard\" href=\"https://github.com/rails/rails/pull/52026\">#52026</a> by fixing the <code class=\"notranslate\">caller_locations</code>.</p>\n<p dir=\"auto\">Before:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"(called from include at /home/wojtek/.asdf/installs/ruby/3.3.2/lib/ruby/gems/3.3.0/gems/railties-7.2.0.beta2/lib/rails/console/methods.rb:6)\"><pre class=\"notranslate\"><code class=\"notranslate\">(called from include at /home/wojtek/.asdf/installs/ruby/3.3.2/lib/ruby/gems/3.3.0/gems/railties-7.2.0.beta2/lib/rails/console/methods.rb:6)\n</code></pre></div>\n<p dir=\"auto\">After:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"(called from block in &lt;class:Engine&gt; at /home/zzak/.rbenv/versions/3.4.0/lib/ruby/gems/3.4.0+0/bundler/gems/mission_control-jobs-7295d75ed735/lib/mission_control/jobs/engine.rb:73)\"><pre class=\"notranslate\"><code class=\"notranslate\">(called from block in &lt;class:Engine&gt; at /home/zzak/.rbenv/versions/3.4.0/lib/ruby/gems/3.4.0+0/bundler/gems/mission_control-jobs-7295d75ed735/lib/mission_control/jobs/engine.rb:73)\n</code></pre></div>",
            "url": "https://github.com/rails/rails/pull/52040",
            "title": "Rails::ConsoleMethods deprecation warning should point to the source",
            "date_modified": "2024-06-08T10:55:12.000Z",
            "date_published": "2024-06-07T03:00:10.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1034?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">I realised that <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2329736976\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51994\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/51994/hovercard\" href=\"https://github.com/rails/rails/pull/51994\">#51994</a> was producing a deprecation warning while running the Active Record tests (I actually thought we'd made that fail CI, but I must be mis-remembering).</p>\n<p dir=\"auto\">While we could just explicitly opt in to the new setting within our test suite(s), I wanted to see if we could save similar callers [i.e. those that aren't particularly concerned with time zones] from having to know about / act upon the change at all.</p>\n<p dir=\"auto\">Mostly that comes down to the fact that for <code class=\"notranslate\">Time#to_time</code>, if the value is already a local time, there's no difference in behaviour, and so no need to warn.</p>\n<p dir=\"auto\">Correspondingly, I've avoided calling <code class=\"notranslate\">to_time</code> in the handful of places we were using it internally: it's easy to do, and we know we don't care about the zone, so again won't be affected by the change.</p>\n<p dir=\"auto\">I'm hoping this will mean that people who do see the deprecation are likely to actually be affected [or at least be genuinely at risk of being affected] by the change, thus justifying the disruption.</p>\n<p dir=\"auto\">It's worth noting that I currently have <em>not</em> changed <code class=\"notranslate\">ActiveSupport::TimeWithZone#to_time</code>: even when its zone matches local (including the most common case where both are UTC), we will still warn. That felt like the right choice at the time, though I'm now less sure... <code class=\"notranslate\">3.days.ago.to_time</code> seems like a pretty reasonable and ordinary thing to be doing, and (in the absence of any zone-related configuration) I believe it should be perfectly safe. ü§î</p>",
            "url": "https://github.com/rails/rails/pull/52031",
            "title": "Don't emit to_time deprecations in known-safe contexts",
            "date_modified": "2024-06-12T23:48:24.000Z",
            "date_published": "2024-06-06T09:16:27.000Z",
            "author": {
                "name": "matthewd",
                "url": "https://github.com/matthewd"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/1034?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Alternate take on <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2332727777\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/52016\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/52016/hovercard\" href=\"https://github.com/rails/rails/pull/52016\">#52016</a></p>\n<p dir=\"auto\">Instead of a proxy object representing the always-instantaneous transaction state, here I'm going the other way, and giving the user an object that will always reference the <em>current</em> state of the then-current transaction at the time of creation.</p>\n<p dir=\"auto\">That means it will behave reasonably even if they do something thoroughly unreasonable, like add a callback after the transaction has already committed / rolled back.</p>\n<p dir=\"auto\">Definitely needs some tidying to be mergeable: at minimum I've lost the callback docs by moving them into a nodoc class -- and I haven't added tests that show the ways this differs from current HEAD behaviour.</p>",
            "url": "https://github.com/rails/rails/pull/52017",
            "title": "Allow users to add transaction callbacks after commit etc",
            "date_modified": "2024-06-04T19:21:41.000Z",
            "date_published": "2024-06-04T07:58:28.000Z",
            "author": {
                "name": "matthewd",
                "url": "https://github.com/matthewd"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/14981592?u=11406fb0121b15a93b3305388377a57b4d9c96f9&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Followup to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2326434456\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51959\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/51959/hovercard\" href=\"https://github.com/rails/rails/pull/51959\">#51959</a>. The test I added in that PR can be improved by actually checking that the runner does what the expected behaviour is.</p>\n<p dir=\"auto\">Since support for minitest/spec should not be implied (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2326434456\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51959\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/51959/hovercard?comment_id=1621385796&amp;comment_type=review_comment\" href=\"https://github.com/rails/rails/pull/51959#discussion_r1621385796\">#51959 (comment)</a>) I also slightly modified the test above</p>",
            "url": "https://github.com/rails/rails/pull/52002",
            "title": "Add a proper test for running tests by line with custom method",
            "date_modified": "2024-06-03T10:28:09.000Z",
            "date_published": "2024-06-03T10:28:04.000Z",
            "author": {
                "name": "Earlopain",
                "url": "https://github.com/Earlopain"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/2853450?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\"><span class=\"issue-keyword tooltipped tooltipped-se\" aria-label=\"This pull request closes issue #51995.\">Fixes</span> <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2329813988\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51995\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51995/hovercard\" href=\"https://github.com/rails/rails/issues/51995\">#51995</a></p>\n<p dir=\"auto\">Calling <code class=\"notranslate\">exists?</code> does not work with composite keys (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2179081656\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51295\" data-hovercard-type=\"issue\" data-hovercard-url=\"/rails/rails/issues/51295/hovercard\" href=\"https://github.com/rails/rails/issues/51295\">#51295</a>) which is used internally for <code class=\"notranslate\">include?</code> here it zips the primary key values into a hash with the primary key keys, a format that is supported by <code class=\"notranslate\">exists?</code> so it does not raise and returns the expected result.</p>",
            "url": "https://github.com/rails/rails/pull/51996",
            "title": "Fix `include?` on composite key relations",
            "date_modified": "2024-06-11T06:27:57.000Z",
            "date_published": "2024-06-02T18:54:30.000Z",
            "author": {
                "name": "jackozi",
                "url": "https://github.com/jackozi"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/39144575?u=27bc8b51723fcd8f9a2de237a4082ecb370f0a59&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">Following up <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/rails/rails/commit/317465a4a8f8c0ebaf9534921350c4540584c03c/hovercard\" href=\"https://github.com/rails/rails/commit/317465a4a8f8c0ebaf9534921350c4540584c03c\"><tt>317465a</tt></a>.</p>",
            "url": "https://github.com/rails/rails/pull/51993",
            "title": "Fix test title mismatch",
            "date_modified": "2024-06-02T01:59:18.000Z",
            "date_published": "2024-06-02T01:59:14.000Z",
            "author": {
                "name": "wonda-tea-coffee",
                "url": "https://github.com/wonda-tea-coffee"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/277819?u=f88292414deeecfd67fee18ae9d7297bcc001138&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">This is to mitigate errors like:<br>\n<a href=\"https://buildkite.com/rails/rails/builds/107403#018f9917-fd63-4701-9620-f9caf2caaf2d/1163-1195\" rel=\"nofollow\">https://buildkite.com/rails/rails/builds/107403#018f9917-fd63-4701-9620-f9caf2caaf2d/1163-1195</a></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ERROR [karma-server]:\nError: [init({...}})] The environment you requested was unavailable.\"><pre class=\"notranslate\"><code class=\"notranslate\">ERROR [karma-server]:\nError: [init({...}})] The environment you requested was unavailable.\n</code></pre></div>\n<p dir=\"auto\">We can make buildkite-config retry this status and soft-fail on exit 3.</p>\n<p dir=\"auto\">For example,<br>\n<a href=\"https://buildkite.com/changelog/56-command-steps-can-now-be-made-to-soft-fail\" rel=\"nofollow\">https://buildkite.com/changelog/56-command-steps-can-now-be-made-to-soft-fail</a></p>\n<p dir=\"auto\">I <em>think</em> we can combine this with a retry policy on the exit status:<br>\n<a href=\"https://buildkite.com/docs/pipelines/command-step#retry-attributes-automatic-retry-attributes\" rel=\"nofollow\">https://buildkite.com/docs/pipelines/command-step#retry-attributes-automatic-retry-attributes</a></p>\n<p dir=\"auto\">/cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a></p>",
            "url": "https://github.com/rails/rails/pull/51990",
            "title": "Exit status 3 when Action Cable integration tests fail due to Saucelabs error",
            "date_modified": "2024-06-01T10:45:18.000Z",
            "date_published": "2024-06-01T10:44:54.000Z",
            "author": {
                "name": "zzak",
                "url": "https://github.com/zzak"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5657035?u=48dc5950e98b199e1ed1e8c5c3f1e4bfd2b39691&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><p dir=\"auto\">I saw a few times <code class=\"notranslate\">.exists?</code>(instead of <code class=\"notranslate\">.any?</code>) being used on loaded relations.<br>\nSeems like there is no reason why we can't improve that method?</p>\n<p dir=\"auto\">This is a reworked <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2327575420\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51966\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/51966/hovercard\" href=\"https://github.com/rails/rails/pull/51966\">#51966</a>.</p>\n<p dir=\"auto\">cc <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/matthewd/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/matthewd\">@matthewd</a></p>",
            "url": "https://github.com/rails/rails/pull/51987",
            "title": "Optimize `ActiveRecord::Relation#exists?` with no conditions for loaded relations",
            "date_modified": "2024-06-12T18:44:33.000Z",
            "date_published": "2024-06-01T09:24:29.000Z",
            "author": {
                "name": "fatkodima",
                "url": "https://github.com/fatkodima"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/44903779?v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">Sometimes when call stored attribute, it requires specific naming semantics. For example when you save some data from external source. This Pull Request adds mapping for store attribute keys</p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">Proposed changes</p>\n<div class=\"highlight highlight-source-ruby notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"class User &lt; ApplicationRecord\n  store_accessor :settings, :language, { country: :country_of_residence }\nend\n\nuser = User.new(country: &quot;US&quot;)\nuser.country # =&gt; &quot;US&quot;\nuser.settings[&quot;country_of_residence&quot;] # =&gt; &quot;US&quot;\nuser.settings[&quot;country_of_residence&quot;] = &quot;CA&quot;\nuser.country # =&gt; &quot;CA&quot;\nuser.country = &quot;NL&quot;\nuser.country # =&gt; &quot;NL&quot;\nuser.settings[&quot;country_of_residence&quot;] # =&gt; &quot;NL&quot;\"><pre class=\"notranslate\"><span class=\"pl-k\">class</span> <span class=\"pl-v\">User</span> &lt; <span class=\"pl-v\">ApplicationRecord</span>\n  <span class=\"pl-en\">store_accessor</span> <span class=\"pl-pds\">:settings</span><span class=\"pl-kos\">,</span> <span class=\"pl-pds\">:language</span><span class=\"pl-kos\">,</span> <span class=\"pl-kos\">{</span> <span class=\"pl-pds\">country</span>: <span class=\"pl-pds\">:country_of_residence</span> <span class=\"pl-kos\">}</span>\n<span class=\"pl-k\">end</span>\n\n<span class=\"pl-s1\">user</span> <span class=\"pl-c1\">=</span> <span class=\"pl-v\">User</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">new</span><span class=\"pl-kos\">(</span><span class=\"pl-pds\">country</span>: <span class=\"pl-s\">\"US\"</span><span class=\"pl-kos\">)</span>\n<span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">country</span> <span class=\"pl-c\"># =&gt; \"US\"</span>\n<span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">settings</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"country_of_residence\"</span><span class=\"pl-kos\">]</span> <span class=\"pl-c\"># =&gt; \"US\"</span>\n<span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">settings</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"country_of_residence\"</span><span class=\"pl-kos\">]</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"CA\"</span>\n<span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">country</span> <span class=\"pl-c\"># =&gt; \"CA\"</span>\n<span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">country</span> <span class=\"pl-c1\">=</span> <span class=\"pl-s\">\"NL\"</span>\n<span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">country</span> <span class=\"pl-c\"># =&gt; \"NL\"</span>\n<span class=\"pl-s1\">user</span><span class=\"pl-kos\">.</span><span class=\"pl-en\">settings</span><span class=\"pl-kos\">[</span><span class=\"pl-s\">\"country_of_residence\"</span><span class=\"pl-kos\">]</span> <span class=\"pl-c\"># =&gt; \"NL\"</span></pre></div>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">This was intended as non-breaking change</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51981",
            "title": "Add mapping to stored attributes",
            "date_modified": "2024-06-03T22:49:41.000Z",
            "date_published": "2024-06-01T00:48:08.000Z",
            "author": {
                "name": "mechnicov",
                "url": "https://github.com/mechnicov"
            }
        },
        {
            "content_html": "<img src=\"https://avatars.githubusercontent.com/u/5077225?u=e9f968c9eb790ee7734442f6b7998155400ad1d8&v=4\" width=\"64\" height=\"64\" alt=\"\"/><br/><h3 dir=\"auto\">Motivation / Background</h3>\n<p dir=\"auto\">As detailed in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2044839875\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/50370\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/50370/hovercard\" href=\"https://github.com/rails/rails/pull/50370\">#50370</a>, the current use of SQLite's <code class=\"notranslate\">busy_timeout</code> functionality leads to notable increases in tail latency as well as occasional <code class=\"notranslate\">SQLite3::BusyException: database is locked</code> errors since it does not release the GVL while waiting to retry acquiring the SQLite database lock. Version 2.0 of the <code class=\"notranslate\">sqlite3</code> gem introduces a new <a href=\"https://github.com/sparklemotion/sqlite3-ruby/pull/456\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/sparklemotion/sqlite3-ruby/pull/456/hovercard\"><code class=\"notranslate\">SQLite3::Database#busy_handler_timeout=</code> method</a>, which provides a non-GVL-blocking, fair retry interval busy handler implementation.</p>\n<p dir=\"auto\">cc: <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/flavorjones/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/flavorjones\">@flavorjones</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/tenderlove/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tenderlove\">@tenderlove</a> <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/byroot/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/byroot\">@byroot</a></p>\n<h3 dir=\"auto\">Detail</h3>\n<p dir=\"auto\">This PR points the <code class=\"notranslate\">timeout</code> option the <code class=\"notranslate\">database.yml</code> config file at this new busy handler implementation. In order to ensure that this new method is present, I have also opened <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2326400791\" data-permission-text=\"Title is private\" data-url=\"https://github.com/rails/rails/issues/51957\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/rails/rails/pull/51957/hovercard\" href=\"https://github.com/rails/rails/pull/51957\">#51957</a> so that Rails 8 defaults to version &gt;= 2.0 for the <code class=\"notranslate\">sqlite3</code> gem.</p>\n<h3 dir=\"auto\">Additional information</h3>\n<p dir=\"auto\">As detailed in <a href=\"https://fractaledmind.github.io/2024/04/15/sqlite-on-rails-the-how-and-why-of-optimal-performance/\" rel=\"nofollow\">my deep dive</a> on this topic, having such a busy handler is essential for running production-grade Rails application using SQLite. In my benchmarks, ensuring that the busy handler doesn't hold the GVL brought p95 latency down from &gt;5s to 0.19s. Then, ensuring that the retry interval was fair for both \"old\" and \"new\" queries brought p99.99 latency down from &gt;1.5s to 0.5s.</p>\n<h3 dir=\"auto\">Checklist</h3>\n<p dir=\"auto\">Before submitting the PR make sure the following are checked:</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> This Pull Request is related to one change. Unrelated changes should be opened in separate PRs.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Commit message has a detailed description of what changed and why. If this PR fixes a related issue include it in the commit message. Ex: <code class=\"notranslate\">[Fix #issue-number]</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Tests are added or updated if you fix a bug or add a feature.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> CHANGELOG files are updated for the changed libraries if there is a behavior change or additional feature. Minor bug fixes and documentation changes should not be included.</li>\n</ul>",
            "url": "https://github.com/rails/rails/pull/51958",
            "title": "SQLite non-GVL-blocking, fair retry interval busy handler",
            "date_modified": "2024-06-04T08:09:25.000Z",
            "date_published": "2024-05-30T19:39:08.000Z",
            "author": {
                "name": "fractaledmind",
                "url": "https://github.com/fractaledmind"
            }
        }
    ]
}